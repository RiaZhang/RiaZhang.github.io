"use strict";var MAX_TEXT_DIVS_TO_RENDER=100000;var NonWhitespaceRegexp=/\S/;function isAllWhitespace(a){return !NonWhitespaceRegexp.test(a)}var TextLayerBuilder=(function TextLayerBuilderClosure(){function f(j){this.textLayerDiv=j.textLayerDiv;this.renderingDone=false;this.divContentDone=false;this.pageIdx=j.pageIndex;this.pageNumber=this.pageIdx+1;this.matches=[];this.viewport=j.viewport;this.textDivs=[];this.findController=j.findController||null}f.prototype={_finishRendering:function d(){this.renderingDone=true;var j=document.createEvent("CustomEvent");j.initCustomEvent("textlayerrendered",true,true,{pageNumber:this.pageNumber});this.textLayerDiv.dispatchEvent(j)},renderLayer:function i(){var q=document.createDocumentFragment();var s=this.textDivs;var j=s.length;var l=document.createElement("canvas");var w=l.getContext("2d");if(j>MAX_TEXT_DIVS_TO_RENDER){this._finishRendering();return}var n;var t;for(var p=0;p<j;p++){var o=s[p];if(o.dataset.isWhitespace!==undefined){continue}var x=o.style.fontSize;var r=o.style.fontFamily;if(x!==n||r!==t){w.font=x+" "+r;n=x;t=r}var k=w.measureText(o.textContent).width;if(k>0){q.appendChild(o);var m;if(o.dataset.canvasWidth!==undefined){var u=o.dataset.canvasWidth/k;m="scaleX("+u+")"}else{m=""}var v=o.dataset.angle;if(v){m="rotate("+v+"deg) "+m}if(m){CustomStyle.setProp("transform",o,m)}}}this.textLayerDiv.appendChild(q);this._finishRendering();this.updateMatches()},render:function e(k){if(!this.divContentDone||this.renderingDone){return}if(this.renderTimer){clearTimeout(this.renderTimer);this.renderTimer=null}if(!k){this.renderLayer()}else{var j=this;this.renderTimer=setTimeout(function(){j.renderLayer();j.renderTimer=null},k)}},appendText:function b(q,s){var j=s[q.fontName];var n=document.createElement("div");this.textDivs.push(n);if(isAllWhitespace(q.str)){n.dataset.isWhitespace=true;return}var o=PDFJS.Util.transform(this.viewport.transform,q.transform);var m=Math.atan2(o[1],o[0]);if(j.vertical){m+=Math.PI/2}var k=Math.sqrt((o[2]*o[2])+(o[3]*o[3]));var r=k;if(j.ascent){r=j.ascent*r}else{if(j.descent){r=(1+j.descent)*r}}var l;var p;if(m===0){l=o[4];p=o[5]-r}else{l=o[4]+(r*Math.sin(m));p=o[5]-(r*Math.cos(m))}n.style.left=l+"px";n.style.top=p+"px";n.style.fontSize=k+"px";n.style.fontFamily=j.fontFamily;n.textContent=q.str;if(PDFJS.pdfBug){n.dataset.fontName=q.fontName}if(m!==0){n.dataset.angle=m*(180/Math.PI)}if(n.textContent.length>1){if(j.vertical){n.dataset.canvasWidth=q.height*this.viewport.scale}else{n.dataset.canvasWidth=q.width*this.viewport.scale}}},setTextContent:function g(m){this.textContent=m;var l=m.items;for(var k=0,j=l.length;k<j;k++){this.appendText(l[k],m.styles)}this.divContentDone=true},convertMatches:function h(q){var o=0;var s=0;var j=this.textContent.items;var n=j.length-1;var l=(this.findController===null?0:this.findController.state.query.length);var t=[];for(var k=0,r=q.length;k<r;k++){var u=q[k];while(o!==n&&u>=(s+j[o].str.length)){s+=j[o].str.length;o++}if(o===j.length){console.error("Could not find a matching mapping")}var p={begin:{divIdx:o,offset:u-s}};u+=l;while(o!==n&&u>(s+j[o].str.length)){s+=j[o].str.length;o++}p.end={divIdx:o,offset:u-s};t.push(p)}return t},renderMatches:function a(j){if(j.length===0){return}var y=this.textContent.items;var t=this.textDivs;var l=null;var k=this.pageIdx;var v=(this.findController===null?false:(k===this.findController.selected.pageIdx));var z=(this.findController===null?-1:this.findController.selected.matchIdx);var A=(this.findController===null?false:this.findController.state.highlightAll);var D={divIdx:-1,offset:undefined};function C(F,E){var G=F.divIdx;t[G].textContent="";n(G,0,F.offset,E)}function n(K,F,E,H){var L=t[K];var J=y[K].str.substring(F,E);var I=document.createTextNode(J);if(H){var G=document.createElement("span");G.className=H;G.appendChild(I);L.appendChild(G);return}L.appendChild(I)}var w=z,u=w+1;if(A){w=0;u=j.length}else{if(!v){return}}for(var x=w;x<u;x++){var o=j[x];var B=o.begin;var m=o.end;var q=(v&&x===z);var s=(q?" selected":"");if(this.findController){this.findController.updateMatchPosition(k,x,t,B.divIdx,m.divIdx)}if(!l||B.divIdx!==l.divIdx){if(l!==null){n(l.divIdx,l.offset,D.offset)}C(B)}else{n(l.divIdx,l.offset,B.offset)}if(B.divIdx===m.divIdx){n(B.divIdx,B.offset,m.offset,"highlight"+s)}else{n(B.divIdx,B.offset,D.offset,"highlight begin"+s);for(var r=B.divIdx+1,p=m.divIdx;r<p;r++){t[r].className="highlight middle"+s}C(m,"highlight end"+s)}l=m}if(l){n(l.divIdx,l.offset,D.offset)}},updateMatches:function c(){if(!this.renderingDone){return}var q=this.matches;var t=this.textDivs;var k=this.textContent.items;var u=-1;for(var p=0,s=q.length;p<s;p++){var r=q[p];var m=Math.max(u,r.begin.divIdx);for(var l=m,o=r.end.divIdx;l<=o;l++){var j=t[l];j.textContent=k[l].str;j.className=""}u=r.end.divIdx+1}if(this.findController===null||!this.findController.active){return}this.matches=this.convertMatches(this.findController===null?[]:(this.findController.pageMatches[this.pageIdx]||[]));this.renderMatches(this.matches)}};return f})();function DefaultTextLayerFactory(){}DefaultTextLayerFactory.prototype={createTextLayerBuilder:function(c,b,a){return new TextLayerBuilder({textLayerDiv:c,pageIndex:b,viewport:a})}};