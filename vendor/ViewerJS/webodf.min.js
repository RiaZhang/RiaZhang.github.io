var webodf_version="0.5.8";function Runtime(){}Runtime.prototype.getVariable=function(a){};Runtime.prototype.toJson=function(a){};Runtime.prototype.fromJson=function(a){};Runtime.prototype.byteArrayFromString=function(b,a){};Runtime.prototype.byteArrayToString=function(b,a){};Runtime.prototype.read=function(e,d,f,a){};Runtime.prototype.readFile=function(b,a,d){};Runtime.prototype.readFileSync=function(b,a){};Runtime.prototype.loadXML=function(b,a){};Runtime.prototype.writeFile=function(b,a,d){};Runtime.prototype.deleteFile=function(b,a){};Runtime.prototype.log=function(b,a){};Runtime.prototype.setTimeout=function(b,a){};Runtime.prototype.clearTimeout=function(a){};Runtime.prototype.libraryPaths=function(){};Runtime.prototype.currentDirectory=function(){};Runtime.prototype.setCurrentDirectory=function(a){};Runtime.prototype.type=function(){};Runtime.prototype.getDOMImplementation=function(){};Runtime.prototype.parseXML=function(a){};Runtime.prototype.exit=function(a){};Runtime.prototype.getWindow=function(){};Runtime.prototype.requestAnimationFrame=function(a){};Runtime.prototype.cancelAnimationFrame=function(a){};Runtime.prototype.assert=function(b,a){};var IS_COMPILED_CODE=!0;Runtime.byteArrayToString=function(e,d){function i(f){var k="",g,j=f.length;for(g=0;g<j;g+=1){k+=String.fromCharCode(f[g]&255)}return k}function a(s){var p="",f,g=s.length,n=[],k,t,o,j;for(f=3<=g&&239===s[0]&&187===s[1]&&191===s[2]?3:0;f<g;f+=1){k=s[f],128>k?n.push(k):(f+=1,t=s[f],194<=k&&224>k?n.push((k&31)<<6|t&63):(f+=1,o=s[f],224<=k&&240>k?n.push((k&15)<<12|(t&63)<<6|o&63):(f+=1,j=s[f],240<=k&&245>k&&(k=(k&7)<<18|(t&63)<<12|(o&63)<<6|j&63,k-=65536,n.push((k>>10)+55296,(k&1023)+56320))))),1000<=n.length&&(p+=String.fromCharCode.apply(null,n),n.length=0)}return p+String.fromCharCode.apply(null,n)}var h;"utf8"===d?h=a(e):("binary"!==d&&this.log("Unsupported encoding: "+d),h=i(e));return h};Runtime.getVariable=function(g){try{return eval(g)}catch(k){}};Runtime.toJson=function(a){return JSON.stringify(a)};Runtime.fromJson=function(a){return JSON.parse(a)};Runtime.getFunctionName=function(a){return void 0===a.name?(a=/function\s+(\w+)/.exec(a))&&a[1]:a.name};Runtime.assert=function(b,a){if(!b){throw this.log("alert","ASSERTION FAILED:\n"+a),Error(a)}};function BrowserRuntime(){function h(c){var k=c.length,g,f,n=0;for(g=0;g<k;g+=1){f=c.charCodeAt(g),n+=1+(128<f)+(2048<f),55040<f&&57344>f&&(n+=1,g+=1)}return n}function d(f,n,k){var g=f.length,o,c;n=new Uint8Array(new ArrayBuffer(n));k?(n[0]=239,n[1]=187,n[2]=191,c=3):c=0;for(k=0;k<g;k+=1){o=f.charCodeAt(k),128>o?(n[c]=o,c+=1):2048>o?(n[c]=192|o>>>6,n[c+1]=128|o&63,c+=2):55040>=o||57344<=o?(n[c]=224|o>>>12&15,n[c+1]=128|o>>>6&63,n[c+2]=128|o&63,c+=3):(k+=1,o=(o-55296<<10|f.charCodeAt(k)-56320)+65536,n[c]=240|o>>>18&7,n[c+1]=128|o>>>12&63,n[c+2]=128|o>>>6&63,n[c+3]=128|o&63,c+=4)}return n}function m(c){var k=c.length,g=new Uint8Array(new ArrayBuffer(k)),f;for(f=0;f<k;f+=1){g[f]=c.charCodeAt(f)&255}return g}function a(c,g){var f;void 0!==g?f=c:g=c;console.log(g);e.enableAlerts&&"alert"===f&&alert(g)}function i(c,k,g){if(0!==g.status||g.responseText){if(200===g.status||0===g.status){if(g.response&&"string"!==typeof g.response){"binary"===k?(g=g.response,g=new Uint8Array(g)):g=String(g.response)}else{if("binary"===k){if(null!==g.responseBody&&"undefined"!==String(typeof VBArray)){g=(new VBArray(g.responseBody)).toArray();var f=g.length;k=new Uint8Array(new ArrayBuffer(f));for(c=0;c<f;c+=1){k[c]=g[c]}g=k}else{(c=g.getResponseHeader("Content-Length"))&&(c=parseInt(c,10));if(c&&c!==g.responseText.length){f:{f=g.responseText;k=!1;var n=h(f);if("number"===typeof c){if(c!==n&&c!==n+3){f=void 0;break f}k=n+3===c;n=c}f=d(f,n,k)}}void 0===f&&(f=m(g.responseText));g=f}}else{g=g.responseText}}g={err:null,data:g}}else{g={err:g.responseText||g.statusText,data:null}}}else{g={err:"File "+c+" is empty.",data:null}}return g}function l(c,k,g){var f=new XMLHttpRequest;f.open("GET",c,g);f.overrideMimeType&&("binary"!==k?f.overrideMimeType("text/plain; charset="+k):f.overrideMimeType("text/plain; charset=x-user-defined"));return f}function j(c,k,g){var f=l(c,k,!0);f.onreadystatechange=function(){var b;4===f.readyState&&(b=i(c,k,f),g(b.err,b.data))};try{f.send(null)}catch(n){g(n.message,null)}}var e=this;this.byteArrayFromString=function(c,g){var f;"utf8"===g?f=d(c,h(c),!1):("binary"!==g&&e.log("unknown encoding: "+g),f=m(c));return f};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=j;this.read=function(c,k,g,f){j(c,"binary",function(o,b){var n=null;if(b){if("string"===typeof b){throw"This should not happen."}n=b.subarray(k,k+g)}f(o,n)})};this.readFileSync=function(c,k){var g=l(c,k,!1),f;try{g.send(null);f=i(c,k,g);if(f.err){throw f.err}if(null===f.data){throw"No data read from "+c+"."}}catch(n){throw n}return f.data};this.writeFile=function(f,n,k){var g=new XMLHttpRequest,o;g.open("PUT",f,!0);g.onreadystatechange=function(){4===g.readyState&&(0!==g.status||g.responseText?200<=g.status&&300>g.status||0===g.status?k(null):k("Status "+String(g.status)+": "+g.responseText||g.statusText):k("File "+f+" is empty."))};o=n.buffer&&!g.sendAsBinary?n.buffer:e.byteArrayToString(n,"binary");try{g.sendAsBinary?g.sendAsBinary(o):g.send(o)}catch(c){e.log("HUH? "+c+" "+n),k(c.message)}};this.deleteFile=function(c,g){var f=new XMLHttpRequest;f.open("DELETE",c,!0);f.onreadystatechange=function(){4===f.readyState&&(200>f.status&&300<=f.status?g(f.responseText):g(null))};f.send(null)};this.loadXML=function(c,k){var g=new XMLHttpRequest;g.open("GET",c,!0);g.overrideMimeType&&g.overrideMimeType("text/xml");g.onreadystatechange=function(){4===g.readyState&&(0!==g.status||g.responseText?200===g.status||0===g.status?k(null,g.responseXML):k(g.responseText,null):k("File "+c+" is empty.",null))};try{g.send(null)}catch(f){k(f.message,null)}};this.log=a;this.enableAlerts=!0;this.assert=Runtime.assert;this.setTimeout=function(c,f){return setTimeout(function(){c()},f)};this.clearTimeout=function(c){clearTimeout(c)};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(){};this.currentDirectory=function(){return""};this.type=function(){return"BrowserRuntime"};this.getDOMImplementation=function(){return window.document.implementation};this.parseXML=function(c){return(new DOMParser).parseFromString(c,"text/xml")};this.exit=function(b){a("Calling exit with code "+String(b)+", but exit() is not implemented.")};this.getWindow=function(){return window};this.requestAnimationFrame=function(c){var g=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,f=0;if(g){g.bind(window),f=g(c)}else{return setTimeout(c,15)}return f};this.cancelAnimationFrame=function(c){var f=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;f?(f.bind(window),f(c)):clearTimeout(c)}}function NodeJSRuntime(){function h(c){var k=c.length,g,f=new Uint8Array(new ArrayBuffer(k));for(g=0;g<k;g+=1){f[g]=c[g]}return f}function d(k,g,f){function b(n,c){if(n){return f(n,null)}if(!c){return f("No data for "+k+".",null)}if("string"===typeof c){return f(n,c)}f(n,h(c))}k=i.resolve(l,k);"binary"!==g?a.readFile(k,g,b):a.readFile(k,null,b)}var m=this,a=require("fs"),i=require("path"),l="",j,e;this.byteArrayFromString=function(f,n){var k=new Buffer(f,n),g,o=k.length,c=new Uint8Array(new ArrayBuffer(o));for(g=0;g<o;g+=1){c[g]=k[g]}return c};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=d;this.loadXML=function(c,f){d(c,"utf-8",function(g,b){if(g){return f(g,null)}if(!b){return f("No data for "+c+".",null)}f(null,m.parseXML(b))})};this.writeFile=function(g,f,b){f=new Buffer(f);g=i.resolve(l,g);a.writeFile(g,f,"binary",function(c){b(c||null)})};this.deleteFile=function(f,b){f=i.resolve(l,f);a.unlink(f,b)};this.read=function(k,g,f,b){k=i.resolve(l,k);a.open(k,"r+",666,function(o,c){if(o){b(o,null)}else{var n=new Buffer(f);a.read(c,n,0,f,g,function(p){a.close(c);b(p,h(n))})}})};this.readFileSync=function(g,f){var b;b=a.readFileSync(g,"binary"===f?null:f);if(null===b){throw"File "+g+" could not be read."}"binary"===f&&(b=h(b));return b};this.log=function(c,g){var f;void 0!==g?f=c:g=c;"alert"===f&&process.stderr.write("\n!!!!! ALERT !!!!!\n");process.stderr.write(g+"\n");"alert"===f&&process.stderr.write("!!!!! ALERT !!!!!\n")};this.assert=Runtime.assert;this.setTimeout=function(c,f){return setTimeout(function(){c()},f)};this.clearTimeout=function(c){clearTimeout(c)};this.libraryPaths=function(){return[__dirname]};this.setCurrentDirectory=function(c){l=c};this.currentDirectory=function(){return l};this.type=function(){return"NodeJSRuntime"};this.getDOMImplementation=function(){return e};this.parseXML=function(c){return j.parseFromString(c,"text/xml")};this.exit=process.exit;this.getWindow=function(){return null};this.requestAnimationFrame=function(c){return setTimeout(c,15)};this.cancelAnimationFrame=function(c){clearTimeout(c)};j=new (require("xmldom").DOMParser);e=m.parseXML("<a/>").implementation}function RhinoRuntime(){var e=this,d={},j=d.javax.xml.parsers.DocumentBuilderFactory.newInstance(),a,h,i="";j.setValidating(!1);j.setNamespaceAware(!0);j.setExpandEntityReferences(!1);j.setSchema(null);h=d.org.xml.sax.EntityResolver({resolveEntity:function(g,l){var k=new d.java.io.FileReader(l);return new d.org.xml.sax.InputSource(k)}});a=j.newDocumentBuilder();a.setEntityResolver(h);this.byteArrayFromString=function(g,o){var m,n=g.length,k=new Uint8Array(new ArrayBuffer(n));for(m=0;m<n;m+=1){k[m]=g.charCodeAt(m)&255}return k};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.loadXML=function(o,g){var m=new d.java.io.File(o),k=null;try{k=a.parse(m)}catch(b){return print(b),g(b,null)}g(null,k)};this.readFile=function(g,o,m){i&&(g=i+"/"+g);var n=new d.java.io.File(g),k="binary"===o?"latin1":o;n.isFile()?((g=readFile(g,k))&&"binary"===o&&(g=e.byteArrayFromString(g,"binary")),m(null,g)):m(g+" is not a file.",null)};this.writeFile=function(g,o,m){i&&(g=i+"/"+g);g=new d.java.io.FileOutputStream(g);var n,k=o.length;for(n=0;n<k;n+=1){g.write(o[n])}g.close();m(null)};this.deleteFile=function(g,m){i&&(g=i+"/"+g);var k=new d.java.io.File(g),l=g+Math.random(),l=new d.java.io.File(l);k.rename(l)?(l.deleteOnExit(),m(null)):m("Could not delete "+g)};this.read=function(g,p,n,o){i&&(g=i+"/"+g);var m;m=g;var k="binary";(new d.java.io.File(m)).isFile()?("binary"===k&&(k="latin1"),m=readFile(m,k)):m=null;m?o(null,this.byteArrayFromString(m.substring(p,p+n),"binary")):o("Cannot read "+g,null)};this.readFileSync=function(g,l){if(!l){return""}var k=readFile(g,l);if(null===k){throw"File could not be read."}return k};this.log=function(g,l){var k;void 0!==l?k=g:l=g;"alert"===k&&print("\n!!!!! ALERT !!!!!");print(l);"alert"===k&&print("!!!!! ALERT !!!!!")};this.assert=Runtime.assert;this.setTimeout=function(c){c();return 0};this.clearTimeout=function(){};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(c){i=c};this.currentDirectory=function(){return i};this.type=function(){return"RhinoRuntime"};this.getDOMImplementation=function(){return a.getDOMImplementation()};this.parseXML=function(b){b=new d.java.io.StringReader(b);b=new d.org.xml.sax.InputSource(b);return a.parse(b)};this.exit=quit;this.getWindow=function(){return null};this.requestAnimationFrame=function(c){c();return 0};this.cancelAnimationFrame=function(){}}Runtime.create=function(){return"undefined"!==String(typeof window)?new BrowserRuntime:"undefined"!==String(typeof require)?new NodeJSRuntime:new RhinoRuntime};var runtime=Runtime.create(),core={},gui={},xmldom={},odf={},ops={},webodf={};(function(){webodf.Version="undefined"!==String(typeof webodf_version)?webodf_version:"From Source"})();(function(){function g(b,c,e){var l=b+"/manifest.json",a,d;runtime.log("Loading manifest: "+l);try{a=runtime.readFileSync(l,"utf-8")}catch(m){if(e){runtime.log("No loadable manifest found.")}else{throw console.log(String(m)),m}return}e=JSON.parse(a);for(d in e){e.hasOwnProperty(d)&&(c[d]={dir:b,deps:e[d]})}}function k(b,c,e){function l(h){if(!m[h]&&!e(h)){if(d[h]){throw"Circular dependency detected for "+h+"."}d[h]=!0;if(!c[h]){throw"Missing dependency information for class "+h+"."}var b=c[h],f=b.deps,n,r=f.length;for(n=0;n<r;n+=1){l(f[n])}d[h]=!1;m[h]=!0;a.push(b.dir+"/"+h.replace(".","/")+".js")}}var a=[],d={},m={};b.forEach(l);return a}function c(b,c){return c+("\n//# sourceURL="+b)}function b(b){var f,e;for(f=0;f<b.length;f+=1){e=runtime.readFileSync(b[f],"utf-8"),e=c(b[f],e),eval(e)}}function f(b){b=b.split(".");var c,e=p,l=b.length;for(c=0;c<l;c+=1){if(!e.hasOwnProperty(b[c])){return !1}e=e[b[c]]}return !0}var n,p={core:core,gui:gui,xmldom:xmldom,odf:odf,ops:ops};runtime.loadClasses=function(c,p){if(IS_COMPILED_CODE||0===c.length){return p&&p()}var e;if(!(e=n)){e=[];var l=runtime.libraryPaths(),a;runtime.currentDirectory()&&-1===l.indexOf(runtime.currentDirectory())&&g(runtime.currentDirectory(),e,!0);for(a=0;a<l.length;a+=1){g(l[a],e)}}n=e;c=k(c,n,f);if(0===c.length){return p&&p()}if("BrowserRuntime"===runtime.type()&&p){e=c;l=document.currentScript||document.documentElement.lastChild;a=document.createDocumentFragment();var d,m;for(m=0;m<e.length;m+=1){d=document.createElement("script"),d.type="text/javascript",d.charset="utf-8",d.async=!1,d.setAttribute("src",e[m]),a.appendChild(d)}p&&(d.onload=p);l.parentNode.insertBefore(a,l)}else{b(c),p&&p()}};runtime.loadClass=function(b,c){runtime.loadClasses([b],c)}})();(function(){var a=function(b){return b};runtime.getTranslator=function(){return a};runtime.setTranslator=function(b){a=b};runtime.tr=function(b){var d=a(b);return d&&"string"===String(typeof d)?d:b}})();(function(g){function k(c){if(c.length){var b=c[0];runtime.readFile(b,"utf8",function(f,n){function g(){var b;(b=eval(k))&&runtime.exit(b)}var r="",r=b.lastIndexOf("/"),k=n,r=-1!==r?b.substring(0,r):".";runtime.setCurrentDirectory(r);f?(runtime.log(f),runtime.exit(1)):null===k?(runtime.log("No code found for "+b),runtime.exit(1)):g.apply(null,c)})}}g=g?Array.prototype.slice.call(g):[];"NodeJSRuntime"===runtime.type()?k(process.argv.slice(2)):"RhinoRuntime"===runtime.type()?k(g):k(g.slice(1))})("undefined"!==String(typeof arguments)&&arguments);(function(){core.Async=function(){return{forEach:function(e,d,l){function a(c){i!==j&&(c?(i=j,l(c)):(i+=1,i===j&&l(null)))}var h,j=e.length,i=0;for(h=0;h<j;h+=1){d(e[h],a)}},destroyAll:function(b,a){function d(c,e){if(e){a(e)}else{if(c<b.length){b[c](function(g){d(c+1,g)})}else{a()}}}d(0,void 0)}}}()})();function makeBase64(){function H(c){var f,b=c.length,e=new Uint8Array(new ArrayBuffer(b));for(f=0;f<b;f+=1){e[f]=c.charCodeAt(f)&255}return e}function F(f){var k,e="",g,c=f.length-2;for(g=0;g<c;g+=3){k=f[g]<<16|f[g+1]<<8|f[g+2],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[k>>>18],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[k>>>12&63],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[k>>>6&63],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[k&63]}g===c+1?(k=f[g]<<4,e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[k>>>6],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[k&63],e+="=="):g===c&&(k=f[g]<<10|f[g+1]<<2,e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[k>>>12],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[k>>>6&63],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[k&63],e+="=");return e}function L(k){k=k.replace(/[^A-Za-z0-9+\/]+/g,"");var p=k.length,g=new Uint8Array(new ArrayBuffer(3*p)),f=k.length%4,q=0,h,n;for(h=0;h<p;h+=4){n=(G[k.charAt(h)]||0)<<18|(G[k.charAt(h+1)]||0)<<12|(G[k.charAt(h+2)]||0)<<6|(G[k.charAt(h+3)]||0),g[q]=n>>16,g[q+1]=n>>8&255,g[q+2]=n&255,q+=3}p=3*p-[0,0,2,1][f];return g.subarray(0,p)}function M(g){var l,f,k=g.length,e=0,n=new Uint8Array(new ArrayBuffer(3*k));for(l=0;l<k;l+=1){f=g[l],128>f?n[e++]=f:(2048>f?n[e++]=192|f>>>6:(n[e++]=224|f>>>12&15,n[e++]=128|f>>>6&63),n[e++]=128|f&63)}return n.subarray(0,e)}function I(n){var r,g,p,f,v=n.length,k=new Uint8Array(new ArrayBuffer(v)),q=0;for(r=0;r<v;r+=1){g=n[r],128>g?k[q++]=g:(r+=1,p=n[r],224>g?k[q++]=(g&31)<<6|p&63:(r+=1,f=n[r],k[q++]=(g&15)<<12|(p&63)<<6|f&63))}return k.subarray(0,q)}function C(b){return F(H(b))}function B(b){return String.fromCharCode.apply(String,L(b))}function u(b){return I(H(b))}function A(c){c=I(c);for(var e="",b=0;b<c.length;){e+=String.fromCharCode.apply(String,c.subarray(b,b+45000)),b+=45000}return e}function J(k,p,f){var n,e,q,g="";for(q=p;q<f;q+=1){p=k.charCodeAt(q)&255,128>p?g+=String.fromCharCode(p):(q+=1,n=k.charCodeAt(q)&255,224>p?g+=String.fromCharCode((p&31)<<6|n&63):(q+=1,e=k.charCodeAt(q)&255,g+=String.fromCharCode((p&15)<<12|(n&63)<<6|e&63)))}return g}function E(f,k){function e(){var a=c+100000;a>f.length&&(a=f.length);g+=J(f,c,a);c=a;a=c===f.length;k(g,a)&&!a&&runtime.setTimeout(e,0)}var g="",c=0;100000>f.length?k(J(f,0,f.length),!0):("string"!==typeof f&&(f=f.slice()),e())}function N(b){return M(H(b))}function K(b){return String.fromCharCode.apply(String,M(b))}function D(b){return String.fromCharCode.apply(String,M(H(b)))}var G=function(c){var f={},b,e;b=0;for(e=c.length;b<e;b+=1){f[c.charAt(b)]=b}return f}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),j,o,i=runtime.getWindow(),s,t;i&&i.btoa?(s=i.btoa,j=function(b){return s(D(b))}):(s=C,j=function(a){return F(N(a))});i&&i.atob?(t=i.atob,o=function(b){b=t(b);return J(b,0,b.length)}):(t=B,o=function(b){return A(L(b))});core.Base64=function(){this.convertByteArrayToBase64=this.convertUTF8ArrayToBase64=F;this.convertBase64ToByteArray=this.convertBase64ToUTF8Array=L;this.convertUTF16ArrayToByteArray=this.convertUTF16ArrayToUTF8Array=M;this.convertByteArrayToUTF16Array=this.convertUTF8ArrayToUTF16Array=I;this.convertUTF8StringToBase64=C;this.convertBase64ToUTF8String=B;this.convertUTF8StringToUTF16Array=u;this.convertByteArrayToUTF16String=this.convertUTF8ArrayToUTF16String=A;this.convertUTF8StringToUTF16String=E;this.convertUTF16StringToByteArray=this.convertUTF16StringToUTF8Array=N;this.convertUTF16ArrayToUTF8String=K;this.convertUTF16StringToUTF8String=D;this.convertUTF16StringToBase64=j;this.convertBase64ToUTF16String=o;this.fromBase64=B;this.toBase64=C;this.atob=t;this.btoa=s;this.utob=D;this.btou=E;this.encode=j;this.encodeURI=function(b){return j(b).replace(/[+\/]/g,function(c){return"+"===c?"-":"_"}).replace(/\\=+$/,"")};this.decode=function(b){return o(b.replace(/[\-_]/g,function(c){return"-"===c?"+":"/"}))};return this};return core.Base64}core.Base64=makeBase64();core.CSSUnits=function(){var b=this,a={"in":1,cm:2.54,mm:25.4,pt:72,pc:12,px:96};this.convert=function(g,d,e){return g*a[e]/a[d]};this.convertMeasure=function(h,d){var e,g;h&&d&&(e=parseFloat(h),g=h.replace(e.toString(),""),e=b.convert(e,g,d));return e};this.getUnits=function(d){return d.substr(d.length-2,d.length)}};(function(){function b(){var r,o,h,m,j,c,p,i,s;void 0===d&&(o=(r=runtime.getWindow())&&r.document,c=o.documentElement,p=o.body,d={rangeBCRIgnoresElementBCR:!1,unscaledRangeClientRects:!1,elementBCRIgnoresBodyScroll:!1},o&&(m=o.createElement("div"),m.style.position="absolute",m.style.left="-99999px",m.style.transform="scale(2)",m.style["-webkit-transform"]="scale(2)",j=o.createElement("div"),m.appendChild(j),p.appendChild(m),r=o.createRange(),r.selectNode(j),d.rangeBCRIgnoresElementBCR=0===r.getClientRects().length,j.appendChild(o.createTextNode("Rect transform test")),o=j.getBoundingClientRect(),h=r.getBoundingClientRect(),d.unscaledRangeClientRects=2<Math.abs(o.height-h.height),m.style.transform="",m.style["-webkit-transform"]="",o=c.style.overflow,h=p.style.overflow,i=p.style.height,s=p.scrollTop,c.style.overflow="visible",p.style.overflow="visible",p.style.height="200%",p.scrollTop=p.scrollHeight,d.elementBCRIgnoresBodyScroll=r.getBoundingClientRect().top!==j.getBoundingClientRect().top,p.scrollTop=s,p.style.height=i,p.style.overflow=h,c.style.overflow=o,r.detach(),p.removeChild(m),r=Object.keys(d).map(function(e){return e+":"+String(d[e])}).join(", "),runtime.log("Detected browser quirks - "+r)));return d}function a(e,g,f){for(e=e?e.firstElementChild:null;e;){if(e.localName===f&&e.namespaceURI===g){return e}e=e.nextElementSibling}return null}var d;core.DomUtilsImpl=function(){function s(l,n){for(var e=0,p;l.parentNode!==n;){runtime.assert(null!==l.parentNode,"parent is null"),l=l.parentNode}for(p=n.firstChild;p!==l;){e+=1,p=p.nextSibling}return e}function o(c,e){return 0>=c.compareBoundaryPoints(Range.START_TO_START,e)&&0<=c.compareBoundaryPoints(Range.END_TO_END,e)}function i(c,e){return 0>=c.compareBoundaryPoints(Range.END_TO_START,e)&&0<=c.compareBoundaryPoints(Range.START_TO_END,e)}function h(e,l){var c=null;e.nodeType===Node.TEXT_NODE&&(0===e.length?(e.parentNode.removeChild(e),l.nodeType===Node.TEXT_NODE&&(c=l)):(l.nodeType===Node.TEXT_NODE&&(e.appendData(l.data),l.parentNode.removeChild(l)),c=e));return c}function f(c){for(var e=c.parentNode;c.firstChild;){e.insertBefore(c.firstChild,c)}e.removeChild(c);return e}function g(q,u){var n=q.parentNode,v=q.firstChild,p=u(q),r;if(p===NodeFilter.FILTER_SKIP){return n}for(;v;){r=v.nextSibling,g(v,u),v=r}n&&p===NodeFilter.FILTER_REJECT&&f(q);return n}function k(c,e){return c===e||Boolean(c.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function j(c,e){return b().unscaledRangeClientRects?c:c/e}function t(l,e,c){Object.keys(e).forEach(function(v){var p=v.split(":"),r=p[1],q=c(p[0]),p=e[v],u=typeof p;"object"===u?Object.keys(p).length&&(v=q?l.getElementsByTagNameNS(q,r)[0]||l.ownerDocument.createElementNS(q,v):l.getElementsByTagName(r)[0]||l.ownerDocument.createElement(v),l.appendChild(v),t(v,p,c)):q&&(runtime.assert("number"===u||"string"===u,"attempting to map unsupported type '"+u+"' (key: "+v+")"),l.setAttributeNS(q,v,String(p)))})}var m=null;this.splitBoundaries=function(p){var u,v=[],n,r,q;if(p.startContainer.nodeType===Node.TEXT_NODE||p.endContainer.nodeType===Node.TEXT_NODE){n=p.endContainer;r=p.endContainer.nodeType!==Node.TEXT_NODE?p.endOffset===p.endContainer.childNodes.length:!1;q=p.endOffset;u=p.endContainer;if(q<u.childNodes.length){for(u=u.childNodes.item(q),q=0;u.firstChild;){u=u.firstChild}}else{for(;u.lastChild;){u=u.lastChild,q=u.nodeType===Node.TEXT_NODE?u.textContent.length:u.childNodes.length}}u===n&&(n=null);p.setEnd(u,q);q=p.endContainer;0!==p.endOffset&&q.nodeType===Node.TEXT_NODE&&(u=q,p.endOffset!==u.length&&(v.push(u.splitText(p.endOffset)),v.push(u)));q=p.startContainer;0!==p.startOffset&&q.nodeType===Node.TEXT_NODE&&(u=q,p.startOffset!==u.length&&(q=u.splitText(p.startOffset),v.push(u),v.push(q),p.setStart(q,0)));if(null!==n){for(q=p.endContainer;q.parentNode&&q.parentNode!==n;){q=q.parentNode}r=r?n.childNodes.length:s(q,n);p.setEnd(n,r)}}return v};this.containsRange=o;this.rangesIntersect=i;this.rangeIntersection=function(e,l){var c;i(e,l)&&(c=e.cloneRange(),-1===e.compareBoundaryPoints(Range.START_TO_START,l)&&c.setStart(l.startContainer,l.startOffset),1===e.compareBoundaryPoints(Range.END_TO_END,l)&&c.setEnd(l.endContainer,l.endOffset));return c};this.getNodesInRange=function(r,w,p){var y=[],q=r.commonAncestorContainer,q=q.nodeType===Node.TEXT_NODE?q.parentNode:q;p=r.startContainer.ownerDocument.createTreeWalker(q,p,w,!1);var v,u;r.endContainer.childNodes[r.endOffset-1]?(v=r.endContainer.childNodes[r.endOffset-1],u=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY):(v=r.endContainer,u=Node.DOCUMENT_POSITION_PRECEDING);if(r.startContainer.childNodes[r.startOffset]){r=r.startContainer.childNodes[r.startOffset],p.currentNode=r}else{var x=r.startContainer;r.startOffset===(x.nodeType===Node.TEXT_NODE?x.length:x.childNodes.length)?(r=r.startContainer,p.currentNode=r,p.lastChild(),r=p.nextNode()):(r=r.startContainer,p.currentNode=r)}if(r){r=p.currentNode;if(r!==q){for(r=r.parentNode;r&&r!==q;){w(r)===NodeFilter.FILTER_REJECT&&(p.currentNode=r),r=r.parentNode}}r=p.currentNode;switch(w(r)){case NodeFilter.FILTER_REJECT:for(r=p.nextSibling();!r&&p.parentNode();){r=p.nextSibling()}break;case NodeFilter.FILTER_SKIP:r=p.nextNode()}for(;r;){w=v.compareDocumentPosition(r);if(0!==w&&0===(w&u)){break}y.push(r);r=p.nextNode()}}return y};this.normalizeTextNodes=function(c){c&&c.nextSibling&&(c=h(c,c.nextSibling));c&&c.previousSibling&&h(c.previousSibling,c)};this.rangeContainsNode=function(p,r){var c=r.ownerDocument.createRange(),n=r.ownerDocument.createRange(),q;c.setStart(p.startContainer,p.startOffset);c.setEnd(p.endContainer,p.endOffset);n.selectNodeContents(r);q=o(c,n);c.detach();n.detach();return q};this.mergeIntoParent=f;this.removeUnwantedNodes=g;this.removeAllChildNodes=function(c){for(;c.firstChild;){c.removeChild(c.firstChild)}};this.getElementsByTagNameNS=function(l,n,e){var p=[];l=l.getElementsByTagNameNS(n,e);p.length=e=l.length;for(n=0;n<e;n+=1){p[n]=l.item(n)}return p};this.getElementsByTagName=function(q,u){var n=[],v,p,r;v=q.getElementsByTagName(u);n.length=r=v.length;for(p=0;p<r;p+=1){n[p]=v.item(p)}return n};this.containsNode=function(c,e){return c===e||c.contains(e)};this.comparePoints=function(p,r,u,n){if(p===u){return n-r}var q=p.compareDocumentPosition(u);2===q?q=-1:4===q?q=1:10===q?(r=s(p,u),q=r<n?1:-1):(n=s(u,p),q=n<r?-1:1);return q};this.adaptRangeDifferenceToZoomLevel=j;this.translateRect=function(e,l,c){return{top:j(e.top-l.top,c),left:j(e.left-l.left,c),bottom:j(e.bottom-l.top,c),right:j(e.right-l.left,c),width:j(e.width,c),height:j(e.height,c)}};this.getBoundingClientRect=function(q){var n=q.ownerDocument,u=b(),p=n.body;if((!1===u.unscaledRangeClientRects||u.rangeBCRIgnoresElementBCR)&&q.nodeType===Node.ELEMENT_NODE){return q=q.getBoundingClientRect(),u.elementBCRIgnoresBodyScroll?{left:q.left+p.scrollLeft,right:q.right+p.scrollLeft,top:q.top+p.scrollTop,bottom:q.bottom+p.scrollTop,width:q.width,height:q.height}:q}var r;m?r=m:m=r=n.createRange();u=r;u.selectNode(q);return u.getBoundingClientRect()};this.mapKeyValObjOntoNode=function(e,l,c){Object.keys(l).forEach(function(r){var n=r.split(":"),q=n[1],n=c(n[0]),p=l[r];n?(q=e.getElementsByTagNameNS(n,q)[0],q||(q=e.ownerDocument.createElementNS(n,r),e.appendChild(q)),q.textContent=p):runtime.log("Key ignored: "+r)})};this.removeKeyElementsFromNode=function(e,l,c){l.forEach(function(p){var q=p.split(":"),n=q[1];(q=c(q[0]))?(n=e.getElementsByTagNameNS(q,n)[0])?n.parentNode.removeChild(n):runtime.log("Element for "+p+" not found."):runtime.log("Property Name ignored: "+p)})};this.getKeyValRepresentationOfNode=function(p,q){for(var e={},r=p.firstElementChild,n;r;){if(n=q(r.namespaceURI)){e[n+":"+r.localName]=r.textContent}r=r.nextElementSibling}return e};this.mapObjOntoNode=t;this.cloneEvent=function(c){var e=Object.create(null);Object.keys(c.constructor.prototype).forEach(function(l){e[l]=c[l]});e.prototype=c.constructor.prototype;return e};this.getDirectChild=a;(function(e){var l,c;c=runtime.getWindow();null!==c&&(l=c.navigator.appVersion.toLowerCase(),c=-1===l.indexOf("chrome")&&(-1!==l.indexOf("applewebkit")||-1!==l.indexOf("safari")),l=-1!==l.indexOf("msie")||-1!==l.indexOf("trident"),c||l)&&(e.containsNode=k)})(this)};core.DomUtils=new core.DomUtilsImpl})();core.Cursor=function(o,m){function u(b){b.parentNode&&(a.push(b.previousSibling),a.push(b.nextSibling),b.parentNode.removeChild(b))}function v(f,g,e){if(g.nodeType===Node.TEXT_NODE){runtime.assert(Boolean(g),"putCursorIntoTextNode: invalid container");var k=g.parentNode;runtime.assert(Boolean(k),"putCursorIntoTextNode: container without parent");runtime.assert(0<=e&&e<=g.length,"putCursorIntoTextNode: offset is out of bounds");0===e?k.insertBefore(f,g):(e!==g.length&&g.splitText(e),k.insertBefore(f,g.nextSibling))}else{g.nodeType===Node.ELEMENT_NODE&&g.insertBefore(f,g.childNodes.item(e))}a.push(f.previousSibling);a.push(f.nextSibling)}var s=o.createElementNS("urn:webodf:names:cursor","cursor"),i=o.createElementNS("urn:webodf:names:cursor","anchor"),h,a=[],d=o.createRange(),t,j=core.DomUtils;this.getNode=function(){return s};this.getAnchorNode=function(){return i.parentNode?i:s};this.getSelectedRange=function(){t?(d.setStartBefore(s),d.collapse(!0)):(d.setStartAfter(h?i:s),d.setEndBefore(h?s:i));return d};this.setSelectedRange=function(b,c){d&&d!==b&&d.detach();d=b;h=!1!==c;(t=b.collapsed)?(u(i),u(s),v(s,b.startContainer,b.startOffset)):(u(i),u(s),v(h?s:i,b.endContainer,b.endOffset),v(h?i:s,b.startContainer,b.startOffset));a.forEach(j.normalizeTextNodes);a.length=0};this.hasForwardSelection=function(){return h};this.remove=function(){u(s);a.forEach(j.normalizeTextNodes);a.length=0};s.setAttributeNS("urn:webodf:names:cursor","memberId",m);i.setAttributeNS("urn:webodf:names:cursor","memberId",m)};core.Destroyable=function(){};core.Destroyable.prototype.destroy=function(a){};core.EventSource=function(){};core.EventSource.prototype.subscribe=function(b,a){};core.EventSource.prototype.unsubscribe=function(b,a){};core.EventNotifier=function(b){function a(c){runtime.assert(!d.hasOwnProperty(c),'Duplicated event ids: "'+c+'" registered more than once.');d[c]=[]}var d={};this.emit=function(c,h){var i,e;runtime.assert(d.hasOwnProperty(c),'unknown event fired "'+c+'"');e=d[c];for(i=0;i<e.length;i+=1){e[i](h)}};this.subscribe=function(c,e){runtime.assert(d.hasOwnProperty(c),'tried to subscribe to unknown event "'+c+'"');d[c].push(e)};this.unsubscribe=function(c,e){var g;runtime.assert(d.hasOwnProperty(c),'tried to unsubscribe from unknown event "'+c+'"');g=d[c].indexOf(e);runtime.assert(-1!==g,'tried to unsubscribe unknown callback from event "'+c+'"');-1!==g&&d[c].splice(g,1)};this.register=a;b&&b.forEach(a)};core.ScheduledTask=function(j,i,m){function o(){e&&(m(h),e=!1)}function l(){o();j.apply(void 0,a);a=null}var h,e=!1,a=[],d=!1;this.trigger=function(){runtime.assert(!1===d,"Can't trigger destroyed ScheduledTask instance");a=Array.prototype.slice.call(arguments);e||(e=!0,h=i(l))};this.triggerImmediate=function(){runtime.assert(!1===d,"Can't trigger destroyed ScheduledTask instance");a=Array.prototype.slice.call(arguments);l()};this.processRequests=function(){e&&l()};this.cancel=o;this.restart=function(){runtime.assert(!1===d,"Can't trigger destroyed ScheduledTask instance");o();e=!0;h=i(l)};this.destroy=function(b){o();d=!0;b()}};(function(){var a;core.Task={};core.Task.SUPPRESS_MANUAL_PROCESSING=!1;core.Task.processTasks=function(){core.Task.SUPPRESS_MANUAL_PROCESSING||a.performRedraw()};core.Task.createRedrawTask=function(b){return new core.ScheduledTask(b,a.requestRedrawTask,a.cancelRedrawTask)};core.Task.createTimeoutTask=function(b,d){return new core.ScheduledTask(b,function(c){return runtime.setTimeout(c,d)},runtime.clearTimeout)};a=new function(){var b={};this.requestRedrawTask=function(e){var d=runtime.requestAnimationFrame(function(){e();delete b[d]});b[d]=e;return d};this.performRedraw=function(){Object.keys(b).forEach(function(d){b[d]();runtime.cancelAnimationFrame(parseInt(d,10))});b={}};this.cancelRedrawTask=function(d){runtime.cancelAnimationFrame(d);delete b[d]}}})();core.EventSubscriptions=function(){function e(c,g,k){c.subscribe(g,k);j.push({eventSource:c,eventid:g,callback:k})}function d(){var b=[];j.forEach(function(c){c.eventSource.unsubscribe(c.eventid,c.callback)});j.length=0;Object.keys(h).forEach(function(c){h[c].forEach(function(f){b.push(f.task.destroy)});delete h[c]});core.Async.destroyAll(b,function(){});a=new core.EventNotifier}var j=[],a=new core.EventNotifier,h={},i=0;this.addSubscription=e;this.addFrameSubscription=function(p,g,m){var n,f,b,o;h.hasOwnProperty(g)||(h[g]=[]);b=h[g];for(o=0;o<b.length;o+=1){if(b[o].eventSource===p){n=b[o];break}}n||(f="s"+i,i+=1,a.register(f),n={frameEventId:f,eventSource:p,task:core.Task.createRedrawTask(function(){a.emit(f,void 0)})},b.push(n),e(p,g,n.task.trigger));a.subscribe(n.frameEventId,m)};this.unsubscribeAll=d;this.destroy=function(c){d();c()}};core.LazyProperty=function(b){var a,d=!1;this.value=function(){d||(a=b(),d=!0);return a};this.reset=function(){d=!1}};core.LoopWatchDog=function(e,d){var f=Date.now(),a=0;this.check=function(){var b;if(e&&(b=Date.now(),b-f>e)){throw runtime.log("alert","watchdog timeout"),"timeout!"}if(0<d&&(a+=1,a>d)){throw runtime.log("alert","watchdog loop overflow"),"loop overflow"}}};core.NodeFilterChain=function(b){var a=NodeFilter.FILTER_REJECT,d=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(c){var e;for(e=0;e<b.length;e+=1){if(b[e].acceptNode(c)===a){return a}}return d}};core.PositionIterator=function(z,v,D,F){function A(){this.acceptNode=function(b){return !b||b.nodeType===t&&0===b.length?G:E}}function s(b){this.acceptNode=function(a){return !a||a.nodeType===t&&0===a.length?G:b.acceptNode(a)}}function o(){var c=u.currentNode,a=c.nodeType;H=a===t?c.length-1:a===w?1:0}function i(){if(null===u.previousSibling()){if(!u.parentNode()||u.currentNode===z){return u.firstChild(),!1}H=0}else{o()}return !0}function j(){var a=u.currentNode,d;d=C(a);if(a!==z){for(a=a.parentNode;a&&a!==z;){C(a)===G&&(u.currentNode=a,d=G),a=a.parentNode}}d===G?(H=u.currentNode.nodeType===t?a.length:1,a=B.nextPosition()):a=d===E?!0:B.nextPosition();a&&runtime.assert(C(u.currentNode)===E,"moveToAcceptedNode did not result in walker being on an accepted node");return a}var B=this,u,H,C,t=Node.TEXT_NODE,w=Node.ELEMENT_NODE,E=NodeFilter.FILTER_ACCEPT,G=NodeFilter.FILTER_REJECT;this.nextPosition=function(){var c=u.currentNode,a=c.nodeType;if(c===z){return !1}if(0===H&&a===w){null===u.firstChild()&&(H=1)}else{if(a===t&&H+1<c.length){H+=1}else{if(null!==u.nextSibling()){H=0}else{if(u.parentNode()){H=1}else{return !1}}}}return !0};this.previousPosition=function(){var c=!0,a=u.currentNode;0===H?c=i():a.nodeType===t?--H:null!==u.lastChild()?o():a===z?c=!1:H=0;return c};this.previousNode=i;this.container=function(){var c=u.currentNode,a=c.nodeType;0===H&&a!==t&&(c=c.parentNode);return c};this.rightNode=function(){var a=u.currentNode,d=a.nodeType;if(d===t&&H===a.length){for(a=a.nextSibling;a&&C(a)!==E;){a=a.nextSibling}}else{d===w&&1===H&&(a=null)}return a};this.leftNode=function(){var a=u.currentNode;if(0===H){for(a=a.previousSibling;a&&C(a)!==E;){a=a.previousSibling}}else{if(a.nodeType===w){for(a=a.lastChild;a&&C(a)!==E;){a=a.previousSibling}}}return a};this.getCurrentNode=function(){return u.currentNode};this.unfilteredDomOffset=function(){if(u.currentNode.nodeType===t){return H}for(var c=0,a=u.currentNode,a=1===H?a.lastChild:a.previousSibling;a;){c+=1,a=a.previousSibling}return c};this.getPreviousSibling=function(){var b=u.currentNode,c=u.previousSibling();u.currentNode=b;return c};this.getNextSibling=function(){var b=u.currentNode,c=u.nextSibling();u.currentNode=b;return c};this.setPositionBeforeElement=function(a){runtime.assert(Boolean(a),"setPositionBeforeElement called without element");u.currentNode=a;H=0;return j()};this.setUnfilteredPosition=function(c,a){runtime.assert(Boolean(c),"PositionIterator.setUnfilteredPosition called without container");u.currentNode=c;c.nodeType===t?(H=a,runtime.assert(a<=c.length,"Error in setPosition: "+a+" > "+c.length),runtime.assert(0<=a,"Error in setPosition: "+a+" < 0"),a===c.length&&(u.nextSibling()?H=0:u.parentNode()?H=1:runtime.assert(!1,"Error in setUnfilteredPosition: position not valid."))):a<c.childNodes.length?(u.currentNode=c.childNodes.item(a),H=0):H=1;return j()};this.moveToEnd=function(){u.currentNode=z;H=1};this.moveToEndOfNode=function(a){a.nodeType===t?B.setUnfilteredPosition(a,a.length):(u.currentNode=a,H=1)};this.isBeforeNode=function(){return 0===H};this.getNodeFilter=function(){return C};C=(D?new s(D):new A).acceptNode;C.acceptNode=C;v=v||NodeFilter.SHOW_ALL;runtime.assert(z.nodeType!==Node.TEXT_NODE,"Internet Explorer doesn't allow tree walker roots to be text nodes");u=z.ownerDocument.createTreeWalker(z,v,C,F);H=0;null===u.firstChild()&&(H=1)};core.PositionFilter=function(){};core.PositionFilter.FilterResult={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3};core.PositionFilter.prototype.acceptPosition=function(a){};core.PositionFilterChain=function(){var b=[],a=core.PositionFilter.FilterResult.FILTER_ACCEPT,d=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(c){var e;for(e=0;e<b.length;e+=1){if(b[e].acceptPosition(c)===d){return d}}return a};this.addFilter=function(c){b.push(c)}};core.StepDirection={PREVIOUS:1,NEXT:2};core.StepIterator=function(v,u){function z(){B=null;s=y=void 0}function A(){void 0===s&&(s=v.acceptPosition(u)===x);return s}function w(b,c){z();return u.setUnfilteredPosition(b,c)}function o(){B||(B=u.container());return B}function j(){void 0===y&&(y=u.unfilteredDomOffset());return y}function h(){for(z();u.nextPosition();){if(z(),A()){return !0}}return !1}function i(){for(z();u.previousPosition();){if(z(),A()){return !0}}return !1}var x=core.PositionFilter.FilterResult.FILTER_ACCEPT,t=core.StepDirection.NEXT,B,y,s;this.isStep=A;this.setPosition=w;this.container=o;this.offset=j;this.nextStep=h;this.previousStep=i;this.advanceStep=function(b){return b===t?h():i()};this.roundToClosestStep=function(){var b,e,f=A();f||(b=o(),e=j(),f=i(),f||(w(b,e),f=h()));return f};this.roundToPreviousStep=function(){var b=A();b||(b=i());return b};this.roundToNextStep=function(){var b=A();b||(b=h());return b};this.leftNode=function(){return u.leftNode()};this.snapshot=function(){return new core.StepIterator.StepSnapshot(o(),j())};this.restore=function(b){w(b.container,b.offset)}};core.StepIterator.StepSnapshot=function(b,a){this.container=b;this.offset=a};core.Utils=function(){function a(b,d){if(d&&Array.isArray(d)){b=b||[];if(!Array.isArray(b)){throw"Destination is not an array."}b=b.concat(d.map(function(c){return a(null,c)}))}else{if(d&&"object"===typeof d){b=b||{};if("object"!==typeof b){throw"Destination is not an object."}Object.keys(d).forEach(function(c){b[c]=a(b[c],d[c])})}else{b=d}}return b}this.hashString=function(e){var i=0,d,h;d=0;for(h=e.length;d<h;d+=1){i=(i<<5)-i+e.charCodeAt(d),i|=0}return i};this.mergeObjects=function(b,d){Object.keys(d).forEach(function(c){b[c]=a(b[c],d[c])});return b}};core.Zip=function(j,i){function m(f,k){var g=a.file(f);g?k(null,g.asUint8Array()):k(f+" not found.",null)}function o(c,f){m(c,function(k,n){if(k||null===n){return f(k,null)}var g=runtime.byteArrayToString(n,"utf8");f(null,g)})}function l(f,k){try{f(a.generate({type:"uint8array",compression:"DEFLATE"}))}catch(g){k(g.message)}}function h(f,g){l(function(b){runtime.writeFile(f,b,g)},g)}var e=this,a,d=new core.Base64;this.load=m;this.save=function(f,n,g,k){a.file(f,n,{date:k,compression:g?null:"STORE"})};this.remove=function(f){var g=null!==a.file(f);a.remove(f);return g};this.write=function(c){h(j,c)};this.writeAs=h;this.createByteArray=l;this.loadContentXmlAsFragments=function(f,b){o(f,function(c,g){if(c){return b.rootElementReady(c)}b.rootElementReady(null,g,!0)})};this.loadAsString=o;this.loadAsDOM=function(f,b){o(f,function(g,k){if(g||null===k){b(g,null)}else{var c=(new DOMParser).parseFromString(k,"text/xml");b(null,c)}})};this.loadAsDataURL=function(c,g,f){m(c,function(p,k){if(p||!k){return f(p,null)}var q=0,n;g||(g=80===k[1]&&78===k[2]&&71===k[3]?"image/png":255===k[0]&&216===k[1]&&255===k[2]?"image/jpeg":71===k[0]&&73===k[1]&&70===k[2]?"image/gif":"");for(n="data:"+g+";base64,";q<k.length;){n+=d.convertUTF8ArrayToBase64(k.subarray(q,Math.min(q+45000,k.length))),q+=45000}f(null,n)})};this.getEntries=function(){return Object.keys(a.files).map(function(c){return{filename:c}})};a=new externs.JSZip;null!==i&&runtime.readFile(j,"binary",function(f,k){"string"===typeof k&&(f="file was read as a string. Should be Uint8Array.");if(f||!k||0===k.length){i("File '"+j+"' cannot be read. Err: "+(f||"[none]"),e)}else{try{a.load(k,{checkCRC32:!1}),i(null,e)}catch(g){i(g.message,e)}}})};core.SimpleClientRect=null;gui.CommonConstraints={EDIT:{ANNOTATIONS:{ONLY_DELETE_OWN:"onlyDeleteOwn"},REVIEW_MODE:"reviewMode"}};gui.SessionConstraints=function(){function b(c){a.hasOwnProperty(c)||(a[c]=!1,d.register(c))}var a={},d=new core.EventNotifier;this.registerConstraint=b;this.subscribe=function(c,e){b(c);d.subscribe(c,e)};this.unsubscribe=function(c,e){d.unsubscribe(c,e)};this.setState=function(c,e){runtime.assert(!0===a.hasOwnProperty(c),"No such constraint");a[c]!==e&&(a[c]=e,d.emit(c,e))};this.getState=function(c){runtime.assert(!0===a.hasOwnProperty(c),"No such constraint");return a[c]}};gui.BlacklistNamespaceNodeFilter=function(e){var d={},f=NodeFilter.FILTER_REJECT,a=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(b){return !b||d.hasOwnProperty(b.namespaceURI)?f:a};(function(){e.forEach(function(c){d[c]=!0})})()};odf.Namespaces={namespaceMap:{config:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",db:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dc:"http://purl.org/dc/elements/1.1/",dr3d:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chart:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fo:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",form:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",math:"http://www.w3.org/1998/Math/MathML",meta:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",number:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",style:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svg:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",table:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xforms:"http://www.w3.org/2002/xforms",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},prefixMap:{},configns:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",dbns:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dcns:"http://purl.org/dc/elements/1.1/",dr3dns:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",drawns:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chartns:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fons:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",formns:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",mathns:"http://www.w3.org/1998/Math/MathML",metans:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",numberns:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",officens:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentationns:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",stylens:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svgns:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",tablens:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",textns:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xformsns:"http://www.w3.org/2002/xforms",xlinkns:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/XML/1998/namespace"};(function(){var b=odf.Namespaces.namespaceMap,a=odf.Namespaces.prefixMap,d;for(d in b){b.hasOwnProperty(d)&&(a[b[d]]=d)}})();odf.Namespaces.forEachPrefix=function(b){var a=odf.Namespaces.namespaceMap,d;for(d in a){a.hasOwnProperty(d)&&b(d,a[d])}};odf.Namespaces.lookupNamespaceURI=function(b){var a=null;odf.Namespaces.namespaceMap.hasOwnProperty(b)&&(a=odf.Namespaces.namespaceMap[b]);return a};odf.Namespaces.lookupPrefix=function(b){var a=odf.Namespaces.prefixMap;return a.hasOwnProperty(b)?a[b]:null};odf.Namespaces.lookupNamespaceURI.lookupNamespaceURI=odf.Namespaces.lookupNamespaceURI;(function(){odf.OdfSchemaImpl=function(){var b=[["config:config-item","uncategorized"],["form:item","object"],["form:option","uncategorized"],["math:math","field"],["meta:user-defined","uncategorized"],["number:currency-symbol","uncategorized"],["number:embedded-text","uncategorized"],["number:text","uncategorized"],["presentation:date-time-decl","uncategorized"],["presentation:footer-decl","uncategorized"],["presentation:header-decl","uncategorized"],["svg:desc","text"],["svg:title","text"],["table:desc","uncategorized"],["table:title","uncategorized"],["text:a","text"],["text:author-initials","field"],["text:author-name","field"],["text:bibliography-mark","field"],["text:bookmark-ref","field"],["text:chapter","field"],["text:character-count","field"],["text:conditional-text","field"],["text:creation-date","field"],["text:creation-time","field"],["text:creator","field"],["text:database-display","field"],["text:database-name","field"],["text:database-row-number","field"],["text:date","field"],["text:dde-connection","field"],["text:description","field"],["text:editing-cycles","field"],["text:editing-duration","field"],["text:execute-macro","uncategorized"],["text:expression","uncategorized"],["text:file-name","field"],["text:h","text"],["text:hidden-paragraph","text"],["text:hidden-text","text"],["text:image-count","field"],["text:index-entry-span","uncategorized"],["text:index-title-template","uncategorized"],["text:initial-creator","field"],["text:keywords","field"],["text:linenumbering-separator","style"],["text:measure","uncategorized"],["text:meta","uncategorized"],["text:meta-field","uncategorized"],["text:modification-date","field"],["text:modification-time","field"],["text:note-citation","field"],["text:note-continuation-notice-backward","style"],["text:note-continuation-notice-forward","style"],["text:note-ref","field"],["text:object-count","field"],["text:p","text"],["text:page-continuation","uncategorized"],["text:page-count","field"],["text:page-number","field"],["text:page-variable-get","field"],["text:page-variable-set","field"],["text:paragraph-count","field"],["text:placeholder","field"],["text:print-date","field"],["text:print-time","field"],["text:printed-by","field"],["text:reference-ref","field"],["text:ruby-base","text"],["text:ruby-text","text"],["text:script","text"],["text:sender-city","field"],["text:sender-company","field"],["text:sender-country","field"],["text:sender-email","field"],["text:sender-fax","field"],["text:sender-firstname","field"],["text:sender-initials","field"],["text:sender-lastname","field"],["text:sender-phone-private","field"],["text:sender-phone-work","field"],["text:sender-position","field"],["text:sender-postal-code","field"],["text:sender-state-or-province","field"],["text:sender-street","field"],["text:sender-title","field"],["text:sequence","uncategorized"],["text:sequence-ref","uncategorized"],["text:sheet-name","uncategorized"],["text:span","text"],["text:subject","field"],["text:table-count","field"],["text:table-formula","deprecated"],["text:template-name","uncategorized"],["text:text-input","field"],["text:time","field"],["text:title","field"],["text:user-defined","field"],["text:user-field-get","field"],["text:user-field-input","field"],["text:variable-get","field"],["text:variable-input","field"],["text:variable-set","field"],["text:word-count","field"],["xforms:model","uncategorized"]],a={};this.isTextContainer=function(e,d){return"text"===a[e+":"+d]};this.isField=function(e,d){return"field"===a[e+":"+d]};this.getFields=function(){return b.filter(function(d){return"field"===d[1]}).map(function(d){return d[0]})};(function(){b.forEach(function(h){var d=h[1],e=h[0].split(":");h=e[0];var e=e[1],g=odf.Namespaces.lookupNamespaceURI(h);g?a[g+":"+e]=d:runtime.log("DEBUG: OdfSchema - unknown prefix '"+h+"'")})})()};odf.OdfSchema=new odf.OdfSchemaImpl})();odf.OdfUtilsImpl=function(){function ap(b){return"image"===(b&&b.localName)&&b.namespaceURI===s}function an(b){return null!==b&&b.nodeType===Node.ELEMENT_NODE&&"frame"===b.localName&&b.namespaceURI===s&&"as-char"===b.getAttributeNS(M,"anchor-type")}function au(b){var c;(c="annotation"===(b&&b.localName)&&b.namespaceURI===odf.Namespaces.officens)||(c="div"===(b&&b.localName)&&"annotationWrapper"===b.className);return c}function av(b){return"a"===(b&&b.localName)&&b.namespaceURI===M}function aq(b){var c=b&&b.localName;return("p"===c||"h"===c)&&b.namespaceURI===M}function ak(b,c){for(b&&void 0!==c&&!aq(b)&&b.childNodes.item(c)&&(b=b.childNodes.item(c));b&&!aq(b);){b=b.parentNode}return b}function aj(b,c){for(;b&&b!==c;){if(b.namespaceURI===odf.Namespaces.officens&&"annotation"===b.localName){return b}b=b.parentNode}return null}function ah(b){return/^[ \t\r\n]+$/.test(b)}function ai(b){if(null===b||b.nodeType!==Node.ELEMENT_NODE){return !1}var c=b.localName;return Z.isTextContainer(b.namespaceURI,c)||"span"===c&&"webodf-annotationHighlight"===b.className}function ar(b){return null===b||b.nodeType!==Node.ELEMENT_NODE?!1:Z.isField(b.namespaceURI,b.localName)}function am(e){var f=e&&e.localName,c=!1;f&&(e=e.namespaceURI,e===M&&(c="s"===f||"tab"===f||"line-break"===f));return c}function aw(b){return am(b)||ar(b)||an(b)||au(b)}function at(e){var f=e&&e.localName,c=!1;f&&(e=e.namespaceURI,e===M&&(c="s"===f));return c}function al(b){return -1!==o.indexOf(b.namespaceURI)}function ao(b){if(am(b)||ar(b)){return !1}if(ai(b.parentNode)&&b.nodeType===Node.TEXT_NODE){return 0===b.textContent.length}for(b=b.firstChild;b;){if(al(b)||!ao(b)){return !1}b=b.nextSibling}return !0}function ab(b){for(;null!==b.firstChild&&ai(b);){b=b.firstChild}return b}function ac(b){for(;null!==b.lastChild&&ai(b);){b=b.lastChild}return b}function aa(b){for(;!aq(b)&&null===b.previousSibling;){b=b.parentNode}return aq(b)?null:ac(b.previousSibling)}function ad(b){for(;!aq(b)&&null===b.nextSibling;){b=b.parentNode}return aq(b)?null:ab(b.nextSibling)}function ae(a){for(var d=!1;a;){if(a.nodeType===Node.TEXT_NODE){if(0===a.length){a=aa(a)}else{return !ah(a.data.substr(a.length-1,1))}}else{aw(a)?(d=!1===at(a),a=null):a=aa(a)}}return d}function af(e){var a=!1,f;for(e=e&&ab(e);e;){f=e.nodeType===Node.TEXT_NODE?e.length:0;if(0<f&&!ah(e.data)){a=!0;break}if(aw(e)){a=!0;break}e=ad(e)}return a}function ag(b,c){return ah(b.data.substr(c))?!af(ad(b)):!1}function X(f,e){var g=f.data,a;if(!ah(g[e])||aw(f.parentNode)){return !1}0<e?ah(g[e-1])||(a=!0):ae(aa(f))&&(a=!0);return !0===a?ag(f,e)?!1:!0:!1}function Q(b){return(b=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px)|(%))/.exec(b))?{value:parseFloat(b[1]),unit:b[3]}:null}function H(b){return(b=Q(b))&&(0>b.value||"%"===b.unit)?null:b}function G(b){return(b=Q(b))&&"%"!==b.unit?null:b}function T(b){switch(b.namespaceURI){case odf.Namespaces.drawns:case odf.Namespaces.svgns:case odf.Namespaces.dr3dns:return !1;case odf.Namespaces.textns:switch(b.localName){case"note-body":case"ruby-text":return !1}break;case odf.Namespaces.officens:switch(b.localName){case"annotation":case"binary-data":case"event-listeners":return !1}break;default:switch(b.localName){case"cursor":case"editinfo":return !1}}return !0}function F(b){return Boolean(ak(b)&&(!ah(b.textContent)||X(b,0)))}function C(b,c){for(;0<c.length&&!Y.rangeContainsNode(b,c[0]);){c.shift()}for(;0<c.length&&!Y.rangeContainsNode(b,c[c.length-1]);){c.pop()}}function U(f,c,a){var e;e=Y.getNodesInRange(f,function(h){var g=NodeFilter.FILTER_REJECT;if(am(h.parentNode)||ar(h.parentNode)||au(h)){g=NodeFilter.FILTER_REJECT}else{if(h.nodeType===Node.TEXT_NODE){if(a||F(h)){g=NodeFilter.FILTER_ACCEPT}}else{if(aw(h)){g=NodeFilter.FILTER_ACCEPT}else{if(T(h)||ai(h)){g=NodeFilter.FILTER_SKIP}}}}return g},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);c||C(f,e);return e}function j(e,f,c){for(;e;){if(c(e)){f[0]!==e&&f.unshift(e);break}if(au(e)){break}e=e.parentNode}}function i(e,f){var c=e;if(f<c.childNodes.length-1){c=c.childNodes[f+1]}else{for(;!c.nextSibling;){c=c.parentNode}c=c.nextSibling}for(;c.firstChild;){c=c.firstChild}return c}var M=odf.Namespaces.textns,s=odf.Namespaces.drawns,B=odf.Namespaces.xlinkns,Y=core.DomUtils,o=[odf.Namespaces.dbns,odf.Namespaces.dcns,odf.Namespaces.dr3dns,odf.Namespaces.drawns,odf.Namespaces.chartns,odf.Namespaces.formns,odf.Namespaces.numberns,odf.Namespaces.officens,odf.Namespaces.presentationns,odf.Namespaces.stylens,odf.Namespaces.svgns,odf.Namespaces.tablens,odf.Namespaces.textns],Z=odf.OdfSchema;this.isImage=ap;this.isCharacterFrame=an;this.isInlineRoot=au;this.isTextSpan=function(b){return"span"===(b&&b.localName)&&b.namespaceURI===M};this.isHyperlink=av;this.getHyperlinkTarget=function(b){return b.getAttributeNS(B,"href")||""};this.isParagraph=aq;this.getParagraphElement=ak;this.getParentAnnotation=aj;this.isWithinAnnotation=function(b,c){return Boolean(aj(b,c))};this.getAnnotationCreator=function(b){return b.getElementsByTagNameNS(odf.Namespaces.dcns,"creator")[0].textContent};this.isListItem=function(b){return"list-item"===(b&&b.localName)&&b.namespaceURI===M};this.isLineBreak=function(b){return"line-break"===(b&&b.localName)&&b.namespaceURI===M};this.isODFWhitespace=ah;this.isGroupingElement=ai;this.isFieldElement=ar;this.isCharacterElement=am;this.isAnchoredAsCharacterElement=aw;this.isSpaceElement=at;this.isODFNode=al;this.hasNoODFContent=ao;this.firstChild=ab;this.lastChild=ac;this.previousNode=aa;this.nextNode=ad;this.scanLeftForNonSpace=ae;this.lookLeftForCharacter=function(e){var a,f=a=0;e.nodeType===Node.TEXT_NODE&&(f=e.length);0<f?(a=e.data,a=ah(a.substr(f-1,1))?1===f?ae(aa(e))?2:0:ah(a.substr(f-2,1))?0:2:1):aw(e)&&(a=1);return a};this.lookRightForCharacter=function(e){var a=!1,f=0;e&&e.nodeType===Node.TEXT_NODE&&(f=e.length);0<f?a=!ah(e.data.substr(0,1)):aw(e)&&(a=!0);return a};this.scanLeftForAnyCharacter=function(e){var a=!1,f;for(e=e&&ac(e);e;){f=e.nodeType===Node.TEXT_NODE?e.length:0;if(0<f&&!ah(e.data)){a=!0;break}if(aw(e)){a=!0;break}e=aa(e)}return a};this.scanRightForAnyCharacter=af;this.isTrailingWhitespace=ag;this.isSignificantWhitespace=X;this.isDowngradableSpaceElement=function(b){return at(b)?ae(aa(b))&&af(ad(b)):!1};this.parseLength=Q;this.parseNonNegativeLength=H;this.parseFoFontSize=function(b){var c;c=(c=Q(b))&&(0>=c.value||"%"===c.unit)?null:c;return c||G(b)};this.parseFoLineHeight=function(b){return H(b)||G(b)};this.isTextContentContainingNode=T;this.getTextNodes=function(e,f){var c;c=Y.getNodesInRange(e,function(b){var g=NodeFilter.FILTER_REJECT;b.nodeType===Node.TEXT_NODE?F(b)&&(g=NodeFilter.FILTER_ACCEPT):T(b)&&(g=NodeFilter.FILTER_SKIP);return g},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);f||C(e,c);return c};this.getTextElements=U;this.getParagraphElements=function(b){var c;c=Y.getNodesInRange(b,function(e){var f=NodeFilter.FILTER_REJECT;if(aq(e)){f=NodeFilter.FILTER_ACCEPT}else{if(T(e)||ai(e)){f=NodeFilter.FILTER_SKIP}}return f},NodeFilter.SHOW_ELEMENT);j(b.startContainer,c,aq);return c};this.getImageElements=function(b){var c;c=Y.getNodesInRange(b,function(e){var f=NodeFilter.FILTER_SKIP;ap(e)&&(f=NodeFilter.FILTER_ACCEPT);return f},NodeFilter.SHOW_ELEMENT);j(b.startContainer,c,ap);return c};this.getHyperlinkElements=function(b){var e=[],f=b.cloneRange();b.collapsed&&b.endContainer.nodeType===Node.ELEMENT_NODE&&(b=i(b.endContainer,b.endOffset),b.nodeType===Node.TEXT_NODE&&f.setEnd(b,1));U(f,!0,!1).forEach(function(c){for(c=c.parentNode;!aq(c);){if(av(c)&&-1===e.indexOf(c)){e.push(c);break}c=c.parentNode}});f.detach();return e};this.getNormalizedFontFamilyName=function(b){/^(["'])(?:.|[\n\r])*?\1$/.test(b)||(b=b.replace(/^[ \t\r\n\f]*((?:.|[\n\r])*?)[ \t\r\n\f]*$/,"$1"),/[ \t\r\n\f]/.test(b)&&(b="'"+b.replace(/[ \t\r\n\f]+/g," ")+"'"));return b}};odf.OdfUtils=new odf.OdfUtilsImpl;gui.OdfTextBodyNodeFilter=function(){var e=odf.OdfUtils,d=Node.TEXT_NODE,i=NodeFilter.FILTER_REJECT,a=NodeFilter.FILTER_ACCEPT,h=odf.Namespaces.textns;this.acceptNode=function(b){if(b.nodeType===d){if(!e.isGroupingElement(b.parentNode)){return i}}else{if(b.namespaceURI===h&&"tracked-changes"===b.localName){return i}}return a}};xmldom.LSSerializerFilter=function(){};xmldom.LSSerializerFilter.prototype.acceptNode=function(a){};odf.OdfNodeFilter=function(){this.acceptNode=function(a){return"http://www.w3.org/1999/xhtml"===a.namespaceURI?NodeFilter.FILTER_SKIP:a.namespaceURI&&a.namespaceURI.match(/^urn:webodf:/)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}};xmldom.XPathIterator=function(){};xmldom.XPathIterator.prototype.next=function(){};xmldom.XPathIterator.prototype.reset=function(){};function createXPathSingleton(){function l(c,e,f){return -1!==c&&(c<e||-1===e)&&(c<f||-1===f)}function j(D){for(var E=[],B=0,C=D.length,y;B<C;){var z=D,w=C,x=E,e="",u=[],g=z.indexOf("[",B),G=z.indexOf("/",B),v=z.indexOf("=",B);l(G,g,v)?(e=z.substring(B,G),B=G+1):l(g,G,v)?(e=z.substring(B,g),B=o(z,g,u)):l(v,G,g)?(e=z.substring(B,v),B=v):(e=z.substring(B,w),B=w);x.push({location:e,predicates:u});if(B<C&&"="===D[B]){y=D.substring(B+1,C);if(2<y.length&&("'"===y[0]||'"'===y[0])){y=y.slice(1,y.length-1)}else{try{y=parseInt(y,10)}catch(F){}}B=C}}return{steps:E,value:y}}function s(){var c=null,e=!1;this.setNode=function(b){c=b};this.reset=function(){e=!1};this.next=function(){var b=e?null:c;e=!0;return b}}function t(c,e,f){this.reset=function(){c.reset()};this.next=function(){for(var b=c.next();b;){b.nodeType===Node.ELEMENT_NODE&&(b=b.getAttributeNodeNS(e,f));if(b){break}b=c.next()}return b}}function m(e,f){var g=e.next(),k=null;this.reset=function(){e.reset();g=e.next();k=null};this.next=function(){for(;g;){if(k){if(f&&k.firstChild){k=k.firstChild}else{for(;!k.nextSibling&&k!==g;){k=k.parentNode}k===g?g=e.next():k=k.nextSibling}}else{do{(k=g.firstChild)||(g=e.next())}while(g&&!k)}if(k&&k.nodeType===Node.ELEMENT_NODE){return k}}return null}}function i(c,e){this.reset=function(){c.reset()};this.next=function(){for(var b=c.next();b&&!e(b);){b=c.next()}return b}}function h(e,f,k){f=f.split(":",2);var n=k(f[0]),g=f[1];return new i(e,function(b){return b.localName===g&&b.namespaceURI===n})}function a(f,g,p){var c=new s,k=d(c,g,p),n=g.value;return void 0===n?new i(f,function(b){c.setNode(b);k.reset();return null!==k.next()}):new i(f,function(b){c.setNode(b);k.reset();return(b=k.next())?b.nodeValue===n:!1})}var d,o;o=function(f,g,p){for(var q=g,k=f.length,n=0;q<k;){"]"===f[q]?(--n,0>=n&&p.push(j(f.substring(g,q)))):"["===f[q]&&(0>=n&&(g=q+1),n+=1),q+=1}return q};d=function(r,f,p){var b,g,k,q;for(b=0;b<f.steps.length;b+=1){k=f.steps[b];g=k.location;if(""===g){r=new m(r,!1)}else{if("@"===g[0]){g=g.substr(1).split(":",2);q=p(g[0]);if(!q){throw"No namespace associated with the prefix "+g[0]}r=new t(r,q,g[1])}else{"."!==g&&(r=new m(r,!1),-1!==g.indexOf(":")&&(r=h(r,g,p)))}}for(g=0;g<k.predicates.length;g+=1){q=k.predicates[g],r=a(r,q,p)}}return r};return{getODFElementsWithXPath:function(f,g,p){var c=f.ownerDocument,k=[],n=null;if(c&&"function"===typeof c.evaluate){for(p=c.evaluate(g,f,p,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null),n=p.iterateNext();null!==n;){n.nodeType===Node.ELEMENT_NODE&&k.push(n),n=p.iterateNext()}}else{k=new s;k.setNode(f);f=j(g);k=d(k,f,p);f=[];for(p=k.next();p;){f.push(p),p=k.next()}k=f}return k}}}xmldom.XPath=createXPathSingleton();odf.StyleInfo=function(){function T(n,r){var g,t,p,f,q,k=0;if(g=j[n.localName]){if(p=g[n.namespaceURI]){k=p.length}}for(g=0;g<k;g+=1){t=p[g],f=t.ns,q=t.localname,(t=n.getAttributeNS(f,q))&&n.setAttributeNS(f,M[f]+q,r+t)}for(p=n.firstElementChild;p;){T(p,r),p=p.nextElementSibling}}function R(n,r){var g,t,p,f,q,k=0;if(g=j[n.localName]){if(p=g[n.namespaceURI]){k=p.length}}for(g=0;g<k;g+=1){if(t=p[g],f=t.ns,q=t.localname,t=n.getAttributeNS(f,q)){t=t.replace(r,""),n.setAttributeNS(f,M[f]+q,t)}}for(p=n.firstElementChild;p;){R(p,r),p=p.nextElementSibling}}function X(n,r){var g,t,p,f,q,k=0;if(g=j[n.localName]){if(p=g[n.namespaceURI]){k=p.length}}for(g=0;g<k;g+=1){if(f=p[g],t=f.ns,q=f.localname,t=n.getAttributeNS(t,q)){r=r||{},f=f.keyname,r.hasOwnProperty(f)?r[f][t]=1:(q={},q[t]=1,r[f]=q)}}return r}function Y(c,f){var e,b;X(c,f);for(e=c.firstChild;e;){e.nodeType===Node.ELEMENT_NODE&&(b=e,Y(b,f)),e=e.nextSibling}}function U(e,f,c){this.key=e;this.name=f;this.family=c;this.requires={}}function O(f,k,e){var l=f+'"'+k,g=e[l];g||(g=e[l]=new U(l,f,k));return g}function N(v,r,u){var t,n,g,q,k,p=0;t=v.getAttributeNS(E,"name");q=v.getAttributeNS(E,"family");t&&q&&(r=O(t,q,u));if(r){if(t=j[v.localName]){if(g=t[v.namespaceURI]){p=g.length}}for(t=0;t<p;t+=1){if(q=g[t],n=q.ns,k=q.localname,n=v.getAttributeNS(n,k)){q=q.keyname,q=O(n,q,u),r.requires[q.key]=q}}}for(v=v.firstElementChild;v;){N(v,r,u),v=v.nextElementSibling}return u}function H(e,f){var c=f[e.family];c||(c=f[e.family]={});c[e.name]=1;Object.keys(e.requires).forEach(function(a){H(e.requires[a],f)})}function J(e,f){var c=N(e,null,{});Object.keys(c).forEach(function(b){b=c[b];var d=f[b.family];d&&d.hasOwnProperty(b.name)&&H(b,f)})}function V(g,l){function f(a){(a=e.getAttributeNS(E,a))&&(g[a]=!0)}var n=["font-name","font-name-asian","font-name-complex"],k,e;for(k=l&&l.firstElementChild;k;){e=k,n.forEach(f),V(g,e),k=k.nextElementSibling}}function Q(g,l){function f(b){var d=e.getAttributeNS(E,b);d&&l.hasOwnProperty(d)&&e.setAttributeNS(E,"style:"+b,l[d])}var n=["font-name","font-name-asian","font-name-complex"],k,e;for(k=g&&g.firstElementChild;k;){e=k,n.forEach(f),Q(e,l),k=k.nextElementSibling}}var Z=odf.Namespaces.chartns,W=odf.Namespaces.dbns,P=odf.Namespaces.dr3dns,S=odf.Namespaces.drawns,s=odf.Namespaces.formns,C=odf.Namespaces.numberns,o=odf.Namespaces.officens,D=odf.Namespaces.presentationns,E=odf.Namespaces.stylens,F=odf.Namespaces.tablens,G=odf.Namespaces.textns,M={"urn:oasis:names:tc:opendocument:xmlns:chart:1.0":"chart:","urn:oasis:names:tc:opendocument:xmlns:database:1.0":"db:","urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0":"dr3d:","urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":"draw:","urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":"fo:","urn:oasis:names:tc:opendocument:xmlns:form:1.0":"form:","urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":"number:","urn:oasis:names:tc:opendocument:xmlns:office:1.0":"office:","urn:oasis:names:tc:opendocument:xmlns:presentation:1.0":"presentation:","urn:oasis:names:tc:opendocument:xmlns:style:1.0":"style:","urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0":"svg:","urn:oasis:names:tc:opendocument:xmlns:table:1.0":"table:","urn:oasis:names:tc:opendocument:xmlns:text:1.0":"chart:","http://www.w3.org/XML/1998/namespace":"xml:"},B={text:[{ens:E,en:"tab-stop",ans:E,a:"leader-text-style"},{ens:E,en:"drop-cap",ans:E,a:"style-name"},{ens:G,en:"notes-configuration",ans:G,a:"citation-body-style-name"},{ens:G,en:"notes-configuration",ans:G,a:"citation-style-name"},{ens:G,en:"a",ans:G,a:"style-name"},{ens:G,en:"alphabetical-index",ans:G,a:"style-name"},{ens:G,en:"linenumbering-configuration",ans:G,a:"style-name"},{ens:G,en:"list-level-style-number",ans:G,a:"style-name"},{ens:G,en:"ruby-text",ans:G,a:"style-name"},{ens:G,en:"span",ans:G,a:"style-name"},{ens:G,en:"a",ans:G,a:"visited-style-name"},{ens:E,en:"text-properties",ans:E,a:"text-line-through-text-style"},{ens:G,en:"alphabetical-index-source",ans:G,a:"main-entry-style-name"},{ens:G,en:"index-entry-bibliography",ans:G,a:"style-name"},{ens:G,en:"index-entry-chapter",ans:G,a:"style-name"},{ens:G,en:"index-entry-link-end",ans:G,a:"style-name"},{ens:G,en:"index-entry-link-start",ans:G,a:"style-name"},{ens:G,en:"index-entry-page-number",ans:G,a:"style-name"},{ens:G,en:"index-entry-span",ans:G,a:"style-name"},{ens:G,en:"index-entry-tab-stop",ans:G,a:"style-name"},{ens:G,en:"index-entry-text",ans:G,a:"style-name"},{ens:G,en:"index-title-template",ans:G,a:"style-name"},{ens:G,en:"list-level-style-bullet",ans:G,a:"style-name"},{ens:G,en:"outline-level-style",ans:G,a:"style-name"}],paragraph:[{ens:S,en:"caption",ans:S,a:"text-style-name"},{ens:S,en:"circle",ans:S,a:"text-style-name"},{ens:S,en:"connector",ans:S,a:"text-style-name"},{ens:S,en:"control",ans:S,a:"text-style-name"},{ens:S,en:"custom-shape",ans:S,a:"text-style-name"},{ens:S,en:"ellipse",ans:S,a:"text-style-name"},{ens:S,en:"frame",ans:S,a:"text-style-name"},{ens:S,en:"line",ans:S,a:"text-style-name"},{ens:S,en:"measure",ans:S,a:"text-style-name"},{ens:S,en:"path",ans:S,a:"text-style-name"},{ens:S,en:"polygon",ans:S,a:"text-style-name"},{ens:S,en:"polyline",ans:S,a:"text-style-name"},{ens:S,en:"rect",ans:S,a:"text-style-name"},{ens:S,en:"regular-polygon",ans:S,a:"text-style-name"},{ens:o,en:"annotation",ans:S,a:"text-style-name"},{ens:s,en:"column",ans:s,a:"text-style-name"},{ens:E,en:"style",ans:E,a:"next-style-name"},{ens:F,en:"body",ans:F,a:"paragraph-style-name"},{ens:F,en:"even-columns",ans:F,a:"paragraph-style-name"},{ens:F,en:"even-rows",ans:F,a:"paragraph-style-name"},{ens:F,en:"first-column",ans:F,a:"paragraph-style-name"},{ens:F,en:"first-row",ans:F,a:"paragraph-style-name"},{ens:F,en:"last-column",ans:F,a:"paragraph-style-name"},{ens:F,en:"last-row",ans:F,a:"paragraph-style-name"},{ens:F,en:"odd-columns",ans:F,a:"paragraph-style-name"},{ens:F,en:"odd-rows",ans:F,a:"paragraph-style-name"},{ens:G,en:"notes-configuration",ans:G,a:"default-style-name"},{ens:G,en:"alphabetical-index-entry-template",ans:G,a:"style-name"},{ens:G,en:"bibliography-entry-template",ans:G,a:"style-name"},{ens:G,en:"h",ans:G,a:"style-name"},{ens:G,en:"illustration-index-entry-template",ans:G,a:"style-name"},{ens:G,en:"index-source-style",ans:G,a:"style-name"},{ens:G,en:"object-index-entry-template",ans:G,a:"style-name"},{ens:G,en:"p",ans:G,a:"style-name"},{ens:G,en:"table-index-entry-template",ans:G,a:"style-name"},{ens:G,en:"table-of-content-entry-template",ans:G,a:"style-name"},{ens:G,en:"table-index-entry-template",ans:G,a:"style-name"},{ens:G,en:"user-index-entry-template",ans:G,a:"style-name"},{ens:E,en:"page-layout-properties",ans:E,a:"register-truth-ref-style-name"}],chart:[{ens:Z,en:"axis",ans:Z,a:"style-name"},{ens:Z,en:"chart",ans:Z,a:"style-name"},{ens:Z,en:"data-label",ans:Z,a:"style-name"},{ens:Z,en:"data-point",ans:Z,a:"style-name"},{ens:Z,en:"equation",ans:Z,a:"style-name"},{ens:Z,en:"error-indicator",ans:Z,a:"style-name"},{ens:Z,en:"floor",ans:Z,a:"style-name"},{ens:Z,en:"footer",ans:Z,a:"style-name"},{ens:Z,en:"grid",ans:Z,a:"style-name"},{ens:Z,en:"legend",ans:Z,a:"style-name"},{ens:Z,en:"mean-value",ans:Z,a:"style-name"},{ens:Z,en:"plot-area",ans:Z,a:"style-name"},{ens:Z,en:"regression-curve",ans:Z,a:"style-name"},{ens:Z,en:"series",ans:Z,a:"style-name"},{ens:Z,en:"stock-gain-marker",ans:Z,a:"style-name"},{ens:Z,en:"stock-loss-marker",ans:Z,a:"style-name"},{ens:Z,en:"stock-range-line",ans:Z,a:"style-name"},{ens:Z,en:"subtitle",ans:Z,a:"style-name"},{ens:Z,en:"title",ans:Z,a:"style-name"},{ens:Z,en:"wall",ans:Z,a:"style-name"}],section:[{ens:G,en:"alphabetical-index",ans:G,a:"style-name"},{ens:G,en:"bibliography",ans:G,a:"style-name"},{ens:G,en:"illustration-index",ans:G,a:"style-name"},{ens:G,en:"index-title",ans:G,a:"style-name"},{ens:G,en:"object-index",ans:G,a:"style-name"},{ens:G,en:"section",ans:G,a:"style-name"},{ens:G,en:"table-of-content",ans:G,a:"style-name"},{ens:G,en:"table-index",ans:G,a:"style-name"},{ens:G,en:"user-index",ans:G,a:"style-name"}],ruby:[{ens:G,en:"ruby",ans:G,a:"style-name"}],table:[{ens:W,en:"query",ans:W,a:"style-name"},{ens:W,en:"table-representation",ans:W,a:"style-name"},{ens:F,en:"background",ans:F,a:"style-name"},{ens:F,en:"table",ans:F,a:"style-name"}],"table-column":[{ens:W,en:"column",ans:W,a:"style-name"},{ens:F,en:"table-column",ans:F,a:"style-name"}],"table-row":[{ens:W,en:"query",ans:W,a:"default-row-style-name"},{ens:W,en:"table-representation",ans:W,a:"default-row-style-name"},{ens:F,en:"table-row",ans:F,a:"style-name"}],"table-cell":[{ens:W,en:"column",ans:W,a:"default-cell-style-name"},{ens:F,en:"table-column",ans:F,a:"default-cell-style-name"},{ens:F,en:"table-row",ans:F,a:"default-cell-style-name"},{ens:F,en:"body",ans:F,a:"style-name"},{ens:F,en:"covered-table-cell",ans:F,a:"style-name"},{ens:F,en:"even-columns",ans:F,a:"style-name"},{ens:F,en:"covered-table-cell",ans:F,a:"style-name"},{ens:F,en:"even-columns",ans:F,a:"style-name"},{ens:F,en:"even-rows",ans:F,a:"style-name"},{ens:F,en:"first-column",ans:F,a:"style-name"},{ens:F,en:"first-row",ans:F,a:"style-name"},{ens:F,en:"last-column",ans:F,a:"style-name"},{ens:F,en:"last-row",ans:F,a:"style-name"},{ens:F,en:"odd-columns",ans:F,a:"style-name"},{ens:F,en:"odd-rows",ans:F,a:"style-name"},{ens:F,en:"table-cell",ans:F,a:"style-name"}],graphic:[{ens:P,en:"cube",ans:S,a:"style-name"},{ens:P,en:"extrude",ans:S,a:"style-name"},{ens:P,en:"rotate",ans:S,a:"style-name"},{ens:P,en:"scene",ans:S,a:"style-name"},{ens:P,en:"sphere",ans:S,a:"style-name"},{ens:S,en:"caption",ans:S,a:"style-name"},{ens:S,en:"circle",ans:S,a:"style-name"},{ens:S,en:"connector",ans:S,a:"style-name"},{ens:S,en:"control",ans:S,a:"style-name"},{ens:S,en:"custom-shape",ans:S,a:"style-name"},{ens:S,en:"ellipse",ans:S,a:"style-name"},{ens:S,en:"frame",ans:S,a:"style-name"},{ens:S,en:"g",ans:S,a:"style-name"},{ens:S,en:"line",ans:S,a:"style-name"},{ens:S,en:"measure",ans:S,a:"style-name"},{ens:S,en:"page-thumbnail",ans:S,a:"style-name"},{ens:S,en:"path",ans:S,a:"style-name"},{ens:S,en:"polygon",ans:S,a:"style-name"},{ens:S,en:"polyline",ans:S,a:"style-name"},{ens:S,en:"rect",ans:S,a:"style-name"},{ens:S,en:"regular-polygon",ans:S,a:"style-name"},{ens:o,en:"annotation",ans:S,a:"style-name"}],presentation:[{ens:P,en:"cube",ans:D,a:"style-name"},{ens:P,en:"extrude",ans:D,a:"style-name"},{ens:P,en:"rotate",ans:D,a:"style-name"},{ens:P,en:"scene",ans:D,a:"style-name"},{ens:P,en:"sphere",ans:D,a:"style-name"},{ens:S,en:"caption",ans:D,a:"style-name"},{ens:S,en:"circle",ans:D,a:"style-name"},{ens:S,en:"connector",ans:D,a:"style-name"},{ens:S,en:"control",ans:D,a:"style-name"},{ens:S,en:"custom-shape",ans:D,a:"style-name"},{ens:S,en:"ellipse",ans:D,a:"style-name"},{ens:S,en:"frame",ans:D,a:"style-name"},{ens:S,en:"g",ans:D,a:"style-name"},{ens:S,en:"line",ans:D,a:"style-name"},{ens:S,en:"measure",ans:D,a:"style-name"},{ens:S,en:"page-thumbnail",ans:D,a:"style-name"},{ens:S,en:"path",ans:D,a:"style-name"},{ens:S,en:"polygon",ans:D,a:"style-name"},{ens:S,en:"polyline",ans:D,a:"style-name"},{ens:S,en:"rect",ans:D,a:"style-name"},{ens:S,en:"regular-polygon",ans:D,a:"style-name"},{ens:o,en:"annotation",ans:D,a:"style-name"}],"drawing-page":[{ens:S,en:"page",ans:S,a:"style-name"},{ens:D,en:"notes",ans:S,a:"style-name"},{ens:E,en:"handout-master",ans:S,a:"style-name"},{ens:E,en:"master-page",ans:S,a:"style-name"}],"list-style":[{ens:G,en:"list",ans:G,a:"style-name"},{ens:G,en:"numbered-paragraph",ans:G,a:"style-name"},{ens:G,en:"list-item",ans:G,a:"style-override"},{ens:E,en:"style",ans:E,a:"list-style-name"}],data:[{ens:E,en:"style",ans:E,a:"data-style-name"},{ens:E,en:"style",ans:E,a:"percentage-data-style-name"},{ens:D,en:"date-time-decl",ans:E,a:"data-style-name"},{ens:G,en:"creation-date",ans:E,a:"data-style-name"},{ens:G,en:"creation-time",ans:E,a:"data-style-name"},{ens:G,en:"database-display",ans:E,a:"data-style-name"},{ens:G,en:"date",ans:E,a:"data-style-name"},{ens:G,en:"editing-duration",ans:E,a:"data-style-name"},{ens:G,en:"expression",ans:E,a:"data-style-name"},{ens:G,en:"meta-field",ans:E,a:"data-style-name"},{ens:G,en:"modification-date",ans:E,a:"data-style-name"},{ens:G,en:"modification-time",ans:E,a:"data-style-name"},{ens:G,en:"print-date",ans:E,a:"data-style-name"},{ens:G,en:"print-time",ans:E,a:"data-style-name"},{ens:G,en:"table-formula",ans:E,a:"data-style-name"},{ens:G,en:"time",ans:E,a:"data-style-name"},{ens:G,en:"user-defined",ans:E,a:"data-style-name"},{ens:G,en:"user-field-get",ans:E,a:"data-style-name"},{ens:G,en:"user-field-input",ans:E,a:"data-style-name"},{ens:G,en:"variable-get",ans:E,a:"data-style-name"},{ens:G,en:"variable-input",ans:E,a:"data-style-name"},{ens:G,en:"variable-set",ans:E,a:"data-style-name"}],"page-layout":[{ens:D,en:"notes",ans:E,a:"page-layout-name"},{ens:E,en:"handout-master",ans:E,a:"page-layout-name"},{ens:E,en:"master-page",ans:E,a:"page-layout-name"}]},j,i=xmldom.XPath;this.collectUsedFontFaces=V;this.changeFontFaceNames=Q;this.UsedStyleList=function(b,e){var f={};this.uses=function(g){var h=g.localName,c=g.getAttributeNS(S,"name")||g.getAttributeNS(E,"name");g="style"===h?g.getAttributeNS(E,"family"):g.namespaceURI===C?"data":h;return(g=f[g])?0<g[c]:!1};Y(b,f);e&&J(e,f)};this.getStyleName=function(f,k){var e,l,g=j[k.localName];if(g&&(g=g[k.namespaceURI])){for(l=0;l<g.length;l+=1){if(g[l].keyname===f&&(g=g[l],k.hasAttributeNS(g.ns,g.localname))){e=k.getAttributeNS(g.ns,g.localname);break}}}return e};this.hasDerivedStyles=function(f,g,e){var h=e.getAttributeNS(E,"name");e=e.getAttributeNS(E,"family");return i.getODFElementsWithXPath(f,'//style:*[@style:parent-style-name="'+h+'"][@style:family="'+e+'"]',g).length?!0:!1};this.prefixStyleNames=function(n,r,h){var t;if(n){for(t=n.firstChild;t;){if(t.nodeType===Node.ELEMENT_NODE){var g=t,q=r,k=g.getAttributeNS(S,"name"),p=void 0;k?p=S:(k=g.getAttributeNS(E,"name"))&&(p=E);p&&g.setAttributeNS(p,M[p]+"name",q+k)}t=t.nextSibling}T(n,r);h&&T(h,r)}};this.removePrefixFromStyleNames=function(n,r,h){var t=new RegExp("^"+r);if(n){for(r=n.firstChild;r;){if(r.nodeType===Node.ELEMENT_NODE){var g=r,q=t,k=g.getAttributeNS(S,"name"),p=void 0;k?p=S:(k=g.getAttributeNS(E,"name"))&&(p=E);p&&(k=k.replace(q,""),g.setAttributeNS(p,M[p]+"name",k))}r=r.nextSibling}R(n,t);h&&R(h,t)}};this.determineStylesForNode=X;j=function(){var x,u,w,v,q,k={},t,p,r,g;for(w in B){if(B.hasOwnProperty(w)){for(v=B[w],u=v.length,x=0;x<u;x+=1){q=v[x],r=q.en,g=q.ens,k.hasOwnProperty(r)?t=k[r]:k[r]=t={},t.hasOwnProperty(g)?p=t[g]:t[g]=p=[],p.push({ns:q.ans,localname:q.a,keyname:w})}}}return k}()};"function"!==typeof Object.create&&(Object.create=function(b){var a=function(){};a.prototype=b;return new a});xmldom.LSSerializer=function(){function e(h){var n=h||{},j=function(c){var g={},k;for(k in c){c.hasOwnProperty(k)&&(g[c[k]]=k)}return g}(h),i=[n],l=[j],m=0;this.push=function(){m+=1;n=i[m]=Object.create(n);j=l[m]=Object.create(j)};this.pop=function(){i.pop();l.pop();--m;n=i[m];j=l[m]};this.getLocalNamespaceDefinitions=function(){return j};this.getQName=function(g){var k=g.namespaceURI,o=0,c;if(!k){return g.localName}if(c=j[k]){return c+":"+g.localName}do{c||!g.prefix?(c="ns"+o,o+=1):c=g.prefix;if(n[c]===k){break}if(!n[c]){n[c]=k;j[k]=c;break}c=null}while(null===c);return c+":"+g.localName}}function d(c){return c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function f(s,i){var p="",b=a.filter?a.filter.acceptNode(i):NodeFilter.FILTER_ACCEPT,c;if(b===NodeFilter.FILTER_ACCEPT&&i.nodeType===Node.ELEMENT_NODE){s.push();c=s.getQName(i);var t,k=i.attributes,w,u,j,o="",v;t="<"+c;w=k.length;for(u=0;u<w;u+=1){j=k.item(u),"http://www.w3.org/2000/xmlns/"!==j.namespaceURI&&(v=a.filter?a.filter.acceptNode(j):NodeFilter.FILTER_ACCEPT,v===NodeFilter.FILTER_ACCEPT&&(v=s.getQName(j),j="string"===typeof j.value?d(j.value):j.value,o+=" "+(v+'="'+j+'"')))}w=s.getLocalNamespaceDefinitions();for(u in w){w.hasOwnProperty(u)&&((k=w[u])?"xmlns"!==k&&(t+=" xmlns:"+w[u]+'="'+u+'"'):t+=' xmlns="'+u+'"')}p+=t+(o+">")}if(b===NodeFilter.FILTER_ACCEPT||b===NodeFilter.FILTER_SKIP){for(b=i.firstChild;b;){p+=f(s,b),b=b.nextSibling}i.nodeValue&&(p+=d(i.nodeValue))}c&&(p+="</"+c+">",s.pop());return p}var a=this;this.filter=null;this.writeToString=function(c,h){if(!c){return""}var g=new e(h);return f(g,c)}};(function(){function m(c){var e,f=d.length;for(e=0;e<f;e+=1){if("urn:oasis:names:tc:opendocument:xmlns:office:1.0"===c.namespaceURI&&c.localName===d[e]){return e}}return -1}function l(e,f){var g=new o.UsedStyleList(e,f),k=new odf.OdfNodeFilter;this.acceptNode=function(a){var c=k.acceptNode(a);c===NodeFilter.FILTER_ACCEPT&&a.parentNode===f&&a.nodeType===Node.ELEMENT_NODE&&(c=g.uses(a)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);return c}}function t(c,e){var f=new l(c,e);this.acceptNode=function(k){var g=f.acceptNode(k);g!==NodeFilter.FILTER_ACCEPT||!k.parentNode||k.parentNode.namespaceURI!==odf.Namespaces.textns||"s"!==k.parentNode.localName&&"tab"!==k.parentNode.localName||(g=NodeFilter.FILTER_REJECT);return g}}function u(e,f){if(f){var k=m(f),n,g=e.firstChild;if(-1!==k){for(;g;){n=m(g);if(-1!==n&&n>k){break}g=g.nextSibling}e.insertBefore(f,g)}}}var o=new odf.StyleInfo,j=core.DomUtils,i=odf.Namespaces.stylens,d="meta settings scripts font-face-decls styles automatic-styles master-styles body".split(" "),h=Date.now()+"_webodf_",s=new core.Base64;odf.ODFElement=function(){};odf.ODFDocumentElement=function(){};odf.ODFDocumentElement.prototype=new odf.ODFElement;odf.ODFDocumentElement.prototype.constructor=odf.ODFDocumentElement;odf.ODFDocumentElement.prototype.fontFaceDecls=null;odf.ODFDocumentElement.prototype.manifest=null;odf.ODFDocumentElement.prototype.settings=null;odf.ODFDocumentElement.namespaceURI="urn:oasis:names:tc:opendocument:xmlns:office:1.0";odf.ODFDocumentElement.localName="document";odf.AnnotationElement=function(){};odf.OdfPart=function(e,f,k,n){var g=this;this.size=0;this.type=null;this.name=e;this.container=k;this.url=null;this.mimetype=f;this.onstatereadychange=this.document=null;this.EMPTY=0;this.LOADING=1;this.DONE=2;this.state=this.EMPTY;this.data="";this.load=function(){null!==n&&(this.mimetype=f,n.loadAsDataURL(e,f,function(b,c){b&&runtime.log(b);g.url=c;if(g.onchange){g.onchange(g)}if(g.onstatereadychange){g.onstatereadychange(g)}}))}};odf.OdfPart.prototype.load=function(){};odf.OdfPart.prototype.getUrl=function(){return this.data?"data:;base64,"+s.toBase64(this.data):null};odf.OdfContainer=function v(aw,at){function au(r){for(var w=r.firstChild,g;w;){g=w.nextSibling,w.nodeType===Node.ELEMENT_NODE?au(w):w.nodeType===Node.PROCESSING_INSTRUCTION_NODE&&r.removeChild(w),w=g}}function av(r){var z={},g,A,w=r.ownerDocument.createNodeIterator(r,NodeFilter.SHOW_ELEMENT,null,!1);for(r=w.nextNode();r;){"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===r.namespaceURI&&("annotation"===r.localName?(g=r.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))&&(z.hasOwnProperty(g)?runtime.log("Warning: annotation name used more than once with <office:annotation/>: '"+g+"'"):z[g]=r):"annotation-end"===r.localName&&((g=r.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))?z.hasOwnProperty(g)?(A=z[g],A.annotationEndElement?runtime.log("Warning: annotation name used more than once with <office:annotation-end/>: '"+g+"'"):A.annotationEndElement=r):runtime.log("Warning: annotation end without an annotation start, name: '"+g+"'"):runtime.log("Warning: annotation end without a name found"))),r=w.nextNode()}}function ar(r,w){for(var g=r&&r.firstChild;g;){g.nodeType===Node.ELEMENT_NODE&&g.setAttributeNS("urn:webodf:names:scope","scope",w),g=g.nextSibling}}function am(r,w){for(var g=ah.rootElement.meta,g=g&&g.firstChild;g&&(g.namespaceURI!==r||g.localName!==w);){g=g.nextSibling}for(g=g&&g.firstChild;g&&g.nodeType!==Node.TEXT_NODE;){g=g.nextSibling}return g?g.data:null}function an(r){var w={},g;for(r=r.firstChild;r;){r.nodeType===Node.ELEMENT_NODE&&r.namespaceURI===i&&"font-face"===r.localName&&(g=r.getAttributeNS(i,"name"),w[g]=r),r=r.nextSibling}return w}function ao(r,A){var g=null,B,w,z;if(r){for(g=r.cloneNode(!0),B=g.firstElementChild;B;){w=B.nextElementSibling,(z=B.getAttributeNS("urn:webodf:names:scope","scope"))&&z!==A&&g.removeChild(B),B=w}}return g}function ap(w,B){var r,C,z,A=null,g={};if(w){for(B.forEach(function(D){o.collectUsedFontFaces(g,D)}),A=w.cloneNode(!0),r=A.firstElementChild;r;){C=r.nextElementSibling,z=r.getAttributeNS(i,"name"),g[z]||A.removeChild(r),r=C}}return A}function aq(r){var w=ah.rootElement.ownerDocument,g;if(r){au(r.documentElement);try{g=w.importNode(r.documentElement,!0)}catch(z){}}return g}function ai(g){ah.state=g;if(ah.onchange){ah.onchange(ah)}if(ah.onstatereadychange){ah.onstatereadychange(ah)}}function ac(g){q=null;ah.rootElement=g;g.fontFaceDecls=j.getDirectChild(g,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");g.styles=j.getDirectChild(g,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles");g.automaticStyles=j.getDirectChild(g,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");g.masterStyles=j.getDirectChild(g,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles");g.body=j.getDirectChild(g,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");g.meta=j.getDirectChild(g,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta");g.settings=j.getDirectChild(g,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings");g.scripts=j.getDirectChild(g,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","scripts");av(g)}function X(w){var z=aq(w),g=ah.rootElement,r;z&&"document-styles"===z.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===z.namespaceURI?(g.fontFaceDecls=j.getDirectChild(z,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),u(g,g.fontFaceDecls),r=j.getDirectChild(z,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),g.styles=r||w.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),u(g,g.styles),r=j.getDirectChild(z,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),g.automaticStyles=r||w.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),ar(g.automaticStyles,"document-styles"),u(g,g.automaticStyles),z=j.getDirectChild(z,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),g.masterStyles=z||w.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),u(g,g.masterStyles),o.prefixStyleNames(g.automaticStyles,h,g.masterStyles)):ai(v.INVALID)}function T(K){K=aq(K);var L,C,J,A;if(K&&"document-content"===K.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===K.namespaceURI){L=ah.rootElement;J=j.getDirectChild(K,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");if(L.fontFaceDecls&&J){A=L.fontFaceDecls;var F,B,I,w,r={};C=an(A);w=an(J);for(J=J.firstElementChild;J;){F=J.nextElementSibling;if(J.namespaceURI===i&&"font-face"===J.localName){if(B=J.getAttributeNS(i,"name"),C.hasOwnProperty(B)){if(!J.isEqualNode(C[B])){I=B;for(var M=C,P=w,N=0,z=void 0,z=I=I.replace(/\d+$/,"");M.hasOwnProperty(z)||P.hasOwnProperty(z);){N+=1,z=I+N}I=z;J.setAttributeNS(i,"style:name",I);A.appendChild(J);C[I]=J;delete w[B];r[B]=I}}else{A.appendChild(J),C[B]=J,delete w[B]}}J=F}A=r}else{J&&(L.fontFaceDecls=J,u(L,J))}C=j.getDirectChild(K,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");ar(C,"document-content");A&&o.changeFontFaceNames(C,A);if(L.automaticStyles&&C){for(A=C.firstChild;A;){L.automaticStyles.appendChild(A),A=C.firstChild}}else{C&&(L.automaticStyles=C,u(L,C))}K=j.getDirectChild(K,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");if(null===K){throw"<office:body/> tag is mising."}L.body=K;u(L,L.body)}else{ai(v.INVALID)}}function ae(g){g=aq(g);var r;g&&"document-meta"===g.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===g.namespaceURI&&(r=ah.rootElement,r.meta=j.getDirectChild(g,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),u(r,r.meta))}function G(g){g=aq(g);var r;g&&"document-settings"===g.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===g.namespaceURI&&(r=ah.rootElement,r.settings=j.getDirectChild(g,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),u(r,r.settings))}function y(g){g=aq(g);var r;if(g&&"manifest"===g.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===g.namespaceURI){for(r=ah.rootElement,r.manifest=g,g=r.manifest.firstElementChild;g;){"file-entry"===g.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===g.namespaceURI&&(H[g.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","full-path")]=g.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","media-type")),g=g.nextElementSibling}}}function af(r,w,g){r=j.getElementsByTagName(r,w);var z;for(z=0;z<r.length;z+=1){w=r[z],g.hasOwnProperty(w.namespaceURI)||w.parentNode.removeChild(w)}}function f(g){af(g,"script",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:office:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:table:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:text:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":!0});af(g,"style",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:style:1.0":!0})}function e(w){var C=w.firstElementChild,r=[],D,z,B,g=w.attributes,A=g.length;for(D=0;D<A;D+=1){B=g.item(D),z=B.localName.substr(0,2).toLowerCase(),null===B.namespaceURI&&"on"===z&&r.push(B)}A=r.length;for(D=0;D<A;D+=1){w.removeAttributeNode(r[D])}for(;C;){e(C),C=C.nextElementSibling}}function ab(r){var g=r.shift();g?c.loadAsDOM(g.path,function(z,w){w&&(f(w),e(w.documentElement));g.handler(w);ah.state===v.INVALID?z?runtime.log("ERROR: Unable to load "+g.path+" - "+z):runtime.log("ERROR: Unable to load "+g.path):(z&&runtime.log("DEBUG: Unable to load "+g.path+" - "+z),ab(r))}):(av(ah.rootElement),ai(v.DONE))}function p(g){var r="";odf.Namespaces.forEachPrefix(function(z,w){r+=" xmlns:"+z+'="'+w+'"'});return'<?xml version="1.0" encoding="UTF-8"?><office:'+g+" "+r+' office:version="1.2">'}function x(){var g=new xmldom.LSSerializer,r=p("document-meta");g.filter=new odf.OdfNodeFilter;r+=g.writeToString(ah.rootElement.meta,odf.Namespaces.namespaceMap);return r+"</office:document-meta>"}function aj(r,w){var g=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:file-entry");g.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:full-path",r);g.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:media-type",w);return g}function n(){var r=runtime.parseXML('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2"></manifest:manifest>'),w=r.documentElement,g=new xmldom.LSSerializer,z;for(z in H){H.hasOwnProperty(z)&&w.appendChild(aj(z,H[z]))}g.filter=new odf.OdfNodeFilter;return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+g.writeToString(r,odf.Namespaces.namespaceMap)}function al(){var r,A,g,B=odf.Namespaces.namespaceMap,w=new xmldom.LSSerializer,z=p("document-styles");A=ao(ah.rootElement.automaticStyles,"document-styles");g=ah.rootElement.masterStyles.cloneNode(!0);r=ap(ah.rootElement.fontFaceDecls,[g,ah.rootElement.styles,A]);o.removePrefixFromStyleNames(A,h,g);w.filter=new l(g,A);z+=w.writeToString(r,B);z+=w.writeToString(ah.rootElement.styles,B);z+=w.writeToString(A,B);z+=w.writeToString(g,B);return z+"</office:document-styles>"}function a(){var r,A,g=odf.Namespaces.namespaceMap,w=new xmldom.LSSerializer,z=p("document-content");A=ao(ah.rootElement.automaticStyles,"document-content");r=ap(ah.rootElement.fontFaceDecls,[A]);w.filter=new t(ah.rootElement.body,A);z+=w.writeToString(r,g);z+=w.writeToString(A,g);z+=w.writeToString(ah.rootElement.body,g);return z+"</office:document-content>"}function ag(r,g){runtime.loadXML(r,function(z,A){if(z){g(z)}else{if(A){f(A);e(A.documentElement);var w=aq(A);w&&"document"===w.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===w.namespaceURI?(ac(w),ai(v.DONE)):ai(v.INVALID)}else{g("No DOM was loaded.")}}})}function b(g,w){var z;z=ah.rootElement;var r=z.meta;r||(z.meta=r=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),u(z,r));z=r;g&&j.mapKeyValObjOntoNode(z,g,odf.Namespaces.lookupNamespaceURI);w&&j.removeKeyElementsFromNode(z,w,odf.Namespaces.lookupNamespaceURI)}function ax(D,w){function E(F,I){var g;I||(I=F);g=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",I);B[F]=g;B.appendChild(g)}var z=new core.Zip("",null),C="application/vnd.oasis.opendocument."+D+(!0===w?"-template":""),r=runtime.byteArrayFromString(C,"utf8"),B=ah.rootElement,A=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",D);z.save("mimetype",r,!1,new Date);E("meta");E("settings");E("scripts");E("fontFaceDecls","font-face-decls");E("styles");E("automaticStyles","automatic-styles");E("masterStyles","master-styles");E("body");B.body.appendChild(A);H["/"]=C;H["settings.xml"]="text/xml";H["meta.xml"]="text/xml";H["styles.xml"]="text/xml";H["content.xml"]="text/xml";ai(v.DONE);return z}function k(){var r,w=new Date,g="";ah.rootElement.settings&&ah.rootElement.settings.firstElementChild&&(r=new xmldom.LSSerializer,g=p("document-settings"),r.filter=new odf.OdfNodeFilter,g+=r.writeToString(ah.rootElement.settings,odf.Namespaces.namespaceMap),g+="</office:document-settings>");(r=g)?(r=runtime.byteArrayFromString(r,"utf8"),c.save("settings.xml",r,!0,w)):c.remove("settings.xml");g=runtime.getWindow();r="WebODF/"+webodf.Version;g&&(r=r+" "+g.navigator.userAgent);b({"meta:generator":r},null);r=runtime.byteArrayFromString(x(),"utf8");c.save("meta.xml",r,!0,w);r=runtime.byteArrayFromString(al(),"utf8");c.save("styles.xml",r,!0,w);r=runtime.byteArrayFromString(a(),"utf8");c.save("content.xml",r,!0,w);r=runtime.byteArrayFromString(n(),"utf8");c.save("META-INF/manifest.xml",r,!0,w)}function ak(g,r){k();c.writeAs(g,function(w){r(w)})}var ah=this,c,H={},q,ad="";this.onstatereadychange=at;this.state=this.onchange=null;this.getMetadata=am;this.setRootElement=ac;this.getContentElement=function(){var g;q||(g=ah.rootElement.body,q=j.getDirectChild(g,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","text")||j.getDirectChild(g,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","presentation")||j.getDirectChild(g,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","spreadsheet"));if(!q){throw"Could not find content element in <office:body/>."}return q};this.getDocumentType=function(){var g=ah.getContentElement();return g&&g.localName};this.isTemplate=function(){return"-template"===H["/"].substr(-9)};this.setIsTemplate=function(r){var w=H["/"],g="-template"===w.substr(-9);r!==g&&(w=r?w+"-template":w.substr(0,w.length-9),H["/"]=w,r=runtime.byteArrayFromString(w,"utf8"),c.save("mimetype",r,!1,new Date))};this.getPart=function(g){return new odf.OdfPart(g,H[g],ah,c)};this.getPartData=function(g,r){c.load(g,r)};this.setMetadata=b;this.incrementEditingCycles=function(){var g=am(odf.Namespaces.metans,"editing-cycles"),g=g?parseInt(g,10):0;isNaN(g)&&(g=0);b({"meta:editing-cycles":g+1},null);return g+1};this.createByteArray=function(g,r){k();c.createByteArray(g,r)};this.saveAs=ak;this.save=function(g){ak(ad,g)};this.getUrl=function(){return ad};this.setBlob=function(r,w,g){g=s.convertBase64ToByteArray(g);c.save(r,g,!1,new Date);H.hasOwnProperty(r)&&runtime.log(r+" has been overwritten.");H[r]=w};this.removeBlob=function(g){var r=c.remove(g);runtime.assert(r,"file is not found: "+g);delete H[g]};this.state=v.LOADING;this.rootElement=function(r){var w=document.createElementNS(r.namespaceURI,r.localName),g;r=new r.Type;for(g in r){r.hasOwnProperty(g)&&(w[g]=r[g])}return w}({Type:odf.ODFDocumentElement,namespaceURI:odf.ODFDocumentElement.namespaceURI,localName:odf.ODFDocumentElement.localName});aw===odf.OdfContainer.DocumentType.TEXT?c=ax("text"):aw===odf.OdfContainer.DocumentType.TEXT_TEMPLATE?c=ax("text",!0):aw===odf.OdfContainer.DocumentType.PRESENTATION?c=ax("presentation"):aw===odf.OdfContainer.DocumentType.PRESENTATION_TEMPLATE?c=ax("presentation",!0):aw===odf.OdfContainer.DocumentType.SPREADSHEET?c=ax("spreadsheet"):aw===odf.OdfContainer.DocumentType.SPREADSHEET_TEMPLATE?c=ax("spreadsheet",!0):(ad=aw,c=new core.Zip(ad,function(r,g){c=g;r?ag(ad,function(w){r&&(c.error=r+"\n"+w,ai(v.INVALID))}):ab([{path:"styles.xml",handler:X},{path:"content.xml",handler:T},{path:"meta.xml",handler:ae},{path:"settings.xml",handler:G},{path:"META-INF/manifest.xml",handler:y}])}))};odf.OdfContainer.EMPTY=0;odf.OdfContainer.LOADING=1;odf.OdfContainer.DONE=2;odf.OdfContainer.INVALID=3;odf.OdfContainer.SAVING=4;odf.OdfContainer.MODIFIED=5;odf.OdfContainer.getContainer=function(b){return new odf.OdfContainer(b,null)}})();odf.OdfContainer.DocumentType={TEXT:1,TEXT_TEMPLATE:2,PRESENTATION:3,PRESENTATION_TEMPLATE:4,SPREADSHEET:5,SPREADSHEET_TEMPLATE:6};gui.AnnotatableCanvas=function(){};gui.AnnotatableCanvas.prototype.refreshSize=function(){};gui.AnnotatableCanvas.prototype.getZoomLevel=function(){};gui.AnnotatableCanvas.prototype.getSizer=function(){};gui.AnnotationViewManager=function(t,s,x,y){function u(g){var a=g.annotationEndElement,k=o.createRange(),f=g.getAttributeNS(odf.Namespaces.officens,"name");a&&(k.setStart(g,g.childNodes.length),k.setEnd(a,0),g=z.getTextNodes(k,!1),g.forEach(function(b){var c;b:{for(c=b.parentNode;c.namespaceURI!==odf.Namespaces.officens||"body"!==c.localName;){if("http://www.w3.org/1999/xhtml"===c.namespaceURI&&"webodf-annotationHighlight"===c.className&&c.getAttribute("annotation")===f){c=!0;break b}c=c.parentNode}c=!1}c||(c=o.createElement("span"),c.className="webodf-annotationHighlight",c.setAttribute("annotation",f),b.parentNode.replaceChild(c,b),c.appendChild(b))}));k.detach()}function m(d){var c=t.getSizer();d?(x.style.display="inline-block",c.style.paddingRight=w.getComputedStyle(x).width):(x.style.display="none",c.style.paddingRight=0);t.refreshSize()}function j(){v.sort(function(b,c){return 0!==(b.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_FOLLOWING)?-1:1})}function h(){var G;for(G=0;G<v.length;G+=1){var E=v[G],F=E.parentNode,D=F.nextElementSibling,B=D.nextElementSibling,A=F.parentNode,C=0,C=v[v.indexOf(E)-1],c=void 0,E=t.getZoomLevel();F.style.left=(x.getBoundingClientRect().left-A.getBoundingClientRect().left)/E+"px";F.style.width=x.getBoundingClientRect().width/E+"px";D.style.width=parseFloat(F.style.left)-30+"px";C?(c=C.parentNode.getBoundingClientRect(),20>=(A.getBoundingClientRect().top-c.bottom)/E?F.style.top=Math.abs(A.getBoundingClientRect().top-c.bottom)/E+20+"px":F.style.top="0px"):F.style.top="0px";B.style.left=D.getBoundingClientRect().width/E+"px";var D=B.style,A=B.getBoundingClientRect().left/E,C=B.getBoundingClientRect().top/E,c=F.getBoundingClientRect().left/E,g=F.getBoundingClientRect().top/E,e=0,H=0,e=c-A,e=e*e,H=g-C,H=H*H,A=Math.sqrt(e+H);D.width=A+"px";C=Math.asin((F.getBoundingClientRect().top-B.getBoundingClientRect().top)/(E*parseFloat(B.style.width)));B.style.transform="rotate("+C+"rad)";B.style.MozTransform="rotate("+C+"rad)";B.style.WebkitTransform="rotate("+C+"rad)";B.style.msTransform="rotate("+C+"rad)"}}function i(f){var g=v.indexOf(f),e=f.parentNode.parentNode;"div"===e.localName&&(e.parentNode.insertBefore(f,e),e.parentNode.removeChild(e));f=f.getAttributeNS(odf.Namespaces.officens,"name");f=o.querySelectorAll('span.webodf-annotationHighlight[annotation="'+f+'"]');for(var k,e=0;e<f.length;e+=1){for(k=f.item(e);k.firstChild;){k.parentNode.insertBefore(k.firstChild,k)}k.parentNode.removeChild(k)}-1!==g&&v.splice(g,1);0===v.length&&m(!1)}var v=[],o=s.ownerDocument,z=odf.OdfUtils,w=runtime.getWindow();runtime.assert(Boolean(w),"Expected to be run in an environment which has a global window, like a browser.");this.rerenderAnnotations=h;this.rehighlightAnnotations=function(){v.forEach(function(b){u(b)})};this.getMinimumHeightForAnnotationPane=function(){return"none"!==x.style.display&&0<v.length?(v[v.length-1].parentNode.getBoundingClientRect().bottom-x.getBoundingClientRect().top)/t.getZoomLevel()+"px":null};this.addAnnotations=function(a){0!==a.length&&(m(!0),a.forEach(function(l){v.push(l);var q=o.createElement("div"),b=o.createElement("div"),p=o.createElement("div"),f=o.createElement("div"),e;q.className="annotationWrapper";q.setAttribute("creator",z.getAnnotationCreator(l));l.parentNode.insertBefore(q,l);b.className="annotationNote";b.appendChild(l);y&&(e=o.createElement("div"),e.className="annotationRemoveButton",b.appendChild(e));p.className="annotationConnector horizontal";f.className="annotationConnector angular";q.appendChild(b);q.appendChild(p);q.appendChild(f);l.annotationEndElement&&u(l)}),j(),h())};this.forgetAnnotation=i;this.forgetAnnotations=function(){for(;v.length;){i(v[0])}}};gui.Viewport=function(){};gui.Viewport.prototype.scrollIntoView=function(b,a){};gui.SingleScrollViewport=function(a){this.scrollIntoView=function(e,l){var d,h,j,i;i=a.offsetHeight-a.clientHeight;j=a.offsetWidth-a.clientWidth;var g=a.getBoundingClientRect();if(e&&g){d=g.left+5;h=g.top+5;j=g.right-(j+5);i=g.bottom-(i+5);if(l||e.top<h){a.scrollTop-=h-e.top}else{if(e.top>i||e.bottom>i){a.scrollTop=e.bottom-e.top<=i-h?a.scrollTop+(e.bottom-i):a.scrollTop+(e.top-h)}}e.left<d?a.scrollLeft-=d-e.left:e.right>j&&(a.scrollLeft=e.right-e.left<=j-d?a.scrollLeft+(e.right-j):a.scrollLeft-(d-e.left))}}};(function(){function e(p,o,h,i,j){var m,g=0,b;for(b in p){if(p.hasOwnProperty(b)){if(g===h){m=b;break}g+=1}}m?o.getPartData(p[m].href,function(n,c){if(n){runtime.log(n)}else{if(c){var q="@font-face { font-family: "+(p[m].family||m)+"; src: url(data:application/x-font-ttf;charset=binary;base64,"+a.convertUTF8ArrayToBase64(c)+') format("truetype"); }';try{i.insertRule(q,i.cssRules.length)}catch(k){runtime.log("Problem inserting rule in CSS: "+runtime.toJson(k)+"\nRule: "+q)}}else{runtime.log("missing font data for "+p[m].href)}}e(p,o,h+1,i,j)}):j&&j()}var d=xmldom.XPath,f=odf.OdfUtils,a=new core.Base64;odf.FontLoader=function(){this.loadFonts=function(c,o){for(var m=c.rootElement.fontFaceDecls;o.cssRules.length;){o.deleteRule(o.cssRules.length-1)}if(m){var i={},j,k,h,g;if(m){for(m=d.getODFElementsWithXPath(m,"style:font-face[svg:font-face-src]",odf.Namespaces.lookupNamespaceURI),j=0;j<m.length;j+=1){k=m[j],h=k.getAttributeNS(odf.Namespaces.stylens,"name"),g=f.getNormalizedFontFamilyName(k.getAttributeNS(odf.Namespaces.svgns,"font-family")),k=d.getODFElementsWithXPath(k,"svg:font-face-src/svg:font-face-uri",odf.Namespaces.lookupNamespaceURI),0<k.length&&(k=k[0].getAttributeNS(odf.Namespaces.xlinkns,"href"),i[h]={href:k,family:g})}}e(i,c,0,o)}}}})();odf.Formatting=function(){function N(b){return(b=G[b])?C.mergeObjects({},b):{}}function L(){for(var g=T.rootElement.fontFaceDecls,a={},h,f,g=g&&g.firstElementChild;g;){if(h=g.getAttributeNS(M,"name")){if((f=g.getAttributeNS(J,"font-family"))||0<g.getElementsByTagNameNS(J,"font-face-uri").length){a[h]=f}}g=g.nextElementSibling}return a}function R(c){for(var a=T.rootElement.styles.firstElementChild;a;){if(a.namespaceURI===M&&"default-style"===a.localName&&a.getAttributeNS(M,"family")===c){return a}a=a.nextElementSibling}return null}function S(k,f,n){var h,a,g;n=n||[T.rootElement.automaticStyles,T.rootElement.styles];for(g=0;g<n.length;g+=1){for(h=n[g],h=h.firstElementChild;h;){a=h.getAttributeNS(M,"name");if(h.namespaceURI===M&&"style"===h.localName&&h.getAttributeNS(M,"family")===f&&a===k||"list-style"===f&&h.namespaceURI===j&&"list-style"===h.localName&&a===k||"data"===f&&h.namespaceURI===o&&a===k){return h}h=h.nextElementSibling}}return null}function O(k){for(var p,g,q,n,f={},h=k.firstElementChild;h;){if(h.namespaceURI===M){for(q=f[h.nodeName]={},g=h.attributes,p=0;p<g.length;p+=1){n=g.item(p),q[n.name]=n.value}}h=h.nextElementSibling}g=k.attributes;for(p=0;p<g.length;p+=1){n=g.item(p),f[n.name]=n.value}return f}function I(h,g){for(var a=T.rootElement.styles,b,p={},c=h.getAttributeNS(M,"family"),f=h;f;){b=O(f),p=C.mergeObjects(b,p),f=(b=f.getAttributeNS(M,"parent-style-name"))?S(b,c,[a]):null}if(f=R(c)){b=O(f),p=C.mergeObjects(b,p)}!1!==g&&(b=N(c),p=C.mergeObjects(b,p));return p}function H(d,t){function k(b){Object.keys(b).forEach(function(c){Object.keys(b[c]).forEach(function(e){p+="|"+c+":"+e+"|"})})}for(var q=d.nodeType===Node.TEXT_NODE?d.parentNode:d,a,g=[],p="",r=!1;q&&!s.isInlineRoot(q)&&q.parentNode!==T.rootElement;){!r&&s.isGroupingElement(q)&&(r=!0),(a=Q.determineStylesForNode(q))&&g.push(a),q=q.parentNode}r&&(g.forEach(k),t&&(t[p]=g));return r?g:void 0}function E(a){var b={orderedStyles:[],styleProperties:{}};a.forEach(function(c){Object.keys(c).forEach(function(k){var d=Object.keys(c[k])[0],g={name:d,family:k,displayName:void 0,isCommonStyle:!1},h;(h=S(d,k))?(k=I(h),b.styleProperties=C.mergeObjects(k,b.styleProperties),g.displayName=h.getAttributeNS(M,"display-name")||void 0,g.isCommonStyle=h.parentNode===T.rootElement.styles):runtime.log("No style element found for '"+d+"' of family '"+k+"'");b.orderedStyles.push(g)})});return b}function F(f,g){var e={},h=[];g||(g={});f.forEach(function(b){H(b,e)});Object.keys(e).forEach(function(b){g[b]||(g[b]=E(e[b]));h.push(g[b])});return h}function P(c){for(var a=T.rootElement.masterStyles.firstElementChild;a&&(a.namespaceURI!==M||"master-page"!==a.localName||a.getAttributeNS(M,"name")!==c);){a=a.nextElementSibling}return a}function K(e,f){var c;e&&(c=D.convertMeasure(e,"px"));void 0===c&&f&&(c=D.convertMeasure(f,"px"));return c}var T,Q=new odf.StyleInfo,J=odf.Namespaces.svgns,M=odf.Namespaces.stylens,j=odf.Namespaces.textns,o=odf.Namespaces.numberns,i=odf.Namespaces.fons,s=odf.OdfUtils,B=core.DomUtils,C=new core.Utils,D=new core.CSSUnits,G={paragraph:{"style:paragraph-properties":{"fo:text-align":"left"}}};this.getSystemDefaultStyleAttributes=N;this.setOdfContainer=function(a){T=a};this.getFontMap=L;this.getAvailableParagraphStyles=function(){for(var g=T.rootElement.styles,a,h,f=[],g=g&&g.firstElementChild;g;){"style"===g.localName&&g.namespaceURI===M&&(a=g.getAttributeNS(M,"family"),"paragraph"===a&&(a=g.getAttributeNS(M,"name"),h=g.getAttributeNS(M,"display-name")||a,a&&h&&f.push({name:a,displayName:h}))),g=g.nextElementSibling}return f};this.isStyleUsed=function(a){var f,d=T.rootElement;f=Q.hasDerivedStyles(d,odf.Namespaces.lookupNamespaceURI,a);a=(new Q.UsedStyleList(d.styles)).uses(a)||(new Q.UsedStyleList(d.automaticStyles)).uses(a)||(new Q.UsedStyleList(d.body)).uses(a);return f||a};this.getDefaultStyleElement=R;this.getStyleElement=S;this.getStyleAttributes=O;this.getInheritedStyleAttributes=I;this.getFirstCommonParentStyleNameOrSelf=function(b){var f=T.rootElement.styles,a;if(a=S(b,"paragraph",[T.rootElement.automaticStyles])){if(b=a.getAttributeNS(M,"parent-style-name"),!b){return null}}return(a=S(b,"paragraph",[f]))?b:null};this.hasParagraphStyle=function(b){return Boolean(S(b,"paragraph"))};this.getAppliedStyles=F;this.getAppliedStylesForElement=function(b,c){return F([b],c)[0]};this.updateStyle=function(g,a){var h,f;B.mapObjOntoNode(g,a,odf.Namespaces.lookupNamespaceURI);(h=(h=a["style:text-properties"])&&h["style:font-name"])&&!L().hasOwnProperty(h)&&(f=g.ownerDocument.createElementNS(M,"style:font-face"),f.setAttributeNS(M,"style:name",h),f.setAttributeNS(J,"svg:font-family",h),T.rootElement.fontFaceDecls.appendChild(f))};this.createDerivedStyleObject=function(f,g,b){var a=S(f,g);runtime.assert(Boolean(a),"No style element found for '"+f+"' of family '"+g+"'");f=a.parentNode===T.rootElement.styles?{"style:parent-style-name":f}:O(a);f["style:family"]=g;C.mergeObjects(f,b);return f};this.getDefaultTabStopDistance=function(){for(var b=R("paragraph"),b=b&&b.firstElementChild,c;b;){b.namespaceURI===M&&"paragraph-properties"===b.localName&&(c=b.getAttributeNS(M,"tab-stop-distance")),b=b.nextElementSibling}c||(c="1.25cm");return s.parseNonNegativeLength(c)};this.getMasterPageElement=P;this.getContentSize=function(x,z){var l,w,h,v,t,a,e,b,A,U;T:{w=S(x,z);runtime.assert("paragraph"===z||"table"===z,"styleFamily must be either paragraph or table");if(w){if(w=w.getAttributeNS(M,"master-page-name")){(l=P(w))||runtime.log("WARN: No master page definition found for "+w)}l||(l=P("Standard"));l||(l=T.rootElement.masterStyles.getElementsByTagNameNS(M,"master-page")[0])||runtime.log("WARN: Document has no master pages defined");if(l){for(w=l.getAttributeNS(M,"page-layout-name"),h=T.rootElement.automaticStyles.getElementsByTagNameNS(M,"page-layout"),v=0;v<h.length;v+=1){if(l=h.item(v),l.getAttributeNS(M,"name")===w){break T}}}}l=null}l||(l=B.getDirectChild(T.rootElement.styles,M,"default-page-layout"));(l=B.getDirectChild(l,M,"page-layout-properties"))?("landscape"===l.getAttributeNS(M,"print-orientation")?(w="29.7cm",h="21.001cm"):(w="21.001cm",h="29.7cm"),w=K(l.getAttributeNS(i,"page-width"),w),h=K(l.getAttributeNS(i,"page-height"),h),v=K(l.getAttributeNS(i,"margin")),void 0===v?(v=K(l.getAttributeNS(i,"margin-left"),"2cm"),t=K(l.getAttributeNS(i,"margin-right"),"2cm"),a=K(l.getAttributeNS(i,"margin-top"),"2cm"),e=K(l.getAttributeNS(i,"margin-bottom"),"2cm")):v=t=a=e=v,b=K(l.getAttributeNS(i,"padding")),void 0===b?(b=K(l.getAttributeNS(i,"padding-left"),"0cm"),A=K(l.getAttributeNS(i,"padding-right"),"0cm"),U=K(l.getAttributeNS(i,"padding-top"),"0cm"),l=K(l.getAttributeNS(i,"padding-bottom"),"0cm")):b=A=U=l=b):(w=K("21.001cm"),h=K("29.7cm"),v=t=a=e=v=K("2cm"),b=A=U=l=b=K("0cm"));return{width:w-v-t-b-A,height:h-a-e-U-l}}};(function(){var b=odf.Namespaces.stylens,a=odf.Namespaces.textns,d={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"};odf.StyleTreeNode=function(c){this.derivedStyles={};this.element=c};odf.StyleTree=function(c,i){function l(f){var m,o,p,n={};if(!f){return n}for(f=f.firstElementChild;f;){if(o=f.namespaceURI!==b||"style"!==f.localName&&"default-style"!==f.localName?f.namespaceURI===a&&"list-style"===f.localName?"list":f.namespaceURI!==b||"page-layout"!==f.localName&&"default-page-layout"!==f.localName?void 0:"page":f.getAttributeNS(b,"family")){(m=f.getAttributeNS(b,"name"))||(m=""),n.hasOwnProperty(o)?p=n[o]:n[o]=p={},p[m]=f}f=f.nextElementSibling}return n}function k(f,m){if(f.hasOwnProperty(m)){return f[m]}var o=null,p=Object.keys(f),n;for(n=0;n<p.length&&!(o=k(f[p[n]].derivedStyles,m));n+=1){}return o}function g(m,n,q){var r,p,o;if(!n.hasOwnProperty(m)){return null}r=new odf.StyleTreeNode(n[m]);p=r.element.getAttributeNS(b,"parent-style-name");o=null;p&&(o=k(q,p)||g(p,n,q));o?o.derivedStyles[m]=r:q[m]=r;delete n[m];return r}function h(e,f){e&&Object.keys(e).forEach(function(m){g(m,e,f)})}var j={};this.getStyleTree=function(){return j};(function(){var f,e,m;e=l(c);m=l(i);Object.keys(d).forEach(function(n){f=j[n]={};h(e[n],f);h(m[n],f)})})()}})();(function(){function h(g,n){try{g.insertRule(n,g.cssRules.length)}catch(k){runtime.log("cannot load rule: "+n+" - "+k)}}function d(f,g){this.listCounterCount=0;this.contentRules=f;this.counterIdStack=[];this.continuedCounterIdStack=g}function m(g){function p(x,v,w,q){var s=v.namespaceURI===l&&"list"===v.localName,b=v.namespaceURI===l&&"list-item"===v.localName;if(s||b){if(s){var s=w+=1,c,y,z;q.listCounterCount+=1;b=x+"-level"+s+"-"+q.listCounterCount;v.setAttributeNS("urn:webodf:names:helper","counter-id",b);c=q.continuedCounterIdStack.shift();c||(c=b,k+=b+" 1 ",y='text|list[webodfhelper|counter-id="'+b+'"] > text|list-item:first-child > :not(text|list):first-child:before',y+="{",y+="counter-increment: "+c+" 0;",y+="}",h(g,y));for(;q.counterIdStack.length>=s;){q.counterIdStack.pop()}q.counterIdStack.push(c);z=q.contentRules[s.toString()]||"";for(y=1;y<=s;y+=1){z=z.replace(y+"webodf-listLevel",q.counterIdStack[y-1])}y='text|list[webodfhelper|counter-id="'+b+'"] > text|list-item > :not(text|list):first-child:before';y+="{";y+=z;y+="counter-increment: "+c+";";y+="}";h(g,y)}for(v=v.firstElementChild;v;){p(x,v,w,q),v=v.nextElementSibling}}else{q.continuedCounterIdStack=[]}}var n=0,k="",o={};this.createCounterRules=function(f,c,t){var s=c.getAttributeNS(j,"id"),q=[];t&&(t=t.getAttributeNS("urn:webodf:names:helper","counter-id"),q=o[t].slice(0));f=new d(f,q);s?s="Y"+s:(n+=1,s="X"+n);p(s,c,0,f);o[s+"-level1-1"]=f.counterIdStack};this.initialiseCreatedCounters=function(){var b;b="office|document{"+("counter-reset: "+k+";");b+="}";h(g,b)}}var a=odf.Namespaces.fons,i=odf.Namespaces.stylens,l=odf.Namespaces.textns,j=odf.Namespaces.xmlns,e={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"};odf.ListStyleToCss=function(){function g(p){var k=b.parseLength(p);return k?o.convert(k.value,k.unit,"px"):(runtime.log("Could not parse value '"+p+"'."),0)}function n(k){return k.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function f(p,q){var k;p&&(k=p.getAttributeNS(l,"style-name"));return k===q}function c(Y,U,X){U=U.getElementsByTagNameNS(l,"list");Y=new m(Y);var Q,T,S,H,F,M,B={},y;for(y=0;y<U.length;y+=1){if(Q=U.item(y),M=Q.getAttributeNS(l,"style-name")){S=Q.getAttributeNS(l,"continue-numbering");H=Q.getAttributeNS(l,"continue-list");(F=Q.getAttributeNS(j,"id"))&&(B[F]=Q);F=X[M].element.firstElementChild;for(var x=void 0,C={};F;){var x=(x=F.getAttributeNS(l,"level"))&&parseInt(x,10),w=F,v="",G=void 0,r=void 0,p=G=void 0;if("list-level-style-number"===w.localName){var z=w,v=z.getAttributeNS(i,"num-format"),G=z.getAttributeNS(i,"num-suffix")||"",r=z.getAttributeNS(i,"num-prefix")||"",s="",u=z.getAttributeNS(l,"level"),z=z.getAttributeNS(l,"display-levels");r&&(s+='"'+n(r)+'"\n');if(e.hasOwnProperty(v)){for(u=u?parseInt(u,10):1,z=z?parseInt(z,10):1;0<z;){s+=" counter("+(u-z+1)+"webodf-listLevel,"+e[v]+")",1<z&&(s+='"."'),--z}}else{s=v?s+(' "'+v+'"'):s+' ""'}v="content:"+s+' "'+n(G)+'"'}else{"list-level-style-image"===w.localName?v="content: none":"list-level-style-bullet"===w.localName&&(v=w.getAttributeNS(l,"bullet-char"),v='content: "'+n(v)+'"')}if(G=w.getElementsByTagNameNS(i,"list-level-properties")[0]){r=G.getAttributeNS(l,"list-level-position-and-space-mode"),"label-alignment"===r&&((G=G.getElementsByTagNameNS(i,"list-level-label-alignment")[0])&&(p=G.getAttributeNS(l,"label-followed-by")),"space"===p&&(v+=' "\\a0"'))}C[x]="\n"+v+";\n";F=F.nextElementSibling}F=C;S&&!H&&f(T,M)?Y.createCounterRules(F,Q,T):H&&f(B[H],M)?Y.createCounterRules(F,Q,B[H]):Y.createCounterRules(F,Q);T=Q}}Y.initialiseCreatedCounters()}var o=new core.CSSUnits,b=odf.OdfUtils;this.applyListStyles=function(r,s,q){var k,p;(k=s.list)&&Object.keys(k).forEach(function(K){p=k[K];for(var G=p.element.firstElementChild;G;){if(G.namespaceURI===l){for(var F=r,u=G,v='text|list[text|style-name="'+K+'"]',H=u.getAttributeNS(l,"level"),L=void 0,M=void 0,C=M=void 0,B=void 0,t=void 0,z=L=void 0,w=void 0,I=void 0,A=void 0,B=void 0,C=(M=u.getElementsByTagNameNS(i,"list-level-properties")[0])&&M.getAttributeNS(l,"list-level-position-and-space-mode"),B=M&&M.getElementsByTagNameNS(i,"list-level-label-alignment")[0],L=H=H&&parseInt(H,10);1<L;){v+=" > text|list-item > text|list",--L}L=M&&M.getAttributeNS(a,"text-align")||"left";switch(L){case"end":L="right";break;case"start":L="left"}"label-alignment"===C?(t=B&&B.getAttributeNS(a,"margin-left")||"0px",I=B&&B.getAttributeNS(a,"text-indent")||"0px",A=B&&B.getAttributeNS(l,"label-followed-by"),B=g(t)):(t=M&&M.getAttributeNS(l,"space-before")||"0px",z=M&&M.getAttributeNS(l,"min-label-width")||"0px",w=M&&M.getAttributeNS(l,"min-label-distance")||"0px",B=g(t)+g(z));M=v+" > text|list-item";M+="{";M+="margin-left: "+B+"px;";M+="}";h(F,M);M=v+" > text|list-item > text|list";M+="{";M+="margin-left: "+-B+"px;";M+="}";h(F,M);M=v+" > text|list-item > :not(text|list):first-child:before";M+="{";M+="text-align: "+L+";";M+="display: inline-block;";"label-alignment"===C?(M+="margin-left: "+I+";","listtab"===A&&(M+="padding-right: 0.2cm;")):(M+="min-width: "+z+";",M+="margin-left: "+(0===parseFloat(z)?"":"-")+z+";",M+="padding-right: "+w+";");M+="}";h(F,M)}G=G.nextElementSibling}});c(r,q,k)}}})();odf.LazyStyleProperties=function(b,a){var d={};this.value=function(c){var e;d.hasOwnProperty(c)?e=d[c]:(e=a[c](),void 0===e&&b&&(e=b.value(c)),d[c]=e);return e};this.reset=function(c){b=c;d={}}};odf.StyleParseUtils=function(){function b(g){var d,e;g=(g=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px))/.exec(g))?{value:parseFloat(g[1]),unit:g[3]}:null;e=g&&g.unit;"px"===e?d=g.value:"cm"===e?d=g.value/2.54*96:"mm"===e?d=g.value/25.4*96:"in"===e?d=96*g.value:"pt"===e?d=g.value/0.75:"pc"===e&&(d=16*g.value);return d}var a=odf.Namespaces.stylens;this.parseLength=b;this.parsePositiveLengthOrPercent=function(i,d,g){var h;i&&(h=parseFloat(i.substr(0,i.indexOf("%"))),isNaN(h)&&(h=void 0));var e;void 0!==h?(g&&(e=g.value(d)),h=void 0===e?void 0:e/100*h):h=b(i);return h};this.getPropertiesElement=function(g,d,e){for(d=e?e.nextElementSibling:d.firstElementChild;null!==d&&(d.localName!==g||d.namespaceURI!==a);){d=d.nextElementSibling}return d};this.parseAttributeList=function(d){d&&(d=d.replace(/^\s*(.*?)\s*$/g,"$1"));return d&&0<d.length?d.split(/\s+/):[]}};odf.Style2CSS=function(){function ap(k,p,g){var q=[];g=g.derivedStyles;var n;var l=aa[k],f;void 0===l?p=null:(f=p?"["+l+'|style-name="'+p+'"]':"","presentation"===l&&(l="draw",f=p?'[presentation|style-name="'+p+'"]':""),p=l+"|"+ad[k].join(f+","+l+"|")+f);null!==p&&q.push(p);for(n in g){g.hasOwnProperty(n)&&(p=ap(k,n,g[n]),q=q.concat(p))}return q}function an(e){var f="",c="",f=null;if("default-style"===e.localName){return null}f=e.getAttributeNS(am,"parent-style-name");c=e.getAttributeNS(am,"family");return f=o.getODFElementsWithXPath(B,f?"//style:*[@style:name='"+f+"'][@style:family='"+c+"']":"//style:default-style[@style:family='"+c+"']",odf.Namespaces.lookupNamespaceURI)[0]}function au(J,D){var I="",E,A,w;for(E=0;E<D.length;E+=1){if(A=D[E],w=J.getAttributeNS(A[0],A[1])){w=w.trim();if(U.hasOwnProperty(A[1])){var v=w,z=v.indexOf(" "),u=void 0;w=void 0;-1!==z?(u=v.substring(0,z),w=v.substring(z)):(u=v,w="");(u=M.parseLength(u))&&"pt"===u.unit&&0.75>u.value&&(v="0.75pt"+w);w=v}else{if(j.hasOwnProperty(A[1])){var v=J,z=A[0],u=A[1],x=M.parseLength(w),k=void 0,t=void 0,l=void 0,y=void 0,l=void 0;if(x&&"%"===x.unit){k=x.value/100;t=an(v.parentNode);for(y="0";t;){if(l=ab.getDirectChild(t,am,"paragraph-properties")){if(l=M.parseLength(l.getAttributeNS(z,u))){if("%"!==l.unit){y=l.value*k+l.unit;break}k*=l.value/100}}t=an(t)}w=y}}}A[2]&&(I+=A[2]+":"+w+";")}}return I}function av(f,g,e,h){return g+g+e+e+h+h}function aq(f,g){var e=[f],h=g.derivedStyles;Object.keys(h).forEach(function(b){b=aq(b,h[b]);e=e.concat(b)});return e}function ak(k,q,g,t){function p(l,a){var m=[],e;l.forEach(function(b){f.forEach(function(c){m.push('draw|page[webodfhelper|page-style-name="'+c+'"] draw|frame[presentation|class="'+b+'"]')})});0<m.length&&(e=m.join(",")+"{visibility:"+a+";}",k.insertRule(e,k.cssRules.length))}var f=aq(q,t),h=[],r=[];["page-number","date-time","header","footer"].forEach(function(b){var c;c=g.getAttributeNS(ao,"display-"+b);"true"===c?h.push(b):"false"===c&&r.push(b)});p(h,"visible");p(r,"hidden")}function aj(q,m,b,e){var p,r;if("page"===m){var c=e.element,l="",n,k;k=n="";b=ab.getDirectChild(c,am,"page-layout-properties");var t;if(b){if(t=c.getAttributeNS(am,"name"),l+=au(b,F),(n=ab.getDirectChild(b,am,"background-image"))&&(k=n.getAttributeNS(al,"href"))&&(l=l+("background-image: url('odfkit:"+k+"');")+au(n,af)),"presentation"===s){for(c=(c=ab.getDirectChild(c.parentNode.parentNode,ar,"master-styles"))&&c.firstElementChild;c;){c.namespaceURI===am&&"master-page"===c.localName&&c.getAttributeNS(am,"page-layout-name")===t&&(k=c.getAttributeNS(am,"name"),n='draw|page[draw|master-page-name="'+k+'"] {'+l+"}",k='office|body, draw|page[draw|master-page-name="'+k+'"] {'+au(b,C)+" }",q.insertRule(n,q.cssRules.length),q.insertRule(k,q.cssRules.length)),c=c.nextElementSibling}}else{"text"===s&&(n="office|text {"+l+"}",k="office|body {width: "+b.getAttributeNS(ai,"page-width")+";}",q.insertRule(n,q.cssRules.length),q.insertRule(k,q.cssRules.length))}}}else{l=ap(m,b,e).join(",");t="";if(c=ab.getDirectChild(e.element,am,"text-properties")){var h=c,g=r="";n="";k=1;c=""+au(h,ae);p=h.getAttributeNS(am,"text-underline-style");"solid"===p&&(r+=" underline");p=h.getAttributeNS(am,"text-line-through-style");"solid"===p&&(r+=" line-through");r.length&&(c=c+("text-decoration:"+r+";\n")+("text-decoration-line:"+r+";\n"),c+="-moz-text-decoration-line:"+r+";\n");p=h.getAttributeNS(am,"text-line-through-type");switch(p){case"double":g+=" double";break;case"single":g+=" single"}g&&(c+="text-decoration-style:"+g+";\n",c+="-moz-text-decoration-style:"+g+";\n");if(r=h.getAttributeNS(am,"font-name")||h.getAttributeNS(ai,"font-family")){p=i[r],c+="font-family: "+(p||r)+";"}if(p=h.getAttributeNS(am,"text-position")){r=ac.parseAttributeList(p),p=r[0],r=r[1],c+="vertical-align: "+p+"\n; ",r&&(k=parseFloat(r)/100)}if(h.hasAttributeNS(ai,"font-size")||1!==k){for(h=h.parentNode;h;){if(p=(p=ab.getDirectChild(h,am,"text-properties"))?M.parseFoFontSize(p.getAttributeNS(ai,"font-size")):null){if("%"!==p.unit){n="font-size: "+p.value*k+p.unit+";";break}k*=p.value/100}h=an(h)}n||(n="font-size: "+parseFloat(Y)*k+Z.getUnits(Y)+";")}c+=n;t+=c}if(c=ab.getDirectChild(e.element,am,"paragraph-properties")){n=c,c=""+au(n,ag),(k=ab.getDirectChild(n,am,"background-image"))&&(h=k.getAttributeNS(al,"href"))&&(c=c+("background-image: url('odfkit:"+h+"');")+au(k,af)),(n=n.getAttributeNS(ai,"line-height"))&&"normal"!==n&&(n=M.parseFoLineHeight(n),c="%"!==n.unit?c+("line-height: "+n.value+n.unit+";"):c+("line-height: "+n.value/100+";")),t+=c}if(c=ab.getDirectChild(e.element,am,"graphic-properties")){h=c,c=""+au(h,X),n=h.getAttributeNS(ah,"opacity"),k=h.getAttributeNS(ah,"fill"),h=h.getAttributeNS(ah,"fill-color"),"solid"===k||"hatch"===k?h&&"none"!==h?(n=isNaN(parseFloat(n))?1:parseFloat(n)/100,k=h.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,av),(h=(k=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(k))?{r:parseInt(k[1],16),g:parseInt(k[2],16),b:parseInt(k[3],16)}:null)&&(c+="background-color: rgba("+h.r+","+h.g+","+h.b+","+n+");")):c+="background: none;":"none"===k&&(c+="background: none;"),t+=c}if(c=ab.getDirectChild(e.element,am,"drawing-page-properties")){n=c,k=""+au(n,X),"true"===n.getAttributeNS(ao,"background-visible")&&(k+="background: none;"),t+=k,ak(q,b,c,e)}if(c=ab.getDirectChild(e.element,am,"table-cell-properties")){b=t,t=""+au(c,Q),t=b+t}if(c=ab.getDirectChild(e.element,am,"table-row-properties")){b=t,t=""+au(c,G),t=b+t}if(c=ab.getDirectChild(e.element,am,"table-column-properties")){b=t,t=""+au(c,H),t=b+t}if(c=ab.getDirectChild(e.element,am,"table-properties")){b=t,t=""+au(c,T),c=c.getAttributeNS(at,"border-model"),"collapsing"===c?t+="border-collapse:collapse;":"separating"===c&&(t+="border-collapse:separate;"),t=b+t}0!==t.length&&q.insertRule(l+"{"+t+"}",q.cssRules.length)}for(var d in e.derivedStyles){e.derivedStyles.hasOwnProperty(d)&&aj(q,m,d,e.derivedStyles[d])}}var ah=odf.Namespaces.drawns,ai=odf.Namespaces.fons,ar=odf.Namespaces.officens,am=odf.Namespaces.stylens,aw=odf.Namespaces.svgns,at=odf.Namespaces.tablens,al=odf.Namespaces.xlinkns,ao=odf.Namespaces.presentationns,ab=core.DomUtils,ac=new odf.StyleParseUtils,aa={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"},ad={graphic:"circle connected control custom-shape ellipse frame g line measure page page-thumbnail path polygon polyline rect regular-polygon".split(" "),paragraph:"alphabetical-index-entry-template h illustration-index-entry-template index-source-style object-index-entry-template p table-index-entry-template table-of-content-entry-template user-index-entry-template".split(" "),presentation:"caption circle connector control custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),"drawing-page":"caption circle connector control page custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),ruby:["ruby","ruby-text"],section:"alphabetical-index bibliography illustration-index index-title object-index section table-of-content table-index user-index".split(" "),table:["background","table"],"table-cell":"body covered-table-cell even-columns even-rows first-column first-row last-column last-row odd-columns odd-rows table-cell".split(" "),"table-column":["table-column"],"table-row":["table-row"],text:"a index-entry-chapter index-entry-link-end index-entry-link-start index-entry-page-number index-entry-span index-entry-tab-stop index-entry-text index-title-template linenumbering-configuration list-level-style-number list-level-style-bullet outline-level-style span".split(" "),list:["list-item"]},ae=[[ai,"color","color"],[ai,"background-color","background-color"],[ai,"font-weight","font-weight"],[ai,"font-style","font-style"]],af=[[am,"repeat","background-repeat"]],ag=[[ai,"background-color","background-color"],[ai,"text-align","text-align"],[ai,"text-indent","text-indent"],[ai,"padding","padding"],[ai,"padding-left","padding-left"],[ai,"padding-right","padding-right"],[ai,"padding-top","padding-top"],[ai,"padding-bottom","padding-bottom"],[ai,"border-left","border-left"],[ai,"border-right","border-right"],[ai,"border-top","border-top"],[ai,"border-bottom","border-bottom"],[ai,"margin","margin"],[ai,"margin-left","margin-left"],[ai,"margin-right","margin-right"],[ai,"margin-top","margin-top"],[ai,"margin-bottom","margin-bottom"],[ai,"border","border"]],X=[[ai,"background-color","background-color"],[ai,"min-height","min-height"],[ah,"stroke","border"],[aw,"stroke-color","border-color"],[aw,"stroke-width","border-width"],[ai,"border","border"],[ai,"border-left","border-left"],[ai,"border-right","border-right"],[ai,"border-top","border-top"],[ai,"border-bottom","border-bottom"]],Q=[[ai,"background-color","background-color"],[ai,"border-left","border-left"],[ai,"border-right","border-right"],[ai,"border-top","border-top"],[ai,"border-bottom","border-bottom"],[ai,"border","border"]],H=[[am,"column-width","width"]],G=[[am,"row-height","height"],[ai,"keep-together",null]],T=[[am,"width","width"],[ai,"margin-left","margin-left"],[ai,"margin-right","margin-right"],[ai,"margin-top","margin-top"],[ai,"margin-bottom","margin-bottom"]],F=[[ai,"background-color","background-color"],[ai,"padding","padding"],[ai,"padding-left","padding-left"],[ai,"padding-right","padding-right"],[ai,"padding-top","padding-top"],[ai,"padding-bottom","padding-bottom"],[ai,"border","border"],[ai,"border-left","border-left"],[ai,"border-right","border-right"],[ai,"border-top","border-top"],[ai,"border-bottom","border-bottom"],[ai,"margin","margin"],[ai,"margin-left","margin-left"],[ai,"margin-right","margin-right"],[ai,"margin-top","margin-top"],[ai,"margin-bottom","margin-bottom"]],C=[[ai,"page-width","width"],[ai,"page-height","height"]],U={border:!0,"border-left":!0,"border-right":!0,"border-top":!0,"border-bottom":!0,"stroke-width":!0},j={margin:!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"margin-bottom":!0},i={},M=odf.OdfUtils,s,B,Y,o=xmldom.XPath,Z=new core.CSSUnits;this.style2css=function(v,r,u,t,q){function n(b,e){g="@namespace "+b+" url("+e+");";try{u.insertRule(g,u.cssRules.length)}catch(f){}}var g,p,k;for(B=r;u.cssRules.length;){u.deleteRule(u.cssRules.length-1)}odf.Namespaces.forEachPrefix(n);n("webodfhelper","urn:webodf:names:helper");i=t;s=v;Y=runtime.getWindow().getComputedStyle(document.body,null).getPropertyValue("font-size")||"12pt";for(k in aa){if(aa.hasOwnProperty(k)){for(p in v=q[k],v){v.hasOwnProperty(p)&&aj(u,k,p,v[p])}}}}};(function(){function a(e,f){var d=this;this.getDistance=function(g){var b=d.x-g.x;g=d.y-g.y;return Math.sqrt(b*b+g*g)};this.getCenter=function(b){return new a((d.x+b.x)/2,(d.y+b.y)/2)};d.x=e;d.y=f}gui.ZoomHelper=function(){function O(f,d,k,h){f=h?"translate3d("+f+"px, "+d+"px, 0) scale3d("+k+", "+k+", 1)":"translate("+f+"px, "+d+"px) scale("+k+")";S.style.WebkitTransform=f;S.style.MozTransform=f;S.style.msTransform=f;S.style.OTransform=f;S.style.transform=f}function T(b){b?O(-M.x,-M.y,s,!0):(O(0,0,s,!0),O(0,0,s,!1))}function U(e){if(B&&o){var f=B.style.overflow,c=B.classList.contains("webodf-customScrollbars");e&&c||!e&&!c||(e?(B.classList.add("webodf-customScrollbars"),B.style.overflow="hidden",runtime.requestAnimationFrame(function(){B.style.overflow=f})):B.classList.remove("webodf-customScrollbars"))}}function Q(){O(-M.x,-M.y,s,!0);B.scrollLeft=0;B.scrollTop=0;g=C.style.overflow;C.style.overflow="visible";U(!1)}function L(){O(0,0,s,!0);B.scrollLeft=M.x;B.scrollTop=M.y;C.style.overflow=g||"";U(!0)}function J(b){return new a(b.pageX-S.offsetLeft,b.pageY-S.offsetTop)}function F(d){if(P){M.x-=d.x-P.x;M.y-=d.y-P.y;var c=M;M=new a(Math.min(Math.max(c.x,S.offsetLeft),(S.offsetLeft+S.offsetWidth)*s-B.clientWidth),Math.min(Math.max(c.y,S.offsetTop),(S.offsetTop+S.offsetHeight)*s-B.clientHeight))}P=d}function G(e){var f=e.touches.length,c=0<f?J(e.touches[0]):null;e=1<f?J(e.touches[1]):null;c&&e?(j=c.getDistance(e),i=s,P=c.getCenter(e),Q(),H=E.PINCH):c&&(P=c,H=E.SCROLL)}function R(d){var c=d.touches.length,k=0<c?J(d.touches[0]):null,c=1<c?J(d.touches[1]):null;if(k&&c){if(d.preventDefault(),H===E.SCROLL){H=E.PINCH,Q(),j=k.getDistance(c)}else{d=k.getCenter(c);k=k.getDistance(c)/j;F(d);var c=s,f=Math.min(4,S.offsetParent.clientWidth/S.offsetWidth);s=i*k;s=Math.min(Math.max(s,f),4);k=s/c;M.x+=(k-1)*(d.x+M.x);M.y+=(k-1)*(d.y+M.y);T(!0)}}else{k&&(H===E.PINCH?(H=E.SCROLL,L()):F(k))}}function N(){H===E.PINCH&&(D.emit(gui.ZoomHelper.signalZoomChanged,s),L(),T(!1));H=E.NONE}function V(){B&&(B.removeEventListener("touchstart",G,!1),B.removeEventListener("touchmove",R,!1),B.removeEventListener("touchend",N,!1))}var S,M,P,j,s,i,B,C,D=new core.EventNotifier([gui.ZoomHelper.signalZoomChanged]),E={NONE:0,SCROLL:1,PINCH:2},H=E.NONE,o=runtime.getWindow().hasOwnProperty("ontouchstart"),g="";this.subscribe=function(b,c){D.subscribe(b,c)};this.unsubscribe=function(b,c){D.unsubscribe(b,c)};this.getZoomLevel=function(){return s};this.setZoomLevel=function(b){S&&(s=b,T(!1),D.emit(gui.ZoomHelper.signalZoomChanged,s))};this.destroy=function(b){V();U(!1);b()};this.setZoomableElement=function(b){V();S=b;B=S.offsetParent;C=S.parentNode;T(!1);B&&(B.addEventListener("touchstart",G,!1),B.addEventListener("touchmove",R,!1),B.addEventListener("touchend",N,!1));U(!0)};i=s=1;M=new a(0,0)};gui.ZoomHelper.signalZoomChanged="zoomChanged"})();ops.Canvas=function(){};ops.Canvas.prototype.getZoomLevel=function(){};ops.Canvas.prototype.getElement=function(){};ops.Canvas.prototype.getSizer=function(){};ops.Canvas.prototype.getZoomHelper=function(){};(function(){function X(){function e(a){c=!0;runtime.setTimeout(function(){try{a()}catch(b){runtime.log(String(b)+"\n"+b.stack)}c=!1;0<f.length&&e(f.pop())},10)}var f=[],c=!1;this.clearQueue=function(){f.length=0};this.addToQueue=function(a){if(0===f.length&&!c){return e(a)}f.push(a)}}function V(f){function g(){for(;0<e.cssRules.length;){e.deleteRule(0)}e.insertRule("#shadowContent draw|page {display:none;}",0);e.insertRule("office|presentation draw|page {display:none;}",1);e.insertRule("#shadowContent draw|page:nth-of-type("+h+") {display:block;}",2);e.insertRule("office|presentation draw|page:nth-of-type("+h+") {display:block;}",3)}var e=f.sheet,h=1;this.showFirstPage=function(){h=1;g()};this.showNextPage=function(){h+=1;g()};this.showPreviousPage=function(){1<h&&(--h,g())};this.showPage=function(b){0<b&&(h=b,g())};this.css=f;this.destroy=function(a){f.parentNode.removeChild(f);a()}}function ab(b){b=b.sheet;for(var c=b.cssRules;c.length;){b.deleteRule(c.length-1)}}function ac(g,m,f){var n=new odf.Style2CSS,l=new odf.ListStyleToCss;f=f.sheet;var k=(new odf.StyleTree(g.rootElement.styles,g.rootElement.automaticStyles)).getStyleTree();n.style2css(g.getDocumentType(),g.rootElement,f,m.getFontMap(),k);l.applyListStyles(f,k,g.rootElement.body)}function Y(b,c){(new odf.FontLoader).loadFonts(b,c.sheet)}function S(g,k,f){var l=null;g=g.rootElement.body.getElementsByTagNameNS(j,f+"-decl");f=k.getAttributeNS(j,"use-"+f+"-name");var h;if(f&&0<g.length){for(k=0;k<g.length;k+=1){if(h=g[k],h.getAttributeNS(j,"name")===f){l=h.textContent;break}}}return l}function R(g,k,f,l){var h=g.ownerDocument;k=i.getElementsByTagNameNS(g,k,f);for(g=0;g<k.length;g+=1){i.removeAllChildNodes(k[g]),l&&(f=k[g],f.appendChild(h.createTextNode(l)))}}function O(z,w,y){w.setAttributeNS("urn:webodf:names:helper","styleid",z);var x,v=w.getAttributeNS(C,"anchor-type"),r=w.getAttributeNS(M,"x"),p=w.getAttributeNS(M,"y"),u=w.getAttributeNS(M,"width"),q=w.getAttributeNS(M,"height"),k=w.getAttributeNS(F,"min-height"),t=w.getAttributeNS(F,"min-width");if("as-char"===v){x="display: inline-block;"}else{if(v||r||p){x="position: absolute;"}else{if(u||q||k||t){x="display: block;"}}}r&&(x+="left: "+r+";");p&&(x+="top: "+p+";");u&&(x+="width: "+u+";");q&&(x+="height: "+q+";");k&&(x+="min-height: "+k+";");t&&(x+="min-width: "+t+";");x&&(x="draw|"+w.localName+'[webodfhelper|styleid="'+z+'"] {'+x+"}",y.insertRule(x,y.cssRules.length))}function P(b){for(b=b.firstChild;b;){if(b.namespaceURI===G&&"binary-data"===b.localName){return"data:image/png;base64,"+b.textContent.replace(/[\r\n\s]/g,"")}b=b.nextSibling}return""}function Z(v,r,u,t){function q(a){a&&(a='draw|image[webodfhelper|styleid="'+v+'"] {'+("background-image: url("+a+");")+"}",t.insertRule(a,t.cssRules.length))}function n(b){q(b.url)}u.setAttributeNS("urn:webodf:names:helper","styleid",v);var g=u.getAttributeNS(o,"href"),p;if(g){try{p=r.getPart(g),p.onchange=n,p.load()}catch(k){runtime.log("slight problem: "+String(k))}}else{g=P(u),q(g)}}function U(b){var c=b.ownerDocument;i.getElementsByTagNameNS(b,C,"line-break").forEach(function(d){d.hasChildNodes()||d.appendChild(c.createElement("br"))})}function ad(b){var c=b.ownerDocument;i.getElementsByTagNameNS(b,C,"s").forEach(function(e){var d,f;i.removeAllChildNodes(e);e.appendChild(c.createTextNode(" "));f=parseInt(e.getAttributeNS(C,"c"),10);if(1<f){for(e.removeAttributeNS(C,"c"),d=1;d<f;d+=1){e.parentNode.insertBefore(e.cloneNode(!0),e)}}})}function aa(b){i.getElementsByTagNameNS(b,C,"tab").forEach(function(c){c.textContent="\t"})}function T(x,u){function w(d,e){var b=r.documentElement.namespaceURI;"video/"===e.substr(0,6)?(t=r.createElementNS(b,"video"),t.setAttribute("controls","controls"),q=r.createElementNS(b,"source"),d&&q.setAttribute("src",d),q.setAttribute("type",e),t.appendChild(q),u.parentNode.appendChild(t)):u.innerHtml="Unrecognised Plugin"}function v(b){w(b.url,b.mimetype)}var t,q,k,r=u.ownerDocument,p;if(k=u.getAttributeNS(o,"href")){try{p=x.getPart(k),p.onchange=v,p.load()}catch(g){runtime.log("slight problem: "+String(g))}}else{runtime.log("using MP4 data fallback"),k=P(u),w(k,"video/mp4")}}function W(f){var g=f.getElementsByTagName("head")[0],e,h;e=f.styleSheets.length;for(h=g.firstElementChild;h&&("style"!==h.localName||!h.hasAttribute("webodfcss"));){h=h.nextElementSibling}if(h){return e=parseInt(h.getAttribute("webodfcss"),10),h.setAttribute("webodfcss",e+1),h}"string"===String(typeof webodf_css)?e=webodf_css:(h="webodf.css",runtime.currentDirectory&&(h=runtime.currentDirectory(),0<h.length&&"/"!==h.substr(-1)&&(h+="/"),h+="../webodf.css"),e=runtime.readFileSync(h,"utf-8"));h=f.createElementNS(g.namespaceURI,"style");h.setAttribute("media","screen, print, handheld, projection");h.setAttribute("type","text/css");h.setAttribute("webodfcss","1");h.appendChild(f.createTextNode(e));g.appendChild(h);return h}function B(b){var c=parseInt(b.getAttribute("webodfcss"),10);1===c?b.parentNode.removeChild(b):b.setAttribute("count",c-1)}function D(f){var g=f.getElementsByTagName("head")[0],e=f.createElementNS(g.namespaceURI,"style"),h="";e.setAttribute("type","text/css");e.setAttribute("media","screen, print, handheld, projection");odf.Namespaces.forEachPrefix(function(b,c){h+="@namespace "+b+" url("+c+");\n"});h+="@namespace webodfhelper url(urn:webodf:names:helper);\n";e.appendChild(f.createTextNode(h));g.appendChild(e);return e}var s=odf.Namespaces.drawns,F=odf.Namespaces.fons,G=odf.Namespaces.officens,H=odf.Namespaces.stylens,M=odf.Namespaces.svgns,Q=odf.Namespaces.tablens,C=odf.Namespaces.textns,o=odf.Namespaces.xlinkns,j=odf.Namespaces.presentationns,J=xmldom.XPath,i=core.DomUtils;odf.OdfCanvas=function(ae,I){function E(w,am,t){function an(ap,ar,ao,aq){v.addToQueue(function(){Z(ap,ar,ao,aq)})}var K,q;K=am.getElementsByTagNameNS(s,"image");for(am=0;am<K.length;am+=1){q=K.item(am),an("image"+String(am),w,q,t)}}function f(t,am){function q(ao,ap){v.addToQueue(function(){T(ao,ap)})}var an,K,w;K=am.getElementsByTagNameNS(s,"plugin");for(an=0;an<K.length;an+=1){w=K.item(an),q(t,w)}}function z(){var q;q=g.firstChild;var t=n.getZoomLevel();q&&(g.style.WebkitTransformOrigin="0% 0%",g.style.MozTransformOrigin="0% 0%",g.style.msTransformOrigin="0% 0%",g.style.OTransformOrigin="0% 0%",g.style.transformOrigin="0% 0%",u&&((q=u.getMinimumHeightForAnnotationPane())?g.style.minHeight=q:g.style.removeProperty("min-height")),ae.style.width=Math.round(t*g.offsetWidth)+"px",ae.style.height=Math.round(t*g.offsetHeight)+"px",ae.style.display="inline-block")}function y(au,ar){var aq=af.sheet;i.removeAllChildNodes(ae);g=p.createElementNS(ae.namespaceURI,"div");g.style.display="inline-block";g.style.background="white";g.style.setProperty("float","left","important");g.appendChild(ar);ae.appendChild(g);al=p.createElementNS(ae.namespaceURI,"div");al.id="annotationsPane";e=p.createElementNS(ae.namespaceURI,"div");e.id="shadowContent";e.style.position="absolute";e.style.top=0;e.style.left=0;au.getContentElement().appendChild(e);var an=ar.body,K,ap=[],ao;for(K=an.firstElementChild;K&&K!==an;){if(K.namespaceURI===s&&(ap[ap.length]=K),K.firstElementChild){K=K.firstElementChild}else{for(;K&&K!==an&&!K.nextElementSibling;){K=K.parentNode}K&&K.nextElementSibling&&(K=K.nextElementSibling)}}for(ao=0;ao<ap.length;ao+=1){K=ap[ao],O("frame"+String(ao),K,aq)}ap=J.getODFElementsWithXPath(an,".//*[*[@text:anchor-type='paragraph']]",odf.Namespaces.lookupNamespaceURI);for(K=0;K<ap.length;K+=1){an=ap[K],an.setAttributeNS&&an.setAttributeNS("urn:webodf:names:helper","containsparagraphanchor",!0)}an=c;K=e;var am,q,at,aw,ax=0,av;ao=au.rootElement.ownerDocument;if((ap=ar.body.firstElementChild)&&ap.namespaceURI===G&&("presentation"===ap.localName||"drawing"===ap.localName)){for(ap=ap.firstElementChild;ap;){if(am=(am=ap.getAttributeNS(s,"master-page-name"))?an.getMasterPageElement(am):null){q=ap.getAttributeNS("urn:webodf:names:helper","styleid");at=ao.createElementNS(s,"draw:page");av=am.firstElementChild;for(ax=0;av;){"true"!==av.getAttributeNS(j,"placeholder")&&(aw=av.cloneNode(!0),at.appendChild(aw)),av=av.nextElementSibling,ax+=1}av=aw=ax=void 0;for(var t=i.getElementsByTagNameNS(at,s,"frame"),ax=0;ax<t.length;ax+=1){aw=t[ax],(av=aw.getAttributeNS(j,"class"))&&!/^(date-time|footer|header|page-number)$/.test(av)&&aw.parentNode.removeChild(aw)}aw=i.getElementsByTagNameNS(at,s,"*");for(ax=0;ax<aw.length;ax+=1){O(q+"_"+ax,aw[ax],aq)}K.appendChild(at);ax=String(K.getElementsByTagNameNS(s,"page").length);R(at,C,"page-number",ax);R(at,j,"header",S(au,ap,"header"));R(at,j,"footer",S(au,ap,"footer"));O(q,at,aq);at.setAttributeNS("urn:webodf:names:helper","page-style-name",ap.getAttributeNS(s,"style-name"));at.setAttributeNS(s,"draw:master-page-name",am.getAttributeNS(H,"name"))}ap=ap.nextElementSibling}}an=ae.namespaceURI;ap=i.getElementsByTagNameNS(ar.body,Q,"table-cell");for(K=0;K<ap.length;K+=1){ao=ap[K],ao.hasAttributeNS(Q,"number-columns-spanned")&&ao.setAttributeNS(an,"colspan",ao.getAttributeNS(Q,"number-columns-spanned")),ao.hasAttributeNS(Q,"number-rows-spanned")&&ao.setAttributeNS(an,"rowspan",ao.getAttributeNS(Q,"number-rows-spanned"))}U(ar.body);ad(ar.body);aa(ar.body);E(au,ar.body,aq);f(au,ar.body);g.insertBefore(e,g.firstChild);n.setZoomableElement(g)}function m(q){N?(al.parentNode||g.appendChild(al),u&&u.forgetAnnotations(),u=new gui.AnnotationViewManager(ag,q.body,al,d),q=i.getElementsByTagNameNS(q.body,G,"annotation"),u.addAnnotations(q),z()):al.parentNode&&(g.removeChild(al),u.forgetAnnotations(),z())}function aj(q){function w(){ab(A);ab(a);ab(af);i.removeAllChildNodes(ae);ae.style.display="inline-block";var K=L.rootElement;ae.ownerDocument.importNode(K,!0);c.setOdfContainer(L);Y(L,A);ac(L,c,a);y(L,K);m(K);q||v.addToQueue(function(){var an=[L];if(ak.hasOwnProperty("statereadychange")){var ao=ak.statereadychange,am;for(am=0;am<ao.length;am+=1){ao[am].apply(null,an)}}})}L.state===odf.OdfContainer.DONE?w():(runtime.log("WARNING: refreshOdf called but ODF was not DONE."),x=runtime.setTimeout(function t(){L.state===odf.OdfContainer.DONE?w():(runtime.log("will be back later..."),x=runtime.setTimeout(t,500))},100))}function h(q){v.clearQueue();i.removeAllChildNodes(ae);ae.appendChild(ae.ownerDocument.createTextNode(runtime.tr("Loading")+q+"..."));ae.removeAttribute("style");L=new odf.OdfContainer(q,function(t){L=t;aj(!1)})}runtime.assert(null!==ae&&void 0!==ae,"odf.OdfCanvas constructor needs DOM element");runtime.assert(null!==ae.ownerDocument&&void 0!==ae.ownerDocument,"odf.OdfCanvas constructor needs DOM");var ag=this,p=ae.ownerDocument,L,c=new odf.Formatting,l,g=null,al=null,N=!1,d=!1,u=null,k,A,a,af,e,ak={},x,ai,ah=!1,b=!1,v=new X,n=new gui.ZoomHelper,r=I||new gui.SingleScrollViewport(ae.parentNode);this.refreshCSS=function(){ah=!0;ai.trigger()};this.refreshSize=function(){ai.trigger()};this.odfContainer=function(){return L};this.setOdfContainer=function(q,t){L=q;aj(!0===t)};this.load=this.load=h;this.save=function(q){L.save(q)};this.addListener=function(t,w){switch(t){case"click":var q=t;ae.addEventListener?ae.addEventListener(q,w,!1):ae.attachEvent?ae.attachEvent("on"+q,w):ae["on"+q]=w;break;default:q=ak.hasOwnProperty(t)?ak[t]:ak[t]=[],w&&-1===q.indexOf(w)&&q.push(w)}};this.getFormatting=function(){return c};this.getAnnotationViewManager=function(){return u};this.refreshAnnotations=function(){m(L.rootElement)};this.rerenderAnnotations=function(){u&&(b=!0,ai.trigger())};this.getSizer=function(){return g};this.enableAnnotations=function(q,t){q!==N&&(N=q,d=t,L&&m(L.rootElement))};this.addAnnotation=function(q){u&&(u.addAnnotations([q]),z())};this.forgetAnnotation=function(q){u&&(u.forgetAnnotation(q),z())};this.getZoomHelper=function(){return n};this.setZoomLevel=function(q){n.setZoomLevel(q)};this.getZoomLevel=function(){return n.getZoomLevel()};this.fitToContainingElement=function(t,w){var q=n.getZoomLevel(),K=ae.offsetHeight/q,q=t/(ae.offsetWidth/q);w/K<q&&(q=w/K);n.setZoomLevel(q)};this.fitToWidth=function(q){var t=ae.offsetWidth/n.getZoomLevel();n.setZoomLevel(q/t)};this.fitSmart=function(t,w){var q,K;K=n.getZoomLevel();q=ae.offsetWidth/K;K=ae.offsetHeight/K;q=t/q;void 0!==w&&w/K<q&&(q=w/K);n.setZoomLevel(Math.min(1,q))};this.fitToHeight=function(q){var t=ae.offsetHeight/n.getZoomLevel();n.setZoomLevel(q/t)};this.showFirstPage=function(){l.showFirstPage()};this.showNextPage=function(){l.showNextPage()};this.showPreviousPage=function(){l.showPreviousPage()};this.showPage=function(q){l.showPage(q);z()};this.getElement=function(){return ae};this.getViewport=function(){return r};this.addCssForFrameWithImage=function(t){var w=t.getAttributeNS(s,"name"),q=t.firstElementChild;O(w,t,af.sheet);q&&Z(w+"img",L,q,af.sheet)};this.destroy=function(t){var w=p.getElementsByTagName("head")[0],q=[l.destroy,ai.destroy];runtime.clearTimeout(x);al&&al.parentNode&&al.parentNode.removeChild(al);n.destroy(function(){g&&(ae.removeChild(g),g=null)});B(k);w.removeChild(A);w.removeChild(a);w.removeChild(af);core.Async.destroyAll(q,t)};k=W(p);l=new V(D(p));A=D(p);a=D(p);af=D(p);ai=core.Task.createRedrawTask(function(){ah&&(ac(L,c,a),ah=!1);b&&(u&&u.rerenderAnnotations(),b=!1);z()});n.subscribe(gui.ZoomHelper.signalZoomChanged,z)}})();odf.StepUtils=function(){this.getContentBounds=function(e){var d=e.container(),f,a;runtime.assert(e.isStep(),"Step iterator must be on a step");d.nodeType===Node.TEXT_NODE&&0<e.offset()?f=e.offset():(d=e.leftNode())&&d.nodeType===Node.TEXT_NODE&&(f=d.length);d&&(d.nodeType===Node.TEXT_NODE?(runtime.assert(0<f,"Empty text node found"),a={container:d,startOffset:f-1,endOffset:f}):a={container:d,startOffset:0,endOffset:d.childNodes.length});return a}};ops.MemberProperties=function(){};ops.Member=function(b,a){var d=new ops.MemberProperties;this.getMemberId=function(){return b};this.getProperties=function(){return d};this.setProperties=function(c){Object.keys(c).forEach(function(e){d[e]=c[e]})};this.removeProperties=function(c){Object.keys(c).forEach(function(e){"fullName"!==e&&"color"!==e&&"imageUrl"!==e&&d.hasOwnProperty(e)&&delete d[e]})};runtime.assert(Boolean(b),"No memberId was supplied!");a.fullName||(a.fullName=runtime.tr("Unknown Author"));a.color||(a.color="black");a.imageUrl||(a.imageUrl="avatar-joe.png");d=a};ops.Document=function(){};ops.Document.prototype.getMemberIds=function(){};ops.Document.prototype.removeCursor=function(a){};ops.Document.prototype.getDocumentElement=function(){};ops.Document.prototype.getRootNode=function(){};ops.Document.prototype.getDOMDocument=function(){};ops.Document.prototype.cloneDocumentElement=function(){};ops.Document.prototype.setDocumentElement=function(a){};ops.Document.prototype.subscribe=function(b,a){};ops.Document.prototype.unsubscribe=function(b,a){};ops.Document.prototype.getCanvas=function(){};ops.Document.prototype.createRootFilter=function(a){};ops.Document.prototype.createPositionIterator=function(a){};ops.Document.prototype.hasCursor=function(a){};ops.Document.signalCursorAdded="cursor/added";ops.Document.signalCursorRemoved="cursor/removed";ops.Document.signalCursorMoved="cursor/moved";ops.Document.signalMemberAdded="member/added";ops.Document.signalMemberUpdated="member/updated";ops.Document.signalMemberRemoved="member/removed";ops.OdtCursor=function(e,d){var l=this,a={},h,j,i=new core.EventNotifier([ops.OdtCursor.signalCursorUpdated]);this.removeFromDocument=function(){j.remove()};this.subscribe=function(f,g){i.subscribe(f,g)};this.unsubscribe=function(f,g){i.unsubscribe(f,g)};this.getMemberId=function(){return e};this.getNode=function(){return j.getNode()};this.getAnchorNode=function(){return j.getAnchorNode()};this.getSelectedRange=function(){return j.getSelectedRange()};this.setSelectedRange=function(c,g){j.setSelectedRange(c,g);i.emit(ops.OdtCursor.signalCursorUpdated,l)};this.hasForwardSelection=function(){return j.hasForwardSelection()};this.getDocument=function(){return d};this.getSelectionType=function(){return h};this.setSelectionType=function(b){a.hasOwnProperty(b)?h=b:runtime.log("Invalid selection type: "+b)};this.resetSelectionType=function(){l.setSelectionType(ops.OdtCursor.RangeSelection)};j=new core.Cursor(d.getDOMDocument(),e);a[ops.OdtCursor.RangeSelection]=!0;a[ops.OdtCursor.RegionSelection]=!0;l.resetSelectionType()};ops.OdtCursor.RangeSelection="Range";ops.OdtCursor.RegionSelection="Region";ops.OdtCursor.signalCursorUpdated="cursorUpdated";(function(){var a=0;ops.StepsCache=function(E,J,K){function G(b,e){var f=this;this.nodeId=b;this.steps=-1;this.node=e;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(c){c.setPositionBeforeElement(e);K(f.steps,c)}}function B(b,h,k){var f=this;this.nodeId=b;this.steps=h;this.node=k;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(c){c.setUnfilteredPosition(k,0);K(f.steps,c)}}function A(e,f){var c="["+e.nodeId;f&&(c+=" => "+f.nodeId);return c+"]"}function t(){if(!0===ops.StepsCache.ENABLE_CACHE_VERIFICATION){for(var k=j,n,f,p,m=new core.LoopWatchDog(0,100000),l={};k;){m.check();(n=k.previousBookmark)?runtime.assert(n.nextBookmark===k,"Broken bookmark link to previous @"+A(n,k)):(runtime.assert(k===j,"Broken bookmark link @"+A(k)),runtime.assert(void 0===g||j===j||j.steps<=g,"Base point is damaged @"+A(k)));(f=k.nextBookmark)&&runtime.assert(f.previousBookmark===k,"Broken bookmark link to next @"+A(k,f));if(void 0===g||k===j||k.steps<=g){runtime.assert(i.containsNode(E,k.node),"Disconnected node is being reported as undamaged @"+A(k)),n&&(p=k.node.compareDocumentPosition(n.node),runtime.assert(0===p||0!==(p&s),"Bookmark order with previous does not reflect DOM order @"+A(n,k))),f&&i.containsNode(E,f.node)&&(p=k.node.compareDocumentPosition(f.node),runtime.assert(0===p||0!==(p&o),"Bookmark order with next does not reflect DOM order @"+A(k,f)))}k=k.nextBookmark}Object.keys(C).forEach(function(b){var c=C[b];(void 0===g||b<=g)&&runtime.assert(c.steps<=b,"Bookmark step of "+c.steps+" exceeds cached step lookup for "+b+" @"+A(c));runtime.assert(!1===l.hasOwnProperty(c.nodeId),"Bookmark "+A(c)+" appears twice in cached step lookup at steps "+l[c.nodeId]+" and "+b);l[c.nodeId]=b})}}function u(b){var c="";b.nodeType===Node.ELEMENT_NODE&&(c=b.getAttributeNS("urn:webodf:names:steps","nodeId")||"");return c}function H(b){var c=a.toString();b.setAttributeNS("urn:webodf:names:steps","nodeId",c);a+=1;return c}function D(f){var k,c,h=new core.LoopWatchDog(0,10000);void 0!==g&&f>g&&(f=g);for(k=Math.floor(f/J)*J;!c&&0<=k;){c=C[k],k-=J}for(c=c||j;c.nextBookmark&&c.nextBookmark.steps<=f;){h.check(),c=c.nextBookmark}runtime.assert(-1===f||c.steps<=f,"Bookmark @"+A(c)+" at step "+c.steps+" exceeds requested step of "+f);return c}function L(b){b.previousBookmark&&(b.previousBookmark.nextBookmark=b.nextBookmark);b.nextBookmark&&(b.nextBookmark.previousBookmark=b.previousBookmark)}function I(e){for(var f,c=null;!c&&e&&e!==E;){(f=u(e))&&(c=F[f])&&c.node!==e&&(runtime.log("Cloned node detected. Creating new bookmark"),c=null,e.removeAttributeNS("urn:webodf:names:steps","nodeId")),e=e.parentNode}return c}var C={},F={},i=core.DomUtils,j,g,o=Node.DOCUMENT_POSITION_FOLLOWING,s=Node.DOCUMENT_POSITION_PRECEDING;this.updateBookmark=function(l,c){var f,m=Math.ceil(l/J)*J,k,e,h;if(void 0!==g&&g<l){k=D(g);for(e=k.nextBookmark;e&&e.steps<=l;){f=e.nextBookmark,h=Math.ceil(e.steps/J)*J,C[h]===e&&delete C[h],i.containsNode(E,e.node)?e.steps=l+1:(L(e),delete F[e.nodeId]),e=f}g=l}else{k=D(l)}e=u(c)||H(c);f=F[e];f?f.node!==c&&(runtime.log("Cloned node detected. Creating new bookmark"),e=H(c),f=F[e]=new G(e,c)):f=F[e]=new G(e,c);e=f;e.steps!==l&&(f=Math.ceil(e.steps/J)*J,f!==m&&C[f]===e&&delete C[f],e.steps=l);if(k!==e&&k.nextBookmark!==e){if(k.steps===e.steps){for(;0!==(e.node.compareDocumentPosition(k.node)&o)&&k!==j;){k=k.previousBookmark}}k!==e&&k.nextBookmark!==e&&(L(e),f=k.nextBookmark,e.nextBookmark=k.nextBookmark,e.previousBookmark=k,k.nextBookmark=e,f&&(f.previousBookmark=e))}k=C[m];if(!k||e.steps>k.steps){C[m]=e}t()};this.setToClosestStep=function(e,f){var c;t();c=D(e);c.setIteratorPosition(f);return c.steps};this.setToClosestDomPoint=function(f,d,m){var l,k;t();if(f===E&&0===d){l=j}else{if(f===E&&d===E.childNodes.length){for(k in l=j,C){C.hasOwnProperty(k)&&(f=C[k],f.steps>l.steps&&(l=f))}}else{if(l=I(f.childNodes.item(d)||f),!l){for(m.setUnfilteredPosition(f,d);!l&&m.previousNode();){l=I(m.getCurrentNode())}}}}l=l||j;void 0!==g&&l.steps>g&&(l=D(g));l.setIteratorPosition(m);return l.steps};this.damageCacheAfterStep=function(b){0>b&&(b=-1);void 0===g?g=b:b<g&&(g=b);t()};(function(){var b=u(E)||H(E);j=new B(b,0,E)})()};ops.StepsCache.ENABLE_CACHE_VERIFICATION=!1;ops.StepsCache.Bookmark=function(){};ops.StepsCache.Bookmark.prototype.setIteratorPosition=function(b){}})();(function(){ops.OdtStepsTranslator=function(s,o,v,w){function t(g,f,l){var k=f.getCurrentNode();f.isBeforeNode()&&d.isParagraph(k)&&(l||(g+=1),i.updateBookmark(g,k))}function j(c,a){if(!a||v.acceptPosition(c)===u){return !0}for(;c.previousPosition();){if(v.acceptPosition(c)===u){if(a(m,c.container(),c.unfilteredDomOffset())){return !0}break}}for(;c.nextPosition();){if(v.acceptPosition(c)===u){if(a(x,c.container(),c.unfilteredDomOffset())){return !0}break}}return !1}var i,d=odf.OdfUtils,h=core.DomUtils,u=core.PositionFilter.FilterResult.FILTER_ACCEPT,m=core.StepDirection.PREVIOUS,x=core.StepDirection.NEXT;this.convertStepsToDomPoint=function(e){var c,f;if(isNaN(e)){throw new TypeError("Requested steps is not numeric ("+e+")")}if(0>e){throw new RangeError("Requested steps is negative ("+e+")")}for(c=i.setToClosestStep(e,o);c<e&&o.nextPosition();){(f=v.acceptPosition(o)===u)&&(c+=1),t(c,o,f)}if(c!==e){throw new RangeError("Requested steps ("+e+") exceeds available steps ("+c+")")}return{node:o.container(),offset:o.unfilteredDomOffset()}};this.convertDomPointToSteps=function(f,c,g){var e;h.containsNode(s,f)||(c=0>h.comparePoints(s,0,f,c),f=s,c=c?0:s.childNodes.length);o.setUnfilteredPosition(f,c);j(o,g)||o.setUnfilteredPosition(f,c);g=o.container();c=o.unfilteredDomOffset();f=i.setToClosestDomPoint(g,c,o);if(0>h.comparePoints(o.container(),o.unfilteredDomOffset(),g,c)){return 0<f?f-1:f}for(;(o.container()!==g||o.unfilteredDomOffset()!==c)&&o.nextPosition();){(e=v.acceptPosition(o)===u)&&(f+=1),t(f,o,e)}return f+0};this.prime=function(){var e,c;for(e=i.setToClosestStep(0,o);o.nextPosition();){(c=v.acceptPosition(o)===u)&&(e+=1),t(e,o,c)}};this.handleStepsInserted=function(b){i.damageCacheAfterStep(b.position)};this.handleStepsRemoved=function(b){i.damageCacheAfterStep(b.position-1)};i=new ops.StepsCache(s,w,function(e,c){do{if(v.acceptPosition(c)===u){t(e,c,!0);break}t(e-1,c,!1)}while(c.nextPosition())})}})();ops.Operation=function(){};ops.Operation.prototype.init=function(a){};ops.Operation.prototype.execute=function(a){};ops.Operation.prototype.spec=function(){};ops.TextPositionFilter=function(){function e(f,g){for(;f&&g(f)!==j;){f=f.previousSibling}return f}function d(c,m,n,k){var g;if(m){if(l.isInlineRoot(m)&&l.isGroupingElement(n)){return i}k=l.lookLeftForCharacter(m);if(1===k||2===k&&(l.scanRightForAnyCharacter(n)||l.scanRightForAnyCharacter(l.nextNode(c)))){return j}}else{if(l.isGroupingElement(c)&&l.isInlineRoot(e(c.previousSibling,k))){return j}}k=null===m&&l.isParagraph(c);g=l.lookRightForCharacter(n);if(k){return g?j:l.scanRightForAnyCharacter(n)?i:j}if(!g){return i}m=m||l.previousNode(c);return l.scanLeftForAnyCharacter(m)?i:j}var l=odf.OdfUtils,a=Node.ELEMENT_NODE,h=Node.TEXT_NODE,j=core.PositionFilter.FilterResult.FILTER_ACCEPT,i=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(f){var k=f.container(),m=k.nodeType,c,b,n;if(m!==a&&m!==h){return i}if(m===h){m=f.unfilteredDomOffset();c=k.data;runtime.assert(m!==c.length,"Unexpected offset.");if(0<m){f=c[m-1];if(!l.isODFWhitespace(f)){return j}if(1<m){if(f=c[m-2],!l.isODFWhitespace(f)){n=j}else{if(!l.isODFWhitespace(c.substr(0,m))){return i}}}else{b=l.previousNode(k),l.scanLeftForNonSpace(b)&&(n=j)}if(n===j){return l.isTrailingWhitespace(k,m)?i:j}f=c[m];return l.isODFWhitespace(f)?i:l.scanLeftForAnyCharacter(l.previousNode(k))?i:j}b=f.leftNode();n=k;k=k.parentNode;n=d(k,b,n,f.getNodeFilter())}else{l.isGroupingElement(k)?(b=f.leftNode(),n=f.rightNode(),n=d(k,b,n,f.getNodeFilter())):n=i}return n}};function RootFilter(e,d,i){var a=core.PositionFilter.FilterResult.FILTER_ACCEPT,h=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(c){c=c.container();var b;b="string"===typeof e?d[e].getNode():e;return i(c)===i(b)?a:h}}ops.OdtDocument=function(T){function R(b){return new core.PositionIterator(b,M,i,!1)}function X(){var b=T.odfContainer().getContentElement(),c=b&&b.localName;runtime.assert("text"===c,"Unsupported content element type '"+c+"' for OdtDocument");return b}function Y(){return Z.getDocumentElement().ownerDocument}function U(b){for(;b&&!(b.namespaceURI===odf.Namespaces.officens&&"text"===b.localName||b.namespaceURI===odf.Namespaces.officens&&"annotation"===b.localName);){b=b.parentNode}return b}function O(g,k,f,l){l=R(l);var h;1===f.length?h=f[0]:(h=new core.PositionFilterChain,f.forEach(h.addFilter));f=new core.StepIterator(h,l);f.setPosition(g,k);return f}function N(b){var c=R(X());b=F.convertStepsToDomPoint(b);c.setUnfilteredPosition(b.node,b.offset);return c}function H(b){return b===D}function J(g){var a=g.spec(),h=a.memberid,f=(new Date(a.timestamp)).toISOString(),a=T.odfContainer();g.isEdit&&(h=Z.getMember(h).getProperties().fullName,a.setMetadata({"dc:creator":h,"dc:date":f},null),h={setProperties:{"dc:creator":h,"dc:date":f},removedProperties:[]},G||(h.setProperties["meta:editing-cycles"]=a.incrementEditingCycles(),a.setMetadata(null,["meta:editing-duration","meta:document-statistic"])),G=g,Z.emit(ops.OdtDocument.signalMetadataUpdated,h))}function V(g){var d,l=[],k,h=2;runtime.assert(g.isStep(),"positionIterator is not at a step");do{if(d=W.getContentBounds(g)){if(d=d.container,P.isDowngradableSpaceElement(d)){for(k=d.lastChild;d.firstChild;){l.push(d.firstChild),d.parentNode.insertBefore(d.firstChild,d)}d.parentNode.removeChild(d);g.setPosition(k,k.nodeType===Node.TEXT_NODE?k.length:k.childNodes.length);g.roundToPreviousStep()}}--h}while(0<h&&g.nextStep());l.forEach(S.normalizeTextNodes)}function Q(e,f,c){e=e.childNodes.item(f)||e;return(e=P.getParagraphElement(e))&&S.containsNode(c,e)?e:c}var Z=this,W,P=odf.OdfUtils,S=core.DomUtils,s={},C={},o=new core.EventNotifier([ops.Document.signalMemberAdded,ops.Document.signalMemberUpdated,ops.Document.signalMemberRemoved,ops.Document.signalCursorAdded,ops.Document.signalCursorRemoved,ops.Document.signalCursorMoved,ops.OdtDocument.signalParagraphChanged,ops.OdtDocument.signalParagraphStyleModified,ops.OdtDocument.signalCommonStyleCreated,ops.OdtDocument.signalCommonStyleDeleted,ops.OdtDocument.signalTableAdded,ops.OdtDocument.signalOperationStart,ops.OdtDocument.signalOperationEnd,ops.OdtDocument.signalProcessingBatchStart,ops.OdtDocument.signalProcessingBatchEnd,ops.OdtDocument.signalUndoStackChanged,ops.OdtDocument.signalStepsInserted,ops.OdtDocument.signalStepsRemoved,ops.OdtDocument.signalMetadataUpdated,ops.OdtDocument.signalAnnotationAdded]),D=core.StepDirection.NEXT,E,F,G,M=NodeFilter.SHOW_ALL,B=new gui.BlacklistNamespaceNodeFilter(["urn:webodf:names:cursor","urn:webodf:names:editinfo"]),j=new gui.OdfTextBodyNodeFilter,i=new core.NodeFilterChain([B,j]);this.createPositionIterator=R;this.getDocumentElement=function(){return T.odfContainer().rootElement};this.cloneDocumentElement=function(){var c=Z.getDocumentElement(),a=T.getAnnotationViewManager();a&&a.forgetAnnotations();c=c.cloneNode(!0);T.refreshAnnotations();Z.fixCursorPositions();return c};this.setDocumentElement=function(b){var c=T.odfContainer();o.unsubscribe(ops.OdtDocument.signalStepsInserted,F.handleStepsInserted);o.unsubscribe(ops.OdtDocument.signalStepsRemoved,F.handleStepsRemoved);c.setRootElement(b);T.setOdfContainer(c,!0);T.refreshCSS();b=X();F=new ops.OdtStepsTranslator(b,R(b),E,500);o.subscribe(ops.OdtDocument.signalStepsInserted,F.handleStepsInserted);o.subscribe(ops.OdtDocument.signalStepsRemoved,F.handleStepsRemoved)};this.getDOMDocument=Y;this.getRootElement=U;this.createStepIterator=O;this.getIteratorAtPosition=N;this.convertCursorStepToDomPoint=function(b){return F.convertStepsToDomPoint(b)};this.convertDomPointToCursorStep=function(f,g,e){var h;e===D&&(h=H);return F.convertDomPointToSteps(f,g,h)};this.convertDomToCursorRange=function(b){var c;c=F.convertDomPointToSteps(b.anchorNode,b.anchorOffset);b=b.anchorNode===b.focusNode&&b.anchorOffset===b.focusOffset?c:F.convertDomPointToSteps(b.focusNode,b.focusOffset);return{position:c,length:b-c}};this.convertCursorToDomRange=function(b,k){var l=Y().createRange(),g,f;g=F.convertStepsToDomPoint(b);k?(f=F.convertStepsToDomPoint(b+k),0<k?(l.setStart(g.node,g.offset),l.setEnd(f.node,f.offset)):(l.setStart(f.node,f.offset),l.setEnd(g.node,g.offset))):l.setStart(g.node,g.offset);return l};this.upgradeWhitespacesAtPosition=function(k){var d=N(k),d=new core.StepIterator(E,d),q,p=2;runtime.assert(d.isStep(),"positionIterator is not at a step (requested step: "+k+")");do{if(q=W.getContentBounds(d)){if(k=q.container,q=q.startOffset,k.nodeType===Node.TEXT_NODE&&P.isSignificantWhitespace(k,q)){runtime.assert(" "===k.data[q],"upgradeWhitespaceToElement: textNode.data[offset] should be a literal space");var m=k.ownerDocument.createElementNS(odf.Namespaces.textns,"text:s"),n=k.parentNode,g=k;m.appendChild(k.ownerDocument.createTextNode(" "));1===k.length?n.replaceChild(m,k):(k.deleteData(q,1),0<q&&(q<k.length&&k.splitText(q),g=k.nextSibling),n.insertBefore(m,g));k=m;d.setPosition(k,k.childNodes.length);d.roundToPreviousStep()}}--p}while(0<p&&d.nextStep())};this.downgradeWhitespaces=V;this.downgradeWhitespacesAtPosition=function(b){b=N(b);b=new core.StepIterator(E,b);V(b)};this.getTextNodeAtStep=function(p,q){var n=N(p),g=n.container(),a,k=0,b=null;g.nodeType===Node.TEXT_NODE?(a=g,k=n.unfilteredDomOffset(),0<a.length&&(0<k&&(a=a.splitText(k)),a.parentNode.insertBefore(Y().createTextNode(""),a),a=a.previousSibling,k=0)):(a=Y().createTextNode(""),k=0,g.insertBefore(a,n.rightNode()));if(q){if(s[q]&&Z.getCursorPosition(q)===p){for(b=s[q].getNode();b.nextSibling&&"cursor"===b.nextSibling.localName;){b.parentNode.insertBefore(b.nextSibling,b)}0<a.length&&a.nextSibling!==b&&(a=Y().createTextNode(""),k=0);b.parentNode.insertBefore(a,b)}}else{for(;a.nextSibling&&"cursor"===a.nextSibling.localName;){a.parentNode.insertBefore(a.nextSibling,a)}}for(;a.previousSibling&&a.previousSibling.nodeType===Node.TEXT_NODE;){n=a.previousSibling,n.appendData(a.data),k=n.length,a=n,a.parentNode.removeChild(a.nextSibling)}for(;a.nextSibling&&a.nextSibling.nodeType===Node.TEXT_NODE;){n=a.nextSibling,a.appendData(n.data),a.parentNode.removeChild(n)}return{textNode:a,offset:k}};this.fixCursorPositions=function(){Object.keys(s).forEach(function(r){var f=s[r],t=U(f.getNode()),q=Z.createRootFilter(t),n,a,p,l=!1;p=f.getSelectedRange();n=Q(p.startContainer,p.startOffset,t);a=O(p.startContainer,p.startOffset,[E,q],n);p.collapsed?t=a:(n=Q(p.endContainer,p.endOffset,t),t=O(p.endContainer,p.endOffset,[E,q],n));a.isStep()&&t.isStep()?a.container()!==t.container()||a.offset()!==t.offset()||p.collapsed&&f.getAnchorNode()===f.getNode()||(l=!0,p.setStart(a.container(),a.offset()),p.collapse(!0)):(l=!0,runtime.assert(a.roundToClosestStep(),"No walkable step found for cursor owned by "+r),p.setStart(a.container(),a.offset()),runtime.assert(t.roundToClosestStep(),"No walkable step found for cursor owned by "+r),p.setEnd(t.container(),t.offset()));l&&(f.setSelectedRange(p,f.hasForwardSelection()),Z.emit(ops.Document.signalCursorMoved,f))})};this.getCursorPosition=function(b){return(b=s[b])?F.convertDomPointToSteps(b.getNode(),0):0};this.getCursorSelection=function(e){e=s[e];var f=0,c=0;e&&(f=F.convertDomPointToSteps(e.getNode(),0),c=F.convertDomPointToSteps(e.getAnchorNode(),0));return{position:c,length:f-c}};this.getPositionFilter=function(){return E};this.getOdfCanvas=function(){return T};this.getCanvas=function(){return T};this.getRootNode=X;this.addMember=function(b){runtime.assert(void 0===C[b.getMemberId()],"This member already exists");C[b.getMemberId()]=b};this.getMember=function(b){return C.hasOwnProperty(b)?C[b]:null};this.removeMember=function(b){delete C[b]};this.getCursor=function(b){return s[b]};this.hasCursor=function(b){return s.hasOwnProperty(b)};this.getMemberIds=function(){return Object.keys(C)};this.addCursor=function(e){runtime.assert(Boolean(e),"OdtDocument::addCursor without cursor");var a=e.getMemberId(),f=Z.convertCursorToDomRange(0,0);runtime.assert("string"===typeof a,"OdtDocument::addCursor has cursor without memberid");runtime.assert(!s[a],"OdtDocument::addCursor is adding a duplicate cursor with memberid "+a);e.setSelectedRange(f,!0);s[a]=e};this.removeCursor=function(c){var a=s[c];return a?(a.removeFromDocument(),delete s[c],Z.emit(ops.Document.signalCursorRemoved,c),!0):!1};this.moveCursor=function(g,a,h,f){g=s[g];a=Z.convertCursorToDomRange(a,h);g&&(g.setSelectedRange(a,0<=h),g.setSelectionType(f||ops.OdtCursor.RangeSelection))};this.getFormatting=function(){return T.getFormatting()};this.emit=function(b,c){o.emit(b,c)};this.subscribe=function(b,c){o.subscribe(b,c)};this.unsubscribe=function(b,c){o.unsubscribe(b,c)};this.createRootFilter=function(b){return new RootFilter(b,s,U)};this.close=function(b){b()};this.destroy=function(b){b()};(function(){var b=X();E=new ops.TextPositionFilter;W=new odf.StepUtils;F=new ops.OdtStepsTranslator(b,R(b),E,500);o.subscribe(ops.OdtDocument.signalStepsInserted,F.handleStepsInserted);o.subscribe(ops.OdtDocument.signalStepsRemoved,F.handleStepsRemoved);o.subscribe(ops.OdtDocument.signalOperationEnd,J);o.subscribe(ops.OdtDocument.signalProcessingBatchEnd,core.Task.processTasks)})()};ops.OdtDocument.signalParagraphChanged="paragraph/changed";ops.OdtDocument.signalTableAdded="table/added";ops.OdtDocument.signalCommonStyleCreated="style/created";ops.OdtDocument.signalCommonStyleDeleted="style/deleted";ops.OdtDocument.signalParagraphStyleModified="paragraphstyle/modified";ops.OdtDocument.signalOperationStart="operation/start";ops.OdtDocument.signalOperationEnd="operation/end";ops.OdtDocument.signalProcessingBatchStart="router/batchstart";ops.OdtDocument.signalProcessingBatchEnd="router/batchend";ops.OdtDocument.signalUndoStackChanged="undo/changed";ops.OdtDocument.signalStepsInserted="steps/inserted";ops.OdtDocument.signalStepsRemoved="steps/removed";ops.OdtDocument.signalMetadataUpdated="metadata/updated";ops.OdtDocument.signalAnnotationAdded="annotation/added";ops.OpAddAnnotation=function(){function e(g,n,m){var k=g.getTextNodeAtStep(m,d);k&&(g=k.textNode,m=g.parentNode,k.offset!==g.length&&g.splitText(k.offset),m.insertBefore(n,g.nextSibling),0===g.length&&m.removeChild(g))}var d,l,a,h,j,i;this.init=function(b){d=b.memberid;l=parseInt(b.timestamp,10);a=parseInt(b.position,10);h=void 0!==b.length?parseInt(b.length,10)||0:void 0;j=b.name};this.isEdit=!0;this.group=void 0;this.execute=function(k){var n=k.getCursor(d),o,f;i=k.getDOMDocument();var c=new Date(l),p,b,g;p=i.createElementNS(odf.Namespaces.officens,"office:annotation");p.setAttributeNS(odf.Namespaces.officens,"office:name",j);o=i.createElementNS(odf.Namespaces.dcns,"dc:creator");o.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",d);o.textContent=k.getMember(d).getProperties().fullName;f=i.createElementNS(odf.Namespaces.dcns,"dc:date");f.appendChild(i.createTextNode(c.toISOString()));c=i.createElementNS(odf.Namespaces.textns,"text:list");b=i.createElementNS(odf.Namespaces.textns,"text:list-item");g=i.createElementNS(odf.Namespaces.textns,"text:p");b.appendChild(g);c.appendChild(b);p.appendChild(o);p.appendChild(f);p.appendChild(c);void 0!==h&&(o=i.createElementNS(odf.Namespaces.officens,"office:annotation-end"),o.setAttributeNS(odf.Namespaces.officens,"office:name",j),p.annotationEndElement=o,e(k,o,a+h));e(k,p,a);k.emit(ops.OdtDocument.signalStepsInserted,{position:a});n&&(o=i.createRange(),f=p.getElementsByTagNameNS(odf.Namespaces.textns,"p")[0],o.selectNodeContents(f),n.setSelectedRange(o,!1),n.setSelectionType(ops.OdtCursor.RangeSelection),k.emit(ops.Document.signalCursorMoved,n));k.getOdfCanvas().addAnnotation(p);k.fixCursorPositions();k.emit(ops.OdtDocument.signalAnnotationAdded,{memberId:d,annotation:p});return !0};this.spec=function(){return{optype:"AddAnnotation",memberid:d,timestamp:l,position:a,length:h,name:j}}};ops.OpAddCursor=function(){var b,a;this.init=function(d){b=d.memberid;a=d.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(e){var d=e.getCursor(b);if(d){return !1}d=new ops.OdtCursor(b,e);e.addCursor(d);e.emit(ops.Document.signalCursorAdded,d);return !0};this.spec=function(){return{optype:"AddCursor",memberid:b,timestamp:a}}};ops.OpAddMember=function(){var b,a,d;this.init=function(c){b=c.memberid;a=parseInt(c.timestamp,10);d=c.setProperties};this.isEdit=!1;this.group=void 0;this.execute=function(c){var e;if(c.getMember(b)){return !1}e=new ops.Member(b,d);c.addMember(e);c.emit(ops.Document.signalMemberAdded,e);return !0};this.spec=function(){return{optype:"AddMember",memberid:b,timestamp:a,setProperties:d}}};ops.OpAddStyle=function(){var e,d,l,a,h,j,i=odf.Namespaces.stylens;this.init=function(b){e=b.memberid;d=b.timestamp;l=b.styleName;a=b.styleFamily;h="true"===b.isAutomaticStyle||!0===b.isAutomaticStyle;j=b.setProperties};this.isEdit=!0;this.group=void 0;this.execute=function(f){var c=f.getOdfCanvas().odfContainer(),m=f.getFormatting(),b=f.getDOMDocument().createElementNS(i,"style:style");if(!b){return !1}j&&m.updateStyle(b,j);b.setAttributeNS(i,"style:family",a);b.setAttributeNS(i,"style:name",l);h?c.rootElement.automaticStyles.appendChild(b):c.rootElement.styles.appendChild(b);f.getOdfCanvas().refreshCSS();h||f.emit(ops.OdtDocument.signalCommonStyleCreated,{name:l,family:a});return !0};this.spec=function(){return{optype:"AddStyle",memberid:e,timestamp:d,styleName:l,styleFamily:a,isAutomaticStyle:h,setProperties:j}}};odf.ObjectNameGenerator=function(t,s){function x(e,f){var c={};this.generateName=function(){var d=f(),b=0,a;do{a=e+b,b+=1}while(c[a]||d[a]);c[a]=!0;return a}}function y(){var b={};[t.rootElement.automaticStyles,t.rootElement.styles].forEach(function(a){for(a=a.firstElementChild;a;){a.namespaceURI===u&&"style"===a.localName&&(b[a.getAttributeNS(u,"name")]=!0),a=a.nextElementSibling}});return b}var u=odf.Namespaces.stylens,m=odf.Namespaces.drawns,j=odf.Namespaces.xlinkns,h=(new core.Utils).hashString(s),i=null,v=null,o=null,z={},w={};this.generateStyleName=function(){null===i&&(i=new x("auto"+h+"_",function(){return y()}));return i.generateName()};this.generateFrameName=function(){var e,a,c;if(null===v){a=t.rootElement.body.getElementsByTagNameNS(m,"frame");for(e=0;e<a.length;e+=1){c=a.item(e),z[c.getAttributeNS(m,"name")]=!0}v=new x("fr"+h+"_",function(){return z})}return v.generateName()};this.generateImageName=function(){var d,c,f;if(null===o){f=t.rootElement.body.getElementsByTagNameNS(m,"image");for(d=0;d<f.length;d+=1){c=f.item(d),c=c.getAttributeNS(j,"href"),c=c.substring(9,c.lastIndexOf(".")),w[c]=!0}o=new x("img"+h+"_",function(){return w})}return o.generateName()}};odf.TextStyleApplicator=function(j,i,m){function o(f){function k(n,c){return"object"===typeof n&&"object"===typeof c?Object.keys(n).every(function(b){return k(n[b],c[b])}):n===c}var g={};this.isStyleApplied=function(b){b=i.getAppliedStylesForElement(b,g).styleProperties;return k(f,b)}}function l(c){var g={};this.applyStyleToContainer=function(f){var p;p=f.getAttributeNS(a,"style-name");var b=f.ownerDocument;p=p||"";if(!g.hasOwnProperty(p)){var k=p,q;q=p?i.createDerivedStyleObject(p,"text",c):c;b=b.createElementNS(d,"style:style");i.updateStyle(b,q);b.setAttributeNS(d,"style:name",j.generateStyleName());b.setAttributeNS(d,"style:family","text");b.setAttributeNS("urn:webodf:names:scope","scope","document-content");m.appendChild(b);g[k]=b}p=g[p].getAttributeNS(d,"name");f.setAttributeNS(a,"text:style-name",p)}}function h(n,u){var p=n.ownerDocument,t=n.parentNode,k,q,s,r=new core.LoopWatchDog(10000);q=[];q.push(n);for(s=n.nextSibling;s&&e.rangeContainsNode(u,s);){r.check(),q.push(s),s=s.nextSibling}"span"!==t.localName||t.namespaceURI!==a?(k=p.createElementNS(a,"text:span"),t.insertBefore(k,n),p=!1):(n.previousSibling&&!e.rangeContainsNode(u,t.firstChild)?(k=t.cloneNode(!1),t.parentNode.insertBefore(k,t.nextSibling)):k=t,p=!0);q.forEach(function(b){b.parentNode!==k&&k.appendChild(b)});if(s&&p){for(q=k.cloneNode(!1),k.parentNode.insertBefore(q,k.nextSibling);s;){r.check(),p=s.nextSibling,q.appendChild(s),s=p}}return k}var e=core.DomUtils,a=odf.Namespaces.textns,d=odf.Namespaces.stylens;this.applyStyle=function(u,r,f){var t={},b,q,n,s;runtime.assert(f&&f.hasOwnProperty("style:text-properties"),"applyStyle without any text properties");t["style:text-properties"]=f["style:text-properties"];n=new l(t);s=new o(t);u.forEach(function(c){b=s.isStyleApplied(c);!1===b&&(q=h(c,r),n.applyStyleToContainer(q))})}};ops.OpApplyDirectStyling=function(){function h(k,q,o){var n=k.getOdfCanvas().odfContainer(),p=e.splitBoundaries(q),g=j.getTextNodes(q,!1);(new odf.TextStyleApplicator(new odf.ObjectNameGenerator(n,d),k.getFormatting(),n.rootElement.automaticStyles)).applyStyle(g,q,o);p.forEach(e.normalizeTextNodes)}var d,m,a,i,l,j=odf.OdfUtils,e=core.DomUtils;this.init=function(b){d=b.memberid;m=b.timestamp;a=parseInt(b.position,10);i=parseInt(b.length,10);l=b.setProperties};this.isEdit=!0;this.group=void 0;this.execute=function(c){var f=c.convertCursorToDomRange(a,i),b=j.getParagraphElements(f);h(c,f,l);f.detach();c.getOdfCanvas().refreshCSS();c.fixCursorPositions();b.forEach(function(g){c.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:g,memberId:d,timeStamp:m})});c.getOdfCanvas().rerenderAnnotations();return !0};this.spec=function(){return{optype:"ApplyDirectStyling",memberid:d,timestamp:m,position:a,length:i,setProperties:l}}};ops.OpApplyHyperlink=function(){function h(c){for(;c;){if(e.isHyperlink(c)){return !0}c=c.parentNode}return !1}var d,m,a,i,l,j=core.DomUtils,e=odf.OdfUtils;this.init=function(b){d=b.memberid;m=b.timestamp;a=b.position;i=b.length;l=b.hyperlink};this.isEdit=!0;this.group=void 0;this.execute=function(g){var k=g.getDOMDocument(),f=g.convertCursorToDomRange(a,i),c=j.splitBoundaries(f),n=[],b=e.getTextNodes(f,!1);if(0===b.length){return !1}b.forEach(function(q){var p=e.getParagraphElement(q);runtime.assert(!1===h(q),"The given range should not contain any link.");var r=l,o=k.createElementNS(odf.Namespaces.textns,"text:a");o.setAttributeNS(odf.Namespaces.xlinkns,"xlink:type","simple");o.setAttributeNS(odf.Namespaces.xlinkns,"xlink:href",r);q.parentNode.insertBefore(o,q);o.appendChild(q);-1===n.indexOf(p)&&n.push(p)});c.forEach(j.normalizeTextNodes);f.detach();g.fixCursorPositions();g.getOdfCanvas().refreshSize();g.getOdfCanvas().rerenderAnnotations();n.forEach(function(o){g.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:o,memberId:d,timeStamp:m})});return !0};this.spec=function(){return{optype:"ApplyHyperlink",memberid:d,timestamp:m,position:a,length:i,hyperlink:l}}};ops.OpInsertImage=function(){var t,s,x,y,u,m,j,h,i=odf.Namespaces.drawns,v=odf.Namespaces.svgns,o=odf.Namespaces.textns,z=odf.Namespaces.xlinkns,w=odf.OdfUtils;this.init=function(b){t=b.memberid;s=b.timestamp;x=b.position;y=b.filename;u=b.frameWidth;m=b.frameHeight;j=b.frameStyleName;h=b.frameName};this.isEdit=!0;this.group=void 0;this.execute=function(b){var e=b.getOdfCanvas(),g=b.getTextNodeAtStep(x,t),a,f;if(!g){return !1}a=g.textNode;f=w.getParagraphElement(a);var g=g.offset!==a.length?a.splitText(g.offset):a.nextSibling,c=b.getDOMDocument(),d=c.createElementNS(i,"draw:image"),c=c.createElementNS(i,"draw:frame");d.setAttributeNS(z,"xlink:href",y);d.setAttributeNS(z,"xlink:type","simple");d.setAttributeNS(z,"xlink:show","embed");d.setAttributeNS(z,"xlink:actuate","onLoad");c.setAttributeNS(i,"draw:style-name",j);c.setAttributeNS(i,"draw:name",h);c.setAttributeNS(o,"text:anchor-type","as-char");c.setAttributeNS(v,"svg:width",u);c.setAttributeNS(v,"svg:height",m);c.appendChild(d);a.parentNode.insertBefore(c,g);b.emit(ops.OdtDocument.signalStepsInserted,{position:x});0===a.length&&a.parentNode.removeChild(a);e.addCssForFrameWithImage(c);e.refreshCSS();b.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:f,memberId:t,timeStamp:s});e.rerenderAnnotations();return !0};this.spec=function(){return{optype:"InsertImage",memberid:t,timestamp:s,filename:y,position:x,frameWidth:u,frameHeight:m,frameStyleName:j,frameName:h}}};ops.OpInsertTable=function(){function o(b,e){var f;if(1===t.length){f=t[0]}else{if(3===t.length){switch(b){case 0:f=t[0];break;case v-1:f=t[2];break;default:f=t[1]}}else{f=t[b]}}if(1===f.length){return f[0]}if(3===f.length){switch(e){case 0:return f[0];case s-1:return f[2];default:return f[1]}}return f[e]}var m,u,v,s,i,h,a,d,t,j=odf.OdfUtils;this.init=function(b){m=b.memberid;u=b.timestamp;i=b.position;v=b.initialRows;s=b.initialColumns;h=b.tableName;a=b.tableStyleName;d=b.tableColumnStyleName;t=b.tableCellStyleMatrix};this.isEdit=!0;this.group=void 0;this.execute=function(l){var f=l.getTextNodeAtStep(i),c=l.getRootNode();if(f){var b=l.getDOMDocument(),k=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table"),n=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-column"),g,p,q,r;a&&k.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",a);h&&k.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:name",h);n.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:number-columns-repeated",s);d&&n.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",d);k.appendChild(n);for(q=0;q<v;q+=1){n=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-row");for(r=0;r<s;r+=1){g=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-cell"),(p=o(q,r))&&g.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",p),p=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:p"),g.appendChild(p),n.appendChild(g)}k.appendChild(n)}f=j.getParagraphElement(f.textNode);c.insertBefore(k,f.nextSibling);l.emit(ops.OdtDocument.signalStepsInserted,{position:i});l.getOdfCanvas().refreshSize();l.emit(ops.OdtDocument.signalTableAdded,{tableElement:k,memberId:m,timeStamp:u});l.getOdfCanvas().rerenderAnnotations();return !0}return !1};this.spec=function(){return{optype:"InsertTable",memberid:m,timestamp:u,position:i,initialRows:v,initialColumns:s,tableName:h,tableStyleName:a,tableColumnStyleName:d,tableCellStyleMatrix:t}}};ops.OpInsertText=function(){function e(c){return"\t"!==c&&i.isODFWhitespace(c)}var d,l,a,h,j,i=odf.OdfUtils;this.init=function(b){d=b.memberid;l=b.timestamp;a=b.position;j=b.text;h="true"===b.moveCursor||!0===b.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(b){var c,n,g,u=null,o=b.getDOMDocument(),f,k=0,s,t=b.getCursor(d),p;b.upgradeWhitespacesAtPosition(a);if(c=b.getTextNodeAtStep(a)){n=c.textNode;u=n.nextSibling;g=n.parentNode;f=i.getParagraphElement(n);for(p=0;p<j.length;p+=1){if(!(s="\t"===j[p])){s=j;var v=p;s=e(s[v])&&(0===v||v===s.length-1||e(s[v-1]))}s&&(0===k?(c.offset!==n.length&&(u=n.splitText(c.offset)),0<p&&n.appendData(j.substring(0,p))):k<p&&(k=j.substring(k,p),g.insertBefore(o.createTextNode(k),u)),k=p+1,"\t"===j[p]?(s=o.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:tab"),s.appendChild(o.createTextNode("\t"))):(" "!==j[p]&&runtime.log("WARN: InsertText operation contains non-tab, non-space whitespace character (character code "+j.charCodeAt(p)+")"),s=o.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:s"),s.appendChild(o.createTextNode(" "))),g.insertBefore(s,u))}0===k?n.insertData(c.offset,j):k<j.length&&(c=j.substring(k),g.insertBefore(o.createTextNode(c),u));g=n.parentNode;u=n.nextSibling;g.removeChild(n);g.insertBefore(n,u);0===n.length&&n.parentNode.removeChild(n);b.emit(ops.OdtDocument.signalStepsInserted,{position:a});t&&h&&(b.moveCursor(d,a+j.length,0),b.emit(ops.Document.signalCursorMoved,t));b.downgradeWhitespacesAtPosition(a);b.downgradeWhitespacesAtPosition(a+j.length);b.getOdfCanvas().refreshSize();b.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:f,memberId:d,timeStamp:l});b.getOdfCanvas().rerenderAnnotations();return !0}return !1};this.spec=function(){return{optype:"InsertText",memberid:d,timestamp:l,position:a,text:j,moveCursor:h}}};odf.CollapsingRules=function(e){function d(b){return a.isODFNode(b)||"br"===b.localName&&a.isLineBreak(b.parentNode)||b.nodeType===Node.TEXT_NODE&&a.isODFNode(b.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}function i(c){var b;c.nodeType===Node.TEXT_NODE?(b=c.parentNode,b.removeChild(c)):b=h.removeUnwantedNodes(c,d);if(c=b){c=b,c=!a.isParagraph(c)&&c!==e&&a.hasNoODFContent(c)}return c?i(b):b}var a=odf.OdfUtils,h=core.DomUtils;this.mergeChildrenIntoParent=i};ops.OpMergeParagraph=function(){function t(b){return odf.OdfUtils.isInlineRoot(b)?NodeFilter.FILTER_SKIP:o.isGroupingElement(b)&&o.hasNoODFContent(b)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}function s(b){if(b.nodeType===Node.TEXT_NODE){if(0===b.length){return runtime.log("WARN: Empty text node found during merge operation"),!0}if(o.isODFWhitespace(b.data)&&!1===o.isSignificantWhitespace(b,0)){return !0}b="#text"}else{b=(b.prefix?b.prefix+":":"")+b.localName}runtime.log("WARN: Unexpected text element found near paragraph boundary ["+b+"]");return !1}function x(a){a.collapsed||(z.splitBoundaries(a),a=o.getTextElements(a,!1,!0).filter(s),a.forEach(function(b){b.parentNode.removeChild(b)}))}function y(f,g,e){f=f.convertCursorStepToDomPoint(g);var k=o.getParagraphElement(f.node,f.offset);runtime.assert(Boolean(k),"Paragraph not found at step "+g);e&&e.setPosition(f.node,f.offset);return k}var u,m,j,h,i,v,o=odf.OdfUtils,z=core.DomUtils,w=odf.Namespaces.textns;this.init=function(b){u=b.memberid;m=b.timestamp;j=b.moveCursor;h=b.paragraphStyleName;i=parseInt(b.sourceStartPosition,10);v=parseInt(b.destinationStartPosition,10)};this.isEdit=!0;this.group=void 0;this.execute=function(a){var g,c,e=a.getCursor(u);g=a.getRootNode();var n=new odf.CollapsingRules(g),b=a.createStepIterator(g,0,[a.getPositionFilter()],g),d;runtime.assert(v<i,"Destination paragraph ("+v+") must be before source paragraph ("+i+")");c=y(a,v);g=y(a,i,b);b.previousStep();runtime.assert(z.containsNode(c,b.container()),"Destination paragraph must be adjacent to the source paragraph");d=c.ownerDocument.createRange();b.setPosition(c,c.childNodes.length);b.roundToPreviousStep();d.setStart(b.container(),b.offset());d.setEnd(c,c.childNodes.length);x(d);d=c.childNodes.length;var f=g.ownerDocument.createRange();b.setPosition(g,0);b.roundToNextStep();f.setStart(g,0);f.setEnd(b.container(),b.offset());x(f);for(f=g.firstChild;f;){"editinfo"===f.localName?g.removeChild(f):(c.appendChild(f),z.removeUnwantedNodes(f,t)),f=g.firstChild}runtime.assert(0===g.childNodes.length,"Source paragraph should be empty before it is removed");n.mergeChildrenIntoParent(g);a.emit(ops.OdtDocument.signalStepsRemoved,{position:i-1});b.setPosition(c,d);b.roundToClosestStep();b.previousStep()||b.roundToNextStep();a.downgradeWhitespaces(b);h?c.setAttributeNS(w,"text:style-name",h):c.removeAttributeNS(w,"style-name");e&&j&&(a.moveCursor(u,i-1,0),a.emit(ops.Document.signalCursorMoved,e));a.fixCursorPositions();a.getOdfCanvas().refreshSize();a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:c,memberId:u,timeStamp:m});a.getOdfCanvas().rerenderAnnotations();return !0};this.spec=function(){return{optype:"MergeParagraph",memberid:u,timestamp:m,moveCursor:j,paragraphStyleName:h,sourceStartPosition:i,destinationStartPosition:v}}};ops.OpMoveCursor=function(){var e,d,i,a,h;this.init=function(b){e=b.memberid;d=b.timestamp;i=b.position;a=b.length||0;h=b.selectionType||ops.OdtCursor.RangeSelection};this.isEdit=!1;this.group=void 0;this.execute=function(f){var b=f.getCursor(e),c;if(!b){return !1}c=f.convertCursorToDomRange(i,a);b.setSelectedRange(c,0<=a);b.setSelectionType(h);f.emit(ops.Document.signalCursorMoved,b);return !0};this.spec=function(){return{optype:"MoveCursor",memberid:e,timestamp:d,position:i,length:a,selectionType:h}}};ops.OpRemoveAnnotation=function(){var e,d,i,a,h=core.DomUtils;this.init=function(b){e=b.memberid;d=b.timestamp;i=parseInt(b.position,10);a=parseInt(b.length,10)};this.isEdit=!0;this.group=void 0;this.execute=function(c){function j(g){l.parentNode.insertBefore(g,l)}for(var f=c.getIteratorAtPosition(i).container(),l;f.namespaceURI!==odf.Namespaces.officens||"annotation"!==f.localName;){f=f.parentNode}if(null===f){return !1}l=f;f=l.annotationEndElement;c.getOdfCanvas().forgetAnnotation(l);h.getElementsByTagNameNS(l,"urn:webodf:names:cursor","cursor").forEach(j);h.getElementsByTagNameNS(l,"urn:webodf:names:cursor","anchor").forEach(j);l.parentNode.removeChild(l);f&&f.parentNode.removeChild(f);c.emit(ops.OdtDocument.signalStepsRemoved,{position:0<i?i-1:i});c.getOdfCanvas().rerenderAnnotations();c.fixCursorPositions();return !0};this.spec=function(){return{optype:"RemoveAnnotation",memberid:e,timestamp:d,position:i,length:a}}};ops.OpRemoveBlob=function(){var b,a,d;this.init=function(c){b=c.memberid;a=c.timestamp;d=c.filename};this.isEdit=!0;this.group=void 0;this.execute=function(c){c.getOdfCanvas().odfContainer().removeBlob(d);return !0};this.spec=function(){return{optype:"RemoveBlob",memberid:b,timestamp:a,filename:d}}};ops.OpRemoveCursor=function(){var b,a;this.init=function(d){b=d.memberid;a=d.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(d){return d.removeCursor(b)?!0:!1};this.spec=function(){return{optype:"RemoveCursor",memberid:b,timestamp:a}}};ops.OpRemoveHyperlink=function(){var e,d,j,a,h=core.DomUtils,i=odf.OdfUtils;this.init=function(b){e=b.memberid;d=b.timestamp;j=b.position;a=b.length};this.isEdit=!0;this.group=void 0;this.execute=function(f){var b=f.convertCursorToDomRange(j,a),c=i.getHyperlinkElements(b);runtime.assert(1===c.length,"The given range should only contain a single link.");c=h.mergeIntoParent(c[0]);b.detach();f.fixCursorPositions();f.getOdfCanvas().refreshSize();f.getOdfCanvas().rerenderAnnotations();f.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:i.getParagraphElement(c),memberId:e,timeStamp:d});return !0};this.spec=function(){return{optype:"RemoveHyperlink",memberid:e,timestamp:d,position:j,length:a}}};ops.OpRemoveMember=function(){var b,a;this.init=function(d){b=d.memberid;a=parseInt(d.timestamp,10)};this.isEdit=!1;this.group=void 0;this.execute=function(d){if(!d.getMember(b)){return !1}d.removeMember(b);d.emit(ops.Document.signalMemberRemoved,b);return !0};this.spec=function(){return{optype:"RemoveMember",memberid:b,timestamp:a}}};ops.OpRemoveStyle=function(){var e,d,f,a;this.init=function(b){e=b.memberid;d=b.timestamp;f=b.styleName;a=b.styleFamily};this.isEdit=!0;this.group=void 0;this.execute=function(c){var b=c.getFormatting().getStyleElement(f,a);if(!b){return !1}b.parentNode.removeChild(b);c.getOdfCanvas().refreshCSS();c.emit(ops.OdtDocument.signalCommonStyleDeleted,{name:f,family:a});return !0};this.spec=function(){return{optype:"RemoveStyle",memberid:e,timestamp:d,styleName:f,styleFamily:a}}};ops.OpRemoveText=function(){var e,d,j,a,h=odf.OdfUtils,i=core.DomUtils;this.init=function(b){runtime.assert(0<=b.length,"OpRemoveText only supports positive lengths");e=b.memberid;d=b.timestamp;j=parseInt(b.position,10);a=parseInt(b.length,10)};this.isEdit=!0;this.group=void 0;this.execute=function(m){var f,g,k,c=m.getCursor(e),b=new odf.CollapsingRules(m.getRootNode());m.upgradeWhitespacesAtPosition(j);m.upgradeWhitespacesAtPosition(j+a);f=m.convertCursorToDomRange(j,a);i.splitBoundaries(f);g=h.getTextElements(f,!1,!0);k=h.getParagraphElement(f.startContainer,f.startOffset);runtime.assert(void 0!==k,"Attempting to remove text outside a paragraph element");f.detach();g.forEach(function(l){l.parentNode?(runtime.assert(i.containsNode(k,l),"RemoveText only supports removing elements within the same paragraph"),b.mergeChildrenIntoParent(l)):runtime.log("WARN: text element has already been removed from it's container")});m.emit(ops.OdtDocument.signalStepsRemoved,{position:j});m.downgradeWhitespacesAtPosition(j);m.fixCursorPositions();m.getOdfCanvas().refreshSize();m.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:k,memberId:e,timeStamp:d});c&&(c.resetSelectionType(),m.emit(ops.Document.signalCursorMoved,c));m.getOdfCanvas().rerenderAnnotations();return !0};this.spec=function(){return{optype:"RemoveText",memberid:e,timestamp:d,position:j,length:a}}};ops.OpSetBlob=function(){var e,d,i,a,h;this.init=function(b){e=b.memberid;d=b.timestamp;i=b.filename;a=b.mimetype;h=b.content};this.isEdit=!0;this.group=void 0;this.execute=function(b){b.getOdfCanvas().odfContainer().setBlob(i,a,h);return !0};this.spec=function(){return{optype:"SetBlob",memberid:e,timestamp:d,filename:i,mimetype:a,content:h}}};ops.OpSetParagraphStyle=function(){function e(k,o,m){var n=[k.getPositionFilter()],l=m.container();m=m.unfilteredDomOffset();return !1===k.createStepIterator(l,m,n,o).previousStep()}var d,j,a,h,i=odf.OdfUtils;this.init=function(b){d=b.memberid;j=b.timestamp;a=b.position;h=b.styleName};this.isEdit=!0;this.group=void 0;this.execute=function(f){var b,c;b=f.getIteratorAtPosition(a);return(c=i.getParagraphElement(b.container()))?(runtime.assert(e(f,c,b),"SetParagraphStyle position should be the first position in the paragraph"),h?c.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:style-name",h):c.removeAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","style-name"),f.getOdfCanvas().refreshSize(),f.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:c,timeStamp:j,memberId:d}),f.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=function(){return{optype:"SetParagraphStyle",memberid:d,timestamp:j,position:a,styleName:h}}};ops.OpSplitParagraph=function(){var h,d,m,a,i,l,j=odf.OdfUtils,e=odf.Namespaces.textns;this.init=function(b){h=b.memberid;d=b.timestamp;a=b.position;m=b.sourceParagraphPosition;l=b.paragraphStyleName;i="true"===b.moveCursor||!0===b.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(o){var k,f,r,n,b,g,p,q=o.getCursor(h);o.upgradeWhitespacesAtPosition(a);k=o.getTextNodeAtStep(a);if(!k){return !1}f=j.getParagraphElement(k.textNode);if(!f){return !1}r=j.isListItem(f.parentNode)?f.parentNode:f;0===k.offset?(p=k.textNode.previousSibling,g=null):(p=k.textNode,g=k.offset>=k.textNode.length?null:k.textNode.splitText(k.offset));for(n=k.textNode;n!==r;){n=n.parentNode;b=n.cloneNode(!1);g&&b.appendChild(g);if(p){for(;p&&p.nextSibling;){b.appendChild(p.nextSibling)}}else{for(;n.firstChild;){b.appendChild(n.firstChild)}}n.parentNode.insertBefore(b,n.nextSibling);p=n;g=b}j.isListItem(g)&&(g=g.childNodes.item(0));l?g.setAttributeNS(e,"text:style-name",l):g.removeAttributeNS(e,"style-name");0===k.textNode.length&&k.textNode.parentNode.removeChild(k.textNode);o.emit(ops.OdtDocument.signalStepsInserted,{position:a});q&&i&&(o.moveCursor(h,a+1,0),o.emit(ops.Document.signalCursorMoved,q));o.fixCursorPositions();o.getOdfCanvas().refreshSize();o.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:f,memberId:h,timeStamp:d});o.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:g,memberId:h,timeStamp:d});o.getOdfCanvas().rerenderAnnotations();return !0};this.spec=function(){return{optype:"SplitParagraph",memberid:h,timestamp:d,position:a,sourceParagraphPosition:m,paragraphStyleName:l,moveCursor:i}}};ops.OpUpdateMember=function(){function e(g){var b="//dc:creator[@editinfo:memberid='"+d+"']";g=xmldom.XPath.getODFElementsWithXPath(g.getRootNode(),b,function(c){return"editinfo"===c?"urn:webodf:names:editinfo":odf.Namespaces.lookupNamespaceURI(c)});for(b=0;b<g.length;b+=1){g[b].textContent=a.fullName}}var d,i,a,h;this.init=function(b){d=b.memberid;i=parseInt(b.timestamp,10);a=b.setProperties;h=b.removedProperties};this.isEdit=!1;this.group=void 0;this.execute=function(f){var b=f.getMember(d);if(!b){return !1}h&&b.removeProperties(h);a&&(b.setProperties(a),a.fullName&&e(f));f.emit(ops.Document.signalMemberUpdated,b);return !0};this.spec=function(){return{optype:"UpdateMember",memberid:d,timestamp:i,setProperties:a,removedProperties:h}}};ops.OpUpdateMetadata=function(){var e,d,f,a;this.init=function(b){e=b.memberid;d=parseInt(b.timestamp,10);f=b.setProperties;a=b.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(h){var c=h.getOdfCanvas().odfContainer(),b=null;a&&(b=a.attributes.split(","));c.setMetadata(f,b);h.emit(ops.OdtDocument.signalMetadataUpdated,{setProperties:null!==f?f:{},removedProperties:null!==b?b:[]});return !0};this.spec=function(){return{optype:"UpdateMetadata",memberid:e,timestamp:d,setProperties:f,removedProperties:a}}};ops.OpUpdateParagraphStyle=function(){function e(g,o){var n,m,k=o?o.split(","):[];for(n=0;n<k.length;n+=1){m=k[n].split(":"),g.removeAttributeNS(odf.Namespaces.lookupNamespaceURI(m[0]),m[1])}}var d,l,a,h,j,i=odf.Namespaces.stylens;this.init=function(b){d=b.memberid;l=b.timestamp;a=b.styleName;h=b.setProperties;j=b.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(n){var g=n.getFormatting(),m,f,b;return(m=""!==a?g.getStyleElement(a,"paragraph"):g.getDefaultStyleElement("paragraph"))?(f=m.getElementsByTagNameNS(i,"paragraph-properties").item(0),b=m.getElementsByTagNameNS(i,"text-properties").item(0),h&&g.updateStyle(m,h),j&&(g=j["style:paragraph-properties"],f&&g&&(e(f,g.attributes),0===f.attributes.length&&m.removeChild(f)),g=j["style:text-properties"],b&&g&&(e(b,g.attributes),0===b.attributes.length&&m.removeChild(b)),e(m,j.attributes)),n.getOdfCanvas().refreshCSS(),n.emit(ops.OdtDocument.signalParagraphStyleModified,a),n.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=function(){return{optype:"UpdateParagraphStyle",memberid:d,timestamp:l,styleName:a,setProperties:h,removedProperties:j}}};ops.OperationFactory=function(){function b(d){return function(c){return new d}}var a;this.register=function(e,d){a[e]=d};this.create=function(g){var d=null,e=a[g.optype];e&&(d=e(g),d.init(g));return d};a={AddMember:b(ops.OpAddMember),UpdateMember:b(ops.OpUpdateMember),RemoveMember:b(ops.OpRemoveMember),AddCursor:b(ops.OpAddCursor),ApplyDirectStyling:b(ops.OpApplyDirectStyling),SetBlob:b(ops.OpSetBlob),RemoveBlob:b(ops.OpRemoveBlob),InsertImage:b(ops.OpInsertImage),InsertTable:b(ops.OpInsertTable),InsertText:b(ops.OpInsertText),RemoveText:b(ops.OpRemoveText),MergeParagraph:b(ops.OpMergeParagraph),SplitParagraph:b(ops.OpSplitParagraph),SetParagraphStyle:b(ops.OpSetParagraphStyle),UpdateParagraphStyle:b(ops.OpUpdateParagraphStyle),AddStyle:b(ops.OpAddStyle),RemoveStyle:b(ops.OpRemoveStyle),MoveCursor:b(ops.OpMoveCursor),RemoveCursor:b(ops.OpRemoveCursor),AddAnnotation:b(ops.OpAddAnnotation),RemoveAnnotation:b(ops.OpRemoveAnnotation),UpdateMetadata:b(ops.OpUpdateMetadata),ApplyHyperlink:b(ops.OpApplyHyperlink),RemoveHyperlink:b(ops.OpRemoveHyperlink)}};ops.OperationRouter=function(){};ops.OperationRouter.prototype.setOperationFactory=function(a){};ops.OperationRouter.prototype.setPlaybackFunction=function(a){};ops.OperationRouter.prototype.push=function(a){};ops.OperationRouter.prototype.close=function(a){};ops.OperationRouter.prototype.subscribe=function(b,a){};ops.OperationRouter.prototype.unsubscribe=function(b,a){};ops.OperationRouter.prototype.hasLocalUnsyncedOps=function(){};ops.OperationRouter.prototype.hasSessionHostConnection=function(){};ops.OperationRouter.signalProcessingBatchStart="router/batchstart";ops.OperationRouter.signalProcessingBatchEnd="router/batchend";ops.TrivialOperationRouter=function(){var e=new core.EventNotifier([ops.OperationRouter.signalProcessingBatchStart,ops.OperationRouter.signalProcessingBatchEnd]),d,f,a=0;this.setOperationFactory=function(c){d=c};this.setPlaybackFunction=function(c){f=c};this.push=function(b){a+=1;e.emit(ops.OperationRouter.signalProcessingBatchStart,{});b.forEach(function(c){c=c.spec();c.timestamp=Date.now();c=d.create(c);c.group="g"+a;f(c)});e.emit(ops.OperationRouter.signalProcessingBatchEnd,{})};this.close=function(c){c()};this.subscribe=function(g,h){e.subscribe(g,h)};this.unsubscribe=function(g,h){e.unsubscribe(g,h)};this.hasLocalUnsyncedOps=function(){return !1};this.hasSessionHostConnection=function(){return !0}};ops.Session=function(e){function d(c){h.emit(ops.OdtDocument.signalProcessingBatchStart,c)}function j(c){h.emit(ops.OdtDocument.signalProcessingBatchEnd,c)}var a=new ops.OperationFactory,h=new ops.OdtDocument(e),i=null;this.setOperationFactory=function(b){a=b;i&&i.setOperationFactory(a)};this.setOperationRouter=function(b){i&&(i.unsubscribe(ops.OperationRouter.signalProcessingBatchStart,d),i.unsubscribe(ops.OperationRouter.signalProcessingBatchEnd,j));i=b;i.subscribe(ops.OperationRouter.signalProcessingBatchStart,d);i.subscribe(ops.OperationRouter.signalProcessingBatchEnd,j);b.setPlaybackFunction(function(c){h.emit(ops.OdtDocument.signalOperationStart,c);return c.execute(h)?(h.emit(ops.OdtDocument.signalOperationEnd,c),!0):!1});b.setOperationFactory(a)};this.getOperationFactory=function(){return a};this.getOdtDocument=function(){return h};this.enqueue=function(c){i.push(c)};this.close=function(c){i.close(function(b){b?c(b):h.close(c)})};this.destroy=function(c){h.destroy(c)};this.setOperationRouter(new ops.TrivialOperationRouter)};gui.AnnotationController=function(s,o,v){function w(){var e=d.getCursor(v),e=e&&e.getNode(),c=!1;e&&(c=!m.isWithinAnnotation(e,d.getRootNode()));c!==h&&(h=c,u.emit(gui.AnnotationController.annotatableChanged,h))}function t(b){b.getMemberId()===v&&w()}function j(b){b===v&&w()}function i(b){b.getMemberId()===v&&w()}var d=s.getOdtDocument(),h=!1,u=new core.EventNotifier([gui.AnnotationController.annotatableChanged]),m=odf.OdfUtils,x=core.StepDirection.NEXT;this.isAnnotatable=function(){return h};this.addAnnotation=function(){var f=new ops.OpAddAnnotation,c=d.getCursorSelection(v),g=c.length,c=c.position;h&&(0===g?g=void 0:(c=0<=g?c:c+g,g=Math.abs(g)),f.init({memberid:v,position:c,length:g,name:v+Date.now()}),s.enqueue([f]))};this.removeAnnotation=function(f){var a,c;a=d.getMember(v).getProperties().fullName;if(!0!==o.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)||a===m.getAnnotationCreator(f)){a=d.convertDomPointToCursorStep(f,0,x),c=d.convertDomPointToCursorStep(f,f.childNodes.length),f=new ops.OpRemoveAnnotation,f.init({memberid:v,position:a,length:c-a}),c=new ops.OpMoveCursor,c.init({memberid:v,position:0<a?a-1:a,length:0}),s.enqueue([f,c])}};this.subscribe=function(e,c){u.subscribe(e,c)};this.unsubscribe=function(e,c){u.unsubscribe(e,c)};this.destroy=function(b){d.unsubscribe(ops.Document.signalCursorAdded,t);d.unsubscribe(ops.Document.signalCursorRemoved,j);d.unsubscribe(ops.Document.signalCursorMoved,i);b()};o.registerConstraint(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN);d.subscribe(ops.Document.signalCursorAdded,t);d.subscribe(ops.Document.signalCursorRemoved,j);d.subscribe(ops.Document.signalCursorMoved,i);w()};gui.AnnotationController.annotatableChanged="annotatable/changed";gui.Avatar=function(e,d){var j=this,a,h,i;this.setColor=function(c){h.style.borderColor=c};this.setImageUrl=function(c){j.isVisible()?h.src=c:i=c};this.isVisible=function(){return"block"===a.style.display};this.show=function(){i&&(h.src=i,i=void 0);a.style.display="block"};this.hide=function(){a.style.display="none"};this.markAsFocussed=function(b){b?a.classList.add("active"):a.classList.remove("active")};this.destroy=function(b){e.removeChild(a);b()};(function(){var b=e.ownerDocument;a=b.createElement("div");h=b.createElement("img");a.appendChild(h);a.style.display=d?"block":"none";a.className="handle";e.appendChild(a)})()};gui.StepInfo=function(){};gui.StepInfo.VisualDirection={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1};gui.StepInfo.prototype.container=function(){};gui.StepInfo.prototype.offset=function(){};gui.VisualStepScanner=function(){};gui.VisualStepScanner.prototype.process=function(b,a,d){};gui.GuiStepUtils=function(){function e(c){c=l.getContentBounds(c);var b,k=null;if(c){if(c.container.nodeType===Node.TEXT_NODE){b=c.container.ownerDocument.createRange(),b.setStart(c.container,c.startOffset),b.setEnd(c.container,c.endOffset),(k=0<b.getClientRects().length?b.getBoundingClientRect():null)&&" "===c.container.data.substring(c.startOffset,c.endOffset)&&1>=k.width&&(k=null),b.detach()}else{if(d.isCharacterElement(c.container)||d.isCharacterFrame(c.container)){k=a.getBoundingClientRect(c.container)}}}return k}var d=odf.OdfUtils,l=new odf.StepUtils,a=core.DomUtils,h=core.StepDirection.NEXT,j=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT,i=gui.StepInfo.VisualDirection.RIGHT_TO_LEFT;this.getContentRect=e;this.moveToFilteredStep=function(t,s,p){function g(k,c){c.process(y,o,n)&&(k=!0,!u&&c.token&&(u=c.token));return k}var v=s===h,q,f,o,n,u,r=t.snapshot();q=!1;var y;do{q=e(t),y={token:t.snapshot(),container:t.container,offset:t.offset,direction:s,visualDirection:s===h?j:i},f=t.nextStep()?e(t):null,t.restore(y.token),v?(o=q,n=f):(o=f,n=q),q=p.reduce(g,!1)}while(!q&&t.advanceStep(s));q||p.forEach(function(b){!u&&b.token&&(u=b.token)});t.restore(u||r);return Boolean(u)}};gui.Caret=function(V,T,Z,aa){function W(){ab.style.opacity="0"===ab.style.opacity?"1":"0";J.trigger()}function Q(){s.selectNodeContents(U);return s.getBoundingClientRect()}function P(b){return H[b]!==i[b]}function M(){Object.keys(i).forEach(function(b){H[b]=i[b]})}function N(){if(!1===i.isShown||V.getSelectionType()!==ops.OdtCursor.RangeSelection||!aa&&!V.getSelectedRange().collapsed){i.visibility="hidden",ab.style.visibility="hidden",J.cancel()}else{if(i.visibility="visible",ab.style.visibility="visible",!1===i.isFocused){ab.style.opacity="1",J.cancel()}else{if(O||P("visibility")){ab.style.opacity="1",J.cancel()}J.trigger()}}if(j||B){var l;l=V.getNode();var g,a,d=o.getBoundingClientRect(C.getSizer()),b=!1,k=0;l.removeAttributeNS("urn:webodf:names:cursor","caret-sizer-active");if(0<l.getClientRects().length){a=Q(),k=a.left-o.getBoundingClientRect(l).left,b=!0}else{if(F.setPosition(l,0),a=D.getContentRect(F),!a&&F.nextStep()&&(g=D.getContentRect(F))&&(a=g,b=!0),a||(l.setAttributeNS("urn:webodf:names:cursor","caret-sizer-active","true"),a=Q(),b=!0),!a){for(runtime.log("WARN: No suitable client rectangle found for visual caret for "+V.getMemberId());l;){if(0<l.getClientRects().length){a=o.getBoundingClientRect(l);b=!0;break}l=l.parentNode}}}a=o.translateRect(a,d,C.getZoomLevel());l={top:a.top,height:a.height,right:b?a.left:a.right,width:o.adaptRangeDifferenceToZoomLevel(k,C.getZoomLevel())};8>l.height&&(l={top:l.top-(8-l.height)/2,height:8,right:l.right});S.style.height=l.height+"px";S.style.top=l.top+"px";S.style.left=l.right-l.width+"px";S.style.width=l.width?l.width+"px":"";R&&(l=runtime.getWindow().getComputedStyle(V.getNode(),null),l.font?R.style.font=l.font:(R.style.fontStyle=l.fontStyle,R.style.fontVariant=l.fontVariant,R.style.fontWeight=l.fontWeight,R.style.fontSize=l.fontSize,R.style.lineHeight=l.lineHeight,R.style.fontFamily=l.fontFamily))}i.isShown&&B&&T.scrollIntoView(ab.getBoundingClientRect());P("isFocused")&&Y.markAsFocussed(i.isFocused);M();j=B=O=!1}function X(b){S.parentNode.removeChild(S);U.parentNode.removeChild(U);b()}var S,ab,Y,R,U,s,C=V.getDocument().getCanvas(),o=core.DomUtils,D=new gui.GuiStepUtils,F,G,J,O=!1,B=!1,j=!1,i={isFocused:!1,isShown:!0,visibility:"hidden"},H={isFocused:!i.isFocused,isShown:!i.isShown,visibility:"hidden"};this.handleUpdate=function(){j=!0;G.trigger()};this.refreshCursorBlinking=function(){O=!0;G.trigger()};this.setFocus=function(){i.isFocused=!0;G.trigger()};this.removeFocus=function(){i.isFocused=!1;G.trigger()};this.show=function(){i.isShown=!0;G.trigger()};this.hide=function(){i.isShown=!1;G.trigger()};this.setAvatarImageUrl=function(b){Y.setImageUrl(b)};this.setColor=function(a){ab.style.borderColor=a;Y.setColor(a)};this.getCursor=function(){return V};this.getFocusElement=function(){return ab};this.toggleHandleVisibility=function(){Y.isVisible()?Y.hide():Y.show()};this.showHandle=function(){Y.show()};this.hideHandle=function(){Y.hide()};this.setOverlayElement=function(b){R=b;S.appendChild(b);j=!0;G.trigger()};this.ensureVisible=function(){B=!0;G.trigger()};this.getBoundingClientRect=function(){return o.getBoundingClientRect(S)};this.destroy=function(b){core.Async.destroyAll([G.destroy,J.destroy,Y.destroy,X],b)};(function(){var c=V.getDocument(),d=[c.createRootFilter(V.getMemberId()),c.getPositionFilter()],a=c.getDOMDocument();s=a.createRange();U=a.createElement("span");U.className="webodf-caretSizer";U.textContent="|";V.getNode().appendChild(U);S=a.createElement("div");S.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",V.getMemberId());S.className="webodf-caretOverlay";ab=a.createElement("div");ab.className="caret";S.appendChild(ab);Y=new gui.Avatar(S,Z);C.getSizer().appendChild(S);F=c.createStepIterator(V.getNode(),0,d,c.getRootNode());G=core.Task.createRedrawTask(N);J=core.Task.createTimeoutTask(W,500);G.triggerImmediate()})()};odf.TextSerializer=function(){function b(c){var g="",i=a.filter?a.filter.acceptNode(c):NodeFilter.FILTER_ACCEPT,h=c.nodeType,e;if((i===NodeFilter.FILTER_ACCEPT||i===NodeFilter.FILTER_SKIP)&&d.isTextContentContainingNode(c)){for(e=c.firstChild;e;){g+=b(e),e=e.nextSibling}}i===NodeFilter.FILTER_ACCEPT&&(h===Node.ELEMENT_NODE&&d.isParagraph(c)?g+="\n":h===Node.TEXT_NODE&&c.textContent&&(g+=c.textContent));return g}var a=this,d=odf.OdfUtils;this.filter=null;this.writeToString=function(c){if(!c){return""}c=b(c);"\n"===c[c.length-1]&&(c=c.substr(0,c.length-1));return c}};gui.MimeDataExporter=function(){var a;this.exportRangeToDataTransfer=function(e,h){var d;d=h.startContainer.ownerDocument.createElement("span");d.appendChild(h.cloneContents());d=a.writeToString(d);try{e.setData("text/plain",d)}catch(g){e.setData("Text",d)}};a=new odf.TextSerializer;a.filter=new odf.OdfNodeFilter};gui.Clipboard=function(a){this.setDataFromRange=function(e,h){var d,g=e.clipboardData;d=runtime.getWindow();!g&&d&&(g=d.clipboardData);g?(d=!0,a.exportRangeToDataTransfer(g,h),e.preventDefault()):d=!1;return d}};gui.SessionContext=function(e,d){var f=e.getOdtDocument(),a=odf.OdfUtils;this.isLocalCursorWithinOwnAnnotation=function(){var c=f.getCursor(d),b;if(!c){return !1}b=c&&c.getNode();c=f.getMember(d).getProperties().fullName;return(b=a.getParentAnnotation(b,f.getRootNode()))&&a.getAnnotationCreator(b)===c?!0:!1}};gui.StyleSummary=function(e){function d(f,l){var g=f+"|"+l,j;h.hasOwnProperty(g)||(j=[],e.forEach(function(b){b=(b=b.styleProperties[f])&&b[l];-1===j.indexOf(b)&&j.push(b)}),h[g]=j);return h[g]}function i(g,k,j){return function(){var b=d(g,k);return j.length>=b.length&&b.every(function(c){return -1!==j.indexOf(c)})}}function a(g,k){var j=d(g,k);return 1===j.length?j[0]:void 0}var h={};this.getPropertyValues=d;this.getCommonValue=a;this.isBold=i("style:text-properties","fo:font-weight",["bold"]);this.isItalic=i("style:text-properties","fo:font-style",["italic"]);this.hasUnderline=i("style:text-properties","style:text-underline-style",["solid"]);this.hasStrikeThrough=i("style:text-properties","style:text-line-through-style",["solid"]);this.fontSize=function(){var b=a("style:text-properties","fo:font-size");return b&&parseFloat(b)};this.fontName=function(){return a("style:text-properties","style:font-name")};this.isAlignedLeft=i("style:paragraph-properties","fo:text-align",["left","start"]);this.isAlignedCenter=i("style:paragraph-properties","fo:text-align",["center"]);this.isAlignedRight=i("style:paragraph-properties","fo:text-align",["right","end"]);this.isAlignedJustified=i("style:paragraph-properties","fo:text-align",["justify"]);this.text={isBold:this.isBold,isItalic:this.isItalic,hasUnderline:this.hasUnderline,hasStrikeThrough:this.hasStrikeThrough,fontSize:this.fontSize,fontName:this.fontName};this.paragraph={isAlignedLeft:this.isAlignedLeft,isAlignedCenter:this.isAlignedCenter,isAlignedRight:this.isAlignedRight,isAlignedJustified:this.isAlignedJustified}};gui.DirectFormattingController=function(ay,aw,aC,aD,az,at,ar){function ap(){return B.value().styleSummary}function aq(){return B.value().enabledFeatures}function aA(d){var c;d.collapsed?(c=d.startContainer,c.hasChildNodes()&&d.startOffset<c.childNodes.length&&(c=c.childNodes.item(d.startOffset)),d=[c]):d=F.getTextElements(d,!0,!1);return d}function av(){var b=H.getCursor(aD),l=b&&b.getSelectedRange(),c=[],c=[],k=!0,e={directTextStyling:!0,directParagraphStyling:!0};l&&(c=aA(l),0===c.length&&(c=[l.startContainer,l.endContainer],k=!1),c=H.getFormatting().getAppliedStyles(c));void 0!==c[0]&&j&&(c[0].styleProperties=ag.mergeObjects(c[0].styleProperties,j));!0===aw.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(e.directTextStyling=e.directParagraphStyling=aC.isLocalCursorWithinOwnAnnotation());e.directTextStyling&&(e.directTextStyling=k&&void 0!==b&&b.getSelectionType()===ops.OdtCursor.RangeSelection);return{enabledFeatures:e,appliedStyles:c,styleSummary:new gui.StyleSummary(c)}}function aE(e,c){var f={};Object.keys(e).forEach(function(d){var b=e[d](),a=c[d]();b!==a&&(f[d]=a)});return f}function aB(){var a,m;m=aF.styleSummary;var n=B.value(),l=n.styleSummary,g=aF.enabledFeatures,k=n.enabledFeatures;a=aE(m.text,l.text);m=aE(m.paragraph,l.paragraph);g=!(k.directTextStyling===g.directTextStyling&&k.directParagraphStyling===g.directParagraphStyling);aF=n;g&&ah.emit(gui.DirectFormattingController.enabledChanged,k);0<Object.keys(a).length&&ah.emit(gui.DirectFormattingController.textStylingChanged,a);0<Object.keys(m).length&&ah.emit(gui.DirectFormattingController.paragraphStylingChanged,m)}function au(){B.reset();aB()}function ax(b){("string"===typeof b?b:b.getMemberId())===aD&&B.reset()}function aj(){B.reset()}function ak(b){var c=H.getCursor(aD);b=b.paragraphElement;c&&F.getParagraphElement(c.getNode())===b&&B.reset()}function ai(d,c){c(!d());return !0}function al(b){if(aq().directTextStyling){var e=H.getCursorSelection(aD),f={"style:text-properties":b};0!==e.length?(b=new ops.OpApplyDirectStyling,b.init({memberid:aD,position:e.position,length:e.length,setProperties:f}),ay.enqueue([b])):(j=ag.mergeObjects(j||{},f),B.reset())}}function am(e,c){var f={};f[e]=c;al(f)}function an(b){b=b.spec();j&&b.memberid===aD&&"SplitParagraph"!==b.optype&&(j=null,B.reset())}function ao(b){am("fo:font-weight",b?"bold":"normal")}function af(b){am("fo:font-style",b?"italic":"normal")}function ab(b){am("style:text-underline-style",b?"solid":"none")}function X(b){am("style:text-line-through-style",b?"solid":"none")}function T(f){if(aq().directParagraphStyling){var l=H.getCursor(aD).getSelectedRange(),l=F.getParagraphElements(l),n=H.getFormatting(),k=[],g={},b;l.forEach(function(h){var e=H.convertDomPointToCursorStep(h,0,ae),a=h.getAttributeNS(odf.Namespaces.textns,"style-name"),c;h=a?g.hasOwnProperty(a)?g[a]:void 0:b;h||(h=az.generateStyleName(),a?(g[a]=h,c=n.createDerivedStyleObject(a,"paragraph",{})):(b=h,c={}),c=f(c),a=new ops.OpAddStyle,a.init({memberid:aD,styleName:h.toString(),styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:c}),k.push(a));a=new ops.OpSetParagraphStyle;a.init({memberid:aD,styleName:h.toString(),position:e});k.push(a)});ay.enqueue(k)}}function ac(b){T(function(a){return ag.mergeObjects(a,b)})}function Q(b){ac({"style:paragraph-properties":{"fo:text-align":b}})}function M(g,f){var k=H.getFormatting().getDefaultTabStopDistance(),l=f["style:paragraph-properties"],h;l&&(l=l["fo:margin-left"],h=F.parseLength(l));return ag.mergeObjects(f,{"style:paragraph-properties":{"fo:margin-left":h&&h.unit===k.unit?h.value+g*k.value+h.unit:g*k.value+k.unit}})}function ad(f,e){var k=aA(f),k=0===k.length?[f.startContainer]:k,k=H.getFormatting().getAppliedStyles(k),l=0<k.length?k[0].styleProperties:void 0,g=H.getFormatting().getAppliedStylesForElement(e).styleProperties;if(!l||"text"!==l["style:family"]||!l["style:text-properties"]){return !1}if(!g||!g["style:text-properties"]){return !0}l=l["style:text-properties"];g=g["style:text-properties"];return !Object.keys(l).every(function(b){return l[b]===g[b]})}function s(){}function o(){return !1}function Y(){return !1}var G=this,H=ay.getOdtDocument(),ag=new core.Utils,F=odf.OdfUtils,ah=new core.EventNotifier([gui.DirectFormattingController.enabledChanged,gui.DirectFormattingController.textStylingChanged,gui.DirectFormattingController.paragraphStylingChanged]),i=odf.Namespaces.textns,ae=core.StepDirection.NEXT,j=null,aF,B;this.enabledFeatures=aq;this.formatTextSelection=al;this.createCursorStyleOp=function(b,k,l){var g=null,f=j;l&&(f=(l=B.value().appliedStyles[0])&&l.styleProperties);f&&f["style:text-properties"]&&(g=new ops.OpApplyDirectStyling,g.init({memberid:aD,position:b,length:k,setProperties:{"style:text-properties":f["style:text-properties"]}}),j=null,B.reset());return g};this.setBold=ao;this.setItalic=af;this.setHasUnderline=ab;this.setHasStrikethrough=X;this.setFontSize=function(b){am("fo:font-size",b+"pt")};this.setFontName=function(b){am("style:font-name",b)};this.getAppliedStyles=function(){return B.value().appliedStyles};this.toggleBold=ai.bind(G,function(){return ap().isBold()},ao);this.toggleItalic=ai.bind(G,function(){return ap().isItalic()},af);this.toggleUnderline=ai.bind(G,function(){return ap().hasUnderline()},ab);this.toggleStrikethrough=ai.bind(G,function(){return ap().hasStrikeThrough()},X);this.isBold=function(){return ap().isBold()};this.isItalic=function(){return ap().isItalic()};this.hasUnderline=function(){return ap().hasUnderline()};this.hasStrikeThrough=function(){return ap().hasStrikeThrough()};this.fontSize=function(){return ap().fontSize()};this.fontName=function(){return ap().fontName()};this.isAlignedLeft=function(){return ap().isAlignedLeft()};this.isAlignedCenter=function(){return ap().isAlignedCenter()};this.isAlignedRight=function(){return ap().isAlignedRight()};this.isAlignedJustified=function(){return ap().isAlignedJustified()};this.alignParagraphLeft=function(){Q("left");return !0};this.alignParagraphCenter=function(){Q("center");return !0};this.alignParagraphRight=function(){Q("right");return !0};this.alignParagraphJustified=function(){Q("justify");return !0};this.indent=function(){T(M.bind(null,1));return !0};this.outdent=function(){T(M.bind(null,-1));return !0};this.createParagraphStyleOps=function(k){if(!aq().directParagraphStyling){return[]}var r=H.getCursor(aD),t=r.getSelectedRange(),q=[],n,p;r.hasForwardSelection()?(n=r.getAnchorNode(),p=r.getNode()):(n=r.getNode(),p=r.getAnchorNode());r=F.getParagraphElement(p);runtime.assert(Boolean(r),"DirectFormattingController: Cursor outside paragraph");var b=r,f=[H.getPositionFilter(),H.createRootFilter(aD)];if(!1!==H.createStepIterator(t.endContainer,t.endOffset,f,b).nextStep()){return q}p!==n&&(r=F.getParagraphElement(n));if(!j&&!ad(t,r)){return q}t=(t=B.value().appliedStyles[0])&&t.styleProperties;if(!t){return q}if(r=r.getAttributeNS(i,"style-name")){t={"style:text-properties":t["style:text-properties"]},t=H.getFormatting().createDerivedStyleObject(r,"paragraph",t)}n=az.generateStyleName();r=new ops.OpAddStyle;r.init({memberid:aD,styleName:n,styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:t});q.push(r);r=new ops.OpSetParagraphStyle;r.init({memberid:aD,styleName:n,position:k});q.push(r);return q};this.subscribe=function(b,c){ah.subscribe(b,c)};this.unsubscribe=function(b,c){ah.unsubscribe(b,c)};this.destroy=function(b){H.unsubscribe(ops.Document.signalCursorAdded,ax);H.unsubscribe(ops.Document.signalCursorRemoved,ax);H.unsubscribe(ops.Document.signalCursorMoved,ax);H.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,aj);H.unsubscribe(ops.OdtDocument.signalParagraphChanged,ak);H.unsubscribe(ops.OdtDocument.signalOperationEnd,an);H.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,aB);aw.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,au);b()};(function(){H.subscribe(ops.Document.signalCursorAdded,ax);H.subscribe(ops.Document.signalCursorRemoved,ax);H.subscribe(ops.Document.signalCursorMoved,ax);H.subscribe(ops.OdtDocument.signalParagraphStyleModified,aj);H.subscribe(ops.OdtDocument.signalParagraphChanged,ak);H.subscribe(ops.OdtDocument.signalOperationEnd,an);H.subscribe(ops.OdtDocument.signalProcessingBatchEnd,aB);aw.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,au);B=new core.LazyProperty(av);aF=B.value();at||(G.formatTextSelection=s,G.setBold=s,G.setItalic=s,G.setHasUnderline=s,G.setHasStrikethrough=s,G.setFontSize=s,G.setFontName=s,G.toggleBold=Y,G.toggleItalic=Y,G.toggleUnderline=Y,G.toggleStrikethrough=Y);ar||(G.alignParagraphCenter=o,G.alignParagraphJustified=o,G.alignParagraphLeft=o,G.alignParagraphRight=o,G.createParagraphStyleOps=function(){return[]},G.indent=o,G.outdent=o)})()};gui.DirectFormattingController.enabledChanged="enabled/changed";gui.DirectFormattingController.textStylingChanged="textStyling/changed";gui.DirectFormattingController.paragraphStylingChanged="paragraphStyling/changed";gui.DirectFormattingController.SelectionInfo=function(){};gui.KeyboardHandler=function(){function e(g,h){h||(h=d.None);switch(g){case gui.KeyboardHandler.KeyCode.LeftMeta:case gui.KeyboardHandler.KeyCode.RightMeta:case gui.KeyboardHandler.KeyCode.MetaInMozilla:h|=d.Meta;break;case gui.KeyboardHandler.KeyCode.Ctrl:h|=d.Ctrl;break;case gui.KeyboardHandler.KeyCode.Alt:h|=d.Alt;break;case gui.KeyboardHandler.KeyCode.Shift:h|=d.Shift}return g+":"+h}var d=gui.KeyboardHandler.Modifier,f=null,a={};this.setDefault=function(c){f=c};this.bind=function(i,b,h,g){i=e(i,b);runtime.assert(g||!1===a.hasOwnProperty(i),"tried to overwrite the callback handler of key combo: "+i);a[i]=h};this.unbind=function(h,b){var g=e(h,b);delete a[g]};this.reset=function(){f=null;a={}};this.handleEvent=function(b){var g=b.keyCode,c=d.None;b.metaKey&&(c|=d.Meta);b.ctrlKey&&(c|=d.Ctrl);b.altKey&&(c|=d.Alt);b.shiftKey&&(c|=d.Shift);g=e(g,c);g=a[g];c=!1;g?c=g():null!==f&&(c=f(b));c&&(b.preventDefault?b.preventDefault():b.returnValue=!1)}};gui.KeyboardHandler.Modifier={None:0,Meta:1,Ctrl:2,Alt:4,CtrlAlt:6,Shift:8,MetaShift:9,CtrlShift:10,AltShift:12};gui.KeyboardHandler.KeyCode={Backspace:8,Tab:9,Clear:12,Enter:13,Shift:16,Ctrl:17,Alt:18,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,MetaInMozilla:224};gui.HyperlinkClickHandler=function(v,u,z){function A(){var b=v();runtime.assert(Boolean(b.classList),"Document container has no classList element");b.classList.remove("webodf-inactiveLinks")}function w(){var b=v();runtime.assert(Boolean(b.classList),"Document container has no classList element");b.classList.add("webodf-inactiveLinks")}function o(){B.removeEventListener("focus",w,!1);s.forEach(function(b){u.unbind(b.keyCode,b.modifier);z.unbind(b.keyCode,b.modifier)});s.length=0}function j(a){o();if(a!==h.None){B.addEventListener("focus",w,!1);switch(a){case h.Ctrl:s.push({keyCode:i.Ctrl,modifier:h.None});break;case h.Meta:s.push({keyCode:i.LeftMeta,modifier:h.None}),s.push({keyCode:i.RightMeta,modifier:h.None}),s.push({keyCode:i.MetaInMozilla,modifier:h.None})}s.forEach(function(b){u.bind(b.keyCode,b.modifier,A);z.bind(b.keyCode,b.modifier,w)})}}var h=gui.KeyboardHandler.Modifier,i=gui.KeyboardHandler.KeyCode,x=xmldom.XPath,t=odf.OdfUtils,B=runtime.getWindow(),y=h.None,s=[];runtime.assert(null!==B,"Expected to be run in an environment which has a global window, like a browser.");this.handleClick=function(d){var g=d.target||d.srcElement,e,a;d.ctrlKey?e=h.Ctrl:d.metaKey&&(e=h.Meta);if(y===h.None||y===e){B:{for(;null!==g;){if(t.isHyperlink(g)){break B}if(t.isParagraph(g)){break}g=g.parentNode}g=null}g&&(g=t.getHyperlinkTarget(g),""!==g&&("#"===g[0]?(g=g.substring(1),e=v(),a=x.getODFElementsWithXPath(e,"//text:bookmark-start[@text:name='"+g+"']",odf.Namespaces.lookupNamespaceURI),0===a.length&&(a=x.getODFElementsWithXPath(e,"//text:bookmark[@text:name='"+g+"']",odf.Namespaces.lookupNamespaceURI)),0<a.length&&a[0].scrollIntoView(!0)):/^\s*(javascript|data):/.test(g)?runtime.log("WARN:","potentially malicious URL ignored"):B.open(g),d.preventDefault?d.preventDefault():d.returnValue=!1))}};this.setModifier=function(b){y!==b&&(runtime.assert(b===h.None||b===h.Ctrl||b===h.Meta,"Unsupported KeyboardHandler.Modifier value: "+b),y=b,y!==h.None?w():A(),j(y))};this.getModifier=function(){return y};this.destroy=function(b){w();o();b()}};gui.EventManager=function(X){function V(k){function p(f,d,u){var t,r=!1;t="on"+d;f.attachEvent&&(f.attachEvent(t,u),r=!0);!r&&f.addEventListener&&(f.addEventListener(d,u,!1),r=!0);r&&!H[d]||!f.hasOwnProperty(t)||(f[t]=u)}function g(b,h,r){var f="on"+h;b.detachEvent&&b.detachEvent(f,r);b.removeEventListener&&b.removeEventListener(h,r,!1);b[f]===r&&(b[f]=null)}function q(a){if(-1===l.indexOf(a)){l.push(a);if(n.filters.every(function(b){return b(a)})){try{m.emit(k,a)}catch(c){runtime.log("Error occurred while processing "+k+":\n"+c.message+"\n"+c.stack)}}runtime.setTimeout(function(){l.splice(l.indexOf(a),1)},0)}}var n=this,l=[],m=new core.EventNotifier([k]);this.filters=[];this.subscribe=function(a){m.subscribe(k,a)};this.unsubscribe=function(a){m.unsubscribe(k,a)};this.destroy=function(){g(G,k,q);g(o,k,q);g(j,k,q)};M[k]&&p(G,k,q);p(o,k,q);p(j,k,q)}function ab(g,f,m){function n(a){m(a,l,function(c){c.type=g;k.emit(g,c)})}var l={},k=new core.EventNotifier([g]);this.subscribe=function(a){k.subscribe(g,a)};this.unsubscribe=function(a){k.unsubscribe(g,a)};this.destroy=function(){f.forEach(function(b){J.unsubscribe(b,n)})};(function(){f.forEach(function(b){J.subscribe(b,n)})})()}function ac(b){runtime.clearTimeout(b);delete i[b]}function Y(b,e){var f=runtime.setTimeout(function(){b();ac(f)},e);i[f]=!0;return f}function S(b,m,n){var l=b.touches.length,f=b.touches[0],k=m.timer;"touchmove"===b.type||"touchend"===b.type?k&&ac(k):"touchstart"===b.type&&(1!==l?runtime.clearTimeout(k):k=Y(function(){n({clientX:f.clientX,clientY:f.clientY,pageX:f.pageX,pageY:f.pageY,target:b.target||b.srcElement||null,detail:1})},400));m.timer=k}function R(g,f,m){var n=g.touches[0],l=g.target||g.srcElement||null,k=f.target;1!==g.touches.length||"touchend"===g.type?k=null:"touchstart"===g.type&&"webodf-draggable"===l.getAttribute("class")?k=l:"touchmove"===g.type&&k&&(g.preventDefault(),g.stopPropagation(),m({clientX:n.clientX,clientY:n.clientY,pageX:n.pageX,pageY:n.pageY,target:k,detail:1}));f.target=k}function O(g,f,k){var l=g.target||g.srcElement||null,h=f.dragging;"drag"===g.type?h=!0:"touchend"===g.type&&h&&(h=!1,g=g.changedTouches[0],k({clientX:g.clientX,clientY:g.clientY,pageX:g.pageX,pageY:g.pageY,target:l,detail:1}));f.dragging=h}function P(){j.classList.add("webodf-touchEnabled");J.unsubscribe("touchstart",P)}function Z(e){var c=e.scrollX,f=e.scrollY;this.restore=function(){e.scrollX===c&&e.scrollY===f||e.scrollTo(c,f)}}function U(e){var c=e.scrollTop,f=e.scrollLeft;this.restore=function(){if(e.scrollTop!==c||e.scrollLeft!==f){e.scrollTop=c,e.scrollLeft=f}}}function ad(e,c){var f=C[e]||Q[e]||null;!f&&c&&(f=C[e]=new V(e));return f}function aa(a,c){ad(a,!0).subscribe(c)}function T(a,e){var f=ad(a,!1);f&&f.unsubscribe(e)}function W(){return X.getDOMDocument().activeElement===o}function B(){W()&&o.blur();o.setAttribute("disabled","true")}function D(){o.removeAttribute("disabled")}function s(d){for(var c=[];d;){(d.scrollWidth>d.clientWidth||d.scrollHeight>d.clientHeight)&&c.push(new U(d)),d=d.parentNode}c.push(new Z(G));return c}function F(){var b;W()||(b=s(o),D(),o.focus(),b.forEach(function(c){c.restore()}))}var G=runtime.getWindow(),H={beforecut:!0,beforepaste:!0,longpress:!0,drag:!0,dragstop:!0},M={mousedown:!0,mouseup:!0,focus:!0},Q={},C={},o,j=X.getCanvas().getElement(),J=this,i={};this.addFilter=function(a,c){ad(a,!0).filters.push(c)};this.removeFilter=function(a,g){var h=ad(a,!0),f=h.filters.indexOf(g);-1!==f&&h.filters.splice(f,1)};this.subscribe=aa;this.unsubscribe=T;this.hasFocus=W;this.focus=F;this.getEventTrap=function(){return o};this.setEditing=function(d){var c=W();c&&o.blur();d?o.removeAttribute("readOnly"):o.setAttribute("readOnly","true");c&&F()};this.destroy=function(b){T("touchstart",P);Object.keys(i).forEach(function(c){ac(parseInt(c,10))});i.length=0;Object.keys(Q).forEach(function(c){Q[c].destroy()});Q={};T("mousedown",B);T("mouseup",D);T("contextmenu",D);Object.keys(C).forEach(function(c){C[c].destroy()});C={};o.parentNode.removeChild(o);b()};(function(){var d=X.getOdfCanvas().getSizer(),c=d.ownerDocument;runtime.assert(Boolean(G),"EventManager requires a window object to operate correctly");o=c.createElement("textarea");o.id="eventTrap";o.setAttribute("tabindex","-1");o.setAttribute("readOnly","true");o.setAttribute("rows","1");d.appendChild(o);aa("mousedown",B);aa("mouseup",D);aa("contextmenu",D);Q.longpress=new ab("longpress",["touchstart","touchmove","touchend"],S);Q.drag=new ab("drag",["touchstart","touchmove","touchend"],R);Q.dragstop=new ab("dragstop",["drag","touchend"],O);aa("touchstart",P)})()};gui.IOSSafariSupport=function(e){function d(){f.innerHeight!==f.outerHeight&&(a.style.display="none",runtime.requestAnimationFrame(function(){a.style.display="block"}))}var f=runtime.getWindow(),a=e.getEventTrap();this.destroy=function(b){e.unsubscribe("focus",d);a.removeAttribute("autocapitalize");a.style.WebkitTransform="";b()};e.subscribe("focus",d);a.setAttribute("autocapitalize","off");a.style.WebkitTransform="translateX(-10000px)"};gui.HyperlinkController=function(l,j,s,t){function m(){var c=!0;!0===j.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(c=s.isLocalCursorWithinOwnAnnotation());c!==o&&(o=c,d.emit(gui.HyperlinkController.enabledChanged,o))}function i(b){b.getMemberId()===t&&m()}var h=odf.OdfUtils,a=l.getOdtDocument(),d=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),o=!1;this.isEnabled=function(){return o};this.subscribe=function(c,e){d.subscribe(c,e)};this.unsubscribe=function(c,e){d.unsubscribe(c,e)};this.addHyperlink=function(n,b){if(o){var k=a.getCursorSelection(t),g=new ops.OpApplyHyperlink,e=[];if(0===k.length||b){b=b||n,g=new ops.OpInsertText,g.init({memberid:t,position:k.position,text:b}),k.length=b.length,e.push(g)}g=new ops.OpApplyHyperlink;g.init({memberid:t,position:k.position,length:k.length,hyperlink:n});e.push(g);l.enqueue(e)}};this.removeHyperlinks=function(){if(o){var w=a.createPositionIterator(a.getRootNode()),b=a.getCursor(t).getSelectedRange(),u=h.getHyperlinkElements(b),r=b.collapsed&&1===u.length,g=a.getDOMDocument().createRange(),e=[],v,p;0!==u.length&&(u.forEach(function(c){g.selectNodeContents(c);v=a.convertDomToCursorRange({anchorNode:g.startContainer,anchorOffset:g.startOffset,focusNode:g.endContainer,focusOffset:g.endOffset});p=new ops.OpRemoveHyperlink;p.init({memberid:t,position:v.position,length:v.length});e.push(p)}),r||(r=u[0],-1===b.comparePoint(r,0)&&(g.setStart(r,0),g.setEnd(b.startContainer,b.startOffset),v=a.convertDomToCursorRange({anchorNode:g.startContainer,anchorOffset:g.startOffset,focusNode:g.endContainer,focusOffset:g.endOffset}),0<v.length&&(p=new ops.OpApplyHyperlink,p.init({memberid:t,position:v.position,length:v.length,hyperlink:h.getHyperlinkTarget(r)}),e.push(p))),u=u[u.length-1],w.moveToEndOfNode(u),w=w.unfilteredDomOffset(),1===b.comparePoint(u,w)&&(g.setStart(b.endContainer,b.endOffset),g.setEnd(u,w),v=a.convertDomToCursorRange({anchorNode:g.startContainer,anchorOffset:g.startOffset,focusNode:g.endContainer,focusOffset:g.endOffset}),0<v.length&&(p=new ops.OpApplyHyperlink,p.init({memberid:t,position:v.position,length:v.length,hyperlink:h.getHyperlinkTarget(u)}),e.push(p)))),l.enqueue(e),g.detach())}};this.destroy=function(c){a.unsubscribe(ops.Document.signalCursorMoved,i);j.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,m);c()};a.subscribe(ops.Document.signalCursorMoved,i);j.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,m);m()};gui.HyperlinkController.enabledChanged="enabled/changed";gui.ImageController=function(v,u,z,A,w){function o(){var b=!0;!0===u.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(b=z.isLocalCursorWithinOwnAnnotation());b!==s&&(s=b,y.emit(gui.ImageController.enabledChanged,s))}function j(b){b.getMemberId()===A&&o()}var h={"image/gif":".gif","image/jpeg":".jpg","image/png":".png"},i=odf.Namespaces.textns,x=v.getOdtDocument(),t=odf.OdfUtils,B=x.getFormatting(),y=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),s=!1;this.isEnabled=function(){return s};this.subscribe=function(d,c){y.subscribe(d,c)};this.unsubscribe=function(d,c){y.unsubscribe(d,c)};this.insertImage=function(l,q,b,m){if(s){var g=new core.CSSUnits;runtime.assert(0<b&&0<m,"Both width and height of the image should be greater than 0px.");m={width:b,height:m};if(b=t.getParagraphElement(x.getCursor(A).getNode()).getAttributeNS(i,"style-name")){b=B.getContentSize(b,"paragraph");var a=1,e=1;m.width>b.width&&(a=b.width/m.width);m.height>b.height&&(e=b.height/m.height);b=Math.min(a,e);m={width:m.width*b,height:m.height*b}}b=g.convert(m.width,"px","cm")+"cm";g=g.convert(m.height,"px","cm")+"cm";e=x.getOdfCanvas().odfContainer().rootElement.styles;m=l.toLowerCase();var a=h.hasOwnProperty(m)?h[m]:null,f;m=[];runtime.assert(null!==a,"Image type is not supported: "+l);a="Pictures/"+w.generateImageName()+a;f=new ops.OpSetBlob;f.init({memberid:A,filename:a,mimetype:l,content:q});m.push(f);B.getStyleElement("Graphics","graphic",[e])||(l=new ops.OpAddStyle,l.init({memberid:A,styleName:"Graphics",styleFamily:"graphic",isAutomaticStyle:!1,setProperties:{"style:graphic-properties":{"text:anchor-type":"paragraph","svg:x":"0cm","svg:y":"0cm","style:wrap":"dynamic","style:number-wrapped-paragraphs":"no-limit","style:wrap-contour":"false","style:vertical-pos":"top","style:vertical-rel":"paragraph","style:horizontal-pos":"center","style:horizontal-rel":"paragraph"}}}),m.push(l));l=w.generateStyleName();q=new ops.OpAddStyle;q.init({memberid:A,styleName:l,styleFamily:"graphic",isAutomaticStyle:!0,setProperties:{"style:parent-style-name":"Graphics","style:graphic-properties":{"style:vertical-pos":"top","style:vertical-rel":"baseline","style:horizontal-pos":"center","style:horizontal-rel":"paragraph","fo:background-color":"transparent","style:background-transparency":"100%","style:shadow":"none","style:mirror":"none","fo:clip":"rect(0cm, 0cm, 0cm, 0cm)","draw:luminance":"0%","draw:contrast":"0%","draw:red":"0%","draw:green":"0%","draw:blue":"0%","draw:gamma":"100%","draw:color-inversion":"false","draw:image-opacity":"100%","draw:color-mode":"standard"}}});m.push(q);f=new ops.OpInsertImage;f.init({memberid:A,position:x.getCursorPosition(A),filename:a,frameWidth:b,frameHeight:g,frameStyleName:l,frameName:w.generateFrameName()});m.push(f);v.enqueue(m)}};this.destroy=function(b){x.unsubscribe(ops.Document.signalCursorMoved,j);u.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,o);b()};x.subscribe(ops.Document.signalCursorMoved,j);u.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,o);o()};gui.ImageController.enabledChanged="enabled/changed";gui.ImageSelector=function(e){function d(){var f=e.getSizer(),b=h.createElement("div");b.id="imageSelector";b.style.borderWidth="1px";f.appendChild(b);a.forEach(function(g){var k=h.createElement("div");k.className=g;b.appendChild(k)});return b}var j=odf.Namespaces.svgns,a="topLeft topRight bottomRight bottomLeft topMiddle rightMiddle bottomMiddle leftMiddle".split(" "),h=e.getElement().ownerDocument,i=!1;this.select=function(c){var k,m,n=h.getElementById("imageSelector");n||(n=d());i=!0;k=n.parentNode;m=c.getBoundingClientRect();var g=k.getBoundingClientRect(),f=e.getZoomLevel();k=(m.left-g.left)/f-1;m=(m.top-g.top)/f-1;n.style.display="block";n.style.left=k+"px";n.style.top=m+"px";n.style.width=c.getAttributeNS(j,"width");n.style.height=c.getAttributeNS(j,"height")};this.clearSelection=function(){var c;i&&(c=h.getElementById("imageSelector"))&&(c.style.display="none");i=!1};this.isSelectorElement=function(f){var g=h.getElementById("imageSelector");return g?f===g||f.parentNode===g:!1}};(function(){function a(e){function k(c){i=c.which&&String.fromCharCode(c.which)===j;j=void 0;return !1===i}function d(){i=!1}function h(c){j=c.data;i=!1}var j,i=!1;this.destroy=function(b){e.unsubscribe("textInput",d);e.unsubscribe("compositionend",h);e.removeFilter("keypress",k);b()};e.subscribe("textInput",d);e.subscribe("compositionend",h);e.addFilter("keypress",k)}gui.InputMethodEditor=function(M,R){function S(c){T&&(c?T.getNode().setAttributeNS("urn:webodf:names:cursor","composing","true"):(T.getNode().removeAttributeNS("urn:webodf:names:cursor","composing"),N.textContent=""))}function O(){o&&(o=!1,S(!1),s.emit(gui.InputMethodEditor.signalCompositionEnd,{data:g}),g="")}function J(){j||(j=!0,O(),T&&T.getSelectedRange().collapsed?Q.value="":Q.value=C.writeToString(T.getSelectedRange().cloneContents()),Q.setSelectionRange(0,Q.value.length),j=!1)}function H(){R.hasFocus()&&i.trigger()}function E(){B=void 0;i.cancel();S(!0);o||s.emit(gui.InputMethodEditor.signalCompositionStart,{data:""})}function F(b){b=B=b.data;o=!0;g+=b;i.trigger()}function P(b){b.data!==B&&(b=b.data,o=!0,g+=b,i.trigger());B=void 0}function L(){N.textContent=Q.value}var T=null,Q=R.getEventTrap(),K=Q.ownerDocument,N,i,o=!1,g="",s=new core.EventNotifier([gui.InputMethodEditor.signalCompositionStart,gui.InputMethodEditor.signalCompositionEnd]),B,C,D=[],G,j=!1;this.subscribe=s.subscribe;this.unsubscribe=s.unsubscribe;this.registerCursor=function(c){c.getMemberId()===M&&(T=c,T.getNode().appendChild(N),c.subscribe(ops.OdtCursor.signalCursorUpdated,H),R.subscribe("input",L),R.subscribe("compositionupdate",L))};this.removeCursor=function(c){T&&c===M&&(T.getNode().removeChild(N),T.unsubscribe(ops.OdtCursor.signalCursorUpdated,H),R.unsubscribe("input",L),R.unsubscribe("compositionupdate",L),T=null)};this.destroy=function(b){R.unsubscribe("compositionstart",E);R.unsubscribe("compositionend",F);R.unsubscribe("textInput",P);R.unsubscribe("keypress",O);R.unsubscribe("focus",J);core.Async.destroyAll(G,b)};(function(){C=new odf.TextSerializer;C.filter=new odf.OdfNodeFilter;R.subscribe("compositionstart",E);R.subscribe("compositionend",F);R.subscribe("textInput",P);R.subscribe("keypress",O);R.subscribe("focus",J);D.push(new a(R));G=D.map(function(b){return b.destroy});N=K.createElement("span");N.setAttribute("id","composer");i=core.Task.createTimeoutTask(J,1);G.push(i.destroy)})()};gui.InputMethodEditor.signalCompositionStart="input/compositionstart";gui.InputMethodEditor.signalCompositionEnd="input/compositionend"})();gui.MetadataController=function(e,d){function l(c){j.emit(gui.MetadataController.signalMetadataChanged,c)}function a(f){var g=-1===i.indexOf(f);g||runtime.log("Setting "+f+" is restricted.");return g}var h=e.getOdtDocument(),j=new core.EventNotifier([gui.MetadataController.signalMetadataChanged]),i=["dc:creator","dc:date","meta:editing-cycles","meta:editing-duration","meta:document-statistic"];this.setMetadata=function(n,k){var m={},g="",b;n&&Object.keys(n).filter(a).forEach(function(c){m[c]=n[c]});k&&(g=k.filter(a).join(","));if(0<g.length||0<Object.keys(m).length){b=new ops.OpUpdateMetadata,b.init({memberid:d,setProperties:m,removedProperties:0<g.length?{attributes:g}:null}),e.enqueue([b])}};this.getMetadata=function(f){var g;runtime.assert("string"===typeof f,"Property must be a string");g=f.split(":");runtime.assert(2===g.length,"Property must be a namespace-prefixed string");f=odf.Namespaces.lookupNamespaceURI(g[0]);runtime.assert(Boolean(f),"Prefix must be for an ODF namespace.");return h.getOdfCanvas().odfContainer().getMetadata(f,g[1])};this.subscribe=function(f,g){j.subscribe(f,g)};this.unsubscribe=function(f,g){j.unsubscribe(f,g)};this.destroy=function(c){h.unsubscribe(ops.OdtDocument.signalMetadataUpdated,l);c()};h.subscribe(ops.OdtDocument.signalMetadataUpdated,l)};gui.MetadataController.signalMetadataChanged="metadata/changed";gui.PasteController=function(o,m,u,v){function s(){a=!0===m.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?u.isLocalCursorWithinOwnAnnotation():!0}function i(b){b.getMemberId()===v&&s()}var h=o.getOdtDocument(),a=!1,d=odf.Namespaces.textns,t=core.StepDirection.NEXT,j=odf.OdfUtils;this.isEnabled=function(){return a};this.paste=function(b){if(a){var p=h.getCursorPosition(v),r=h.getCursor(v).getNode(),r=j.getParagraphElement(r),g=r.getAttributeNS(d,"style-name")||"",l=p,e=[],q=h.convertDomPointToCursorStep(r,0,t);b.replace(/\r/g,"").split("\n").forEach(function(f){var k=new ops.OpInsertText,n=new ops.OpSplitParagraph;k.init({memberid:v,position:l,text:f,moveCursor:!0});e.push(k);l+=f.length;n.init({memberid:v,position:l,paragraphStyleName:g,sourceParagraphPosition:q,moveCursor:!0});e.push(n);q=l+=1});e.pop();o.enqueue(e)}};this.destroy=function(b){h.unsubscribe(ops.Document.signalCursorMoved,i);m.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,s);b()};h.subscribe(ops.Document.signalCursorMoved,i);m.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,s);s()};gui.ClosestXOffsetScanner=function(e){function d(c){return null!==c&&void 0!==h?Math.abs(c-e)>h:!1}function j(c){null!==c&&!1===d(c)&&(h=Math.abs(c-e))}var a=this,h,i=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT;this.token=void 0;this.process=function(m,c,k){var n,b;m.visualDirection===i?(n=c&&c.right,b=k&&k.left):(n=c&&c.left,b=k&&k.right);if(d(n)||d(b)){return !0}if(c||k){j(n),j(b),a.token=m.token}return !1}};gui.LineBoundaryScanner=function(){var b=this,a=null;this.token=void 0;this.process=function(j,d,g){var i;if(i=g){if(a){var h=a;i=Math.min(h.bottom-h.top,g.bottom-g.top);var e=Math.max(h.top,g.top),h=Math.min(h.bottom,g.bottom)-e;i=0.4>=(0<i?h/i:0)}else{i=!1}}!d||g&&!i||(b.token=j.token);if(i){return !0}a=(j=a)&&d?{left:Math.min(j.left,d.left),right:Math.max(j.right,d.right),top:Math.min(j.top,d.top),bottom:Math.min(j.bottom,d.bottom)}:j||d;return !1}};gui.ParagraphBoundaryScanner=function(){var e=this,d=!1,f,a=odf.OdfUtils;this.token=void 0;this.process=function(b){var c=a.getParagraphElement(b.container());d||(f=c,d=!0);if(f!==c){return !0}e.token=b.token;return !1}};odf.WordBoundaryFilter=function(v,u){function z(k,g,n){for(var p=null,m=v.getRootNode(),l;k!==m&&null!==k&&null===p;){l=0>g?k.previousSibling:k.nextSibling,n(l)===NodeFilter.FILTER_ACCEPT&&(p=l),k=k.parentNode}return p}function A(e,c){var f;return null===e?s.NO_NEIGHBOUR:j.isCharacterElement(e)?s.SPACE_CHAR:e.nodeType===w||j.isTextSpan(e)||j.isHyperlink(e)?(f=e.textContent.charAt(c()),i.test(f)?s.SPACE_CHAR:h.test(f)?s.PUNCTUATION_CHAR:s.WORD_CHAR):s.OTHER}var w=Node.TEXT_NODE,o=Node.ELEMENT_NODE,j=odf.OdfUtils,h=/[!-#%-*,-\/:-;?-@\[-\]_{}\u00a1\u00ab\u00b7\u00bb\u00bf;\u00b7\u055a-\u055f\u0589-\u058a\u05be\u05c0\u05c3\u05c6\u05f3-\u05f4\u0609-\u060a\u060c-\u060d\u061b\u061e-\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964-\u0965\u0970\u0df4\u0e4f\u0e5a-\u0e5b\u0f04-\u0f12\u0f3a-\u0f3d\u0f85\u0fd0-\u0fd4\u104a-\u104f\u10fb\u1361-\u1368\u166d-\u166e\u169b-\u169c\u16eb-\u16ed\u1735-\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u180a\u1944-\u1945\u19de-\u19df\u1a1e-\u1a1f\u1b5a-\u1b60\u1c3b-\u1c3f\u1c7e-\u1c7f\u2000-\u206e\u207d-\u207e\u208d-\u208e\u3008-\u3009\u2768-\u2775\u27c5-\u27c6\u27e6-\u27ef\u2983-\u2998\u29d8-\u29db\u29fc-\u29fd\u2cf9-\u2cfc\u2cfe-\u2cff\u2e00-\u2e7e\u3000-\u303f\u30a0\u30fb\ua60d-\ua60f\ua673\ua67e\ua874-\ua877\ua8ce-\ua8cf\ua92e-\ua92f\ua95f\uaa5c-\uaa5f\ufd3e-\ufd3f\ufe10-\ufe19\ufe30-\ufe52\ufe54-\ufe61\ufe63\ufe68\ufe6a-\ufe6b\uff01-\uff03\uff05-\uff0a\uff0c-\uff0f\uff1a-\uff1b\uff1f-\uff20\uff3b-\uff3d\uff3f\uff5b\uff5d\uff5f-\uff65]|\ud800[\udd00-\udd01\udf9f\udfd0]|\ud802[\udd1f\udd3f\ude50-\ude58]|\ud809[\udc00-\udc7e]/,i=/\s/,x=core.PositionFilter.FilterResult.FILTER_ACCEPT,t=core.PositionFilter.FilterResult.FILTER_REJECT,B=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,y=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,s={NO_NEIGHBOUR:0,SPACE_CHAR:1,PUNCTUATION_CHAR:2,WORD_CHAR:3,OTHER:4};this.acceptPosition=function(e){var c=e.container(),k=e.leftNode(),d=e.rightNode(),b=e.unfilteredDomOffset,a=function(){return e.unfilteredDomOffset()-1};c.nodeType===o&&(null===d&&(d=z(c,1,e.getNodeFilter())),null===k&&(k=z(c,-1,e.getNodeFilter())));c!==d&&(b=function(){return 0});c!==k&&null!==k&&(a=function(){return k.textContent.length-1});c=A(k,a);d=A(d,b);return c===s.WORD_CHAR&&d===s.WORD_CHAR||c===s.PUNCTUATION_CHAR&&d===s.PUNCTUATION_CHAR||u===B&&c!==s.NO_NEIGHBOUR&&d===s.SPACE_CHAR||u===y&&c===s.SPACE_CHAR&&d!==s.NO_NEIGHBOUR?t:x}};odf.WordBoundaryFilter.IncludeWhitespace={None:0,TRAILING:1,LEADING:2};gui.SelectionController=function(Z,X){function ad(d){var c=d.spec();if(d.isEdit||c.memberid===X){D=void 0,s.cancel()}}function ae(){var b=F.getCursor(X).getNode();return F.createStepIterator(b,0,[H,P],F.getRootElement(b))}function aa(g,f,k){k=new odf.WordBoundaryFilter(F,k);var l=F.getRootElement(g)||F.getRootNode(),h=F.createRootFilter(l);return F.createStepIterator(g,f,[H,h,k],l)}function U(d,c){return c?{anchorNode:d.startContainer,anchorOffset:d.startOffset,focusNode:d.endContainer,focusOffset:d.endOffset}:{anchorNode:d.endContainer,anchorOffset:d.endOffset,focusNode:d.startContainer,focusOffset:d.startOffset}}function T(f,e,g){var h=new ops.OpMoveCursor;h.init({memberid:X,position:f,length:e||0,selectionType:g});return h}function Q(f,e,g){var h;h=F.getCursor(X);h=U(h.getSelectedRange(),h.hasForwardSelection());h.focusNode=f;h.focusOffset=e;g||(h.anchorNode=h.focusNode,h.anchorOffset=h.focusOffset);f=F.convertDomToCursorRange(h);Z.enqueue([T(f.position,f.length)])}function R(d){var c;c=aa(d.startContainer,d.startOffset,o);c.roundToPreviousStep()&&d.setStart(c.container(),c.offset());c=aa(d.endContainer,d.endOffset,M);c.roundToNextStep()&&d.setEnd(c.container(),c.offset())}function ab(e){var c=G.getParagraphElements(e),f=c[0],c=c[c.length-1];f&&e.setStart(f,0);c&&(G.isParagraph(e.endContainer)&&0===e.endOffset?e.setEndBefore(c):e.setEnd(c,c.childNodes.length))}function W(h,g,m,n){var l,k;n?(l=m.startContainer,k=m.startOffset):(l=m.endContainer,k=m.endOffset);B.containsNode(h,l)||(k=0>B.comparePoints(h,0,l,k)?0:h.childNodes.length,l=h);h=F.createStepIterator(l,k,g,G.getParagraphElement(l)||h);h.roundToClosestStep()||runtime.assert(!1,"No step found in requested range");n?m.setStart(h.container(),h.offset()):m.setEnd(h.container(),h.offset())}function af(b,e){var f=ae();f.advanceStep(b)&&Q(f.container(),f.offset(),e)}function ac(b,k){var l,h=D,g=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];void 0===h&&S&&(h=S());isNaN(h)||(l=ae(),J.moveToFilteredStep(l,b,g)&&l.advanceStep(b)&&(g=[new gui.ClosestXOffsetScanner(h),new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner],J.moveToFilteredStep(l,b,g)&&(Q(l.container(),l.offset(),k),D=h,s.restart())))}function V(b,g){var h=ae(),f=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];J.moveToFilteredStep(h,b,f)&&Q(h.container(),h.offset(),g)}function Y(e,c){var f=F.getCursor(X),f=U(f.getSelectedRange(),f.hasForwardSelection()),f=aa(f.focusNode,f.focusOffset,o);f.advanceStep(e)&&Q(f.container(),f.offset(),c)}function C(g,f,k){var l=!1,h=F.getCursor(X),h=U(h.getSelectedRange(),h.hasForwardSelection()),l=F.getRootElement(h.focusNode);runtime.assert(Boolean(l),"SelectionController: Cursor outside root");h=F.createStepIterator(h.focusNode,h.focusOffset,[H,P],l);h.roundToClosestStep();h.advanceStep(g)&&(k=k(h.container()))&&(g===j?(h.setPosition(k,0),l=h.roundToNextStep()):(h.setPosition(k,k.childNodes.length),l=h.roundToPreviousStep()),l&&Q(h.container(),h.offset(),f))}var F=Z.getOdtDocument(),B=core.DomUtils,G=odf.OdfUtils,H=F.getPositionFilter(),J=new gui.GuiStepUtils,P=F.createRootFilter(X),S=null,D,s,o=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,M=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,j=core.StepDirection.PREVIOUS,i=core.StepDirection.NEXT;this.selectionToRange=function(e){var c=0<=B.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset),f=e.focusNode.ownerDocument.createRange();c?(f.setStart(e.anchorNode,e.anchorOffset),f.setEnd(e.focusNode,e.focusOffset)):(f.setStart(e.focusNode,e.focusOffset),f.setEnd(e.anchorNode,e.anchorOffset));return{range:f,hasForwardSelection:c}};this.rangeToSelection=U;this.selectImage=function(f){var e=F.getRootElement(f),g=F.createRootFilter(e),e=F.createStepIterator(f,0,[g,F.getPositionFilter()],e),h;e.roundToPreviousStep()||runtime.assert(!1,"No walkable position before frame");g=e.container();h=e.offset();e.setPosition(f,f.childNodes.length);e.roundToNextStep()||runtime.assert(!1,"No walkable position after frame");f=F.convertDomToCursorRange({anchorNode:g,anchorOffset:h,focusNode:e.container(),focusOffset:e.offset()});f=T(f.position,f.length,ops.OdtCursor.RegionSelection);Z.enqueue([f])};this.expandToWordBoundaries=R;this.expandToParagraphBoundaries=ab;this.selectRange=function(g,e,m){var n=F.getOdfCanvas().getElement(),l,k=[H];l=B.containsNode(n,g.startContainer);n=B.containsNode(n,g.endContainer);if(l||n){if(l&&n&&(2===m?R(g):3<=m&&ab(g)),(m=e?F.getRootElement(g.startContainer):F.getRootElement(g.endContainer))||(m=F.getRootNode()),k.push(F.createRootFilter(m)),W(m,k,g,!0),W(m,k,g,!1),g=U(g,e),e=F.convertDomToCursorRange(g),g=F.getCursorSelection(X),e.position!==g.position||e.length!==g.length){g=T(e.position,e.length,ops.OdtCursor.RangeSelection),Z.enqueue([g])}}};this.moveCursorToLeft=function(){af(j,!1);return !0};this.moveCursorToRight=function(){af(i,!1);return !0};this.extendSelectionToLeft=function(){af(j,!0);return !0};this.extendSelectionToRight=function(){af(i,!0);return !0};this.setCaretXPositionLocator=function(b){S=b};this.moveCursorUp=function(){ac(j,!1);return !0};this.moveCursorDown=function(){ac(i,!1);return !0};this.extendSelectionUp=function(){ac(j,!0);return !0};this.extendSelectionDown=function(){ac(i,!0);return !0};this.moveCursorBeforeWord=function(){Y(j,!1);return !0};this.moveCursorPastWord=function(){Y(i,!1);return !0};this.extendSelectionBeforeWord=function(){Y(j,!0);return !0};this.extendSelectionPastWord=function(){Y(i,!0);return !0};this.moveCursorToLineStart=function(){V(j,!1);return !0};this.moveCursorToLineEnd=function(){V(i,!1);return !0};this.extendSelectionToLineStart=function(){V(j,!0);return !0};this.extendSelectionToLineEnd=function(){V(i,!0);return !0};this.extendSelectionToParagraphStart=function(){C(j,!0,G.getParagraphElement);return !0};this.extendSelectionToParagraphEnd=function(){C(i,!0,G.getParagraphElement);return !0};this.moveCursorToParagraphStart=function(){C(j,!1,G.getParagraphElement);return !0};this.moveCursorToParagraphEnd=function(){C(i,!1,G.getParagraphElement);return !0};this.moveCursorToDocumentStart=function(){C(j,!1,F.getRootElement);return !0};this.moveCursorToDocumentEnd=function(){C(i,!1,F.getRootElement);return !0};this.extendSelectionToDocumentStart=function(){C(j,!0,F.getRootElement);return !0};this.extendSelectionToDocumentEnd=function(){C(i,!0,F.getRootElement);return !0};this.extendSelectionToEntireDocument=function(){var f=F.getCursor(X),f=F.getRootElement(f.getNode()),e,g,h;runtime.assert(Boolean(f),"SelectionController: Cursor outside root");h=F.createStepIterator(f,0,[H,P],f);h.roundToClosestStep();e=h.container();g=h.offset();h.setPosition(f,f.childNodes.length);h.roundToClosestStep();f=F.convertDomToCursorRange({anchorNode:e,anchorOffset:g,focusNode:h.container(),focusOffset:h.offset()});Z.enqueue([T(f.position,f.length)]);return !0};this.destroy=function(b){F.unsubscribe(ops.OdtDocument.signalOperationStart,ad);core.Async.destroyAll([s.destroy],b)};(function(){s=core.Task.createTimeoutTask(function(){D=void 0},2000);F.subscribe(ops.OdtDocument.signalOperationStart,ad)})()};gui.TextController=function(D,B,H,I,E,v){function u(){j=!0===B.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?H.isLocalCursorWithinOwnAnnotation():!0}function s(b){b.getMemberId()===I&&u()}function t(f,d,h){var g=[G.getPositionFilter()];h&&g.push(G.createRootFilter(f.startContainer));h=G.createStepIterator(f.startContainer,f.startOffset,g,d);h.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range start");d=G.convertDomPointToCursorStep(h.container(),h.offset());f.collapsed?f=d:(h.setPosition(f.endContainer,f.endOffset),h.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range end"),f=G.convertDomPointToCursorStep(h.container(),h.offset()));return{position:d,length:f-d}}function F(h){var p,q,n,m=w.getParagraphElements(h),k=h.cloneRange(),b=[];p=m[0];1<m.length&&(w.hasNoODFContent(p)&&(p=m[m.length-1]),q=p.getAttributeNS(odf.Namespaces.textns,"style-name")||"");m.forEach(function(g,e){var a,c;k.setStart(g,0);k.collapse(!0);a=t(k,g,!1).position;0<e&&(c=new ops.OpMergeParagraph,c.init({memberid:I,paragraphStyleName:q,destinationStartPosition:n,sourceStartPosition:a,moveCursor:1===e}),b.unshift(c));n=a;k.selectNodeContents(g);if(a=C.rangeIntersection(k,h)){a=t(a,g,!0),0<a.length&&(c=new ops.OpRemoveText,c.init({memberid:I,position:a.position,length:a.length}),b.unshift(c))}});return b}function A(b){0>b.length&&(b.position+=b.length,b.length=-b.length);return b}function J(d){if(!j){return !1}var n,l=G.getCursor(I).getSelectedRange().cloneRange(),g=A(G.getCursorSelection(I)),b;if(0===g.length){g=void 0;n=G.getCursor(I).getNode();b=G.getRootElement(n);var e=[G.getPositionFilter(),G.createRootFilter(b)];b=G.createStepIterator(n,0,e,b);b.roundToClosestStep()&&(d?b.nextStep():b.previousStep())&&(g=A(G.convertDomToCursorRange({anchorNode:n,anchorOffset:0,focusNode:b.container(),focusOffset:b.offset()})),d?(l.setStart(n,0),l.setEnd(b.container(),b.offset())):(l.setStart(b.container(),b.offset()),l.setEnd(n,0)))}g&&D.enqueue(F(l));return void 0!==g}var G=D.getOdtDocument(),w=odf.OdfUtils,C=core.DomUtils,j=!1,o=odf.Namespaces.textns,i=core.StepDirection.NEXT;this.isEnabled=function(){return j};this.enqueueParagraphSplittingOps=function(){if(!j){return !1}var b=G.getCursor(I),l=b.getSelectedRange(),g=A(G.getCursorSelection(I)),e=[],b=w.getParagraphElement(b.getNode()),d=b.getAttributeNS(o,"style-name")||"";0<g.length&&(e=e.concat(F(l)));l=new ops.OpSplitParagraph;l.init({memberid:I,position:g.position,paragraphStyleName:d,sourceParagraphPosition:G.convertDomPointToCursorStep(b,0,i),moveCursor:!0});e.push(l);v&&(g=v(g.position+1),e=e.concat(g));D.enqueue(e);return !0};this.removeTextByBackspaceKey=function(){return J(!1)};this.removeTextByDeleteKey=function(){return J(!0)};this.removeCurrentSelection=function(){if(!j){return !1}var b=G.getCursor(I).getSelectedRange();D.enqueue(F(b));return !0};this.insertText=function(d){if(j){var g=G.getCursor(I).getSelectedRange(),f=A(G.getCursorSelection(I)),b=[],e=!1;0<f.length&&(b=b.concat(F(g)),e=!0);g=new ops.OpInsertText;g.init({memberid:I,position:f.position,text:d,moveCursor:!0});b.push(g);E&&(d=E(f.position,d.length,e))&&b.push(d);D.enqueue(b)}};this.destroy=function(b){G.unsubscribe(ops.Document.signalCursorMoved,s);B.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,u);b()};G.subscribe(ops.Document.signalCursorMoved,s);B.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,u);u()};gui.UndoManager=function(){};gui.UndoManager.prototype.subscribe=function(b,a){};gui.UndoManager.prototype.unsubscribe=function(b,a){};gui.UndoManager.prototype.setDocument=function(a){};gui.UndoManager.prototype.setInitialState=function(){};gui.UndoManager.prototype.initialize=function(){};gui.UndoManager.prototype.purgeInitialState=function(){};gui.UndoManager.prototype.setPlaybackFunction=function(a){};gui.UndoManager.prototype.hasUndoStates=function(){};gui.UndoManager.prototype.hasRedoStates=function(){};gui.UndoManager.prototype.moveForward=function(a){};gui.UndoManager.prototype.moveBackward=function(a){};gui.UndoManager.prototype.onOperationExecuted=function(a){};gui.UndoManager.prototype.isDocumentModified=function(){};gui.UndoManager.prototype.setDocumentModified=function(a){};gui.UndoManager.signalUndoStackChanged="undoStackChanged";gui.UndoManager.signalUndoStateCreated="undoStateCreated";gui.UndoManager.signalUndoStateModified="undoStateModified";gui.UndoManager.signalDocumentModifiedChanged="documentModifiedChanged";gui.SessionControllerOptions=function(){this.annotationsEnabled=this.directParagraphStylingEnabled=this.directTextStylingEnabled=!1};(function(){var a=core.PositionFilter.FilterResult.FILTER_ACCEPT;gui.SessionController=function(a5,bb,bc,a7){function a2(f,e){var h=at.getDOMDocument(),k=null;h.caretRangeFromPoint?(h=h.caretRangeFromPoint(f,e),k={container:h.startContainer,offset:h.startOffset}):h.caretPositionFromPoint&&(h=h.caretPositionFromPoint(f,e))&&h.offsetNode&&(k={container:h.offsetNode,offset:h.offset});return k}function a1(d){var c=at.getCursor(bb).getSelectedRange();c.collapsed?d.preventDefault():i.setDataFromRange(d,c)?aE.removeCurrentSelection():runtime.log("Cut operation failed")}function aZ(){return !1!==at.getCursor(bb).getSelectedRange().collapsed}function a0(d){var c=at.getCursor(bb).getSelectedRange();c.collapsed?d.preventDefault():i.setDataFromRange(d,c)||runtime.log("Copy operation failed")}function a8(d){var c;ad.clipboardData&&ad.clipboardData.getData?c=ad.clipboardData.getData("Text"):d.clipboardData&&d.clipboardData.getData&&(c=d.clipboardData.getData("text/plain"));c&&(aE.removeCurrentSelection(),g.paste(c));d.preventDefault?d.preventDefault():d.returnValue=!1}function a4(){return !1}function bd(b){if(al){al.onOperationExecuted(b)}}function a9(b){at.emit(ops.OdtDocument.signalUndoStackChanged,b)}function a3(){var b;return al?(b=ax.hasFocus(),al.moveBackward(1),b&&ax.focus(),!0):!1}function a6(){var b;return al?(b=ax.hasFocus(),al.moveForward(1),b&&ax.focus(),!0):!1}function aP(b){var f=at.getCursor(bb).getSelectedRange(),c=(b.target||b.srcElement||null).getAttribute("end");f&&c&&(b=a2(b.clientX,b.clientY))&&(aN.setUnfilteredPosition(b.container,b.offset),s.acceptPosition(aN)===a&&(f=f.cloneRange(),"left"===c?f.setStart(aN.container(),aN.unfilteredDomOffset()):f.setEnd(aN.container(),aN.unfilteredDomOffset()),bc.setSelectedRange(f,"right"===c),at.emit(ops.Document.signalCursorMoved,bc)))}function aR(){ah.selectRange(bc.getSelectedRange(),bc.hasForwardSelection(),1)}function aO(){var b=ad.getSelection(),c=0<b.rangeCount&&ah.selectionToRange(b);ag&&c&&(aB=!0,aQ.clearSelection(),aN.setUnfilteredPosition(b.focusNode,b.focusOffset),s.acceptPosition(aN)===a&&(2===aT?ah.expandToWordBoundaries(c.range):3<=aT&&ah.expandToParagraphBoundaries(c.range),bc.setSelectedRange(c.range,c.hasForwardSelection),at.emit(ops.Document.signalCursorMoved,bc)))}function aS(e){var c=e.target||e.srcElement||null,f=at.getCursor(bb);if(ag=null!==c&&aD.containsNode(at.getOdfCanvas().getElement(),c)){aB=!1,c=at.getRootElement(c)||at.getRootNode(),s=at.createRootFilter(c),aT=0===e.button?e.detail:0,f&&e.shiftKey?ad.getSelection().collapse(f.getAnchorNode(),0):(e=ad.getSelection(),c=f.getSelectedRange(),e.extend?f.hasForwardSelection()?(e.collapse(c.startContainer,c.startOffset),e.extend(c.endContainer,c.endOffset)):(e.collapse(c.endContainer,c.endOffset),e.extend(c.startContainer,c.startOffset)):(e.removeAllRanges(),e.addRange(c.cloneRange()))),1<aT&&aO()}}function aU(e){var c=at.getRootElement(e),f=at.createRootFilter(c),c=at.createStepIterator(e,0,[f,at.getPositionFilter()],c);c.setPosition(e,e.childNodes.length);return c.roundToNextStep()?{container:c.container(),offset:c.offset()}:null}function aV(h){var f;f=(f=ad.getSelection())?{anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}:null;var l=ad.getSelection().isCollapsed,m,k;f.anchorNode||f.focusNode||!(m=a2(h.clientX,h.clientY))||(f.anchorNode=m.container,f.anchorOffset=m.offset,f.focusNode=f.anchorNode,f.focusOffset=f.anchorOffset);if(aj.isImage(f.focusNode)&&0===f.focusOffset&&aj.isCharacterFrame(f.focusNode.parentNode)){if(k=f.focusNode.parentNode,m=k.getBoundingClientRect(),h.clientX>m.left&&(m=aU(k))){f.focusNode=m.container,f.focusOffset=m.offset,l&&(f.anchorNode=f.focusNode,f.anchorOffset=f.focusOffset)}}else{aj.isImage(f.focusNode.firstChild)&&1===f.focusOffset&&aj.isCharacterFrame(f.focusNode)&&(m=aU(f.focusNode))&&(f.anchorNode=f.focusNode=m.container,f.anchorOffset=f.focusOffset=m.offset)}f.anchorNode&&f.focusNode&&(f=ah.selectionToRange(f),ah.selectRange(f.range,f.hasForwardSelection,0===h.button?h.detail:0));ax.focus()}function aX(d){var c;if(c=a2(d.clientX,d.clientY)){d=c.container,c=c.offset,d={anchorNode:d,anchorOffset:c,focusNode:d,focusOffset:c},d=ah.selectionToRange(d),ah.selectRange(d.range,d.hasForwardSelection,2),ax.focus()}}function aC(b){var l=b.target||b.srcElement||null,m,k,h;aH.processRequests();ag&&(aj.isImage(l)&&aj.isCharacterFrame(l.parentNode)&&ad.getSelection().isCollapsed?(ah.selectImage(l.parentNode),ax.focus()):aQ.isSelectorElement(l)?ax.focus():aB?(l=bc.getSelectedRange(),k=l.collapsed,aj.isImage(l.endContainer)&&0===l.endOffset&&aj.isCharacterFrame(l.endContainer.parentNode)&&(h=l.endContainer.parentNode,h=aU(h))&&(l.setEnd(h.container,h.offset),k&&l.collapse(!1)),ah.selectRange(l,bc.hasForwardSelection(),0===b.button?b.detail:0),ax.focus()):aY?aV(b):(m=aD.cloneEvent(b),ap=runtime.setTimeout(function(){aV(m)},0)),aT=0,aB=ag=!1)}function au(d){var c=at.getCursor(bb).getSelectedRange();c.collapsed||aM.exportRangeToDataTransfer(d.dataTransfer,c)}function ar(){ag&&ax.focus();aT=0;aB=ag=!1}function aq(b){aC(b)}function ay(e){var c=e.target||e.srcElement||null,f=null;"annotationRemoveButton"===c.className?(runtime.assert(aG,"Remove buttons are displayed on annotations while annotation editing is disabled in the controller."),f=c.parentNode.getElementsByTagNameNS(odf.Namespaces.officens,"annotation").item(0),aL.removeAnnotation(f),ax.focus()):"webodf-draggable"!==c.getAttribute("class")&&aC(e)}function ao(b){(b=b.data)&&(-1===b.indexOf("\n")?aE.insertText(b):g.paste(b))}function an(b){return function(){b();return !0}}function az(b){return function(c){return at.getCursor(bb).getSelectionType()===ops.OdtCursor.RangeSelection?b(c):!0}}function ae(c){ax.unsubscribe("keydown",aA.handleEvent);ax.unsubscribe("keypress",j.handleEvent);ax.unsubscribe("keyup",be.handleEvent);ax.unsubscribe("copy",a0);ax.unsubscribe("mousedown",aS);ax.unsubscribe("mousemove",aH.trigger);ax.unsubscribe("mouseup",ay);ax.unsubscribe("contextmenu",aq);ax.unsubscribe("dragstart",au);ax.unsubscribe("dragend",ar);ax.unsubscribe("click",aI.handleClick);ax.unsubscribe("longpress",aX);ax.unsubscribe("drag",aP);ax.unsubscribe("dragstop",aR);at.unsubscribe(ops.OdtDocument.signalOperationEnd,ac.trigger);at.unsubscribe(ops.Document.signalCursorAdded,o.registerCursor);at.unsubscribe(ops.Document.signalCursorRemoved,o.removeCursor);at.unsubscribe(ops.OdtDocument.signalOperationEnd,bd);c()}var ad=runtime.getWindow(),at=a5.getOdtDocument(),ak=new gui.SessionConstraints,am=new gui.SessionContext(a5,bb),aD=core.DomUtils,aj=odf.OdfUtils,aM=new gui.MimeDataExporter,i=new gui.Clipboard(aM),aA=new gui.KeyboardHandler,j=new gui.KeyboardHandler,be=new gui.KeyboardHandler,ag=!1,aF=new odf.ObjectNameGenerator(at.getOdfCanvas().odfContainer(),bb),aB=!1,s=null,ap,al=null,ax=new gui.EventManager(at),aG=a7.annotationsEnabled,aL=new gui.AnnotationController(a5,ak,bb),ab=new gui.DirectFormattingController(a5,ak,am,bb,aF,a7.directTextStylingEnabled,a7.directParagraphStylingEnabled),aE=new gui.TextController(a5,ak,am,bb,ab.createCursorStyleOp,ab.createParagraphStyleOps),af=new gui.ImageController(a5,ak,am,bb,aF),aQ=new gui.ImageSelector(at.getOdfCanvas()),aN=at.createPositionIterator(at.getRootNode()),aH,ac,g=new gui.PasteController(a5,ak,am,bb),o=new gui.InputMethodEditor(bb,ax),aT=0,aI=new gui.HyperlinkClickHandler(at.getOdfCanvas().getElement,aA,be),ai=new gui.HyperlinkController(a5,ak,am,bb),ah=new gui.SelectionController(a5,bb),aK=new gui.MetadataController(a5,bb),aw=gui.KeyboardHandler.Modifier,av=gui.KeyboardHandler.KeyCode,aW=-1!==ad.navigator.appVersion.toLowerCase().indexOf("mac"),aY=-1!==["iPad","iPod","iPhone"].indexOf(ad.navigator.platform),aJ;runtime.assert(null!==ad,"Expected to be run in an environment which has a global window, like a browser.");this.undo=a3;this.redo=a6;this.insertLocalCursor=function(){runtime.assert(void 0===a5.getOdtDocument().getCursor(bb),"Inserting local cursor a second time.");var b=new ops.OpAddCursor;b.init({memberid:bb});a5.enqueue([b]);ax.focus()};this.removeLocalCursor=function(){runtime.assert(void 0!==a5.getOdtDocument().getCursor(bb),"Removing local cursor without inserting before.");var b=new ops.OpRemoveCursor;b.init({memberid:bb});a5.enqueue([b])};this.startEditing=function(){o.subscribe(gui.InputMethodEditor.signalCompositionStart,aE.removeCurrentSelection);o.subscribe(gui.InputMethodEditor.signalCompositionEnd,ao);ax.subscribe("beforecut",aZ);ax.subscribe("cut",a1);ax.subscribe("beforepaste",a4);ax.subscribe("paste",a8);al&&al.initialize();ax.setEditing(!0);aI.setModifier(aW?aw.Meta:aw.Ctrl);aA.bind(av.Backspace,aw.None,an(aE.removeTextByBackspaceKey),!0);aA.bind(av.Delete,aw.None,aE.removeTextByDeleteKey);aA.bind(av.Tab,aw.None,az(function(){aE.insertText("\t");return !0}));aW?(aA.bind(av.Clear,aw.None,aE.removeCurrentSelection),aA.bind(av.B,aw.Meta,az(ab.toggleBold)),aA.bind(av.I,aw.Meta,az(ab.toggleItalic)),aA.bind(av.U,aw.Meta,az(ab.toggleUnderline)),aA.bind(av.L,aw.MetaShift,az(ab.alignParagraphLeft)),aA.bind(av.E,aw.MetaShift,az(ab.alignParagraphCenter)),aA.bind(av.R,aw.MetaShift,az(ab.alignParagraphRight)),aA.bind(av.J,aw.MetaShift,az(ab.alignParagraphJustified)),aG&&aA.bind(av.C,aw.MetaShift,aL.addAnnotation),aA.bind(av.Z,aw.Meta,a3),aA.bind(av.Z,aw.MetaShift,a6)):(aA.bind(av.B,aw.Ctrl,az(ab.toggleBold)),aA.bind(av.I,aw.Ctrl,az(ab.toggleItalic)),aA.bind(av.U,aw.Ctrl,az(ab.toggleUnderline)),aA.bind(av.L,aw.CtrlShift,az(ab.alignParagraphLeft)),aA.bind(av.E,aw.CtrlShift,az(ab.alignParagraphCenter)),aA.bind(av.R,aw.CtrlShift,az(ab.alignParagraphRight)),aA.bind(av.J,aw.CtrlShift,az(ab.alignParagraphJustified)),aG&&aA.bind(av.C,aw.CtrlAlt,aL.addAnnotation),aA.bind(av.Z,aw.Ctrl,a3),aA.bind(av.Z,aw.CtrlShift,a6));j.setDefault(az(function(d){var c;c=null===d.which||void 0===d.which?String.fromCharCode(d.keyCode):0!==d.which&&0!==d.charCode?String.fromCharCode(d.which):null;return !c||d.altKey||d.ctrlKey||d.metaKey?!1:(aE.insertText(c),!0)}));j.bind(av.Enter,aw.None,az(aE.enqueueParagraphSplittingOps))};this.endEditing=function(){o.unsubscribe(gui.InputMethodEditor.signalCompositionStart,aE.removeCurrentSelection);o.unsubscribe(gui.InputMethodEditor.signalCompositionEnd,ao);ax.unsubscribe("cut",a1);ax.unsubscribe("beforecut",aZ);ax.unsubscribe("paste",a8);ax.unsubscribe("beforepaste",a4);ax.setEditing(!1);aI.setModifier(aw.None);aA.bind(av.Backspace,aw.None,function(){return !0},!0);aA.unbind(av.Delete,aw.None);aA.unbind(av.Tab,aw.None);aW?(aA.unbind(av.Clear,aw.None),aA.unbind(av.B,aw.Meta),aA.unbind(av.I,aw.Meta),aA.unbind(av.U,aw.Meta),aA.unbind(av.L,aw.MetaShift),aA.unbind(av.E,aw.MetaShift),aA.unbind(av.R,aw.MetaShift),aA.unbind(av.J,aw.MetaShift),aG&&aA.unbind(av.C,aw.MetaShift),aA.unbind(av.Z,aw.Meta),aA.unbind(av.Z,aw.MetaShift)):(aA.unbind(av.B,aw.Ctrl),aA.unbind(av.I,aw.Ctrl),aA.unbind(av.U,aw.Ctrl),aA.unbind(av.L,aw.CtrlShift),aA.unbind(av.E,aw.CtrlShift),aA.unbind(av.R,aw.CtrlShift),aA.unbind(av.J,aw.CtrlShift),aG&&aA.unbind(av.C,aw.CtrlAlt),aA.unbind(av.Z,aw.Ctrl),aA.unbind(av.Z,aw.CtrlShift));j.setDefault(null);j.unbind(av.Enter,aw.None)};this.getInputMemberId=function(){return bb};this.getSession=function(){return a5};this.getSessionConstraints=function(){return ak};this.setUndoManager=function(b){al&&al.unsubscribe(gui.UndoManager.signalUndoStackChanged,a9);if(al=b){al.setDocument(at),al.setPlaybackFunction(a5.enqueue),al.subscribe(gui.UndoManager.signalUndoStackChanged,a9)}};this.getUndoManager=function(){return al};this.getMetadataController=function(){return aK};this.getAnnotationController=function(){return aL};this.getDirectFormattingController=function(){return ab};this.getHyperlinkClickHandler=function(){return aI};this.getHyperlinkController=function(){return ai};this.getImageController=function(){return af};this.getSelectionController=function(){return ah};this.getTextController=function(){return aE};this.getEventManager=function(){return ax};this.getKeyboardHandlers=function(){return{keydown:aA,keypress:j}};this.destroy=function(d){var c=[aH.destroy,ac.destroy,ab.destroy,o.destroy,ax.destroy,aI.destroy,ai.destroy,aK.destroy,ah.destroy,aE.destroy,ae];aJ&&c.unshift(aJ.destroy);runtime.clearTimeout(ap);core.Async.destroyAll(c,d)};aH=core.Task.createRedrawTask(aO);ac=core.Task.createRedrawTask(function(){var b=at.getCursor(bb);if(b&&b.getSelectionType()===ops.OdtCursor.RegionSelection&&(b=aj.getImageElements(b.getSelectedRange())[0])){aQ.select(b.parentNode);return}aQ.clearSelection()});aA.bind(av.Left,aw.None,az(ah.moveCursorToLeft));aA.bind(av.Right,aw.None,az(ah.moveCursorToRight));aA.bind(av.Up,aw.None,az(ah.moveCursorUp));aA.bind(av.Down,aw.None,az(ah.moveCursorDown));aA.bind(av.Left,aw.Shift,az(ah.extendSelectionToLeft));aA.bind(av.Right,aw.Shift,az(ah.extendSelectionToRight));aA.bind(av.Up,aw.Shift,az(ah.extendSelectionUp));aA.bind(av.Down,aw.Shift,az(ah.extendSelectionDown));aA.bind(av.Home,aw.None,az(ah.moveCursorToLineStart));aA.bind(av.End,aw.None,az(ah.moveCursorToLineEnd));aA.bind(av.Home,aw.Ctrl,az(ah.moveCursorToDocumentStart));aA.bind(av.End,aw.Ctrl,az(ah.moveCursorToDocumentEnd));aA.bind(av.Home,aw.Shift,az(ah.extendSelectionToLineStart));aA.bind(av.End,aw.Shift,az(ah.extendSelectionToLineEnd));aA.bind(av.Up,aw.CtrlShift,az(ah.extendSelectionToParagraphStart));aA.bind(av.Down,aw.CtrlShift,az(ah.extendSelectionToParagraphEnd));aA.bind(av.Home,aw.CtrlShift,az(ah.extendSelectionToDocumentStart));aA.bind(av.End,aw.CtrlShift,az(ah.extendSelectionToDocumentEnd));aW?(aA.bind(av.Left,aw.Alt,az(ah.moveCursorBeforeWord)),aA.bind(av.Right,aw.Alt,az(ah.moveCursorPastWord)),aA.bind(av.Left,aw.Meta,az(ah.moveCursorToLineStart)),aA.bind(av.Right,aw.Meta,az(ah.moveCursorToLineEnd)),aA.bind(av.Home,aw.Meta,az(ah.moveCursorToDocumentStart)),aA.bind(av.End,aw.Meta,az(ah.moveCursorToDocumentEnd)),aA.bind(av.Left,aw.AltShift,az(ah.extendSelectionBeforeWord)),aA.bind(av.Right,aw.AltShift,az(ah.extendSelectionPastWord)),aA.bind(av.Left,aw.MetaShift,az(ah.extendSelectionToLineStart)),aA.bind(av.Right,aw.MetaShift,az(ah.extendSelectionToLineEnd)),aA.bind(av.Up,aw.AltShift,az(ah.extendSelectionToParagraphStart)),aA.bind(av.Down,aw.AltShift,az(ah.extendSelectionToParagraphEnd)),aA.bind(av.Up,aw.MetaShift,az(ah.extendSelectionToDocumentStart)),aA.bind(av.Down,aw.MetaShift,az(ah.extendSelectionToDocumentEnd)),aA.bind(av.A,aw.Meta,az(ah.extendSelectionToEntireDocument))):(aA.bind(av.Left,aw.Ctrl,az(ah.moveCursorBeforeWord)),aA.bind(av.Right,aw.Ctrl,az(ah.moveCursorPastWord)),aA.bind(av.Left,aw.CtrlShift,az(ah.extendSelectionBeforeWord)),aA.bind(av.Right,aw.CtrlShift,az(ah.extendSelectionPastWord)),aA.bind(av.A,aw.Ctrl,az(ah.extendSelectionToEntireDocument)));aY&&(aJ=new gui.IOSSafariSupport(ax));ax.subscribe("keydown",aA.handleEvent);ax.subscribe("keypress",j.handleEvent);ax.subscribe("keyup",be.handleEvent);ax.subscribe("copy",a0);ax.subscribe("mousedown",aS);ax.subscribe("mousemove",aH.trigger);ax.subscribe("mouseup",ay);ax.subscribe("contextmenu",aq);ax.subscribe("dragstart",au);ax.subscribe("dragend",ar);ax.subscribe("click",aI.handleClick);ax.subscribe("longpress",aX);ax.subscribe("drag",aP);ax.subscribe("dragstop",aR);at.subscribe(ops.OdtDocument.signalOperationEnd,ac.trigger);at.subscribe(ops.Document.signalCursorAdded,o.registerCursor);at.subscribe(ops.Document.signalCursorRemoved,o.removeCursor);at.subscribe(ops.OdtDocument.signalOperationEnd,bd)}})();gui.CaretManager=function(j,i){function m(c){return h.hasOwnProperty(c)?h[c]:null}function o(){return Object.keys(h).map(function(c){return h[c]})}function l(f){var g=h[f];g&&(delete h[f],f===j.getInputMemberId()?(a.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,g.ensureVisible),a.unsubscribe(ops.Document.signalCursorMoved,g.refreshCursorBlinking),d.unsubscribe("compositionupdate",g.handleUpdate),d.unsubscribe("compositionend",g.handleUpdate),d.unsubscribe("focus",g.setFocus),d.unsubscribe("blur",g.removeFocus),e.removeEventListener("focus",g.show,!1),e.removeEventListener("blur",g.hide,!1)):a.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,g.handleUpdate),g.destroy(function(){}))}var h={},e=runtime.getWindow(),a=j.getSession().getOdtDocument(),d=j.getEventManager();this.registerCursor=function(f,n,g){var k=f.getMemberId();f=new gui.Caret(f,i,n,g);h[k]=f;k===j.getInputMemberId()?(runtime.log("Starting to track input on new cursor of "+k),a.subscribe(ops.OdtDocument.signalProcessingBatchEnd,f.ensureVisible),a.subscribe(ops.Document.signalCursorMoved,f.refreshCursorBlinking),d.subscribe("compositionupdate",f.handleUpdate),d.subscribe("compositionend",f.handleUpdate),d.subscribe("focus",f.setFocus),d.subscribe("blur",f.removeFocus),e.addEventListener("focus",f.show,!1),e.addEventListener("blur",f.hide,!1),f.setOverlayElement(d.getEventTrap())):a.subscribe(ops.OdtDocument.signalProcessingBatchEnd,f.handleUpdate);return f};this.getCaret=m;this.getCarets=o;this.destroy=function(f){var b=o().map(function(c){return c.destroy});j.getSelectionController().setCaretXPositionLocator(null);a.unsubscribe(ops.Document.signalCursorRemoved,l);h={};core.Async.destroyAll(b,f)};j.getSelectionController().setCaretXPositionLocator(function(){var c=m(j.getInputMemberId()),g;c&&(g=c.getBoundingClientRect());return g?g.right:void 0});a.subscribe(ops.Document.signalCursorRemoved,l)};gui.EditInfoHandle=function(e){var d=[],i,a=e.ownerDocument,h=a.documentElement.namespaceURI;this.setEdits=function(c){d=c;var k,b,f,j;core.DomUtils.removeAllChildNodes(i);for(c=0;c<d.length;c+=1){k=a.createElementNS(h,"div"),k.className="editInfo",b=a.createElementNS(h,"span"),b.className="editInfoColor",b.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",d[c].memberid),f=a.createElementNS(h,"span"),f.className="editInfoAuthor",f.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",d[c].memberid),j=a.createElementNS(h,"span"),j.className="editInfoTime",j.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",d[c].memberid),j.appendChild(a.createTextNode(d[c].time.toString())),k.appendChild(b),k.appendChild(f),k.appendChild(j),i.appendChild(k)}};this.show=function(){i.style.display="block"};this.hide=function(){i.style.display="none"};this.destroy=function(c){e.removeChild(i);c()};i=a.createElementNS(h,"div");i.setAttribute("class","editInfoHandle");i.style.display="none";e.appendChild(i)};ops.EditInfo=function(e,d){function i(){var f=[],g;for(g in h){h.hasOwnProperty(g)&&f.push({memberid:g,time:h[g].time})}f.sort(function(j,k){return j.time-k.time});return f}var a,h={};this.getNode=function(){return a};this.getOdtDocument=function(){return d};this.getEdits=function(){return h};this.getSortedEdits=function(){return i()};this.addEdit=function(f,g){h[f]={time:g}};this.clearEdits=function(){h={}};this.destroy=function(b){e.parentNode&&e.removeChild(a);b()};a=d.getDOMDocument().createElementNS("urn:webodf:names:editinfo","editinfo");e.insertBefore(a,e.firstChild)};gui.EditInfoMarker=function(l,j){function s(c,e){return runtime.setTimeout(function(){h.style.opacity=c},e)}var t=this,m,i,h,a,d,o;this.addEdit=function(c,e){var f=Date.now()-e;l.addEdit(c,e);i.setEdits(l.getSortedEdits());h.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",c);runtime.clearTimeout(d);runtime.clearTimeout(o);10000>f?(a=s(1,0),d=s(0.5,10000-f),o=s(0.2,20000-f)):10000<=f&&20000>f?(a=s(0.5,0),o=s(0.2,20000-f)):a=s(0.2,0)};this.getEdits=function(){return l.getEdits()};this.clearEdits=function(){l.clearEdits();i.setEdits([]);h.hasAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")&&h.removeAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")};this.getEditInfo=function(){return l};this.show=function(){h.style.display="block"};this.hide=function(){t.hideHandle();h.style.display="none"};this.showHandle=function(){i.show()};this.hideHandle=function(){i.hide()};this.destroy=function(c){runtime.clearTimeout(a);runtime.clearTimeout(d);runtime.clearTimeout(o);m.removeChild(h);i.destroy(function(b){b?c(b):l.destroy(c)})};(function(){var b=l.getOdtDocument().getDOMDocument();h=b.createElementNS(b.documentElement.namespaceURI,"div");h.setAttribute("class","editInfoMarker");h.onmouseover=function(){t.showHandle()};h.onmouseout=function(){t.hideHandle()};m=l.getNode();m.appendChild(h);i=new gui.EditInfoHandle(m);j||t.hide()})()};gui.HyperlinkTooltipView=function(h,d){var m=core.DomUtils,a=odf.OdfUtils,i=runtime.getWindow(),l,j,e;runtime.assert(null!==i,"Expected to be run in an environment which has a global window, like a browser.");this.showTooltip=function(g){var k=g.target||g.srcElement,f=h.getSizer(),c=h.getZoomLevel(),n;c:{for(;k;){if(a.isHyperlink(k)){break c}if(a.isParagraph(k)||a.isInlineRoot(k)){break}k=k.parentNode}k=null}if(k){m.containsNode(f,e)||f.appendChild(e);n=j;var b;switch(d()){case gui.KeyboardHandler.Modifier.Ctrl:b=runtime.tr("Ctrl-click to follow link");break;case gui.KeyboardHandler.Modifier.Meta:b=runtime.tr("\u2318-click to follow link");break;default:b=""}n.textContent=b;l.textContent=a.getHyperlinkTarget(k);e.style.display="block";n=i.innerWidth-e.offsetWidth-15;k=g.clientX>n?n:g.clientX+15;n=i.innerHeight-e.offsetHeight-10;g=g.clientY>n?n:g.clientY+10;f=f.getBoundingClientRect();k=(k-f.left)/c;g=(g-f.top)/c;e.style.left=k+"px";e.style.top=g+"px"}};this.hideTooltip=function(){e.style.display="none"};this.destroy=function(c){e.parentNode&&e.parentNode.removeChild(e);c()};(function(){var c=h.getElement().ownerDocument;l=c.createElement("span");j=c.createElement("span");l.className="webodf-hyperlinkTooltipLink";j.className="webodf-hyperlinkTooltipText";e=c.createElement("div");e.className="webodf-hyperlinkTooltip";e.appendChild(l);e.appendChild(j);h.getElement().appendChild(e)})()};gui.OdfFieldView=function(e){function d(){var g=odf.OdfSchema.getFields().map(function(c){return c.replace(":","|")}),h=g.join(",\n")+"\n{ background-color: #D0D0D0; }\n",g=g.map(function(c){return c+":empty::after"}).join(",\n")+"\n{ content:' '; white-space: pre; }\n";return h+"\n"+g}var f,a=e.getElement().ownerDocument;this.showFieldHighlight=function(){f.appendChild(a.createTextNode(d()))};this.hideFieldHighlight=function(){for(var c=f.sheet,h=c.cssRules;h.length;){c.deleteRule(h.length-1)}};this.destroy=function(c){f.parentNode&&f.parentNode.removeChild(f);c()};f=function(){var i=a.getElementsByTagName("head").item(0),h=a.createElement("style"),b="";h.type="text/css";h.media="screen, print, handheld, projection";odf.Namespaces.forEachPrefix(function(g,j){b+="@namespace "+g+" url("+j+");\n"});h.appendChild(a.createTextNode(b));i.appendChild(h);return h}()};gui.ShadowCursor=function(b){var a=b.getDOMDocument().createRange(),d=!0;this.removeFromDocument=function(){};this.getMemberId=function(){return gui.ShadowCursor.ShadowCursorMemberId};this.getSelectedRange=function(){return a};this.setSelectedRange=function(c,e){a=c;d=!1!==e};this.hasForwardSelection=function(){return d};this.getDocument=function(){return b};this.getSelectionType=function(){return ops.OdtCursor.RangeSelection};a.setStart(b.getRootNode(),0)};gui.ShadowCursor.ShadowCursorMemberId="";gui.SelectionView=function(a){};gui.SelectionView.prototype.rerender=function(){};gui.SelectionView.prototype.show=function(){};gui.SelectionView.prototype.hide=function(){};gui.SelectionView.prototype.destroy=function(a){};gui.SelectionViewManager=function(b){function a(){return Object.keys(d).map(function(c){return d[c]})}var d={};this.getSelectionView=function(c){return d.hasOwnProperty(c)?d[c]:null};this.getSelectionViews=a;this.removeSelectionView=function(c){d.hasOwnProperty(c)&&(d[c].destroy(function(){}),delete d[c])};this.hideSelectionView=function(c){d.hasOwnProperty(c)&&d[c].hide()};this.showSelectionView=function(c){d.hasOwnProperty(c)&&d[c].show()};this.rerenderSelectionViews=function(){Object.keys(d).forEach(function(c){d[c].rerender()})};this.registerCursor=function(c,g){var e=c.getMemberId(),h=new b(c);g?h.show():h.hide();return d[e]=h};this.destroy=function(e){function h(c,g){g?e(g):c<f.length?f[c].destroy(function(i){h(c+1,i)}):e()}var f=a();h(0,void 0)}};gui.SessionViewOptions=function(){this.caretBlinksOnRangeSelect=this.caretAvatarsInitiallyVisible=this.editInfoMarkersInitiallyVisible=!0};(function(){function a(b,d){return void 0!==b?Boolean(b):d}gui.SessionView=function(U,Z,aa,W,R,Q){function M(b){b.memberId===Z&&B.getViewport().scrollIntoView(b.annotation.getBoundingClientRect())}function O(){var d=document.getElementsByTagName("head").item(0),c=document.createElement("style");c.type="text/css";c.media="screen, print, handheld, projection";d.appendChild(c);return c}function X(f,c,k){function h(e,m,n){m=e+'[editinfo|memberid="'+f+'"]'+n+m;f:{var l=F.firstChild;for(e=e+'[editinfo|memberid="'+f+'"]'+n+"{";l;){if(l.nodeType===Node.TEXT_NODE&&0===l.data.indexOf(e)){e=l;break f}l=l.nextSibling}e=null}e?e.data=m:F.appendChild(document.createTextNode(m))}h("div.editInfoMarker","{ background-color: "+k+"; }","");h("span.editInfoColor","{ background-color: "+k+"; }","");h("span.editInfoAuthor",'{ content: "'+c+'"; }',":before");h("dc|creator","{ background-color: "+k+"; }","");h(".webodf-selectionOverlay","{ fill: "+k+"; stroke: "+k+";}","");f===Z&&(h(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"),f=gui.ShadowCursor.ShadowCursorMemberId,h(".webodf-selectionOverlay","{ fill: "+k+"; stroke: "+k+";}",""),h(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"))}function T(e){var c,f;for(f in J){J.hasOwnProperty(f)&&(c=J[f],e?c.show():c.hide())}}function ab(b){R.getCarets().forEach(function(c){b?c.showHandle():c.hideHandle()})}function Y(d){var c=d.getMemberId();d=d.getProperties();X(c,d.fullName,d.color)}function S(b){var e=b.getMemberId(),f=aa.getOdtDocument().getMember(e).getProperties();R.registerCursor(b,H,g);Q.registerCursor(b,!0);if(b=R.getCaret(e)){b.setAvatarImageUrl(f.imageUrl),b.setColor(f.color)}runtime.log("+++ View here +++ eagerly created an Caret for '"+e+"'! +++")}function V(f){f=f.getMemberId();var c=Q.getSelectionView(Z),k=Q.getSelectionView(gui.ShadowCursor.ShadowCursorMemberId),h=R.getCaret(Z);f===Z?(k.hide(),c&&c.show(),h&&h.show()):f===gui.ShadowCursor.ShadowCursorMemberId&&(k.show(),c&&c.hide(),h&&h.hide())}function s(b){Q.removeSelectionView(b)}function C(b){var n=b.paragraphElement,p=b.memberId;b=b.timeStamp;var m,l="",k=n.getElementsByTagNameNS("urn:webodf:names:editinfo","editinfo").item(0);k?(l=k.getAttributeNS("urn:webodf:names:editinfo","id"),m=J[l]):(l=Math.random().toString(),m=new ops.EditInfo(n,aa.getOdtDocument()),m=new gui.EditInfoMarker(m,i),k=n.getElementsByTagNameNS("urn:webodf:names:editinfo","editinfo").item(0),k.setAttributeNS("urn:webodf:names:editinfo","id",l),J[l]=m);m.addEdit(p,new Date(b));j.trigger()}function o(){var b;G.hasChildNodes()&&core.DomUtils.removeAllChildNodes(G);!0===W.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&(b=aa.getOdtDocument().getMember(Z))&&(b=b.getProperties().fullName,G.appendChild(document.createTextNode(".annotationWrapper:not([creator = '"+b+"']) .annotationRemoveButton { display: none; }")))}function D(e){var d=Object.keys(J).map(function(b){return J[b]});P.unsubscribe(ops.Document.signalMemberAdded,Y);P.unsubscribe(ops.Document.signalMemberUpdated,Y);P.unsubscribe(ops.Document.signalCursorAdded,S);P.unsubscribe(ops.Document.signalCursorRemoved,s);P.unsubscribe(ops.OdtDocument.signalParagraphChanged,C);P.unsubscribe(ops.Document.signalCursorMoved,V);P.unsubscribe(ops.OdtDocument.signalParagraphChanged,Q.rerenderSelectionViews);P.unsubscribe(ops.OdtDocument.signalTableAdded,Q.rerenderSelectionViews);P.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,Q.rerenderSelectionViews);W.unsubscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,o);P.unsubscribe(ops.Document.signalMemberAdded,o);P.unsubscribe(ops.Document.signalMemberUpdated,o);F.parentNode.removeChild(F);G.parentNode.removeChild(G);(function c(b,f){f?e(f):b<d.length?d[b].destroy(function(h){c(b+1,h)}):e()})(0,void 0)}var F,G,J={},P,B,j,i=a(U.editInfoMarkersInitiallyVisible,!0),H=a(U.caretAvatarsInitiallyVisible,!0),g=a(U.caretBlinksOnRangeSelect,!0);this.showEditInfoMarkers=function(){i||(i=!0,T(i))};this.hideEditInfoMarkers=function(){i&&(i=!1,T(i))};this.showCaretAvatars=function(){H||(H=!0,ab(H))};this.hideCaretAvatars=function(){H&&(H=!1,ab(H))};this.getSession=function(){return aa};this.getCaret=function(b){return R.getCaret(b)};this.destroy=function(d){var c=[j.destroy,D];P.unsubscribe(ops.OdtDocument.signalAnnotationAdded,M);core.Async.destroyAll(c,d)};P=aa.getOdtDocument();B=P.getOdfCanvas();P.subscribe(ops.OdtDocument.signalAnnotationAdded,M);P.subscribe(ops.Document.signalMemberAdded,Y);P.subscribe(ops.Document.signalMemberUpdated,Y);P.subscribe(ops.Document.signalCursorAdded,S);P.subscribe(ops.Document.signalCursorRemoved,s);P.subscribe(ops.OdtDocument.signalParagraphChanged,C);P.subscribe(ops.Document.signalCursorMoved,V);P.subscribe(ops.OdtDocument.signalParagraphChanged,Q.rerenderSelectionViews);P.subscribe(ops.OdtDocument.signalTableAdded,Q.rerenderSelectionViews);P.subscribe(ops.OdtDocument.signalParagraphStyleModified,Q.rerenderSelectionViews);W.subscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,o);P.subscribe(ops.Document.signalMemberAdded,o);P.subscribe(ops.Document.signalMemberUpdated,o);F=O();F.appendChild(document.createTextNode("@namespace editinfo url(urn:webodf:names:editinfo);"));F.appendChild(document.createTextNode("@namespace dc url(http://purl.org/dc/elements/1.1/);"));G=O();o();j=core.Task.createRedrawTask(function(){var b=B.getAnnotationViewManager();b&&(b.rehighlightAnnotations(),P.fixCursorPositions())})}})();gui.SvgSelectionView=function(X){function V(){var b=aa.getRootNode();T!==b&&(T=b,W=aa.getCanvas().getSizer(),W.appendChild(D),D.setAttribute("class","webodf-selectionOverlay"),F.setAttribute("class","webodf-draggable"),G.setAttribute("class","webodf-draggable"),F.setAttribute("end","left"),G.setAttribute("end","right"),F.setAttribute("r",8),G.setAttribute("r",8),D.appendChild(s),D.appendChild(F),D.appendChild(G))}function ab(b){b=b.getBoundingClientRect();return Boolean(b&&0!==b.height)}function ac(l){var k=H.getTextElements(l,!0,!1),t=l.cloneRange(),r=l.cloneRange();l=l.cloneRange();if(!k.length){return null}var q;l:{q=0;var n=k[q],p=t.startContainer===n?t.startOffset:0,c=p;t.setStart(n,p);for(t.setEnd(n,c);!ab(t);){if(n.nodeType===Node.ELEMENT_NODE&&c<n.childNodes.length){c=n.childNodes.length}else{if(n.nodeType===Node.TEXT_NODE&&c<n.length){c+=1}else{if(k[q]){n=k[q],q+=1,p=c=0}else{q=!1;break l}}}t.setStart(n,p);t.setEnd(n,c)}q=!0}if(!q){return null}l:{q=k.length-1;n=k[q];c=p=r.endContainer===n?r.endOffset:n.nodeType===Node.TEXT_NODE?n.length:n.childNodes.length;r.setStart(n,p);for(r.setEnd(n,c);!ab(r);){if(n.nodeType===Node.ELEMENT_NODE&&0<p){p=0}else{if(n.nodeType===Node.TEXT_NODE&&0<p){--p}else{if(k[q]){n=k[q],--q,p=c=n.length||n.childNodes.length}else{k=!1;break l}}}r.setStart(n,p);r.setEnd(n,c)}k=!0}if(!k){return null}l.setStart(t.startContainer,t.startOffset);l.setEnd(r.endContainer,r.endOffset);return{firstRange:t,lastRange:r,fillerRange:l}}function Y(e,c){var f={};f.top=Math.min(e.top,c.top);f.left=Math.min(e.left,c.left);f.right=Math.max(e.right,c.right);f.bottom=Math.max(e.bottom,c.bottom);f.width=f.right-f.left;f.height=f.bottom-f.top;return f}function S(d,c){c&&0<c.width&&0<c.height&&(d=d?Y(d,c):c);return d}function R(af){function N(b){o.setUnfilteredPosition(b,0);return ah.acceptNode(b)===j&&ae.acceptPosition(o)===j?j:J}function L(b){var c=null;N(b)===j&&(c=M.getBoundingClientRect(b));return c}var K=af.commonAncestorContainer,I=af.startContainer,A=af.endContainer,E=af.startOffset,u=af.endOffset,z,y,t=null,n,d=B.createRange(),ae,ah=new odf.OdfNodeFilter,ag;if(I===K||A===K){return d=af.cloneRange(),t=d.getBoundingClientRect(),d.detach(),t}for(af=I;af.parentNode!==K;){af=af.parentNode}for(y=A;y.parentNode!==K;){y=y.parentNode}ae=aa.createRootFilter(I);for(K=af.nextSibling;K&&K!==y;){n=L(K),t=S(t,n),K=K.nextSibling}if(H.isParagraph(af)){t=S(t,M.getBoundingClientRect(af))}else{if(af.nodeType===Node.TEXT_NODE){K=af,d.setStart(K,E),d.setEnd(K,K===y?u:K.length),n=d.getBoundingClientRect(),t=S(t,n)}else{for(ag=B.createTreeWalker(af,NodeFilter.SHOW_TEXT,N,!1),K=ag.currentNode=I;K&&K!==A;){d.setStart(K,E),d.setEnd(K,K.length),n=d.getBoundingClientRect(),t=S(t,n),z=K,E=0,K=ag.nextNode()}}}z||(z=I);if(H.isParagraph(y)){t=S(t,M.getBoundingClientRect(y))}else{if(y.nodeType===Node.TEXT_NODE){K=y,d.setStart(K,K===af?E:0),d.setEnd(K,u),n=d.getBoundingClientRect(),t=S(t,n)}else{for(ag=B.createTreeWalker(y,NodeFilter.SHOW_TEXT,N,!1),K=ag.currentNode=A;K&&K!==z;){if(d.setStart(K,0),d.setEnd(K,u),n=d.getBoundingClientRect(),t=S(t,n),K=ag.previousNode()){u=K.length}}}}return t}function O(f,e){var g=f.getBoundingClientRect(),h={width:0};h.top=g.top;h.bottom=g.bottom;h.height=g.height;h.left=h.right=e?g.right:g.left;return h}function P(){var v=X.getSelectedRange(),p;if(p=C&&X.getSelectionType()===ops.OdtCursor.RangeSelection&&!v.collapsed){V();var r=M.getBoundingClientRect(W),k=Q.getZoomLevel(),v=ac(v),g,h,f,b,t,w;if(v){p=v.firstRange;g=v.lastRange;h=v.fillerRange;f=M.translateRect(O(p,!1),r,k);t=M.translateRect(O(g,!0),r,k);b=(b=R(h))?M.translateRect(b,r,k):Y(f,t);w=b.left;b=f.left+Math.max(0,b.width-(f.left-b.left));r=Math.min(f.top,t.top);k=t.top+t.height;w=[{x:f.left,y:r+f.height},{x:f.left,y:r},{x:b,y:r},{x:b,y:k-t.height},{x:t.right,y:k-t.height},{x:t.right,y:k},{x:w,y:k},{x:w,y:r+f.height},{x:f.left,y:r+f.height}];b="";var x;for(x=0;x<w.length;x+=1){b+=w[x].x+","+w[x].y+" "}s.setAttribute("points",b);F.setAttribute("cx",f.left);F.setAttribute("cy",r+f.height/2);G.setAttribute("cx",t.right);G.setAttribute("cy",k-t.height/2);p.detach();g.detach();h.detach()}p=Boolean(v)}D.style.display=p?"block":"none"}function Z(b){C&&b===X&&i.trigger()}function U(b){b=8/b;F.setAttribute("r",b);G.setAttribute("r",b)}function ad(b){W.removeChild(D);W.classList.remove("webodf-virtualSelections");X.getDocument().unsubscribe(ops.Document.signalCursorMoved,Z);Q.unsubscribe(gui.ZoomHelper.signalZoomChanged,U);b()}var aa=X.getDocument(),T,W,B=aa.getDOMDocument(),D=B.createElementNS("http://www.w3.org/2000/svg","svg"),s=B.createElementNS("http://www.w3.org/2000/svg","polygon"),F=B.createElementNS("http://www.w3.org/2000/svg","circle"),G=B.createElementNS("http://www.w3.org/2000/svg","circle"),H=odf.OdfUtils,M=core.DomUtils,Q=aa.getCanvas().getZoomHelper(),C=!0,o=X.getDocument().createPositionIterator(aa.getRootNode()),j=NodeFilter.FILTER_ACCEPT,J=NodeFilter.FILTER_REJECT,i;this.rerender=function(){C&&i.trigger()};this.show=function(){C=!0;i.trigger()};this.hide=function(){C=!1;i.trigger()};this.destroy=function(a){core.Async.destroyAll([i.destroy,ad],a)};(function(){var b=X.getMemberId();i=core.Task.createRedrawTask(P);V();D.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",b);W.classList.add("webodf-virtualSelections");X.getDocument().subscribe(ops.Document.signalCursorMoved,Z);Q.subscribe(gui.ZoomHelper.signalZoomChanged,U);U(Q.getZoomLevel())})()};gui.UndoStateRules=function(){function e(h,j){var i=h.length;this.previous=function(){for(--i;0<=i;--i){if(j(h[i])){return h[i]}}return null}}function d(g){g=g.spec();var h;g.hasOwnProperty("position")&&(h=g.position);return h}function f(c){return c.isEdit}function a(h,j,i){if(!i){return i=d(h)-d(j),0===i||1===Math.abs(i)}h=d(h);j=d(j);i=d(i);return h-j===j-i}this.isEditOperation=f;this.isPartOfOperationSet=function(j,i){var g=void 0!==j.group,b;if(!j.isEdit||0===i.length){return !0}b=i[i.length-1];if(g&&j.group===b.group){return !0}o:switch(j.spec().optype){case"RemoveText":case"InsertText":b=!0;break o;default:b=!1}if(b&&i.some(f)){if(g){var c;g=j.spec().optype;b=new e(i,f);var m=b.previous(),h=null,o,n;runtime.assert(Boolean(m),"No edit operations found in state");n=m.group;runtime.assert(void 0!==n,"Operation has no group");for(o=1;m&&m.group===n;){if(g===m.spec().optype){c=m;break}m=b.previous()}if(c){for(m=b.previous();m;){if(m.group!==n){if(2===o){break}n=m.group;o+=1}if(g===m.spec().optype){h=m;break}m=b.previous()}c=a(j,c,h)}else{c=!1}return c}c=j.spec().optype;g=new e(i,f);b=g.previous();runtime.assert(Boolean(b),"No edit operations found in state");c=c===b.spec().optype?a(j,b,g.previous()):!1;return c}return !1}};(function(){function b(e,f){this.mainId=void 0!==e?e:-1;this.subId=void 0!==f?f:-1}function a(c,j,g){function m(f,e){return f+(c.isEditOperation(e)?1:0)}var h,i,l;this.addOperation=function(e){c.isEditOperation(e)&&(l+=1);i.push(e)};this.isNextStateId=function(e){return e.mainId===h&&e.subId===l};this.getNextStateId=function(){return new b(h,l)};this.getOperations=function(){return i};h=d+=1;i=j||[];l=j&&g?j.reduce(m,0):0}var d=0;gui.TrivialUndoManager=function(S){function R(){return !0!==C.isNextStateId(B)}function J(c){c=c.getOperations();0<c.length&&(f=!0,i(c),f=!1)}function H(){k.emit(gui.UndoManager.signalUndoStackChanged,{undoAvailable:M.hasUndoStates(),redoAvailable:M.hasRedoStates()})}function E(e){var c=R();e!==c&&k.emit(gui.UndoManager.signalDocumentModifiedChanged,c)}function F(){C!==o&&C!==D[D.length-1]&&D.push(C)}function P(e){var c=e.previousSibling||e.nextSibling;e.parentNode.removeChild(e);O.normalizeTextNodes(c)}function N(c){return Object.keys(c).map(function(e){return c[e]})}function T(m){function l(c){var e=c.spec();if(q[e.memberid]){switch(e.optype){case"AddCursor":r[e.memberid]||(r[e.memberid]=c,delete q[e.memberid],--p);break;case"MoveCursor":t[e.memberid]||(t[e.memberid]=c)}}}var r={},t={},q={},p,n;n=m.pop();s.getMemberIds().forEach(function(c){q[c]=!0});for(p=Object.keys(q).length;n&&0<p;){n=n.getOperations(),n.reverse(),n.forEach(l),n=m.pop()}return new a(g,N(r).concat(N(t)))}function Q(){var c=R(),e=j=s.cloneDocumentElement();O.getElementsByTagNameNS(e,"urn:webodf:names:cursor","cursor").forEach(P);O.getElementsByTagNameNS(e,"urn:webodf:names:cursor","anchor").forEach(P);F();C=o=T([o].concat(D));D.length=0;G.length=0;c||(B=C.getNextStateId());H();E(c)}var M=this,O=core.DomUtils,j,o,i,s,B,C,D=[],G=[],k=new core.EventNotifier([gui.UndoManager.signalUndoStackChanged,gui.UndoManager.signalUndoStateCreated,gui.UndoManager.signalUndoStateModified,gui.UndoManager.signalDocumentModifiedChanged,gui.TrivialUndoManager.signalDocumentRootReplaced]),g=S||new gui.UndoStateRules,f=!1;this.subscribe=function(e,c){k.subscribe(e,c)};this.unsubscribe=function(e,c){k.unsubscribe(e,c)};this.isDocumentModified=R;this.setDocumentModified=function(c){R()!==c&&(B=c?new b:C.getNextStateId(),k.emit(gui.UndoManager.signalDocumentModifiedChanged,c))};this.hasUndoStates=function(){return 0<D.length};this.hasRedoStates=function(){return 0<G.length};this.setDocument=function(c){s=c};this.purgeInitialState=function(){var c=R();D.length=0;G.length=0;C=o=new a(g);B=C.getNextStateId();j=null;H();E(c)};this.setInitialState=Q;this.initialize=function(){j||Q()};this.setPlaybackFunction=function(c){i=c};this.onOperationExecuted=function(e){if(!f){var c=R();g.isEditOperation(e)&&(C===o||0<G.length)||!g.isPartOfOperationSet(e,C.getOperations())?(G.length=0,F(),C=new a(g,[e],!0),D.push(C),k.emit(gui.UndoManager.signalUndoStateCreated,{operations:C.getOperations()}),H()):(C.addOperation(e),k.emit(gui.UndoManager.signalUndoStateModified,{operations:C.getOperations()}));E(c)}};this.moveForward=function(h){for(var c=0,m=R(),l;h&&G.length;){l=G.pop(),D.push(l),J(l),--h,c+=1}c&&(C=D[D.length-1],H(),E(m));return c};this.moveBackward=function(e){for(var c=0,h=R();e&&D.length;){G.push(D.pop()),--e,c+=1}c&&(s.getMemberIds().forEach(function(l){s.hasCursor(l)&&s.removeCursor(l)}),s.setDocumentElement(j.cloneNode(!0)),k.emit(gui.TrivialUndoManager.signalDocumentRootReplaced,{}),J(o),D.forEach(J),C=D[D.length-1]||o,H(),E(h));return c};C=o=new a(g);B=C.getNextStateId()};gui.TrivialUndoManager.signalDocumentRootReplaced="documentRootReplaced"})();odf.GraphicProperties=function(e,d,j){var a=this,h=odf.Namespaces.stylens,i=odf.Namespaces.svgns;this.verticalPos=function(){return a.data.value("verticalPos")};this.verticalRel=function(){return a.data.value("verticalRel")};this.horizontalPos=function(){return a.data.value("horizontalPos")};this.horizontalRel=function(){return a.data.value("horizontalRel")};this.strokeWidth=function(){return a.data.value("strokeWidth")};a.data=new odf.LazyStyleProperties(void 0===j?void 0:j.data,{verticalPos:function(){var c=e.getAttributeNS(h,"vertical-pos");return""===c?void 0:c},verticalRel:function(){var c=e.getAttributeNS(h,"vertical-rel");return""===c?void 0:c},horizontalPos:function(){var c=e.getAttributeNS(h,"horizontal-pos");return""===c?void 0:c},horizontalRel:function(){var c=e.getAttributeNS(h,"horizontal-rel");return""===c?void 0:c},strokeWidth:function(){var c=e.getAttributeNS(i,"stroke-width");return d.parseLength(c)}})};odf.ComputedGraphicProperties=function(){var a;this.setGraphicProperties=function(b){a=b};this.verticalPos=function(){return a&&a.verticalPos()||"from-top"};this.verticalRel=function(){return a&&a.verticalRel()||"page"};this.horizontalPos=function(){return a&&a.horizontalPos()||"from-left"};this.horizontalRel=function(){return a&&a.horizontalRel()||"page"}};odf.PageLayoutProperties=function(e,d,i){var a=this,h=odf.Namespaces.fons;this.pageHeight=function(){return a.data.value("pageHeight")||1123};this.pageWidth=function(){return a.data.value("pageWidth")||794};a.data=new odf.LazyStyleProperties(void 0===i?void 0:i.data,{pageHeight:function(){var c;e&&(c=e.getAttributeNS(h,"page-height"),c=d.parseLength(c));return c},pageWidth:function(){var c;e&&(c=e.getAttributeNS(h,"page-width"),c=d.parseLength(c));return c}})};odf.PageLayout=function(e,d,f){var a=null;e&&(a=d.getPropertiesElement("page-layout-properties",e));this.pageLayout=new odf.PageLayoutProperties(a,d,f&&f.pageLayout)};odf.PageLayoutCache=function(){};odf.PageLayoutCache.prototype.getPageLayout=function(a){};odf.PageLayoutCache.prototype.getDefaultPageLayout=function(){};odf.ParagraphProperties=function(e,d,i){var a=this,h=odf.Namespaces.fons;this.marginTop=function(){return a.data.value("marginTop")};a.data=new odf.LazyStyleProperties(void 0===i?void 0:i.data,{marginTop:function(){var c=e.getAttributeNS(h,"margin-top");return d.parsePositiveLengthOrPercent(c,"marginTop",i&&i.data)}})};odf.ComputedParagraphProperties=function(){var b={},a=[];this.setStyleChain=function(d){a=d;b={}};this.marginTop=function(){var e,d;if(b.hasOwnProperty("marginTop")){e=b.marginTop}else{for(d=0;void 0===e&&d<a.length;d+=1){e=a[d].marginTop()}b.marginTop=e}return e||0}};odf.TextProperties=function(e,d,i){var a=this,h=odf.Namespaces.fons;this.fontSize=function(){return a.data.value("fontSize")};a.data=new odf.LazyStyleProperties(void 0===i?void 0:i.data,{fontSize:function(){var c=e.getAttributeNS(h,"font-size");return d.parsePositiveLengthOrPercent(c,"fontSize",i&&i.data)}})};odf.ComputedTextProperties=function(){var b={},a=[];this.setStyleChain=function(d){a=d;b={}};this.fontSize=function(){var e,d;if(b.hasOwnProperty("fontSize")){e=b.fontSize}else{for(d=0;void 0===e&&d<a.length;d+=1){e=a[d].fontSize()}b.fontSize=e}return e||12}};odf.MasterPage=function(b,a){var d;b?(d=b.getAttributeNS(odf.Namespaces.stylens,"page-layout-name"),this.pageLayout=a.getPageLayout(d)):this.pageLayout=a.getDefaultPageLayout()};odf.MasterPageCache=function(){};odf.MasterPageCache.prototype.getMasterPage=function(a){};odf.StylePileEntry=function(e,d,f,a){this.masterPage=function(){var c=e.getAttributeNS(odf.Namespaces.stylens,"master-page-name"),g=null;c&&(g=f.getMasterPage(c));return g};(function(h){var g=e.getAttributeNS(odf.Namespaces.stylens,"family"),b=null;if("graphic"===g||"chart"===g){h.graphic=void 0===a?void 0:a.graphic,b=d.getPropertiesElement("graphic-properties",e,b),null!==b&&(h.graphic=new odf.GraphicProperties(b,d,h.graphic))}if("paragraph"===g||"table-cell"===g||"graphic"===g||"presentation"===g||"chart"===g){h.paragraph=void 0===a?void 0:a.paragraph,b=d.getPropertiesElement("paragraph-properties",e,b),null!==b&&(h.paragraph=new odf.ParagraphProperties(b,d,h.paragraph))}if("text"===g||"paragraph"===g||"table-cell"===g||"graphic"===g||"presentation"===g||"chart"===g){h.text=void 0===a?void 0:a.text,b=d.getPropertiesElement("text-properties",e,b),null!==b&&(h.text=new odf.TextProperties(b,d,h.text))}})(this)};odf.StylePile=function(l,j){function s(k,b){var g,e;k.hasAttributeNS(t,"parent-style-name")&&(e=k.getAttributeNS(t,"parent-style-name"),-1===b.indexOf(e)&&(g=o(e,b)));return new odf.StylePileEntry(k,l,j,g)}var t=odf.Namespaces.stylens,m={},i={},h,a={},d={},o;o=function(c,f){var k=a[c],g;!k&&(g=m[c])&&(f.push(c),k=s(g,f),a[c]=k);return k};this.getStyle=function(c){var f=d[c]||a[c],k,g=[];f||(k=i[c],k||(k=m[c])&&g.push(c),k&&(f=s(k,g)));return f};this.addCommonStyle=function(e){var b;e.hasAttributeNS(t,"name")&&(b=e.getAttributeNS(t,"name"),m.hasOwnProperty(b)||(m[b]=e))};this.addAutomaticStyle=function(e){var b;e.hasAttributeNS(t,"name")&&(b=e.getAttributeNS(t,"name"),i.hasOwnProperty(b)||(i[b]=e))};this.setDefaultStyle=function(c){void 0===h&&(h=s(c,[]))};this.getDefaultStyle=function(){return h}};odf.ComputedGraphicStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties;this.graphic=new odf.ComputedGraphicProperties};odf.ComputedParagraphStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties};odf.ComputedTextStyle=function(){this.text=new odf.ComputedTextProperties};odf.StyleCache=function(P){function N(g,f,k,l){f=k.getAttributeNS(f,"class-names");var h;if(f){for(f=f.split(" "),h=0;h<f.length;h+=1){if(k=f[h]){l.push(g),l.push(k)}}}}function T(e,c){var f=s.getStyleName("paragraph",e);void 0!==f&&(c.push("paragraph"),c.push(f));e.namespaceURI!==O||"h"!==e.localName&&"p"!==e.localName||N("paragraph",O,e,c);return c}function U(l,k,r){var t=[],q,m,p,n;for(q=0;q<l.length;q+=2){p=l[q],n=l[q+1],p=F[p],n=p.getStyle(n),void 0!==n&&(n=n[k],void 0!==n&&n!==m&&(t.push(n),m=n))}p=F[r];if(n=p.getDefaultStyle()){n=n[k],void 0!==n&&n!==m&&t.push(n)}return t}function Q(f,c){var h=s.getStyleName("text",f),g=f.parentNode;void 0!==h&&(c.push("text"),c.push(h));"span"===f.localName&&f.namespaceURI===O&&N("text",O,f,c);if(!g||g===P){return c}g.namespaceURI!==O||"p"!==g.localName&&"h"!==g.localName?Q(g,c):T(g,c);return c}function K(b){b=b.getAttributeNS(j,"family");return F[b]}var J=this,F,G,R,M,V,S,L,O=odf.Namespaces.textns,j=odf.Namespaces.stylens,s=new odf.StyleInfo,i=new odf.StyleParseUtils,B,C,D,E,H,o;this.getComputedGraphicStyle=function(b){var e=[];b=s.getStyleName("graphic",b);void 0!==b&&(e.push("graphic"),e.push(b));b=e.join("/");var f=M[b];runtime.assert(0===e.length%2,"Invalid style chain.");void 0===f&&(f=new odf.ComputedGraphicStyle,f.graphic.setGraphicProperties(U(e,"graphic","graphic")[0]),f.text.setStyleChain(U(e,"text","graphic")),f.paragraph.setStyleChain(U(e,"paragraph","graphic")),M[b]=f);return f};this.getComputedParagraphStyle=function(b){b=T(b,[]);var e=b.join("/"),c=R[e];runtime.assert(0===b.length%2,"Invalid style chain.");void 0===c&&(c=new odf.ComputedParagraphStyle,c.text.setStyleChain(U(b,"text","paragraph")),c.paragraph.setStyleChain(U(b,"paragraph","paragraph")),R[e]=c);return c};this.getComputedTextStyle=function(b){b=Q(b,[]);var e=b.join("/"),f=G[e];runtime.assert(0===b.length%2,"Invalid style chain.");void 0===f&&(f=new odf.ComputedTextStyle,f.text.setStyleChain(U(b,"text","text")),G[e]=f);return f};this.getPageLayout=function(d){var c=o[d];c||((c=H[d])?(c=new odf.PageLayout(c,i,E),o[d]=c):c=E);return c};this.getDefaultPageLayout=function(){return E};this.getMasterPage=function(d){var c=C[d];void 0===c&&((c=B[d])?(c=new odf.MasterPage(c,J),C[d]=c):c=null);return c};this.getDefaultMasterPage=function(){return D};this.update=function(){var a,g,e=null,d=null;G={};R={};M={};B={};C={};o={};H={};V=new odf.StylePile(i,J);S=new odf.StylePile(i,J);L=new odf.StylePile(i,J);F={text:V,paragraph:S,graphic:L};for(a=P.styles.firstElementChild;a;){a.namespaceURI===j&&((g=K(a))?"style"===a.localName?g.addCommonStyle(a):"default-style"===a.localName&&g.setDefaultStyle(a):"default-page-layout"===a.localName&&(e=a)),a=a.nextElementSibling}E=new odf.PageLayout(e,i);for(a=P.automaticStyles.firstElementChild;a;){a.namespaceURI===j&&((g=K(a))&&"style"===a.localName?g.addAutomaticStyle(a):"page-layout"===a.localName&&(H[a.getAttributeNS(j,"name")]=a)),a=a.nextElementSibling}for(a=P.masterStyles.firstElementChild;a;){a.namespaceURI===j&&"master-page"===a.localName&&(d=d||a,g=a,e=g.getAttributeNS(j,"name"),0<e.length&&!B.hasOwnProperty(e)&&(B[e]=g)),a=a.nextElementSibling}D=new odf.MasterPage(d,J)}};ops.OperationTransformMatrix=function(){function o(b){b.position+=b.length;b.length*=-1}function m(e){var c=0>e.length;c&&o(e);return c}function u(g,f){function l(b){g[b]===f&&k.push(b)}var k=[];g&&["style:parent-style-name","style:next-style-name"].forEach(l);return k}function v(f,e){function g(b){f[b]===e&&delete f[b]}f&&["style:parent-style-name","style:next-style-name"].forEach(g)}function s(e){var c={};Object.keys(e).forEach(function(b){c[b]="object"===typeof e[b]?s(e[b]):e[b]});return c}function i(B,A,z,y){var x,w=!1,r=!1,q,p=[];y&&y.attributes&&(p=y.attributes.split(","));B&&(z||0<p.length)&&Object.keys(B).forEach(function(c){var g=B[c],f;"object"!==typeof g&&(z&&(f=z[c]),void 0!==f?(delete B[c],r=!0,f===g&&(delete z[c],w=!0)):-1!==p.indexOf(c)&&(delete B[c],r=!0))});if(A&&A.attributes&&(z||0<p.length)){q=A.attributes.split(",");for(y=0;y<q.length;y+=1){if(x=q[y],z&&void 0!==z[x]||p&&-1!==p.indexOf(x)){q.splice(y,1),--y,r=!0}}0<q.length?A.attributes=q.join(","):delete A.attributes}return{majorChanged:w,minorChanged:r}}function h(e){for(var c in e){if(e.hasOwnProperty(c)){return !0}}return !1}function a(e){for(var c in e){if(e.hasOwnProperty(c)&&("attributes"!==c||0<e.attributes.length)){return !0}}return !1}function d(B,A,z,y,x){var w=B?B[x]:null,r=A?A[x]:null,p=z?z[x]:null,n=y?y[x]:null,C;C=i(w,r,p,n);w&&!h(w)&&delete B[x];r&&!a(r)&&delete A[x];p&&!h(p)&&delete z[x];n&&!a(n)&&delete y[x];return C}function t(e,c){return{opSpecsA:[e],opSpecsB:[c]}}var j;j={AddAnnotation:{AddAnnotation:function(g,f,l){var k;g.position<f.position?(k=g,l=f):f.position<g.position?(k=f,l=g):(k=l?g:f,l=l?f:g);l.position<k.position+k.length&&(k.length+=2);l.position+=2;return{opSpecsA:[g],opSpecsB:[f]}},AddCursor:t,AddMember:t,AddStyle:t,ApplyDirectStyling:function(e,c){e.position<=c.position?c.position+=2:e.position<=c.position+c.length&&(c.length+=2);return{opSpecsA:[e],opSpecsB:[c]}},InsertText:function(e,c){c.position<=e.position?e.position+=c.text.length:(void 0!==e.length&&c.position<=e.position+e.length&&(e.length+=c.text.length),c.position+=2);return{opSpecsA:[e],opSpecsB:[c]}},MergeParagraph:function(e,c){c.sourceStartPosition<=e.position?--e.position:(void 0!==e.length&&c.sourceStartPosition<=e.position+e.length&&--e.length,c.sourceStartPosition+=2,e.position<c.destinationStartPosition&&(c.destinationStartPosition+=2));return{opSpecsA:[e],opSpecsB:[c]}},MoveCursor:function(f,e){var g=m(e);f.position<e.position?e.position+=2:f.position<e.position+e.length&&(e.length+=2);g&&o(e);return{opSpecsA:[f],opSpecsB:[e]}},RemoveAnnotation:function(e,c){e.position<c.position?(c.position<e.position+e.length&&(e.length-=c.length+2),c.position+=2):e.position-=c.length+2;return{opSpecsA:[e],opSpecsB:[c]}},RemoveCursor:t,RemoveMember:t,RemoveStyle:t,RemoveText:function(n,l){var x=l.position,w=l.position+l.length,r,q=[n],p=[l];n.position<=l.position?l.position+=2:n.position<w&&(l.length=n.position-l.position,r={optype:"RemoveText",memberid:l.memberid,timestamp:l.timestamp,position:n.position+2,length:w-n.position},p.unshift(r));l.position+l.length<=n.position?(n.position-=l.length,void 0!==n.length&&r&&(n.length=r.length>=n.length?0:n.length-r.length)):void 0!==n.length&&(r=n.position+n.length,w<=r?n.length-=l.length:x<r&&(n.length=x-n.position));return{opSpecsA:q,opSpecsB:p}},SetParagraphStyle:function(e,c){e.position<c.position&&(c.position+=2);return{opSpecsA:[e],opSpecsB:[c]}},SplitParagraph:function(e,c){e.position<c.sourceParagraphPosition&&(c.sourceParagraphPosition+=2);c.position<=e.position?e.position+=1:(void 0!==e.length&&c.position<=e.position+e.length&&(e.length+=1),c.position+=2);return{opSpecsA:[e],opSpecsB:[c]}},UpdateMember:t,UpdateMetadata:t,UpdateParagraphStyle:t},AddCursor:{AddCursor:t,AddMember:t,AddStyle:t,ApplyDirectStyling:t,InsertText:t,MergeParagraph:t,MoveCursor:t,RemoveAnnotation:t,RemoveCursor:t,RemoveMember:t,RemoveStyle:t,RemoveText:t,SetParagraphStyle:t,SplitParagraph:t,UpdateMember:t,UpdateMetadata:t,UpdateParagraphStyle:t},AddMember:{AddStyle:t,ApplyDirectStyling:t,InsertText:t,MergeParagraph:t,MoveCursor:t,RemoveAnnotation:t,RemoveCursor:t,RemoveStyle:t,RemoveText:t,SetParagraphStyle:t,SplitParagraph:t,UpdateMetadata:t,UpdateParagraphStyle:t},AddStyle:{AddStyle:t,ApplyDirectStyling:t,InsertText:t,MergeParagraph:t,MoveCursor:t,RemoveAnnotation:t,RemoveCursor:t,RemoveMember:t,RemoveStyle:function(b,n){var l,k=[b],c=[n];b.styleFamily===n.styleFamily&&(l=u(b.setProperties,n.styleName),0<l.length&&(l={optype:"UpdateParagraphStyle",memberid:n.memberid,timestamp:n.timestamp,styleName:b.styleName,removedProperties:{attributes:l.join(",")}},c.unshift(l)),v(b.setProperties,n.styleName));return{opSpecsA:k,opSpecsB:c}},RemoveText:t,SetParagraphStyle:t,SplitParagraph:t,UpdateMember:t,UpdateMetadata:t,UpdateParagraphStyle:t},ApplyDirectStyling:{ApplyDirectStyling:function(B,A,z){var y,x,w,q,p,f,C,D;q=[B];w=[A];if(!(B.position+B.length<=A.position||B.position>=A.position+A.length)){y=z?B:A;x=z?A:B;if(B.position!==A.position||B.length!==A.length){f=s(y),C=s(x)}A=d(x.setProperties,null,y.setProperties,null,"style:text-properties");if(A.majorChanged||A.minorChanged){w=[],B=[],q=y.position+y.length,p=x.position+x.length,x.position<y.position?A.minorChanged&&(D=s(C),D.length=y.position-x.position,B.push(D),x.position=y.position,x.length=p-x.position):y.position<x.position&&A.majorChanged&&(D=s(f),D.length=x.position-y.position,w.push(D),y.position=x.position,y.length=q-y.position),p>q?A.minorChanged&&(f=C,f.position=q,f.length=p-q,B.push(f),x.length=q-x.position):q>p&&A.majorChanged&&(f.position=p,f.length=q-p,w.push(f),y.length=p-y.position),y.setProperties&&h(y.setProperties)&&w.push(y),x.setProperties&&h(x.setProperties)&&B.push(x),z?(q=w,w=B):q=B}}return{opSpecsA:q,opSpecsB:w}},InsertText:function(e,c){c.position<=e.position?e.position+=c.text.length:c.position<=e.position+e.length&&(e.length+=c.text.length);return{opSpecsA:[e],opSpecsB:[c]}},MergeParagraph:function(g,f){var l=g.position,k=g.position+g.length;l>=f.sourceStartPosition&&--l;k>=f.sourceStartPosition&&--k;g.position=l;g.length=k-l;return{opSpecsA:[g],opSpecsB:[f]}},MoveCursor:t,RemoveAnnotation:function(n,l){var x=n.position,w=n.position+n.length,r=l.position+l.length,q=[n],p=[l];l.position<=x&&w<=r?q=[]:(r<x&&(x-=l.length+2),r<w&&(w-=l.length+2),n.position=x,n.length=w-x);return{opSpecsA:q,opSpecsB:p}},RemoveCursor:t,RemoveMember:t,RemoveStyle:t,RemoveText:function(l,k){var r=l.position+l.length,q=k.position+k.length,p=[l],n=[k];q<=l.position?l.position-=k.length:k.position<r&&(l.position<k.position?l.length=q<r?l.length-k.length:k.position-l.position:(l.position=k.position,q<r?l.length=r-q:p=[]));return{opSpecsA:p,opSpecsB:n}},SetParagraphStyle:t,SplitParagraph:function(e,c){c.position<e.position?e.position+=1:c.position<e.position+e.length&&(e.length+=1);return{opSpecsA:[e],opSpecsB:[c]}},UpdateMember:t,UpdateMetadata:t,UpdateParagraphStyle:t},InsertText:{InsertText:function(f,e,g){f.position<e.position?e.position+=f.text.length:f.position>e.position?f.position+=e.text.length:g?e.position+=f.text.length:f.position+=e.text.length;return{opSpecsA:[f],opSpecsB:[e]}},MergeParagraph:function(e,c){e.position>=c.sourceStartPosition?--e.position:(e.position<c.sourceStartPosition&&(c.sourceStartPosition+=e.text.length),e.position<c.destinationStartPosition&&(c.destinationStartPosition+=e.text.length));return{opSpecsA:[e],opSpecsB:[c]}},MoveCursor:function(f,e){var g=m(e);f.position<e.position?e.position+=f.text.length:f.position<e.position+e.length&&(e.length+=f.text.length);g&&o(e);return{opSpecsA:[f],opSpecsB:[e]}},RemoveAnnotation:function(l,k){var r=l.position,q=k.position+k.length,p=[l],n=[k];k.position<=r&&r<=q?(p=[],k.length+=l.text.length):q<l.position?l.position-=k.length+2:k.position+=l.text.length;return{opSpecsA:p,opSpecsB:n}},RemoveCursor:t,RemoveMember:t,RemoveStyle:t,RemoveText:function(k,g){var p;p=g.position+g.length;var n=[k],l=[g];p<=k.position?k.position-=g.length:k.position<=g.position?g.position+=k.text.length:(g.length=k.position-g.position,p={optype:"RemoveText",memberid:g.memberid,timestamp:g.timestamp,position:k.position+k.text.length,length:p-k.position},l.unshift(p),k.position=g.position);return{opSpecsA:n,opSpecsB:l}},SetParagraphStyle:function(e,c){c.position>e.position&&(c.position+=e.text.length);return{opSpecsA:[e],opSpecsB:[c]}},SplitParagraph:function(e,c){e.position<c.sourceParagraphPosition&&(c.sourceParagraphPosition+=e.text.length);e.position<=c.position?c.position+=e.text.length:e.position+=1;return{opSpecsA:[e],opSpecsB:[c]}},UpdateMember:t,UpdateMetadata:t,UpdateParagraphStyle:t},MergeParagraph:{MergeParagraph:function(l,k,r){var q=[l],p=[k],n;l.destinationStartPosition===k.destinationStartPosition?(q=[],p=[],l.moveCursor&&(n={optype:"MoveCursor",memberid:l.memberid,timestamp:l.timestamp,position:l.sourceStartPosition-1},q.push(n)),k.moveCursor&&(n={optype:"MoveCursor",memberid:k.memberid,timestamp:k.timestamp,position:k.sourceStartPosition-1},p.push(n)),l=r?l:k,l={optype:"SetParagraphStyle",memberid:l.memberid,timestamp:l.timestamp,position:l.destinationStartPosition,styleName:l.paragraphStyleName},r?q.push(l):p.push(l)):k.sourceStartPosition===l.destinationStartPosition?(l.destinationStartPosition=k.destinationStartPosition,--l.sourceStartPosition,l.paragraphStyleName=k.paragraphStyleName):l.sourceStartPosition===k.destinationStartPosition?(k.destinationStartPosition=l.destinationStartPosition,--k.sourceStartPosition,k.paragraphStyleName=l.paragraphStyleName):l.destinationStartPosition<k.destinationStartPosition?(--k.destinationStartPosition,--k.sourceStartPosition):(--l.destinationStartPosition,--l.sourceStartPosition);return{opSpecsA:q,opSpecsB:p}},MoveCursor:function(k,g){var p=g.position,n=g.position+g.length,l=Math.min(p,n),p=Math.max(p,n);l>=k.sourceStartPosition&&--l;p>=k.sourceStartPosition&&--p;0<=g.length?(g.position=l,g.length=p-l):(g.position=p,g.length=l-p);return{opSpecsA:[k],opSpecsB:[g]}},RemoveAnnotation:function(k,g){var p=g.position+g.length,n=[k],l=[g];g.position<=k.destinationStartPosition&&k.sourceStartPosition<=p?(n=[],--g.length):k.sourceStartPosition<g.position?--g.position:(p<k.destinationStartPosition&&(k.destinationStartPosition-=g.length+2),p<k.sourceStartPosition&&(k.sourceStartPosition-=g.length+2));return{opSpecsA:n,opSpecsB:l}},RemoveCursor:t,RemoveMember:t,RemoveStyle:t,RemoveText:function(e,c){c.position>=e.sourceStartPosition?--c.position:(c.position<e.destinationStartPosition&&(e.destinationStartPosition-=c.length),c.position<e.sourceStartPosition&&(e.sourceStartPosition-=c.length));return{opSpecsA:[e],opSpecsB:[c]}},SetParagraphStyle:function(g,f){var l=[g],k=[f];if(f.position>g.sourceStartPosition){--f.position}else{if(f.position===g.destinationStartPosition||f.position===g.sourceStartPosition){f.position=g.destinationStartPosition,g.paragraphStyleName=f.styleName}}return{opSpecsA:l,opSpecsB:k}},SplitParagraph:function(k,g){var p,n=[k],l=[g];g.position<k.destinationStartPosition?(k.destinationStartPosition+=1,k.sourceStartPosition+=1):g.position>=k.destinationStartPosition&&g.position<k.sourceStartPosition?(g.paragraphStyleName=k.paragraphStyleName,p={optype:"SetParagraphStyle",memberid:k.memberid,timestamp:k.timestamp,position:k.destinationStartPosition,styleName:k.paragraphStyleName},n.push(p),g.position===k.sourceStartPosition-1&&k.moveCursor&&(p={optype:"MoveCursor",memberid:k.memberid,timestamp:k.timestamp,position:g.position,length:0},n.push(p)),k.destinationStartPosition=g.position+1,k.sourceStartPosition+=1):g.position>=k.sourceStartPosition&&(--g.position,--g.sourceParagraphPosition);return{opSpecsA:n,opSpecsB:l}},UpdateMember:t,UpdateMetadata:t,UpdateParagraphStyle:t},MoveCursor:{MoveCursor:t,RemoveAnnotation:function(k,g){var p=m(k),n=k.position+k.length,l=g.position+g.length;g.position<=k.position&&n<=l?(k.position=g.position-1,k.length=0):(l<k.position?k.position-=g.length+2:l<n&&(k.length-=g.length+2),p&&o(k));return{opSpecsA:[k],opSpecsB:[g]}},RemoveCursor:function(e,c){return{opSpecsA:e.memberid===c.memberid?[]:[e],opSpecsB:[c]}},RemoveMember:t,RemoveStyle:t,RemoveText:function(k,g){var p=m(k),n=k.position+k.length,l=g.position+g.length;l<=k.position?k.position-=g.length:g.position<n&&(k.position<g.position?k.length=l<n?k.length-g.length:g.position-k.position:(k.position=g.position,k.length=l<n?n-l:0));p&&o(k);return{opSpecsA:[k],opSpecsB:[g]}},SetParagraphStyle:t,SplitParagraph:function(f,e){var g=m(f);e.position<f.position?f.position+=1:e.position<f.position+f.length&&(f.length+=1);g&&o(f);return{opSpecsA:[f],opSpecsB:[e]}},UpdateMember:t,UpdateMetadata:t,UpdateParagraphStyle:t},RemoveAnnotation:{RemoveAnnotation:function(g,f){var l=[g],k=[f];g.position===f.position&&g.length===f.length?(l=[],k=[]):g.position<f.position?f.position-=g.length+2:g.position-=f.length+2;return{opSpecsA:l,opSpecsB:k}},RemoveCursor:t,RemoveMember:t,RemoveStyle:t,RemoveText:function(l,k){var r=l.position+l.length,q=k.position+k.length,p=[l],n=[k];l.position<=k.position&&q<=r?(n=[],l.length-=k.length):q<l.position?l.position-=k.length:k.position<l.position?(l.position=k.position+1,k.length-=l.length+2):k.position-=l.length+2;return{opSpecsA:p,opSpecsB:n}},SetParagraphStyle:function(l,k){var r=k.position,q=l.position+l.length,p=[l],n=[k];l.position<=r&&r<=q?n=[]:q<r&&(k.position-=l.length+2);return{opSpecsA:p,opSpecsB:n}},SplitParagraph:function(l,k){var r=k.position,q=l.position+l.length,p=[l],n=[k];l.position<=r&&r<=q?(n=[],l.length+=1):(q<k.sourceParagraphPosition&&(k.sourceParagraphPosition-=l.length+2),q<r?k.position-=l.length+2:l.position+=1);return{opSpecsA:p,opSpecsB:n}},UpdateMember:t,UpdateMetadata:t,UpdateParagraphStyle:t},RemoveCursor:{RemoveCursor:function(f,e){var g=f.memberid===e.memberid;return{opSpecsA:g?[]:[f],opSpecsB:g?[]:[e]}},RemoveMember:t,RemoveStyle:t,RemoveText:t,SetParagraphStyle:t,SplitParagraph:t,UpdateMember:t,UpdateMetadata:t,UpdateParagraphStyle:t},RemoveMember:{RemoveStyle:t,RemoveText:t,SetParagraphStyle:t,SplitParagraph:t,UpdateMetadata:t,UpdateParagraphStyle:t},RemoveStyle:{RemoveStyle:function(f,e){var g=f.styleName===e.styleName&&f.styleFamily===e.styleFamily;return{opSpecsA:g?[]:[f],opSpecsB:g?[]:[e]}},RemoveText:t,SetParagraphStyle:function(k,g){var p,n=[k],l=[g];"paragraph"===k.styleFamily&&k.styleName===g.styleName&&(p={optype:"SetParagraphStyle",memberid:k.memberid,timestamp:k.timestamp,position:g.position,styleName:""},n.unshift(p),g.styleName="");return{opSpecsA:n,opSpecsB:l}},SplitParagraph:t,UpdateMember:t,UpdateMetadata:t,UpdateParagraphStyle:function(b,n){var l,k=[b],c=[n];"paragraph"===b.styleFamily&&(l=u(n.setProperties,b.styleName),0<l.length&&(l={optype:"UpdateParagraphStyle",memberid:b.memberid,timestamp:b.timestamp,styleName:n.styleName,removedProperties:{attributes:l.join(",")}},k.unshift(l)),b.styleName===n.styleName?c=[]:v(n.setProperties,b.styleName));return{opSpecsA:k,opSpecsB:c}}},RemoveText:{RemoveText:function(l,k){var r=l.position+l.length,q=k.position+k.length,p=[l],n=[k];q<=l.position?l.position-=k.length:r<=k.position?k.position-=l.length:k.position<r&&(l.position<k.position?(l.length=q<r?l.length-k.length:k.position-l.position,r<q?(k.position=l.position,k.length=q-r):n=[]):(r<q?k.length-=l.length:k.position<l.position?k.length=l.position-k.position:n=[],q<r?(l.position=k.position,l.length=r-q):p=[]));return{opSpecsA:p,opSpecsB:n}},SetParagraphStyle:function(e,c){e.position<c.position&&(c.position-=e.length);return{opSpecsA:[e],opSpecsB:[c]}},SplitParagraph:function(k,g){var p=k.position+k.length,n=[k],l=[g];g.position<=k.position?k.position+=1:g.position<p&&(k.length=g.position-k.position,p={optype:"RemoveText",memberid:k.memberid,timestamp:k.timestamp,position:g.position+1,length:p-g.position},n.unshift(p));k.position+k.length<=g.position?g.position-=k.length:k.position<g.position&&(g.position=k.position);k.position+k.length<g.sourceParagraphPosition&&(g.sourceParagraphPosition-=k.length);return{opSpecsA:n,opSpecsB:l}},UpdateMember:t,UpdateMetadata:t,UpdateParagraphStyle:t},SetParagraphStyle:{SetParagraphStyle:function(f,e,g){f.position===e.position&&(g?e.styleName=f.styleName:f.styleName=e.styleName);return{opSpecsA:[f],opSpecsB:[e]}},SplitParagraph:function(k,f){var p=[k],n=[f],l;k.position>f.position?k.position+=1:k.position===f.sourceParagraphPosition&&(f.paragraphStyleName=k.styleName,l=s(k),l.position=f.position+1,p.push(l));return{opSpecsA:p,opSpecsB:n}},UpdateMember:t,UpdateMetadata:t,UpdateParagraphStyle:t},SplitParagraph:{SplitParagraph:function(k,g,p){var n,l;k.position<g.position?n=!0:g.position<k.position?l=!0:k.position===g.position&&(p?n=!0:l=!0);n?(g.position+=1,g.sourceParagraphPosition=k.position<g.sourceParagraphPosition?g.sourceParagraphPosition+1:k.position+1):l&&(k.position+=1,k.sourceParagraphPosition=g.position<g.sourceParagraphPosition?k.sourceParagraphPosition+1:g.position+1);return{opSpecsA:[k],opSpecsB:[g]}},UpdateMember:t,UpdateMetadata:t,UpdateParagraphStyle:t},UpdateMember:{UpdateMetadata:t,UpdateParagraphStyle:t},UpdateMetadata:{UpdateMetadata:function(l,k,r){var q,p=[l],n=[k];q=r?l:k;l=r?k:l;i(l.setProperties||null,l.removedProperties||null,q.setProperties||null,q.removedProperties||null);q.setProperties&&h(q.setProperties)||q.removedProperties&&a(q.removedProperties)||(r?p=[]:n=[]);l.setProperties&&h(l.setProperties)||l.removedProperties&&a(l.removedProperties)||(r?n=[]:p=[]);return{opSpecsA:p,opSpecsB:n}},UpdateParagraphStyle:t},UpdateParagraphStyle:{UpdateParagraphStyle:function(l,k,r){var q,p=[l],n=[k];l.styleName===k.styleName&&(q=r?l:k,l=r?k:l,d(l.setProperties,l.removedProperties,q.setProperties,q.removedProperties,"style:paragraph-properties"),d(l.setProperties,l.removedProperties,q.setProperties,q.removedProperties,"style:text-properties"),i(l.setProperties||null,l.removedProperties||null,q.setProperties||null,q.removedProperties||null),q.setProperties&&h(q.setProperties)||q.removedProperties&&a(q.removedProperties)||(r?p=[]:n=[]),l.setProperties&&h(l.setProperties)||l.removedProperties&&a(l.removedProperties)||(r?n=[]:p=[]));return{opSpecsA:p,opSpecsB:n}}}};this.passUnchanged=t;this.extendTransformations=function(b){Object.keys(b).forEach(function(g){var n=b[g],l,k=j.hasOwnProperty(g);runtime.log((k?"Extending":"Adding")+" map for optypeA: "+g);k||(j[g]={});l=j[g];Object.keys(n).forEach(function(c){var e=l.hasOwnProperty(c);runtime.assert(g<=c,"Wrong order:"+g+", "+c);runtime.log("  "+(e?"Overwriting":"Adding")+" entry for optypeB: "+c);l[c]=n[c]})})};this.transformOpspecVsOpspec=function(g,f){var l=g.optype<=f.optype,k;runtime.log("Crosstransforming:");runtime.log(runtime.toJson(g));runtime.log(runtime.toJson(f));l||(k=g,g=f,f=k);(k=(k=j[g.optype])&&k[f.optype])?(k=k(g,f,!l),l||null===k||(k={opSpecsA:k.opSpecsB,opSpecsB:k.opSpecsA})):k=null;runtime.log("result:");k?(runtime.log(runtime.toJson(k.opSpecsA)),runtime.log(runtime.toJson(k.opSpecsB))):runtime.log("null");return k}};ops.OperationTransformer=function(){function b(j,d){for(var g,i,h=[],e=[];0<j.length&&d;){g=j.shift();g=a.transformOpspecVsOpspec(g,d);if(!g){return null}h=h.concat(g.opSpecsA);if(0===g.opSpecsB.length){h=h.concat(j);d=null;break}for(;1<g.opSpecsB.length;){i=b(j,g.opSpecsB.shift());if(!i){return null}e=e.concat(i.opSpecsB);j=i.opSpecsA}d=g.opSpecsB.pop()}d&&e.push(d);return{opSpecsA:h,opSpecsB:e}}var a=new ops.OperationTransformMatrix;this.getOperationTransformMatrix=function(){return a};this.transform=function(h,d){for(var g,e=[];0<d.length;){g=b(h,d.shift());if(!g){return null}h=g.opSpecsA;e=e.concat(g.opSpecsB)}return{opSpecsA:h,opSpecsB:e}}};var webodf_css='@namespace draw url(urn:oasis:names:tc:opendocument:xmlns:drawing:1.0);@namespace fo url(urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0);@namespace office url(urn:oasis:names:tc:opendocument:xmlns:office:1.0);@namespace presentation url(urn:oasis:names:tc:opendocument:xmlns:presentation:1.0);@namespace style url(urn:oasis:names:tc:opendocument:xmlns:style:1.0);@namespace svg url(urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0);@namespace table url(urn:oasis:names:tc:opendocument:xmlns:table:1.0);@namespace text url(urn:oasis:names:tc:opendocument:xmlns:text:1.0);@namespace webodfhelper url(urn:webodf:names:helper);@namespace cursor url(urn:webodf:names:cursor);@namespace editinfo url(urn:webodf:names:editinfo);@namespace annotation url(urn:webodf:names:annotation);@namespace dc url(http://purl.org/dc/elements/1.1/);@namespace svgns url(http://www.w3.org/2000/svg);office|document > *, office|document-content > * {display: none;}office|body, office|document {display: inline-block;position: relative;}text|p, text|h {display: block;padding: 0;margin: 0;line-height: normal;position: relative;}text|p::after, text|h::after {content: "\\200B";white-space: pre;}*[webodfhelper|containsparagraphanchor] {position: relative;}text|s {white-space: pre;}text|tab {display: inline;white-space: pre;}text|tracked-changes {display: none;}office|binary-data {display: none;}office|text {display: block;text-align: left;overflow: visible;word-wrap: break-word;}office|text::selection {background: transparent;}.webodf-virtualSelections *::selection {background: transparent;}.webodf-virtualSelections *::-moz-selection {background: transparent;}office|text * draw|text-box {display: block;border: 1px solid #d3d3d3;}office|text draw|frame {z-index: 1;}office|spreadsheet {display: block;border-collapse: collapse;empty-cells: show;font-family: sans-serif;font-size: 10pt;text-align: left;page-break-inside: avoid;overflow: hidden;}office|presentation {display: inline-block;text-align: left;}#shadowContent {display: inline-block;text-align: left;}draw|page {display: block;position: relative;overflow: hidden;}presentation|notes, presentation|footer-decl, presentation|date-time-decl {display: none;}@media print {draw|page {border: 1pt solid black;page-break-inside: avoid;}presentation|notes {}}office|spreadsheet text|p {border: 0px;padding: 1px;margin: 0px;}office|spreadsheet table|table {margin: 3px;}office|spreadsheet table|table:after {}office|spreadsheet table|table-row {counter-increment: row;}office|spreadsheet table|table-row:before {width: 3em;background: #cccccc;border: 1px solid black;text-align: center;content: counter(row);display: table-cell;}office|spreadsheet table|table-cell {border: 1px solid #cccccc;}table|table {display: table;}draw|frame table|table {width: 100%;height: 100%;background: white;}table|table-header-rows {display: table-header-group;}table|table-row {display: table-row;}table|table-column {display: table-column;}table|table-cell {width: 0.889in;display: table-cell;word-break: break-all;}draw|frame {display: block;}draw|image {display: block;width: 100%;height: 100%;top: 0px;left: 0px;background-repeat: no-repeat;background-size: 100% 100%;-moz-background-size: 100% 100%;}draw|frame > draw|image:nth-of-type(n+2) {display: none;}text|list:before {display: none;content:"";}text|list {display: block;}text|list-item {display: block;}text|number {display:none;}text|a {color: blue;text-decoration: underline;cursor: pointer;}.webodf-inactiveLinks text|a {cursor: text;}text|note-citation {vertical-align: super;font-size: smaller;}text|note-body {display: none;}text|note:hover text|note-citation {background: #dddddd;}text|note:hover text|note-body {display: block;left:1em;max-width: 80%;position: absolute;background: #ffffaa;}text|bibliography-source {display: none;}svg|title, svg|desc {display: none;}video {width: 100%;height: 100%}cursor|anchor {display: none;}cursor|cursor {display: none;}.webodf-caretOverlay {position: absolute;top: 5%;height: 1em;z-index: 10;padding-left: 1px;pointer-events: none;}.webodf-caretOverlay .caret {position: absolute;border-left: 2px solid black;top: 0;bottom: 0;right: 0;}.webodf-caretOverlay .handle {position: absolute;margin-top: 5px;padding-top: 3px;margin-left: auto;margin-right: auto;width: 64px;height: 68px;border-radius: 5px;opacity: 0.3;text-align: center;background-color: black;box-shadow: 0px 0px 5px rgb(90, 90, 90);border: 1px solid black;top: -85px;right: -32px;}.webodf-caretOverlay .handle > img {box-shadow: 0px 0px 5px rgb(90, 90, 90) inset;background-color: rgb(200, 200, 200);border-radius: 5px;border: 2px solid;height: 60px;width: 60px;display: block;margin: auto;}.webodf-caretOverlay .handle.active {opacity: 0.8;}.webodf-caretOverlay .handle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 43%;}.webodf-caretSizer {display: inline-block;width: 0;visibility: hidden;}#eventTrap {display: block;position: absolute;bottom: 0;left: 0;outline: none;opacity: 0;color: rgba(255, 255, 255, 0);pointer-events: none;white-space: pre;overflow: hidden;}cursor|cursor > #composer {text-decoration: underline;}cursor|cursor[cursor|caret-sizer-active="true"],cursor|cursor[cursor|composing="true"] {display: inline;}editinfo|editinfo {display: inline-block;}.editInfoMarker {position: absolute;width: 10px;height: 100%;left: -20px;opacity: 0.8;top: 0;border-radius: 5px;background-color: transparent;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);}.editInfoMarker:hover {box-shadow: 0px 0px 8px rgba(0, 0, 0, 1);}.editInfoHandle {position: absolute;background-color: black;padding: 5px;border-radius: 5px;opacity: 0.8;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);bottom: 100%;margin-bottom: 10px;z-index: 3;left: -25px;}.editInfoHandle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 5px;}.editInfo {font-family: sans-serif;font-weight: normal;font-style: normal;text-decoration: none;color: white;width: 100%;height: 12pt;}.editInfoColor {float: left;width: 10pt;height: 10pt;border: 1px solid white;}.editInfoAuthor {float: left;margin-left: 5pt;font-size: 10pt;text-align: left;height: 12pt;line-height: 12pt;}.editInfoTime {float: right;margin-left: 30pt;font-size: 8pt;font-style: italic;color: yellow;height: 12pt;line-height: 12pt;}.annotationWrapper {display: inline;position: relative;}.annotationRemoveButton:before {content: "\u00d7";color: white;padding: 5px;line-height: 1em;}.annotationRemoveButton {width: 20px;height: 20px;border-radius: 10px;background-color: black;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);position: absolute;top: -10px;left: -10px;z-index: 3;text-align: center;font-family: sans-serif;font-style: normal;font-weight: normal;text-decoration: none;font-size: 15px;}.annotationRemoveButton:hover {cursor: pointer;box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);}.annotationNote {width: 4cm;position: absolute;display: inline;z-index: 10;top: 0;}.annotationNote > office|annotation {display: block;text-align: left;}.annotationConnector {position: absolute;display: inline;top: 0;z-index: 2;border-top: 1px dashed brown;}.annotationConnector.angular {-moz-transform-origin: left top;-webkit-transform-origin: left top;-ms-transform-origin: left top;transform-origin: left top;}.annotationConnector.horizontal {left: 0;}.annotationConnector.horizontal:before {content: "";display: inline;position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: brown transparent transparent transparent;top: -1px;left: -5px;}office|annotation {width: 100%;height: 100%;display: none;background: rgb(198, 238, 184);background: -moz-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -webkit-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -o-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -ms-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: linear-gradient(180deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);box-shadow: 0 3px 4px -3px #ccc;}office|annotation > dc|creator {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;color: white;background-color: brown;padding: 4px;}office|annotation > dc|date {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;border: 4px solid transparent;color: black;}office|annotation > text|list {display: block;padding: 5px;}office|annotation text|p {font-size: 10pt;color: black;font-weight: normal;font-style: normal;text-decoration: none;font-family: sans-serif;}#annotationsPane {background-color: #EAEAEA;width: 4cm;height: 100%;display: none;position: absolute;outline: 1px solid #ccc;}.webodf-annotationHighlight {background-color: yellow;position: relative;}.webodf-selectionOverlay {position: absolute;pointer-events: none;top: 0;left: 0;top: 0;left: 0;width: 100%;height: 100%;z-index: 15;}.webodf-selectionOverlay > polygon {fill-opacity: 0.3;stroke-opacity: 0.8;stroke-width: 1;fill-rule: evenodd;}.webodf-selectionOverlay > .webodf-draggable {fill-opacity: 0.8;stroke-opacity: 0;stroke-width: 8;pointer-events: all;display: none;-moz-transform-origin: center center;-webkit-transform-origin: center center;-ms-transform-origin: center center;transform-origin: center center;}#imageSelector {display: none;position: absolute;border-style: solid;border-color: black;}#imageSelector > div {width: 5px;height: 5px;display: block;position: absolute;border: 1px solid black;background-color: #ffffff;}#imageSelector > .topLeft {top: -4px;left: -4px;}#imageSelector > .topRight {top: -4px;right: -4px;}#imageSelector > .bottomRight {right: -4px;bottom: -4px;}#imageSelector > .bottomLeft {bottom: -4px;left: -4px;}#imageSelector > .topMiddle {top: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .rightMiddle {top: 50%;right: -4px;margin-top: -2.5px;}#imageSelector > .bottomMiddle {bottom: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .leftMiddle {top: 50%;left: -4px;margin-top: -2.5px;}div.webodf-customScrollbars::-webkit-scrollbar{width: 8px;height: 8px;background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-track{background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-thumb{background-color: #444;border-radius: 4px;}.webodf-hyperlinkTooltip {display: none;color: white;background-color: black;border-radius: 5px;box-shadow: 2px 2px 5px gray;padding: 3px;position: absolute;max-width: 210px;text-align: left;word-break: break-all;z-index: 16;}.webodf-hyperlinkTooltipText {display: block;font-weight: bold;}';!function(c){var b=typeof window!=="undefined"?window:typeof global!=="undefined"?global:{},a=b.externs||(b.externs={});a.JSZip=c()}(function(){var d,b,a;return function c(f,k,h){function g(n,l){if(!k[n]){if(!f[n]){var i=typeof require=="function"&&require;if(!l&&i){return i(n,!0)}if(e){return e(n,!0)}throw new Error("Cannot find module '"+n+"'")}var m=k[n]={exports:{}};f[n][0].call(m.exports,function(o){var p=f[n][1][o];return g(p?p:o)},m,m.exports,c,f,k,h)}return k[n].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g}({1:[function(h,g,e){var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.encode=function(m,l){var j="";var t,r,p,s,q,o,n;var k=0;while(k<m.length){t=m.charCodeAt(k++);r=m.charCodeAt(k++);p=m.charCodeAt(k++);s=t>>2;q=(t&3)<<4|r>>4;o=(r&15)<<2|p>>6;n=p&63;if(isNaN(r)){o=n=64}else{if(isNaN(p)){n=64}}j=j+f.charAt(s)+f.charAt(q)+f.charAt(o)+f.charAt(n)}return j};e.decode=function(m,l){var j="";var t,r,p;var s,q,o,n;var k=0;m=m.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(k<m.length){s=f.indexOf(m.charAt(k++));q=f.indexOf(m.charAt(k++));o=f.indexOf(m.charAt(k++));n=f.indexOf(m.charAt(k++));t=s<<2|q>>4;r=(q&15)<<4|o>>2;p=(o&3)<<6|n;j=j+String.fromCharCode(t);if(o!=64){j=j+String.fromCharCode(r)}if(n!=64){j=j+String.fromCharCode(p)}}return j}},{}],2:[function(h,f,e){function g(){this.compressedSize=0;this.uncompressedSize=0;this.crc32=0;this.compressionMethod=null;this.compressedContent=null}g.prototype={getContent:function(){return null},getCompressedContent:function(){return null}};f.exports=g},{}],3:[function(g,f,e){e.STORE={magic:"\x00\x00",compress:function(h){return h},uncompress:function(h){return h},compressInputType:null,uncompressInputType:null};e.DEFLATE=g("./flate")},{"./flate":8}],4:[function(j,g,f){var e=j("./utils");var i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918000,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];g.exports=function h(n,p){if(typeof n==="undefined"||!n.length){return 0}var m=e.getTypeOf(n)!=="string";if(typeof p=="undefined"){p=0}var l=0;var r=0;var k=0;p=p^-1;for(var o=0,q=n.length;o<q;o++){k=m?n[o]:n.charCodeAt(o);r=(p^k)&255;l=i[r];p=p>>>8^l}return p^-1}},{"./utils":21}],5:[function(h,g,f){var e=h("./utils");function i(j){this.data=null;this.length=0;this.index=0}i.prototype={checkOffset:function(j){this.checkIndex(this.index+j)},checkIndex:function(j){if(this.length<j||j<0){throw new Error("End of data reached (data length = "+this.length+", asked index = "+j+"). Corrupted zip ?")}},setIndex:function(j){this.checkIndex(j);this.index=j},skip:function(j){this.setIndex(this.index+j)},byteAt:function(j){},readInt:function(l){var j=0,k;this.checkOffset(l);for(k=this.index+l-1;k>=this.index;k--){j=(j<<8)+this.byteAt(k)}this.index+=l;return j},readString:function(j){return e.transformTo("string",this.readData(j))},readData:function(j){},lastIndexOfSignature:function(j){},readDate:function(){var j=this.readInt(4);return new Date((j>>25&127)+1980,(j>>21&15)-1,j>>16&31,j>>11&31,j>>5&63,(j&31)<<1)}};g.exports=i},{"./utils":21}],6:[function(g,f,e){e.base64=false;e.binary=false;e.dir=false;e.createFolders=false;e.date=null;e.compression=null;e.comment=null},{}],7:[function(h,g,f){var e=h("./utils");f.string2binary=function(i){return e.string2binary(i)};f.string2Uint8Array=function(i){return e.transformTo("uint8array",i)};f.uint8Array2String=function(i){return e.transformTo("string",i)};f.string2Blob=function(j){var i=e.transformTo("arraybuffer",j);return e.arrayBuffer2Blob(i)};f.arrayBuffer2Blob=function(i){return e.arrayBuffer2Blob(i)};f.transformTo=function(j,i){return e.transformTo(j,i)};f.getTypeOf=function(i){return e.getTypeOf(i)};f.checkSupport=function(i){return e.checkSupport(i)};f.MAX_VALUE_16BITS=e.MAX_VALUE_16BITS;f.MAX_VALUE_32BITS=e.MAX_VALUE_32BITS;f.pretty=function(i){return e.pretty(i)};f.findCompression=function(i){return e.findCompression(i)};f.isRegExp=function(i){return e.isRegExp(i)}},{"./utils":21}],8:[function(i,g,e){var f=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Uint32Array!=="undefined";var h=i("pako");e.uncompressInputType=f?"uint8array":"array";e.compressInputType=f?"uint8array":"array";e.magic="\b\x00";e.compress=function(j){return h.deflateRaw(j)};e.uncompress=function(j){return h.inflateRaw(j)}},{pako:24}],9:[function(h,g,f){var e=h("./base64");function i(k,j){if(!(this instanceof i)){return new i(k,j)}this.files={};this.comment=null;this.root="";if(k){this.load(k,j)}this.clone=function(){var l=new i;for(var m in this){if(typeof this[m]!=="function"){l[m]=this[m]}}return l}}i.prototype=h("./object");i.prototype.load=h("./load");i.support=h("./support");i.defaults=h("./defaults");i.utils=h("./deprecatedPublicUtils");i.base64={encode:function(j){return e.encode(j)},decode:function(j){return e.decode(j)}};i.compressions=h("./compressions");g.exports=i},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(i,h,g){var f=i("./base64");var e=i("./zipEntries");h.exports=function(o,k){var n,m,l,j;k=k||{};if(k.base64){o=f.decode(o)}m=new e(o,k);n=m.files;for(l=0;l<n.length;l++){j=n[l];this.file(j.fileName,j.decompressed,{binary:true,optimizedBinaryString:true,date:j.date,dir:j.dir,comment:j.fileComment.length?j.fileComment:null,createFolders:k.createFolders})}if(m.zipComment.length){this.comment=m.zipComment}return this}},{"./base64":1,"./zipEntries":22}],11:[function(g,f,e){(function(h){f.exports=function(j,i){return new h(j,i)};f.exports.test=function(i){return h.isBuffer(i)}}).call(this,typeof Buffer!=="undefined"?Buffer:undefined)},{}],12:[function(h,g,f){var e=h("./uint8ArrayReader");function i(j){this.data=j;this.length=this.data.length;this.index=0}i.prototype=new e;i.prototype.readData=function(k){this.checkOffset(k);var j=this.data.slice(this.index,this.index+k);this.index+=k;return j};g.exports=i},{"./uint8ArrayReader":18}],13:[function(l,g,F){var r=l("./support");var C=l("./utils");var j=l("./crc32");var u=l("./signature");var q=l("./defaults");var f=l("./base64");var y=l("./compressions");var i=l("./compressedObject");var s=l("./nodeBuffer");var h=l("./utf8");var k=l("./stringWriter");var o=l("./uint8ArrayWriter");var B=function(G){if(G._data instanceof i){G._data=G._data.getContent();G.options.binary=true;G.options.base64=false;if(C.getTypeOf(G._data)==="uint8array"){var H=G._data;G._data=new Uint8Array(H.length);if(H.length!==0){G._data.set(H,0)}}}return G._data};var E=function(H){var G=B(H),I=C.getTypeOf(G);if(I==="string"){if(!H.options.binary){if(r.nodebuffer){return s(G,"utf-8")}}return H.asBinary()}return G};var n=function(H){var G=B(this);if(G===null||typeof G==="undefined"){return""}if(this.options.base64){G=f.decode(G)}if(H&&this.options.binary){G=w.utf8decode(G)}else{G=C.transformTo("string",G)}if(!H&&!this.options.binary){G=C.transformTo("string",w.utf8encode(G))}return G};var p=function(H,I,G){this.name=H;this.dir=G.dir;this.date=G.date;this.comment=G.comment;this._data=I;this.options=G;this._initialMetadata={dir:G.dir,date:G.date}};p.prototype={asText:function(){return n.call(this,true)},asBinary:function(){return n.call(this,false)},asNodeBuffer:function(){var G=E(this);return C.transformTo("nodebuffer",G)},asUint8Array:function(){var G=E(this);return C.transformTo("uint8array",G)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var e=function(J,G){var I="",H;for(H=0;H<G;H++){I+=String.fromCharCode(J&255);J=J>>>8}return I};var A=function(){var H={},I,G;for(I=0;I<arguments.length;I++){for(G in arguments[I]){if(arguments[I].hasOwnProperty(G)&&typeof H[G]==="undefined"){H[G]=arguments[I][G]}}}return H};var m=function(G){G=G||{};if(G.base64===true&&(G.binary===null||G.binary===undefined)){G.binary=true}G=A(G,q);G.date=G.date||new Date;if(G.compression!==null){G.compression=G.compression.toUpperCase()}return G};var x=function(I,K,L){var G=C.getTypeOf(K),J;L=m(L);if(L.createFolders&&(J=z(I))){D.call(this,J,true)}if(L.dir||K===null||typeof K==="undefined"){L.base64=false;L.binary=false;K=null}else{if(G==="string"){if(L.binary&&!L.base64){if(L.optimizedBinaryString!==true){K=C.string2binary(K)}}}else{L.base64=false;L.binary=true;if(!G&&!(K instanceof i)){throw new Error("The data of '"+I+"' is in an unsupported format !")}if(G==="arraybuffer"){K=C.transformTo("uint8array",K)}}}var H=new p(I,K,L);this.files[I]=H;return H};var z=function(H){if(H.slice(-1)=="/"){H=H.substring(0,H.length-1)}var G=H.lastIndexOf("/");return G>0?H.substring(0,G):""};var D=function(G,H){if(G.slice(-1)!="/"){G+="/"}H=typeof H!=="undefined"?H:false;if(!this.files[G]){x.call(this,G,null,{dir:true,createFolders:H})}return this.files[G]};var t=function(I,H){var G=new i,J;if(I._data instanceof i){G.uncompressedSize=I._data.uncompressedSize;G.crc32=I._data.crc32;if(G.uncompressedSize===0||I.dir){H=y.STORE;G.compressedContent="";G.crc32=0}else{if(I._data.compressionMethod===H.magic){G.compressedContent=I._data.getCompressedContent()}else{J=I._data.getContent();G.compressedContent=H.compress(C.transformTo(H.compressInputType,J))}}}else{J=E(I);if(!J||J.length===0||I.dir){H=y.STORE;J=""}G.uncompressedSize=J.length;G.crc32=j(J);G.compressedContent=H.compress(C.transformTo(H.compressInputType,J))}G.compressedSize=G.compressedContent.length;G.compressionMethod=H.magic;return G};var v=function(aa,V,I,L){var Z=I.compressedContent,G=C.transformTo("string",h.utf8encode(V.name)),H=V.comment||"",K=C.transformTo("string",h.utf8encode(H)),Y=G.length!==V.name.length,W=K.length!==H.length,P=V.options,J,T,N="",X="",M="",O,U;if(V._initialMetadata.dir!==V.dir){O=V.dir}else{O=P.dir}if(V._initialMetadata.date!==V.date){U=V.date}else{U=P.date}J=U.getHours();J=J<<6;J=J|U.getMinutes();J=J<<5;J=J|U.getSeconds()/2;T=U.getFullYear()-1980;T=T<<4;T=T|U.getMonth()+1;T=T<<5;T=T|U.getDate();if(Y){X=e(1,1)+e(j(G),4)+G;N+="up"+e(X.length,2)+X}if(W){M=e(1,1)+e(this.crc32(K),4)+K;N+="uc"+e(M.length,2)+M}var S="";S+="\n\x00";S+=Y||W?"\x00\b":"\x00\x00";S+=I.compressionMethod;S+=e(J,2);S+=e(T,2);S+=e(I.crc32,4);S+=e(I.compressedSize,4);S+=e(I.uncompressedSize,4);S+=e(G.length,2);S+=e(N.length,2);var R=u.LOCAL_FILE_HEADER+S+G+N;var Q=u.CENTRAL_FILE_HEADER+"\u0014\x00"+S+e(K.length,2)+"\x00\x00\x00\x00"+(O===true?"\u0010\x00\x00\x00":"\x00\x00\x00\x00")+e(L,4)+G+N+K;return{fileRecord:R,dirRecord:Q,compressedObject:I}};var w={load:function(H,G){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(L){var G=[],I,H,K,J;for(I in this.files){if(!this.files.hasOwnProperty(I)){continue}K=this.files[I];J=new p(K.name,K._data,A(K.options));H=I.slice(this.root.length,I.length);if(I.slice(0,this.root.length)===this.root&&L(H,J)){G.push(J)}}return G},file:function(G,I,J){if(arguments.length===1){if(C.isRegExp(G)){var H=G;return this.filter(function(K,L){return !L.dir&&H.test(K)})}else{return this.filter(function(K,L){return !L.dir&&K===G})[0]||null}}else{G=this.root+G;x.call(this,G,I,J)}return this},folder:function(G){if(!G){return this}if(C.isRegExp(G)){return this.filter(function(K,L){return L.dir&&G.test(K)})}var I=this.root+G;var J=D.call(this,I);var H=this.clone();H.root=J.name;return H},remove:function(H){H=this.root+H;var J=this.files[H];if(!J){if(H.slice(-1)!="/"){H+="/"}J=this.files[H]}if(J&&!J.dir){delete this.files[H]}else{var G=this.filter(function(K,L){return L.name.slice(0,H.length)===H});for(var I=0;I<G.length;I++){delete this.files[G[I].name]}}return this},generate:function(V){V=A(V||{},{base64:true,compression:"STORE",type:"base64",comment:null});C.checkSupport(V.type);var N=[],O=0,J=0,M,Q,P=C.transformTo("string",this.utf8encode(V.comment||this.comment||""));for(var H in this.files){if(!this.files.hasOwnProperty(H)){continue}var L=this.files[H];var R=L.options.compression||V.compression.toUpperCase();var U=y[R];if(!U){throw new Error(R+" is not a valid compression method !")}var S=t.call(this,L,U);var G=v.call(this,H,L,S,O);O+=G.fileRecord.length+S.compressedSize;J+=G.dirRecord.length;N.push(G)}var K="";K=u.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+e(N.length,2)+e(N.length,2)+e(J,4)+e(O,4)+e(P.length,2)+P;var T=V.type.toLowerCase();if(T==="uint8array"||T==="arraybuffer"||T==="blob"||T==="nodebuffer"){M=new o(O+J+K.length)}else{M=new k(O+J+K.length)}for(Q=0;Q<N.length;Q++){M.append(N[Q].fileRecord);M.append(N[Q].compressedObject.compressedContent)}for(Q=0;Q<N.length;Q++){M.append(N[Q].dirRecord)}M.append(K);var I=M.finalize();switch(V.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return C.transformTo(V.type.toLowerCase(),I);case"blob":return C.arrayBuffer2Blob(C.transformTo("arraybuffer",I));case"base64":return V.base64?f.encode(I):I;default:return I}},crc32:function(G,H){return j(G,H)},utf8encode:function(G){return C.transformTo("string",h.utf8encode(G))},utf8decode:function(G){return h.utf8decode(G)}};g.exports=w},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(g,f,e){e.LOCAL_FILE_HEADER="PK\u0003\u0004";e.CENTRAL_FILE_HEADER="PK\u0001\u0002";e.CENTRAL_DIRECTORY_END="PK\u0005\u0006";e.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\u0006\u0007";e.ZIP64_CENTRAL_DIRECTORY_END="PK\u0006\u0006";e.DATA_DESCRIPTOR="PK\u0007\b"},{}],15:[function(h,g,f){var j=h("./dataReader");var e=h("./utils");function i(l,k){this.data=l;if(!k){this.data=e.string2binary(this.data)}this.length=this.data.length;this.index=0}i.prototype=new j;i.prototype.byteAt=function(k){return this.data.charCodeAt(k)};i.prototype.lastIndexOfSignature=function(k){return this.data.lastIndexOf(k)};i.prototype.readData=function(l){this.checkOffset(l);var k=this.data.slice(this.index,this.index+l);this.index+=l;return k};g.exports=i},{"./dataReader":5,"./utils":21}],16:[function(i,h,f){var e=i("./utils");var g=function(){this.data=[]};g.prototype={append:function(j){j=e.transformTo("string",j);this.data.push(j)},finalize:function(){return this.data.join("")}};h.exports=g},{"./utils":21}],17:[function(g,f,e){(function(l){e.base64=true;e.array=true;e.string=true;e.arraybuffer=typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined";e.nodebuffer=typeof l!=="undefined";e.uint8array=typeof Uint8Array!=="undefined";if(typeof ArrayBuffer==="undefined"){e.blob=false}else{var h=new ArrayBuffer(0);try{e.blob=(new Blob([h],{type:"application/zip"})).size===0}catch(j){try{var k=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;var i=new k;i.append(h);e.blob=i.getBlob("application/zip").size===0}catch(j){e.blob=false}}}}).call(this,typeof Buffer!=="undefined"?Buffer:undefined)},{}],18:[function(h,g,f){var i=h("./dataReader");function e(j){if(j){this.data=j;this.length=this.data.length;this.index=0}}e.prototype=new i;e.prototype.byteAt=function(j){return this.data[j]};e.prototype.lastIndexOfSignature=function(o){var n=o.charCodeAt(0),m=o.charCodeAt(1),l=o.charCodeAt(2),k=o.charCodeAt(3);for(var j=this.length-4;j>=0;--j){if(this.data[j]===n&&this.data[j+1]===m&&this.data[j+2]===l&&this.data[j+3]===k){return j}}return -1};e.prototype.readData=function(k){this.checkOffset(k);if(k===0){return new Uint8Array(0)}var j=this.data.subarray(this.index,this.index+k);this.index+=k;return j};g.exports=e},{"./dataReader":5}],19:[function(h,g,f){var e=h("./utils");var i=function(j){this.data=new Uint8Array(j);this.index=0};i.prototype={append:function(j){if(j.length!==0){j=e.transformTo("uint8array",j);this.data.set(j,this.index);this.index+=j.length}},finalize:function(){return this.data}};g.exports=i},{"./utils":21}],20:[function(e,f,k){var p=e("./utils");var q=e("./support");var n=e("./nodeBuffer");var j=new Array(256);for(var l=0;l<256;l++){j[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1}j[254]=j[254]=1;var r=function(y){var s,z,u,v,t,x=y.length,w=0;for(v=0;v<x;v++){z=y.charCodeAt(v);if((z&64512)===55296&&v+1<x){u=y.charCodeAt(v+1);if((u&64512)===56320){z=65536+(z-55296<<10)+(u-56320);v++}}w+=z<128?1:z<2048?2:z<65536?3:4}if(q.uint8array){s=new Uint8Array(w)}else{s=new Array(w)}for(t=0,v=0;t<w;v++){z=y.charCodeAt(v);if((z&64512)===55296&&v+1<x){u=y.charCodeAt(v+1);if((u&64512)===56320){z=65536+(z-55296<<10)+(u-56320);v++}}if(z<128){s[t++]=z}else{if(z<2048){s[t++]=192|z>>>6;s[t++]=128|z&63}else{if(z<65536){s[t++]=224|z>>>12;s[t++]=128|z>>>6&63;s[t++]=128|z&63}else{s[t++]=240|z>>>18;s[t++]=128|z>>>12&63;s[t++]=128|z>>>6&63;s[t++]=128|z&63}}}}return s};var m=function(s,i){var t;i=i||s.length;if(i>s.length){i=s.length}t=i-1;while(t>=0&&(s[t]&192)===128){t--}if(t<0){return i}if(t===0){return i}return t+j[s[t]]>i?t:i};var h=function(w){var y,x,v,z,u;var t=w.length;var s=new Array(t*2);for(v=0,x=0;x<t;){z=w[x++];if(z<128){s[v++]=z;continue}u=j[z];if(u>4){s[v++]=65533;x+=u-1;continue}z&=u===2?31:u===3?15:7;while(u>1&&x<t){z=z<<6|w[x++]&63;u--}if(u>1){s[v++]=65533;continue}if(z<65536){s[v++]=z}else{z-=65536;s[v++]=55296|z>>10&1023;s[v++]=56320|z&1023}}if(s.length!==v){if(s.subarray){s=s.subarray(0,v)}else{s.length=v}}return p.applyFromCharCode(s)};k.utf8encode=function o(i){if(q.nodebuffer){return n(i,"utf-8")}return r(i)};k.utf8decode=function g(v){if(q.nodebuffer){return p.transformTo("nodebuffer",v).toString("utf-8")}v=p.transformTo(q.uint8array?"uint8array":"array",v);var s=[],t=0,i=v.length,u=65536;while(t<i){var w=m(v,Math.min(t+u,i));if(q.uint8array){s.push(h(v.subarray(t,w)))}else{s.push(h(v.slice(t,w)))}t=w}return s.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(e,f,h){var m=e("./support");var l=e("./compressions");var j=e("./nodeBuffer");h.string2binary=function(r){var p="";for(var q=0;q<r.length;q++){p+=String.fromCharCode(r.charCodeAt(q)&255)}return p};h.arrayBuffer2Blob=function(p){h.checkSupport("blob");try{return new Blob([p],{type:"application/zip"})}catch(r){try{var s=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;var q=new s;q.append(p);return q.getBlob("application/zip")}catch(r){throw new Error("Bug : can't construct the Blob.")}}};function k(p){return p}function o(q,r){for(var p=0;p<q.length;++p){r[p]=q.charCodeAt(p)&255}return r}function n(t){var x=65536;var y=[],s=t.length,w=h.getTypeOf(t),q=0,p=true;try{switch(w){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,j(0));break}}catch(u){p=false}if(!p){var v="";for(var r=0;r<t.length;r++){v+=String.fromCharCode(t[r])}return v}while(q<s&&x>1){try{if(w==="array"||w==="nodebuffer"){y.push(String.fromCharCode.apply(null,t.slice(q,Math.min(q+x,s))))}else{y.push(String.fromCharCode.apply(null,t.subarray(q,Math.min(q+x,s))))}q+=x}catch(u){x=Math.floor(x/2)}}return y.join("")}h.applyFromCharCode=n;function i(q,r){for(var p=0;p<q.length;p++){r[p]=q[p]}return r}var g={};g.string={string:k,array:function(p){return o(p,new Array(p.length))},arraybuffer:function(p){return g.string["uint8array"](p).buffer},uint8array:function(p){return o(p,new Uint8Array(p.length))},nodebuffer:function(p){return o(p,j(p.length))}};g.array={string:n,array:k,arraybuffer:function(p){return(new Uint8Array(p)).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return j(p)}};g.arraybuffer={string:function(p){return n(new Uint8Array(p))},array:function(p){return i(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:k,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return j(new Uint8Array(p))}};g.uint8array={string:n,array:function(p){return i(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:k,nodebuffer:function(p){return j(p)}};g.nodebuffer={string:n,array:function(p){return i(p,new Array(p.length))},arraybuffer:function(p){return g.nodebuffer["uint8array"](p).buffer},uint8array:function(p){return i(p,new Uint8Array(p.length))},nodebuffer:k};h.transformTo=function(s,q){if(!q){q=""}if(!s){return q}h.checkSupport(s);var r=h.getTypeOf(q);var p=g[r][s](q);return p};h.getTypeOf=function(p){if(typeof p==="string"){return"string"}if(Object.prototype.toString.call(p)==="[object Array]"){return"array"}if(m.nodebuffer&&j.test(p)){return"nodebuffer"}if(m.uint8array&&p instanceof Uint8Array){return"uint8array"}if(m.arraybuffer&&p instanceof ArrayBuffer){return"arraybuffer"}};h.checkSupport=function(q){var p=m[q.toLowerCase()];if(!p){throw new Error(q+" is not supported by this browser")}};h.MAX_VALUE_16BITS=65535;h.MAX_VALUE_32BITS=-1;h.pretty=function(s){var q="",r,p;for(p=0;p<(s||"").length;p++){r=s.charCodeAt(p);q+="\\x"+(r<16?"0":"")+r.toString(16).toUpperCase()}return q};h.findCompression=function(p){for(var q in l){if(!l.hasOwnProperty(q)){continue}if(l[q].magic===p){return l[q]}}return null};h.isRegExp=function(p){return Object.prototype.toString.call(p)==="[object RegExp]"}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(f,g,j){var h=f("./stringReader");var e=f("./nodeBufferReader");var l=f("./uint8ArrayReader");var m=f("./utils");var p=f("./signature");var k=f("./zipEntry");var n=f("./support");var o=f("./object");function i(r,q){this.files=[];this.loadOptions=q;if(r){this.load(r)}}i.prototype={checkSignature:function(r){var q=this.reader.readString(4);if(q!==r){throw new Error("Corrupted zip or bug : unexpected signature ("+m.pretty(q)+", expected "+m.pretty(r)+")")}},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2);this.diskWithCentralDirStart=this.reader.readInt(2);this.centralDirRecordsOnThisDisk=this.reader.readInt(2);this.centralDirRecords=this.reader.readInt(2);this.centralDirSize=this.reader.readInt(4);this.centralDirOffset=this.reader.readInt(4);this.zipCommentLength=this.reader.readInt(2);this.zipComment=this.reader.readString(this.zipCommentLength);this.zipComment=o.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8);this.versionMadeBy=this.reader.readString(2);this.versionNeeded=this.reader.readInt(2);this.diskNumber=this.reader.readInt(4);this.diskWithCentralDirStart=this.reader.readInt(4);this.centralDirRecordsOnThisDisk=this.reader.readInt(8);this.centralDirRecords=this.reader.readInt(8);this.centralDirSize=this.reader.readInt(8);this.centralDirOffset=this.reader.readInt(8);this.zip64ExtensibleData={};var u=this.zip64EndOfCentralSize-44,r=0,s,t,q;while(r<u){s=this.reader.readInt(2);t=this.reader.readInt(4);q=this.reader.readString(t);this.zip64ExtensibleData[s]={id:s,length:t,value:q}}},readBlockZip64EndOfCentralLocator:function(){this.diskWithZip64CentralDirStart=this.reader.readInt(4);this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8);this.disksCount=this.reader.readInt(4);if(this.disksCount>1){throw new Error("Multi-volumes zip are not supported")}},readLocalFiles:function(){var r,q;for(r=0;r<this.files.length;r++){q=this.files[r];this.reader.setIndex(q.localHeaderOffset);this.checkSignature(p.LOCAL_FILE_HEADER);q.readLocalPart(this.reader);q.handleUTF8()}},readCentralDir:function(){var q;this.reader.setIndex(this.centralDirOffset);while(this.reader.readString(4)===p.CENTRAL_FILE_HEADER){q=new k({zip64:this.zip64},this.loadOptions);q.readCentralPart(this.reader);this.files.push(q)}},readEndOfCentral:function(){var q=this.reader.lastIndexOfSignature(p.CENTRAL_DIRECTORY_END);if(q===-1){throw new Error("Corrupted zip : can't find end of central directory")}this.reader.setIndex(q);this.checkSignature(p.CENTRAL_DIRECTORY_END);this.readBlockEndOfCentral();if(this.diskNumber===m.MAX_VALUE_16BITS||this.diskWithCentralDirStart===m.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===m.MAX_VALUE_16BITS||this.centralDirRecords===m.MAX_VALUE_16BITS||this.centralDirSize===m.MAX_VALUE_32BITS||this.centralDirOffset===m.MAX_VALUE_32BITS){this.zip64=true;q=this.reader.lastIndexOfSignature(p.ZIP64_CENTRAL_DIRECTORY_LOCATOR);if(q===-1){throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator")}this.reader.setIndex(q);this.checkSignature(p.ZIP64_CENTRAL_DIRECTORY_LOCATOR);this.readBlockZip64EndOfCentralLocator();this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);this.checkSignature(p.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral()}},prepareReader:function(r){var q=m.getTypeOf(r);if(q==="string"&&!n.uint8array){this.reader=new h(r,this.loadOptions.optimizedBinaryString)}else{if(q==="nodebuffer"){this.reader=new e(r)}else{this.reader=new l(m.transformTo("uint8array",r))}}},load:function(q){this.prepareReader(q);this.readEndOfCentral();this.readCentralDir();this.readLocalFiles()}};g.exports=i},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(i,g,f){var k=i("./stringReader");var e=i("./utils");var h=i("./compressedObject");var j=i("./object");function l(m,n){this.options=m;this.loadOptions=n}l.prototype={isEncrypted:function(){return(this.bitFlag&1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},prepareCompressedContent:function(m,o,n){return function(){var q=m.index;m.setIndex(o);var p=m.readData(n);m.setIndex(q);return p}},prepareContent:function(m,q,p,o,n){return function(){var r=e.transformTo(o.uncompressInputType,this.getCompressedContent());var s=o.uncompress(r);if(s.length!==n){throw new Error("Bug : uncompressed data size mismatch")}return s}},readLocalPart:function(m){var n,o;m.skip(22);this.fileNameLength=m.readInt(2);o=m.readInt(2);this.fileName=m.readString(this.fileNameLength);m.skip(o);if(this.compressedSize==-1||this.uncompressedSize==-1){throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)")}n=e.findCompression(this.compressionMethod);if(n===null){throw new Error("Corrupted zip : compression "+e.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")")}this.decompressed=new h;this.decompressed.compressedSize=this.compressedSize;this.decompressed.uncompressedSize=this.uncompressedSize;this.decompressed.crc32=this.crc32;this.decompressed.compressionMethod=this.compressionMethod;this.decompressed.getCompressedContent=this.prepareCompressedContent(m,m.index,this.compressedSize,n);this.decompressed.getContent=this.prepareContent(m,m.index,this.compressedSize,n,this.uncompressedSize);if(this.loadOptions.checkCRC32){this.decompressed=e.transformTo("string",this.decompressed.getContent());if(j.crc32(this.decompressed)!==this.crc32){throw new Error("Corrupted zip : CRC32 mismatch")}}},readCentralPart:function(m){this.versionMadeBy=m.readString(2);this.versionNeeded=m.readInt(2);this.bitFlag=m.readInt(2);this.compressionMethod=m.readString(2);this.date=m.readDate();this.crc32=m.readInt(4);this.compressedSize=m.readInt(4);this.uncompressedSize=m.readInt(4);this.fileNameLength=m.readInt(2);this.extraFieldsLength=m.readInt(2);this.fileCommentLength=m.readInt(2);this.diskNumberStart=m.readInt(2);this.internalFileAttributes=m.readInt(2);this.externalFileAttributes=m.readInt(4);this.localHeaderOffset=m.readInt(4);if(this.isEncrypted()){throw new Error("Encrypted zip are not supported")}this.fileName=m.readString(this.fileNameLength);this.readExtraFields(m);this.parseZIP64ExtraField(m);this.fileComment=m.readString(this.fileCommentLength);this.dir=this.externalFileAttributes&16?true:false},parseZIP64ExtraField:function(m){if(!this.extraFields[1]){return}var n=new k(this.extraFields[1].value);if(this.uncompressedSize===e.MAX_VALUE_32BITS){this.uncompressedSize=n.readInt(8)}if(this.compressedSize===e.MAX_VALUE_32BITS){this.compressedSize=n.readInt(8)}if(this.localHeaderOffset===e.MAX_VALUE_32BITS){this.localHeaderOffset=n.readInt(8)}if(this.diskNumberStart===e.MAX_VALUE_32BITS){this.diskNumberStart=n.readInt(4)}},readExtraFields:function(n){var q=n.index,o,p,m;this.extraFields=this.extraFields||{};while(n.index<q+this.extraFieldsLength){o=n.readInt(2);p=n.readInt(2);m=n.readString(p);this.extraFields[o]={id:o,length:p,value:m}}},handleUTF8:function(){if(this.useUTF8()){this.fileName=j.utf8decode(this.fileName);this.fileComment=j.utf8decode(this.fileComment)}else{var m=this.findExtraFieldUnicodePath();if(m!==null){this.fileName=m}var n=this.findExtraFieldUnicodeComment();if(n!==null){this.fileComment=n}}},findExtraFieldUnicodePath:function(){var n=this.extraFields[28789];if(n){var m=new k(n.value);if(m.readInt(1)!==1){return null}if(j.crc32(this.fileName)!==m.readInt(4)){return null}return j.utf8decode(m.readString(n.length-5))}return null},findExtraFieldUnicodeComment:function(){var n=this.extraFields[25461];if(n){var m=new k(n.value);if(m.readInt(1)!==1){return null}if(j.crc32(this.fileComment)!==m.readInt(4)){return null}return j.utf8decode(m.readString(n.length-5))}return null}};g.exports=l},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(k,i,f){var e=k("./lib/utils/common").assign;var h=k("./lib/deflate");var l=k("./lib/inflate");var g=k("./lib/zlib/constants");var j={};e(j,h,l,g);i.exports=j},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(i,e,u){var p=i("./zlib/deflate.js");var t=i("./utils/common");var j=i("./utils/strings");var l=i("./zlib/messages");var s=i("./zlib/zstream");var q=0;var w=4;var k=0;var n=1;var f=-1;var g=0;var o=8;var v=function(y){this.options=t.assign({level:f,method:o,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},y||{});var z=this.options;if(z.raw&&z.windowBits>0){z.windowBits=-z.windowBits}else{if(z.gzip&&z.windowBits>0&&z.windowBits<16){z.windowBits+=16}}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new s;this.strm.avail_out=0;var x=p.deflateInit2(this.strm,z.level,z.method,z.windowBits,z.memLevel,z.strategy);if(x!==k){throw new Error(l[x])}if(z.header){p.deflateSetHeader(this.strm,z.header)}};v.prototype.push=function(A,B){var y=this.strm;var C=this.options.chunkSize;var x,z;if(this.ended){return false}z=B===~~B?B:B===true?w:q;if(typeof A==="string"){y.input=j.string2buf(A)}else{y.input=A}y.next_in=0;y.avail_in=y.input.length;do{if(y.avail_out===0){y.output=new t.Buf8(C);y.next_out=0;y.avail_out=C}x=p.deflate(y,z);if(x!==n&&x!==k){this.onEnd(x);this.ended=true;return false}if(y.avail_out===0||y.avail_in===0&&z===w){if(this.options.to==="string"){this.onData(j.buf2binstring(t.shrinkBuf(y.output,y.next_out)))}else{this.onData(t.shrinkBuf(y.output,y.next_out))}}}while((y.avail_in>0||y.avail_out===0)&&x!==n);if(z===w){x=p.deflateEnd(this.strm);this.onEnd(x);this.ended=true;return x===k}return true};v.prototype.onData=function(x){this.chunks.push(x)};v.prototype.onEnd=function(x){if(x===k){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=t.flattenChunks(this.chunks)}}this.chunks=[];this.err=x;this.msg=this.strm.msg};function m(x,y){var z=new v(y);z.push(x,true);if(z.err){throw z.msg}return z.result}function r(x,y){y=y||{};y.raw=true;return m(x,y)}function h(x,y){y=y||{};y.gzip=true;return m(x,y)}u.Deflate=v;u.deflate=m;u.deflateRaw=r;u.gzip=h},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(g,h,l){var e=g("./zlib/inflate.js");var o=g("./utils/common");var p=g("./utils/strings");var n=g("./zlib/constants");var j=g("./zlib/messages");var k=g("./zlib/zstream");var f=g("./zlib/gzheader");var m=function(s){this.options=o.assign({chunkSize:16384,windowBits:0,to:""},s||{});var t=this.options;if(t.raw&&t.windowBits>=0&&t.windowBits<16){t.windowBits=-t.windowBits;if(t.windowBits===0){t.windowBits=-15}}if(t.windowBits>=0&&t.windowBits<16&&!(s&&s.windowBits)){t.windowBits+=32}if(t.windowBits>15&&t.windowBits<48){if((t.windowBits&15)===0){t.windowBits|=15}}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new k;this.strm.avail_out=0;var r=e.inflateInit2(this.strm,t.windowBits);if(r!==n.Z_OK){throw new Error(j[r])}this.header=new f;e.inflateGetHeader(this.strm,this.header)};m.prototype.push=function(w,x){var z=this.strm;var u=this.options.chunkSize;var v,t;var s,y,r;if(this.ended){return false}t=x===~~x?x:x===true?n.Z_FINISH:n.Z_NO_FLUSH;if(typeof w==="string"){z.input=p.binstring2buf(w)}else{z.input=w}z.next_in=0;z.avail_in=z.input.length;do{if(z.avail_out===0){z.output=new o.Buf8(u);z.next_out=0;z.avail_out=u}v=e.inflate(z,n.Z_NO_FLUSH);if(v!==n.Z_STREAM_END&&v!==n.Z_OK){this.onEnd(v);this.ended=true;return false}if(z.next_out){if(z.avail_out===0||v===n.Z_STREAM_END||z.avail_in===0&&t===n.Z_FINISH){if(this.options.to==="string"){s=p.utf8border(z.output,z.next_out);y=z.next_out-s;r=p.buf2string(z.output,s);z.next_out=y;z.avail_out=u-y;if(y){o.arraySet(z.output,z.output,s,y,0)}this.onData(r)}else{this.onData(o.shrinkBuf(z.output,z.next_out))}}}}while(z.avail_in>0&&v!==n.Z_STREAM_END);if(v===n.Z_STREAM_END){t=n.Z_FINISH}if(t===n.Z_FINISH){v=e.inflateEnd(this.strm);this.onEnd(v);this.ended=true;return v===n.Z_OK}return true};m.prototype.onData=function(r){this.chunks.push(r)};m.prototype.onEnd=function(r){if(r===n.Z_OK){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=o.flattenChunks(this.chunks)}}this.chunks=[];this.err=r;this.msg=this.strm.msg};function q(r,s){var t=new m(s);t.push(r,true);if(t.err){throw t.msg}return t.result}function i(r,s){s=s||{};s.raw=true;return q(r,s)}l.Inflate=m;l.inflate=q;l.inflateRaw=i;l.ungzip=q},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(g,f,e){var j=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";e.assign=function(n){var k=Array.prototype.slice.call(arguments,1);while(k.length){var l=k.shift();if(!l){continue}if(typeof l!=="object"){throw new TypeError(l+"must be non-object")}for(var m in l){if(l.hasOwnProperty(m)){n[m]=l[m]}}}return n};e.shrinkBuf=function(k,l){if(k.length===l){return k}if(k.subarray){return k.subarray(0,l)}k.length=l;return k};var h={arraySet:function(l,n,p,k,o){if(n.subarray&&l.subarray){l.set(n.subarray(p,p+k),o);return}for(var m=0;m<k;m++){l[o+m]=n[p+m]}},flattenChunks:function(r){var p,n,m,q,o,k;m=0;for(p=0,n=r.length;p<n;p++){m+=r[p].length}k=new Uint8Array(m);q=0;for(p=0,n=r.length;p<n;p++){o=r[p];k.set(o,q);q+=o.length}return k}};var i={arraySet:function(l,n,p,k,o){for(var m=0;m<k;m++){l[o+m]=n[p+m]}},flattenChunks:function(k){return[].concat.apply([],k)}};e.setTyped=function(k){if(k){e.Buf8=Uint8Array;e.Buf16=Uint16Array;e.Buf32=Int32Array;e.assign(e,h)}else{e.Buf8=Array;e.Buf16=Array;e.Buf32=Array;e.assign(e,i)}};e.setTyped(j)},{}],28:[function(e,f,h){var o=e("./common");var m=true;var k=true;try{String.fromCharCode.apply(null,[0])}catch(n){m=false}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(n){k=false}var g=new o.Buf8(256);for(var j=0;j<256;j++){g[j]=j>=252?6:j>=248?5:j>=240?4:j>=224?3:j>=192?2:1}g[254]=g[254]=1;h.string2buf=function(v){var p,w,r,s,q,u=v.length,t=0;for(s=0;s<u;s++){w=v.charCodeAt(s);if((w&64512)===55296&&s+1<u){r=v.charCodeAt(s+1);if((r&64512)===56320){w=65536+(w-55296<<10)+(r-56320);s++}}t+=w<128?1:w<2048?2:w<65536?3:4}p=new o.Buf8(t);for(q=0,s=0;q<t;s++){w=v.charCodeAt(s);if((w&64512)===55296&&s+1<u){r=v.charCodeAt(s+1);if((r&64512)===56320){w=65536+(w-55296<<10)+(r-56320);s++}}if(w<128){p[q++]=w}else{if(w<2048){p[q++]=192|w>>>6;p[q++]=128|w&63}else{if(w<65536){p[q++]=224|w>>>12;p[q++]=128|w>>>6&63;p[q++]=128|w&63}else{p[q++]=240|w>>>18;p[q++]=128|w>>>12&63;p[q++]=128|w>>>6&63;p[q++]=128|w&63}}}}return p};function l(r,q){if(q<65537){if(r.subarray&&k||!r.subarray&&m){return String.fromCharCode.apply(null,o.shrinkBuf(r,q))}}var p="";for(var s=0;s<q;s++){p+=String.fromCharCode(r[s])}return p}h.buf2binstring=function(i){return l(i,i.length)};h.binstring2buf=function(s){var q=new o.Buf8(s.length);for(var r=0,p=q.length;r<p;r++){q[r]=s.charCodeAt(r)}return q};h.buf2string=function(u,r){var v,t,w,s;var q=r||u.length;var p=new Array(q*2);for(t=0,v=0;v<q;){w=u[v++];if(w<128){p[t++]=w;continue}s=g[w];if(s>4){p[t++]=65533;v+=s-1;continue}w&=s===2?31:s===3?15:7;while(s>1&&v<q){w=w<<6|u[v++]&63;s--}if(s>1){p[t++]=65533;continue}if(w<65536){p[t++]=w}else{w-=65536;p[t++]=55296|w>>10&1023;p[t++]=56320|w&1023}}return l(p,t)};h.utf8border=function(p,i){var q;i=i||p.length;if(i>p.length){i=p.length}q=i-1;while(q>=0&&(p[q]&192)===128){q--}if(q<0){return i}if(q===0){return i}return q+g[p[q]]>i?q:i}},{"./common":27}],29:[function(h,f,e){function g(l,k,i,p){var m=l&65535|0,j=l>>>16&65535|0,o=0;while(i!==0){o=i>2000?2000:i;i-=o;do{m=m+k[p++]|0;j=j+m|0}while(--o);m%=65521;j%=65521}return m|j<<16|0}f.exports=g},{}],30:[function(g,f,e){f.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(j,g,f){function h(){var p,m=[];for(var o=0;o<256;o++){p=o;for(var l=0;l<8;l++){p=p&1?3988292384^p>>>1:p>>>1}m[o]=p}return m}var e=h();function i(p,m,k,q){var o=e,l=q+k;p=p^-1;for(var n=q;n<l;n++){p=p>>>8^o[(p^m[n])&255]}return p^-1}g.exports=i},{}],32:[function(U,aC,L){var S=U("../utils/common");var aA=U("./trees");var K=U("./adler32");var aa=U("./crc32");var F=U("./messages");var N=0;var Z=1;var at=3;var n=4;var T=5;var t=0;var x=1;var ap=-2;var w=-3;var i=-5;var k=-1;var O=1;var D=2;var z=3;var u=4;var au=0;var J=2;var Y=8;var av=9;var Q=15;var p=8;var al=29;var az=256;var aB=az+1+al;var C=30;var ag=19;var an=2*aB+1;var R=15;var H=3;var aq=258;var g=aq+H+1;var l=32;var W=42;var r=69;var ab=73;var am=91;var s=103;var aE=113;var B=666;var ao=1;var v=2;var V=3;var h=4;var ar=3;function ah(aF,aG){aF.msg=F[aG];return aG}function P(aF){return(aF<<1)-(aF>4?9:0)}function ay(aG){var aF=aG.length;while(--aF>=0){aG[aF]=0}}function j(aG){var aH=aG.state;var aF=aH.pending;if(aF>aG.avail_out){aF=aG.avail_out}if(aF===0){return}S.arraySet(aG.output,aH.pending_buf,aH.pending_out,aF,aG.next_out);aG.next_out+=aF;aH.pending_out+=aF;aG.total_out+=aF;aG.avail_out-=aF;aH.pending-=aF;if(aH.pending===0){aH.pending_out=0}}function m(aF,aG){aA._tr_flush_block(aF,aF.block_start>=0?aF.block_start:-1,aF.strstart-aF.block_start,aG);aF.block_start=aF.strstart;j(aF.strm)}function f(aG,aF){aG.pending_buf[aG.pending++]=aF}function A(aG,aF){aG.pending_buf[aG.pending++]=aF>>>8&255;aG.pending_buf[aG.pending++]=aF&255}function E(aG,aH,aJ,aI){var aF=aG.avail_in;if(aF>aI){aF=aI}if(aF===0){return 0}aG.avail_in-=aF;S.arraySet(aH,aG.input,aG.next_in,aF,aJ);if(aG.state.wrap===1){aG.adler=K(aG.adler,aH,aF,aJ)}else{if(aG.state.wrap===2){aG.adler=aa(aG.adler,aH,aF,aJ)}}aG.next_in+=aF;aG.total_in+=aF;return aF}function ax(aS,aJ){var aM=aS.max_chain_length;var aT=aS.strstart;var aK;var aL;var aF=aS.prev_length;var aG=aS.nice_match;var aI=aS.strstart>aS.w_size-g?aS.strstart-(aS.w_size-g):0;var aQ=aS.window;var aN=aS.w_mask;var aH=aS.prev;var aP=aS.strstart+aq;var aR=aQ[aT+aF-1];var aO=aQ[aT+aF];if(aS.prev_length>=aS.good_match){aM>>=2}if(aG>aS.lookahead){aG=aS.lookahead}do{aK=aJ;if(aQ[aK+aF]!==aO||aQ[aK+aF-1]!==aR||aQ[aK]!==aQ[aT]||aQ[++aK]!==aQ[aT+1]){continue}aT+=2;aK++;do{}while(aQ[++aT]===aQ[++aK]&&aQ[++aT]===aQ[++aK]&&aQ[++aT]===aQ[++aK]&&aQ[++aT]===aQ[++aK]&&aQ[++aT]===aQ[++aK]&&aQ[++aT]===aQ[++aK]&&aQ[++aT]===aQ[++aK]&&aQ[++aT]===aQ[++aK]&&aT<aP);aL=aq-(aP-aT);aT=aP-aq;if(aL>aF){aS.match_start=aJ;aF=aL;if(aL>=aG){break}aR=aQ[aT+aF-1];aO=aQ[aT+aF]}}while((aJ=aH[aJ&aN])>aI&&--aM!==0);if(aF<=aS.lookahead){return aF}return aS.lookahead}function ak(aH){var aL=aH.w_size;var aI,aK,aF,aG,aJ;do{aG=aH.window_size-aH.lookahead-aH.strstart;if(aH.strstart>=aL+(aL-g)){S.arraySet(aH.window,aH.window,aL,aL,0);aH.match_start-=aL;aH.strstart-=aL;aH.block_start-=aL;aK=aH.hash_size;aI=aK;do{aF=aH.head[--aI];aH.head[aI]=aF>=aL?aF-aL:0}while(--aK);aK=aL;aI=aK;do{aF=aH.prev[--aI];aH.prev[aI]=aF>=aL?aF-aL:0}while(--aK);aG+=aL}if(aH.strm.avail_in===0){break}aK=E(aH.strm,aH.window,aH.strstart+aH.lookahead,aG);aH.lookahead+=aK;if(aH.lookahead+aH.insert>=H){aJ=aH.strstart-aH.insert;aH.ins_h=aH.window[aJ];aH.ins_h=(aH.ins_h<<aH.hash_shift^aH.window[aJ+1])&aH.hash_mask;while(aH.insert){aH.ins_h=(aH.ins_h<<aH.hash_shift^aH.window[aJ+H-1])&aH.hash_mask;aH.prev[aJ&aH.w_mask]=aH.head[aH.ins_h];aH.head[aH.ins_h]=aJ;aJ++;aH.insert--;if(aH.lookahead+aH.insert<H){break}}}}while(aH.lookahead<g&&aH.strm.avail_in!==0)}function M(aI,aF){var aH=65535;if(aH>aI.pending_buf_size-5){aH=aI.pending_buf_size-5}for(;;){if(aI.lookahead<=1){ak(aI);if(aI.lookahead===0&&aF===N){return ao}if(aI.lookahead===0){break}}aI.strstart+=aI.lookahead;aI.lookahead=0;var aG=aI.block_start+aH;if(aI.strstart===0||aI.strstart>=aG){aI.lookahead=aI.strstart-aG;aI.strstart=aG;m(aI,false);if(aI.strm.avail_out===0){return ao}}if(aI.strstart-aI.block_start>=aI.w_size-g){m(aI,false);if(aI.strm.avail_out===0){return ao}}}aI.insert=0;if(aF===n){m(aI,true);if(aI.strm.avail_out===0){return V}return h}if(aI.strstart>aI.block_start){m(aI,false);if(aI.strm.avail_out===0){return ao}}return ao}function o(aH,aF){var aI;var aG;for(;;){if(aH.lookahead<g){ak(aH);if(aH.lookahead<g&&aF===N){return ao}if(aH.lookahead===0){break}}aI=0;if(aH.lookahead>=H){aH.ins_h=(aH.ins_h<<aH.hash_shift^aH.window[aH.strstart+H-1])&aH.hash_mask;aI=aH.prev[aH.strstart&aH.w_mask]=aH.head[aH.ins_h];aH.head[aH.ins_h]=aH.strstart}if(aI!==0&&aH.strstart-aI<=aH.w_size-g){aH.match_length=ax(aH,aI)}if(aH.match_length>=H){aG=aA._tr_tally(aH,aH.strstart-aH.match_start,aH.match_length-H);aH.lookahead-=aH.match_length;if(aH.match_length<=aH.max_lazy_match&&aH.lookahead>=H){aH.match_length--;do{aH.strstart++;aH.ins_h=(aH.ins_h<<aH.hash_shift^aH.window[aH.strstart+H-1])&aH.hash_mask;aI=aH.prev[aH.strstart&aH.w_mask]=aH.head[aH.ins_h];aH.head[aH.ins_h]=aH.strstart}while(--aH.match_length!==0);aH.strstart++}else{aH.strstart+=aH.match_length;aH.match_length=0;aH.ins_h=aH.window[aH.strstart];aH.ins_h=(aH.ins_h<<aH.hash_shift^aH.window[aH.strstart+1])&aH.hash_mask}}else{aG=aA._tr_tally(aH,0,aH.window[aH.strstart]);aH.lookahead--;aH.strstart++}if(aG){m(aH,false);if(aH.strm.avail_out===0){return ao}}}aH.insert=aH.strstart<H-1?aH.strstart:H-1;if(aF===n){m(aH,true);if(aH.strm.avail_out===0){return V}return h}if(aH.last_lit){m(aH,false);if(aH.strm.avail_out===0){return ao}}return v}function ai(aI,aG){var aJ;var aH;var aF;for(;;){if(aI.lookahead<g){ak(aI);if(aI.lookahead<g&&aG===N){return ao}if(aI.lookahead===0){break}}aJ=0;if(aI.lookahead>=H){aI.ins_h=(aI.ins_h<<aI.hash_shift^aI.window[aI.strstart+H-1])&aI.hash_mask;aJ=aI.prev[aI.strstart&aI.w_mask]=aI.head[aI.ins_h];aI.head[aI.ins_h]=aI.strstart}aI.prev_length=aI.match_length;aI.prev_match=aI.match_start;aI.match_length=H-1;if(aJ!==0&&aI.prev_length<aI.max_lazy_match&&aI.strstart-aJ<=aI.w_size-g){aI.match_length=ax(aI,aJ);if(aI.match_length<=5&&(aI.strategy===O||aI.match_length===H&&aI.strstart-aI.match_start>4096)){aI.match_length=H-1}}if(aI.prev_length>=H&&aI.match_length<=aI.prev_length){aF=aI.strstart+aI.lookahead-H;aH=aA._tr_tally(aI,aI.strstart-1-aI.prev_match,aI.prev_length-H);aI.lookahead-=aI.prev_length-1;aI.prev_length-=2;do{if(++aI.strstart<=aF){aI.ins_h=(aI.ins_h<<aI.hash_shift^aI.window[aI.strstart+H-1])&aI.hash_mask;aJ=aI.prev[aI.strstart&aI.w_mask]=aI.head[aI.ins_h];aI.head[aI.ins_h]=aI.strstart}}while(--aI.prev_length!==0);aI.match_available=0;aI.match_length=H-1;aI.strstart++;if(aH){m(aI,false);if(aI.strm.avail_out===0){return ao}}}else{if(aI.match_available){aH=aA._tr_tally(aI,0,aI.window[aI.strstart-1]);if(aH){m(aI,false)}aI.strstart++;aI.lookahead--;if(aI.strm.avail_out===0){return ao}}else{aI.match_available=1;aI.strstart++;aI.lookahead--}}}if(aI.match_available){aH=aA._tr_tally(aI,0,aI.window[aI.strstart-1]);aI.match_available=0}aI.insert=aI.strstart<H-1?aI.strstart:H-1;if(aG===n){m(aI,true);if(aI.strm.avail_out===0){return V}return h}if(aI.last_lit){m(aI,false);if(aI.strm.avail_out===0){return ao}}return v}function ae(aJ,aG){var aI;var aK;var aH,aF;var aL=aJ.window;for(;;){if(aJ.lookahead<=aq){ak(aJ);if(aJ.lookahead<=aq&&aG===N){return ao}if(aJ.lookahead===0){break}}aJ.match_length=0;if(aJ.lookahead>=H&&aJ.strstart>0){aH=aJ.strstart-1;aK=aL[aH];if(aK===aL[++aH]&&aK===aL[++aH]&&aK===aL[++aH]){aF=aJ.strstart+aq;do{}while(aK===aL[++aH]&&aK===aL[++aH]&&aK===aL[++aH]&&aK===aL[++aH]&&aK===aL[++aH]&&aK===aL[++aH]&&aK===aL[++aH]&&aK===aL[++aH]&&aH<aF);aJ.match_length=aq-(aF-aH);if(aJ.match_length>aJ.lookahead){aJ.match_length=aJ.lookahead}}}if(aJ.match_length>=H){aI=aA._tr_tally(aJ,1,aJ.match_length-H);aJ.lookahead-=aJ.match_length;aJ.strstart+=aJ.match_length;aJ.match_length=0}else{aI=aA._tr_tally(aJ,0,aJ.window[aJ.strstart]);aJ.lookahead--;aJ.strstart++}if(aI){m(aJ,false);if(aJ.strm.avail_out===0){return ao}}}aJ.insert=0;if(aG===n){m(aJ,true);if(aJ.strm.avail_out===0){return V}return h}if(aJ.last_lit){m(aJ,false);if(aJ.strm.avail_out===0){return ao}}return v}function af(aH,aF){var aG;for(;;){if(aH.lookahead===0){ak(aH);if(aH.lookahead===0){if(aF===N){return ao}break}}aH.match_length=0;aG=aA._tr_tally(aH,0,aH.window[aH.strstart]);aH.lookahead--;aH.strstart++;if(aG){m(aH,false);if(aH.strm.avail_out===0){return ao}}}aH.insert=0;if(aF===n){m(aH,true);if(aH.strm.avail_out===0){return V}return h}if(aH.last_lit){m(aH,false);if(aH.strm.avail_out===0){return ao}}return v}var ad=function(aF,aJ,aG,aI,aH){this.good_length=aF;this.max_lazy=aJ;this.nice_length=aG;this.max_chain=aI;this.func=aH};var ac;ac=[new ad(0,0,0,0,M),new ad(4,4,8,4,o),new ad(4,5,16,8,o),new ad(4,6,32,32,o),new ad(4,4,16,16,ai),new ad(8,16,32,32,ai),new ad(8,16,128,128,ai),new ad(8,32,128,256,ai),new ad(32,128,258,1024,ai),new ad(32,258,258,4096,ai)];function I(aF){aF.window_size=2*aF.w_size;ay(aF.head);aF.max_lazy_match=ac[aF.level].max_lazy;aF.good_match=ac[aF.level].good_length;aF.nice_match=ac[aF.level].nice_length;aF.max_chain_length=ac[aF.level].max_chain;aF.strstart=0;aF.block_start=0;aF.lookahead=0;aF.insert=0;aF.match_length=aF.prev_length=H-1;aF.match_available=0;aF.ins_h=0}function e(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=Y;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new S.Buf16(an*2);this.dyn_dtree=new S.Buf16((2*C+1)*2);this.bl_tree=new S.Buf16((2*ag+1)*2);ay(this.dyn_ltree);ay(this.dyn_dtree);ay(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new S.Buf16(R+1);this.heap=new S.Buf16(2*aB+1);ay(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new S.Buf16(2*aB+1);ay(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function aj(aF){var aG;if(!aF||!aF.state){return ah(aF,ap)}aF.total_in=aF.total_out=0;aF.data_type=J;aG=aF.state;aG.pending=0;aG.pending_out=0;if(aG.wrap<0){aG.wrap=-aG.wrap}aG.status=aG.wrap?W:aE;aF.adler=aG.wrap===2?0:1;aG.last_flush=N;aA._tr_init(aG);return t}function y(aF){var aG=aj(aF);if(aG===t){I(aF.state)}return aG}function aD(aF,aG){if(!aF||!aF.state){return ap}if(aF.state.wrap!==2){return ap}aF.state.gzhead=aG;return t}function G(aF,aM,aL,aI,aK,aJ){if(!aF){return ap}var aH=1;if(aM===k){aM=6}if(aI<0){aH=0;aI=-aI}else{if(aI>15){aH=2;aI-=16}}if(aK<1||aK>av||aL!==Y||aI<8||aI>15||aM<0||aM>9||aJ<0||aJ>u){return ah(aF,ap)}if(aI===8){aI=9}var aG=new e;aF.state=aG;aG.strm=aF;aG.wrap=aH;aG.gzhead=null;aG.w_bits=aI;aG.w_size=1<<aG.w_bits;aG.w_mask=aG.w_size-1;aG.hash_bits=aK+7;aG.hash_size=1<<aG.hash_bits;aG.hash_mask=aG.hash_size-1;aG.hash_shift=~~((aG.hash_bits+H-1)/H);aG.window=new S.Buf8(aG.w_size*2);aG.head=new S.Buf16(aG.hash_size);aG.prev=new S.Buf16(aG.w_size);aG.lit_bufsize=1<<aK+6;aG.pending_buf_size=aG.lit_bufsize*4;aG.pending_buf=new S.Buf8(aG.pending_buf_size);aG.d_buf=aG.lit_bufsize>>1;aG.l_buf=(1+2)*aG.lit_bufsize;aG.level=aM;aG.strategy=aJ;aG.method=aL;return y(aF)}function X(aF,aG){return G(aF,aG,Y,Q,p,au)}function q(aK,aL){var aJ,aN;var aI,aG;if(!aK||!aK.state||aL>T||aL<0){return aK?ah(aK,ap):ap}aN=aK.state;if(!aK.output||!aK.input&&aK.avail_in!==0||aN.status===B&&aL!==n){return ah(aK,aK.avail_out===0?i:ap)}aN.strm=aK;aJ=aN.last_flush;aN.last_flush=aL;if(aN.status===W){if(aN.wrap===2){aK.adler=0;f(aN,31);f(aN,139);f(aN,8);if(!aN.gzhead){f(aN,0);f(aN,0);f(aN,0);f(aN,0);f(aN,0);f(aN,aN.level===9?2:aN.strategy>=D||aN.level<2?4:0);f(aN,ar);aN.status=aE}else{f(aN,(aN.gzhead.text?1:0)+(aN.gzhead.hcrc?2:0)+(!aN.gzhead.extra?0:4)+(!aN.gzhead.name?0:8)+(!aN.gzhead.comment?0:16));f(aN,aN.gzhead.time&255);f(aN,aN.gzhead.time>>8&255);f(aN,aN.gzhead.time>>16&255);f(aN,aN.gzhead.time>>24&255);f(aN,aN.level===9?2:aN.strategy>=D||aN.level<2?4:0);f(aN,aN.gzhead.os&255);if(aN.gzhead.extra&&aN.gzhead.extra.length){f(aN,aN.gzhead.extra.length&255);f(aN,aN.gzhead.extra.length>>8&255)}if(aN.gzhead.hcrc){aK.adler=aa(aK.adler,aN.pending_buf,aN.pending,0)}aN.gzindex=0;aN.status=r}}else{var aH=Y+(aN.w_bits-8<<4)<<8;var aM=-1;if(aN.strategy>=D||aN.level<2){aM=0}else{if(aN.level<6){aM=1}else{if(aN.level===6){aM=2}else{aM=3}}}aH|=aM<<6;if(aN.strstart!==0){aH|=l}aH+=31-aH%31;aN.status=aE;A(aN,aH);if(aN.strstart!==0){A(aN,aK.adler>>>16);A(aN,aK.adler&65535)}aK.adler=1}}if(aN.status===r){if(aN.gzhead.extra){aI=aN.pending;while(aN.gzindex<(aN.gzhead.extra.length&65535)){if(aN.pending===aN.pending_buf_size){if(aN.gzhead.hcrc&&aN.pending>aI){aK.adler=aa(aK.adler,aN.pending_buf,aN.pending-aI,aI)}j(aK);aI=aN.pending;if(aN.pending===aN.pending_buf_size){break}}f(aN,aN.gzhead.extra[aN.gzindex]&255);aN.gzindex++}if(aN.gzhead.hcrc&&aN.pending>aI){aK.adler=aa(aK.adler,aN.pending_buf,aN.pending-aI,aI)}if(aN.gzindex===aN.gzhead.extra.length){aN.gzindex=0;aN.status=ab}}else{aN.status=ab}}if(aN.status===ab){if(aN.gzhead.name){aI=aN.pending;do{if(aN.pending===aN.pending_buf_size){if(aN.gzhead.hcrc&&aN.pending>aI){aK.adler=aa(aK.adler,aN.pending_buf,aN.pending-aI,aI)}j(aK);aI=aN.pending;if(aN.pending===aN.pending_buf_size){aG=1;break}}if(aN.gzindex<aN.gzhead.name.length){aG=aN.gzhead.name.charCodeAt(aN.gzindex++)&255}else{aG=0}f(aN,aG)}while(aG!==0);if(aN.gzhead.hcrc&&aN.pending>aI){aK.adler=aa(aK.adler,aN.pending_buf,aN.pending-aI,aI)}if(aG===0){aN.gzindex=0;aN.status=am}}else{aN.status=am}}if(aN.status===am){if(aN.gzhead.comment){aI=aN.pending;do{if(aN.pending===aN.pending_buf_size){if(aN.gzhead.hcrc&&aN.pending>aI){aK.adler=aa(aK.adler,aN.pending_buf,aN.pending-aI,aI)}j(aK);aI=aN.pending;if(aN.pending===aN.pending_buf_size){aG=1;break}}if(aN.gzindex<aN.gzhead.comment.length){aG=aN.gzhead.comment.charCodeAt(aN.gzindex++)&255}else{aG=0}f(aN,aG)}while(aG!==0);if(aN.gzhead.hcrc&&aN.pending>aI){aK.adler=aa(aK.adler,aN.pending_buf,aN.pending-aI,aI)}if(aG===0){aN.status=s}}else{aN.status=s}}if(aN.status===s){if(aN.gzhead.hcrc){if(aN.pending+2>aN.pending_buf_size){j(aK)}if(aN.pending+2<=aN.pending_buf_size){f(aN,aK.adler&255);f(aN,aK.adler>>8&255);aK.adler=0;aN.status=aE}}else{aN.status=aE}}if(aN.pending!==0){j(aK);if(aK.avail_out===0){aN.last_flush=-1;return t}}else{if(aK.avail_in===0&&P(aL)<=P(aJ)&&aL!==n){return ah(aK,i)}}if(aN.status===B&&aK.avail_in!==0){return ah(aK,i)}if(aK.avail_in!==0||aN.lookahead!==0||aL!==N&&aN.status!==B){var aF=aN.strategy===D?af(aN,aL):aN.strategy===z?ae(aN,aL):ac[aN.level].func(aN,aL);if(aF===V||aF===h){aN.status=B}if(aF===ao||aF===V){if(aK.avail_out===0){aN.last_flush=-1}return t}if(aF===v){if(aL===Z){aA._tr_align(aN)}else{if(aL!==T){aA._tr_stored_block(aN,0,0,false);if(aL===at){ay(aN.head);if(aN.lookahead===0){aN.strstart=0;aN.block_start=0;aN.insert=0}}}}j(aK);if(aK.avail_out===0){aN.last_flush=-1;return t}}}if(aL!==n){return t}if(aN.wrap<=0){return x}if(aN.wrap===2){f(aN,aK.adler&255);f(aN,aK.adler>>8&255);f(aN,aK.adler>>16&255);f(aN,aK.adler>>24&255);f(aN,aK.total_in&255);f(aN,aK.total_in>>8&255);f(aN,aK.total_in>>16&255);f(aN,aK.total_in>>24&255)}else{A(aN,aK.adler>>>16);A(aN,aK.adler&65535)}j(aK);if(aN.wrap>0){aN.wrap=-aN.wrap}return aN.pending!==0?t:x}function aw(aG){var aF;if(!aG||!aG.state){return ap}aF=aG.state.status;if(aF!==W&&aF!==r&&aF!==ab&&aF!==am&&aF!==s&&aF!==aE&&aF!==B){return ah(aG,ap)}aG.state=null;return aF===aE?ah(aG,w):t}L.deflateInit=X;L.deflateInit2=G;L.deflateReset=y;L.deflateResetKeep=aj;L.deflateSetHeader=aD;L.deflate=q;L.deflateEnd=aw;L.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(g,f,e){function h(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=false}f.exports=h},{}],34:[function(i,g,f){var h=30;var j=12;g.exports=function e(I,p){var q;var K;var w;var J;var v;var o;var C;var l;var A;var m;var r;var z;var F;var D;var G;var u;var x;var k;var t;var H;var B;var E;var n;var y,s;q=I.state;K=I.next_in;y=I.input;w=K+(I.avail_in-5);J=I.next_out;s=I.output;v=J-(p-I.avail_out);o=J+(I.avail_out-257);C=q.dmax;l=q.wsize;A=q.whave;m=q.wnext;r=q.window;z=q.hold;F=q.bits;D=q.lencode;G=q.distcode;u=(1<<q.lenbits)-1;x=(1<<q.distbits)-1;top:do{if(F<15){z+=y[K++]<<F;F+=8;z+=y[K++]<<F;F+=8}k=D[z&u];dolen:for(;;){t=k>>>24;z>>>=t;F-=t;t=k>>>16&255;if(t===0){s[J++]=k&65535}else{if(t&16){H=k&65535;t&=15;if(t){if(F<t){z+=y[K++]<<F;F+=8}H+=z&(1<<t)-1;z>>>=t;F-=t}if(F<15){z+=y[K++]<<F;F+=8;z+=y[K++]<<F;F+=8}k=G[z&x];dodist:for(;;){t=k>>>24;z>>>=t;F-=t;t=k>>>16&255;if(t&16){B=k&65535;t&=15;if(F<t){z+=y[K++]<<F;F+=8;if(F<t){z+=y[K++]<<F;F+=8}}B+=z&(1<<t)-1;if(B>C){I.msg="invalid distance too far back";q.mode=h;break top}z>>>=t;F-=t;t=J-v;if(B>t){t=B-t;if(t>A){if(q.sane){I.msg="invalid distance too far back";q.mode=h;break top}}E=0;n=r;if(m===0){E+=l-t;if(t<H){H-=t;do{s[J++]=r[E++]}while(--t);E=J-B;n=s}}else{if(m<t){E+=l+m-t;t-=m;if(t<H){H-=t;do{s[J++]=r[E++]}while(--t);E=0;if(m<H){t=m;H-=t;do{s[J++]=r[E++]}while(--t);E=J-B;n=s}}}else{E+=m-t;if(t<H){H-=t;do{s[J++]=r[E++]}while(--t);E=J-B;n=s}}}while(H>2){s[J++]=n[E++];s[J++]=n[E++];s[J++]=n[E++];H-=3}if(H){s[J++]=n[E++];if(H>1){s[J++]=n[E++]}}}else{E=J-B;do{s[J++]=s[E++];s[J++]=s[E++];s[J++]=s[E++];H-=3}while(H>2);if(H){s[J++]=s[E++];if(H>1){s[J++]=s[E++]}}}}else{if((t&64)===0){k=G[(k&65535)+(z&(1<<t)-1)];continue dodist}else{I.msg="invalid distance code";q.mode=h;break top}}break}}else{if((t&64)===0){k=D[(k&65535)+(z&(1<<t)-1)];continue dolen}else{if(t&32){q.mode=j;break top}else{I.msg="invalid literal/length code";q.mode=h;break top}}}}break}}while(K<w&&J<o);H=F>>3;K-=H;F-=H<<3;z&=(1<<F)-1;I.next_in=K;I.next_out=J;I.avail_in=K<w?5+(w-K):5-(K-w);I.avail_out=J<o?257+(o-J):257-(J-o);q.hold=z;q.bits=F;return}},{}],35:[function(W,ax,N){var S=W("../utils/common");var M=W("./adler32");var ae=W("./crc32");var aq=W("./inffast");var n=W("./inftrees");var ad=0;var af=1;var J=2;var p=4;var T=5;var C=6;var v=0;var z=1;var u=2;var at=-2;var x=-3;var L=-4;var j=-5;var ab=8;var am=1;var al=2;var k=3;var ah=4;var E=5;var f=6;var t=7;var Z=8;var r=9;var ar=10;var w=11;var m=12;var aj=13;var h=14;var az=15;var ap=16;var o=17;var A=18;var U=19;var aa=20;var e=21;var aw=22;var V=23;var au=24;var D=25;var F=26;var ao=27;var X=28;var B=29;var g=30;var ay=31;var G=32;var Y=852;var P=592;var Q=15;var K=Q;function s(aA){return(aA>>>24&255)+(aA>>>8&65280)+((aA&65280)<<8)+((aA&255)<<24)}function ag(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new S.Buf16(320);this.work=new S.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function R(aA){var aB;if(!aA||!aA.state){return at}aB=aA.state;aA.total_in=aA.total_out=aB.total=0;aA.msg="";if(aB.wrap){aA.adler=aB.wrap&1}aB.mode=am;aB.last=0;aB.havedict=0;aB.dmax=32768;aB.head=null;aB.hold=0;aB.bits=0;aB.lencode=aB.lendyn=new S.Buf32(Y);aB.distcode=aB.distdyn=new S.Buf32(P);aB.sane=1;aB.back=-1;return v}function av(aA){var aB;if(!aA||!aA.state){return at}aB=aA.state;aB.wsize=0;aB.whave=0;aB.wnext=0;return R(aA)}function y(aA,aC){var aB;var aD;if(!aA||!aA.state){return at}aD=aA.state;if(aC<0){aB=0;aC=-aC}else{aB=(aC>>4)+1;if(aC<48){aC&=15}}if(aC&&(aC<8||aC>15)){return at}if(aD.window!==null&&aD.wbits!==aC){aD.window=null}aD.wrap=aB;aD.wbits=aC;return av(aA)}function q(aA,aC){var aB;var aD;if(!aA){return at}aD=new ag;aA.state=aD;aD.window=null;aB=y(aA,aC);if(aB!==v){aA.state=null}return aB}function I(aA){return q(aA,K)}var ai=true;var an,l;function H(aB){if(ai){var aA;an=new S.Buf32(512);l=new S.Buf32(32);aA=0;while(aA<144){aB.lens[aA++]=8}while(aA<256){aB.lens[aA++]=9}while(aA<280){aB.lens[aA++]=7}while(aA<288){aB.lens[aA++]=8}n(af,aB.lens,0,288,an,0,aB.work,{bits:9});aA=0;while(aA<32){aB.lens[aA++]=5}n(J,aB.lens,0,32,l,0,aB.work,{bits:5});ai=false}aB.lencode=an;aB.lenbits=9;aB.distcode=l;aB.distbits=5}function O(aB,aE,aA,aF){var aD;var aC=aB.state;if(aC.window===null){aC.wsize=1<<aC.wbits;aC.wnext=0;aC.whave=0;aC.window=new S.Buf8(aC.wsize)}if(aF>=aC.wsize){S.arraySet(aC.window,aE,aA-aC.wsize,aC.wsize,0);aC.wnext=0;aC.whave=aC.wsize}else{aD=aC.wsize-aC.wnext;if(aD>aF){aD=aF}S.arraySet(aC.window,aE,aA-aF,aD,aC.wnext);aF-=aD;if(aF){S.arraySet(aC.window,aE,aA-aF,aF,0);aC.wnext=aF;aC.whave=aC.wsize}else{aC.wnext+=aD;if(aC.wnext===aC.wsize){aC.wnext=0}if(aC.whave<aC.wsize){aC.whave+=aD}}}return 0}function ac(aX,aR){var aF;var aK,aI;var aP;var aG;var aD,aE;var aN;var aT;var a1,a0;var aS;var aU;var aC;var aA=0;var aY,aJ,aZ;var aO,aB,aL;var aW;var a2;var aH=new S.Buf8(4);var aM;var aQ;var aV=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!aX||!aX.state||!aX.output||!aX.input&&aX.avail_in!==0){return at}aF=aX.state;if(aF.mode===m){aF.mode=aj}aG=aX.next_out;aI=aX.output;aE=aX.avail_out;aP=aX.next_in;aK=aX.input;aD=aX.avail_in;aN=aF.hold;aT=aF.bits;a1=aD;a0=aE;a2=v;inf_leave:for(;;){switch(aF.mode){case am:if(aF.wrap===0){aF.mode=aj;break}while(aT<16){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}if(aF.wrap&2&&aN===35615){aF.check=0;aH[0]=aN&255;aH[1]=aN>>>8&255;aF.check=ae(aF.check,aH,2,0);aN=0;aT=0;aF.mode=al;break}aF.flags=0;if(aF.head){aF.head.done=false}if(!(aF.wrap&1)||(((aN&255)<<8)+(aN>>8))%31){aX.msg="incorrect header check";aF.mode=g;break}if((aN&15)!==ab){aX.msg="unknown compression method";aF.mode=g;break}aN>>>=4;aT-=4;aW=(aN&15)+8;if(aF.wbits===0){aF.wbits=aW}else{if(aW>aF.wbits){aX.msg="invalid window size";aF.mode=g;break}}aF.dmax=1<<aW;aX.adler=aF.check=1;aF.mode=aN&512?ar:m;aN=0;aT=0;break;case al:while(aT<16){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}aF.flags=aN;if((aF.flags&255)!==ab){aX.msg="unknown compression method";aF.mode=g;break}if(aF.flags&57344){aX.msg="unknown header flags set";aF.mode=g;break}if(aF.head){aF.head.text=aN>>8&1}if(aF.flags&512){aH[0]=aN&255;aH[1]=aN>>>8&255;aF.check=ae(aF.check,aH,2,0)}aN=0;aT=0;aF.mode=k;case k:while(aT<32){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}if(aF.head){aF.head.time=aN}if(aF.flags&512){aH[0]=aN&255;aH[1]=aN>>>8&255;aH[2]=aN>>>16&255;aH[3]=aN>>>24&255;aF.check=ae(aF.check,aH,4,0)}aN=0;aT=0;aF.mode=ah;case ah:while(aT<16){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}if(aF.head){aF.head.xflags=aN&255;aF.head.os=aN>>8}if(aF.flags&512){aH[0]=aN&255;aH[1]=aN>>>8&255;aF.check=ae(aF.check,aH,2,0)}aN=0;aT=0;aF.mode=E;case E:if(aF.flags&1024){while(aT<16){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}aF.length=aN;if(aF.head){aF.head.extra_len=aN}if(aF.flags&512){aH[0]=aN&255;aH[1]=aN>>>8&255;aF.check=ae(aF.check,aH,2,0)}aN=0;aT=0}else{if(aF.head){aF.head.extra=null}}aF.mode=f;case f:if(aF.flags&1024){aS=aF.length;if(aS>aD){aS=aD}if(aS){if(aF.head){aW=aF.head.extra_len-aF.length;if(!aF.head.extra){aF.head.extra=new Array(aF.head.extra_len)}S.arraySet(aF.head.extra,aK,aP,aS,aW)}if(aF.flags&512){aF.check=ae(aF.check,aK,aS,aP)}aD-=aS;aP+=aS;aF.length-=aS}if(aF.length){break inf_leave}}aF.length=0;aF.mode=t;case t:if(aF.flags&2048){if(aD===0){break inf_leave}aS=0;do{aW=aK[aP+aS++];if(aF.head&&aW&&aF.length<65536){aF.head.name+=String.fromCharCode(aW)}}while(aW&&aS<aD);if(aF.flags&512){aF.check=ae(aF.check,aK,aS,aP)}aD-=aS;aP+=aS;if(aW){break inf_leave}}else{if(aF.head){aF.head.name=null}}aF.length=0;aF.mode=Z;case Z:if(aF.flags&4096){if(aD===0){break inf_leave}aS=0;do{aW=aK[aP+aS++];if(aF.head&&aW&&aF.length<65536){aF.head.comment+=String.fromCharCode(aW)}}while(aW&&aS<aD);if(aF.flags&512){aF.check=ae(aF.check,aK,aS,aP)}aD-=aS;aP+=aS;if(aW){break inf_leave}}else{if(aF.head){aF.head.comment=null}}aF.mode=r;case r:if(aF.flags&512){while(aT<16){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}if(aN!==(aF.check&65535)){aX.msg="header crc mismatch";aF.mode=g;break}aN=0;aT=0}if(aF.head){aF.head.hcrc=aF.flags>>9&1;aF.head.done=true}aX.adler=aF.check=0;aF.mode=m;break;case ar:while(aT<32){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}aX.adler=aF.check=s(aN);aN=0;aT=0;aF.mode=w;case w:if(aF.havedict===0){aX.next_out=aG;aX.avail_out=aE;aX.next_in=aP;aX.avail_in=aD;aF.hold=aN;aF.bits=aT;return u}aX.adler=aF.check=1;aF.mode=m;case m:if(aR===T||aR===C){break inf_leave}case aj:if(aF.last){aN>>>=aT&7;aT-=aT&7;aF.mode=ao;break}while(aT<3){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}aF.last=aN&1;aN>>>=1;aT-=1;switch(aN&3){case 0:aF.mode=h;break;case 1:H(aF);aF.mode=aa;if(aR===C){aN>>>=2;aT-=2;break inf_leave}break;case 2:aF.mode=o;break;case 3:aX.msg="invalid block type";aF.mode=g}aN>>>=2;aT-=2;break;case h:aN>>>=aT&7;aT-=aT&7;while(aT<32){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}if((aN&65535)!==(aN>>>16^65535)){aX.msg="invalid stored block lengths";aF.mode=g;break}aF.length=aN&65535;aN=0;aT=0;aF.mode=az;if(aR===C){break inf_leave}case az:aF.mode=ap;case ap:aS=aF.length;if(aS){if(aS>aD){aS=aD}if(aS>aE){aS=aE}if(aS===0){break inf_leave}S.arraySet(aI,aK,aP,aS,aG);aD-=aS;aP+=aS;aE-=aS;aG+=aS;aF.length-=aS;break}aF.mode=m;break;case o:while(aT<14){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}aF.nlen=(aN&31)+257;aN>>>=5;aT-=5;aF.ndist=(aN&31)+1;aN>>>=5;aT-=5;aF.ncode=(aN&15)+4;aN>>>=4;aT-=4;if(aF.nlen>286||aF.ndist>30){aX.msg="too many length or distance symbols";aF.mode=g;break}aF.have=0;aF.mode=A;case A:while(aF.have<aF.ncode){while(aT<3){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}aF.lens[aV[aF.have++]]=aN&7;aN>>>=3;aT-=3}while(aF.have<19){aF.lens[aV[aF.have++]]=0}aF.lencode=aF.lendyn;aF.lenbits=7;aM={bits:aF.lenbits};a2=n(ad,aF.lens,0,19,aF.lencode,0,aF.work,aM);aF.lenbits=aM.bits;if(a2){aX.msg="invalid code lengths set";aF.mode=g;break}aF.have=0;aF.mode=U;case U:while(aF.have<aF.nlen+aF.ndist){for(;;){aA=aF.lencode[aN&(1<<aF.lenbits)-1];aY=aA>>>24;aJ=aA>>>16&255;aZ=aA&65535;if(aY<=aT){break}if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}if(aZ<16){aN>>>=aY;aT-=aY;aF.lens[aF.have++]=aZ}else{if(aZ===16){aQ=aY+2;while(aT<aQ){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}aN>>>=aY;aT-=aY;if(aF.have===0){aX.msg="invalid bit length repeat";aF.mode=g;break}aW=aF.lens[aF.have-1];aS=3+(aN&3);aN>>>=2;aT-=2}else{if(aZ===17){aQ=aY+3;while(aT<aQ){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}aN>>>=aY;aT-=aY;aW=0;aS=3+(aN&7);aN>>>=3;aT-=3}else{aQ=aY+7;while(aT<aQ){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}aN>>>=aY;aT-=aY;aW=0;aS=11+(aN&127);aN>>>=7;aT-=7}}if(aF.have+aS>aF.nlen+aF.ndist){aX.msg="invalid bit length repeat";aF.mode=g;break}while(aS--){aF.lens[aF.have++]=aW}}}if(aF.mode===g){break}if(aF.lens[256]===0){aX.msg="invalid code -- missing end-of-block";aF.mode=g;break}aF.lenbits=9;aM={bits:aF.lenbits};a2=n(af,aF.lens,0,aF.nlen,aF.lencode,0,aF.work,aM);aF.lenbits=aM.bits;if(a2){aX.msg="invalid literal/lengths set";aF.mode=g;break}aF.distbits=6;aF.distcode=aF.distdyn;aM={bits:aF.distbits};a2=n(J,aF.lens,aF.nlen,aF.ndist,aF.distcode,0,aF.work,aM);aF.distbits=aM.bits;if(a2){aX.msg="invalid distances set";aF.mode=g;break}aF.mode=aa;if(aR===C){break inf_leave}case aa:aF.mode=e;case e:if(aD>=6&&aE>=258){aX.next_out=aG;aX.avail_out=aE;aX.next_in=aP;aX.avail_in=aD;aF.hold=aN;aF.bits=aT;aq(aX,a0);aG=aX.next_out;aI=aX.output;aE=aX.avail_out;aP=aX.next_in;aK=aX.input;aD=aX.avail_in;aN=aF.hold;aT=aF.bits;if(aF.mode===m){aF.back=-1}break}aF.back=0;for(;;){aA=aF.lencode[aN&(1<<aF.lenbits)-1];aY=aA>>>24;aJ=aA>>>16&255;aZ=aA&65535;if(aY<=aT){break}if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}if(aJ&&(aJ&240)===0){aO=aY;aB=aJ;aL=aZ;for(;;){aA=aF.lencode[aL+((aN&(1<<aO+aB)-1)>>aO)];aY=aA>>>24;aJ=aA>>>16&255;aZ=aA&65535;if(aO+aY<=aT){break}if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}aN>>>=aO;aT-=aO;aF.back+=aO}aN>>>=aY;aT-=aY;aF.back+=aY;aF.length=aZ;if(aJ===0){aF.mode=F;break}if(aJ&32){aF.back=-1;aF.mode=m;break}if(aJ&64){aX.msg="invalid literal/length code";aF.mode=g;break}aF.extra=aJ&15;aF.mode=aw;case aw:if(aF.extra){aQ=aF.extra;while(aT<aQ){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}aF.length+=aN&(1<<aF.extra)-1;aN>>>=aF.extra;aT-=aF.extra;aF.back+=aF.extra}aF.was=aF.length;aF.mode=V;case V:for(;;){aA=aF.distcode[aN&(1<<aF.distbits)-1];aY=aA>>>24;aJ=aA>>>16&255;aZ=aA&65535;if(aY<=aT){break}if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}if((aJ&240)===0){aO=aY;aB=aJ;aL=aZ;for(;;){aA=aF.distcode[aL+((aN&(1<<aO+aB)-1)>>aO)];aY=aA>>>24;aJ=aA>>>16&255;aZ=aA&65535;if(aO+aY<=aT){break}if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}aN>>>=aO;aT-=aO;aF.back+=aO}aN>>>=aY;aT-=aY;aF.back+=aY;if(aJ&64){aX.msg="invalid distance code";aF.mode=g;break}aF.offset=aZ;aF.extra=aJ&15;aF.mode=au;case au:if(aF.extra){aQ=aF.extra;while(aT<aQ){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}aF.offset+=aN&(1<<aF.extra)-1;aN>>>=aF.extra;aT-=aF.extra;aF.back+=aF.extra}if(aF.offset>aF.dmax){aX.msg="invalid distance too far back";aF.mode=g;break}aF.mode=D;case D:if(aE===0){break inf_leave}aS=a0-aE;if(aF.offset>aS){aS=aF.offset-aS;if(aS>aF.whave){if(aF.sane){aX.msg="invalid distance too far back";aF.mode=g;break}}if(aS>aF.wnext){aS-=aF.wnext;aU=aF.wsize-aS}else{aU=aF.wnext-aS}if(aS>aF.length){aS=aF.length}aC=aF.window}else{aC=aI;aU=aG-aF.offset;aS=aF.length}if(aS>aE){aS=aE}aE-=aS;aF.length-=aS;do{aI[aG++]=aC[aU++]}while(--aS);if(aF.length===0){aF.mode=e}break;case F:if(aE===0){break inf_leave}aI[aG++]=aF.length;aE--;aF.mode=e;break;case ao:if(aF.wrap){while(aT<32){if(aD===0){break inf_leave}aD--;aN|=aK[aP++]<<aT;aT+=8}a0-=aE;aX.total_out+=a0;aF.total+=a0;if(a0){aX.adler=aF.check=aF.flags?ae(aF.check,aI,a0,aG-a0):M(aF.check,aI,a0,aG-a0)}a0=aE;if((aF.flags?aN:s(aN))!==aF.check){aX.msg="incorrect data check";aF.mode=g;break}aN=0;aT=0}aF.mode=X;case X:if(aF.wrap&&aF.flags){while(aT<32){if(aD===0){break inf_leave}aD--;aN+=aK[aP++]<<aT;aT+=8}if(aN!==(aF.total&4294967295)){aX.msg="incorrect length check";aF.mode=g;break}aN=0;aT=0}aF.mode=B;case B:a2=z;break inf_leave;case g:a2=x;break inf_leave;case ay:return L;case G:default:return at}}aX.next_out=aG;aX.avail_out=aE;aX.next_in=aP;aX.avail_in=aD;aF.hold=aN;aF.bits=aT;if(aF.wsize||a0!==aX.avail_out&&aF.mode<g&&(aF.mode<ao||aR!==p)){if(O(aX,aX.output,aX.next_out,a0-aX.avail_out)){aF.mode=ay;return L}}a1-=aX.avail_in;a0-=aX.avail_out;aX.total_in+=a1;aX.total_out+=a0;aF.total+=a0;if(aF.wrap&&a0){aX.adler=aF.check=aF.flags?ae(aF.check,aI,a0,aX.next_out-a0):M(aF.check,aI,a0,aX.next_out-a0)}aX.data_type=aF.bits+(aF.last?64:0)+(aF.mode===m?128:0)+(aF.mode===aa||aF.mode===az?256:0);if((a1===0&&a0===0||aR===p)&&a2===v){a2=j}return a2}function ak(aA){if(!aA||!aA.state){return at}var aB=aA.state;if(aB.window){aB.window=null}aA.state=null;return v}function i(aA,aB){var aC;if(!aA||!aA.state){return at}aC=aA.state;if((aC.wrap&2)===0){return at}aC.head=aB;aB.done=false;return v}N.inflateReset=av;N.inflateReset2=y;N.inflateResetKeep=R;N.inflateInit=I;N.inflateInit2=q;N.inflate=ac;N.inflateEnd=ak;N.inflateGetHeader=i;N.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(f,g,i){var r=f("../utils/common");var q=15;var n=852;var m=592;var p=0;var k=1;var h=2;var o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var j=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var e=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];g.exports=function l(v,aa,I,X,W,U,H,E){var L=E.bits;var S=0;var D=0;var K=0,R=0;var J=0;var V=0;var B=0;var w=0;var z=0;var Q=0;var P;var M;var ab;var O;var G;var y=null;var F=0;var u;var A=new r.Buf16(q+1);var x=new r.Buf16(q+1);var t=null;var Z=0;var T,C,Y;for(S=0;S<=q;S++){A[S]=0}for(D=0;D<X;D++){A[aa[I+D]]++}J=L;for(R=q;R>=1;R--){if(A[R]!==0){break}}if(J>R){J=R}if(R===0){W[U++]=1<<24|64<<16|0;W[U++]=1<<24|64<<16|0;E.bits=1;return 0}for(K=1;K<R;K++){if(A[K]!==0){break}}if(J<K){J=K}w=1;for(S=1;S<=q;S++){w<<=1;w-=A[S];if(w<0){return -1}}if(w>0&&(v===p||R!==1)){return -1}x[1]=0;for(S=1;S<q;S++){x[S+1]=x[S]+A[S]}for(D=0;D<X;D++){if(aa[I+D]!==0){H[x[aa[I+D]]++]=D}}if(v===p){y=t=H;u=19}else{if(v===k){y=o;F-=257;t=s;Z-=257;u=256}else{y=j;t=e;u=-1}}Q=0;D=0;S=K;G=U;V=J;B=0;ab=-1;z=1<<J;O=z-1;if(v===k&&z>n||v===h&&z>m){return 1}var N=0;for(;;){N++;T=S-B;if(H[D]<u){C=0;Y=H[D]}else{if(H[D]>u){C=t[Z+H[D]];Y=y[F+H[D]]}else{C=32+64;Y=0}}P=1<<S-B;M=1<<V;K=M;do{M-=P;W[G+(Q>>B)+M]=T<<24|C<<16|Y|0}while(M!==0);P=1<<S-1;while(Q&P){P>>=1}if(P!==0){Q&=P-1;Q+=P}else{Q=0}D++;if(--A[S]===0){if(S===R){break}S=aa[I+H[D]]}if(S>J&&(Q&O)!==ab){if(B===0){B=J}G+=K;V=S-B;w=1<<V;while(V+B<R){w-=A[V+B];if(w<=0){break}V++;w<<=1}z+=1<<V;if(v===k&&z>n||v===h&&z>m){return 1}ab=Q&O;W[ab]=J<<24|V<<16|G-U|0}}if(Q!==0){W[G+Q]=S-B<<24|64<<16|0}E.bits=J;return 0}},{"../utils/common":27}],37:[function(g,f,e){f.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(J,k,al){var aw=J("../utils/common");var T=4;var t=0;var D=1;var E=2;function e(ay){var ax=ay.length;while(--ax>=0){ay[ax]=0}}var X=0;var an=1;var M=2;var av=3;var F=258;var q=29;var h=256;var i=h+1+q;var f=30;var w=19;var j=2*i+1;var ar=15;var z=16;var ag=7;var g=256;var I=16;var H=17;var N=18;var l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var x=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];var U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var V=512;var P=new Array((i+2)*2);e(P);var ab=new Array(f*2);e(ab);var ah=new Array(V);e(ah);var A=new Array(F-av+1);e(A);var O=new Array(q);e(O);var aq=new Array(f);e(aq);var ae=function(aA,az,ay,ax,aB){this.static_tree=aA;this.extra_bits=az;this.extra_base=ay;this.elems=ax;this.max_length=aB;this.has_stree=aA&&aA.length};var aj;var aa;var y;var au=function(ay,ax){this.dyn_tree=ay;this.max_code=0;this.stat_desc=ax};function ac(ax){return ax<256?ah[ax]:ah[256+(ax>>>7)]}function o(ay,ax){ay.pending_buf[ay.pending++]=ax&255;ay.pending_buf[ay.pending++]=ax>>>8&255}function ai(ax,az,ay){if(ax.bi_valid>z-ay){ax.bi_buf|=az<<ax.bi_valid&65535;o(ax,ax.bi_buf);ax.bi_buf=az>>z-ax.bi_valid;ax.bi_valid+=ay-z}else{ax.bi_buf|=az<<ax.bi_valid&65535;ax.bi_valid+=ay}}function am(ay,az,ax){ai(ay,ax[az*2],ax[az*2+1])}function B(az,ax){var ay=0;do{ay|=az&1;az>>>=1;ay<<=1}while(--ax>0);return ay>>>1}function v(ax){if(ax.bi_valid===16){o(ax,ax.bi_buf);ax.bi_buf=0;ax.bi_valid=0}else{if(ax.bi_valid>=8){ax.pending_buf[ax.pending++]=ax.bi_buf&255;ax.bi_buf>>=8;ax.bi_valid-=8}}}function n(aL,aG){var aM=aG.dyn_tree;var aH=aG.max_code;var aK=aG.stat_desc.static_tree;var az=aG.stat_desc.has_stree;var aB=aG.stat_desc.extra_bits;var ax=aG.stat_desc.extra_base;var aJ=aG.stat_desc.max_length;var aE;var ay,aA;var aI;var aD;var aF;var aC=0;for(aI=0;aI<=ar;aI++){aL.bl_count[aI]=0}aM[aL.heap[aL.heap_max]*2+1]=0;for(aE=aL.heap_max+1;aE<j;aE++){ay=aL.heap[aE];aI=aM[aM[ay*2+1]*2+1]+1;if(aI>aJ){aI=aJ;aC++}aM[ay*2+1]=aI;if(ay>aH){continue}aL.bl_count[aI]++;aD=0;if(ay>=ax){aD=aB[ay-ax]}aF=aM[ay*2];aL.opt_len+=aF*(aI+aD);if(az){aL.static_len+=aF*(aK[ay*2+1]+aD)}}if(aC===0){return}do{aI=aJ-1;while(aL.bl_count[aI]===0){aI--}aL.bl_count[aI]--;aL.bl_count[aI+1]+=2;aL.bl_count[aJ]--;aC-=2}while(aC>0);for(aI=aJ;aI!==0;aI--){ay=aL.bl_count[aI];while(ay!==0){aA=aL.heap[--aE];if(aA>aH){continue}if(aM[aA*2+1]!==aI){aL.opt_len+=(aI-aM[aA*2+1])*aM[aA*2];aM[aA*2+1]=aI}ay--}}}function ak(ay,aE,az){var aB=new Array(ar+1);var aA=0;var aC;var aD;for(aC=1;aC<=ar;aC++){aB[aC]=aA=aA+az[aC-1]<<1}for(aD=0;aD<=aE;aD++){var ax=ay[aD*2+1];if(ax===0){continue}ay[aD*2]=B(aB[ax]++,ax)}}function W(){var aC;var aA;var az;var ay;var aB;var ax=new Array(ar+1);az=0;for(ay=0;ay<q-1;ay++){O[ay]=az;for(aC=0;aC<1<<l[ay];aC++){A[az++]=ay}}A[az-1]=ay;aB=0;for(ay=0;ay<16;ay++){aq[ay]=aB;for(aC=0;aC<1<<x[ay];aC++){ah[aB++]=ay}}aB>>=7;for(;ay<f;ay++){aq[ay]=aB<<7;for(aC=0;aC<1<<x[ay]-7;aC++){ah[256+aB++]=ay}}for(aA=0;aA<=ar;aA++){ax[aA]=0}aC=0;while(aC<=143){P[aC*2+1]=8;aC++;ax[8]++}while(aC<=255){P[aC*2+1]=9;aC++;ax[9]++}while(aC<=279){P[aC*2+1]=7;aC++;ax[7]++}while(aC<=287){P[aC*2+1]=8;aC++;ax[8]++}ak(P,i+1,ax);for(aC=0;aC<f;aC++){ab[aC*2+1]=5;ab[aC*2]=B(aC,5)}aj=new ae(P,l,h+1,i,ar);aa=new ae(ab,x,0,f,ar);y=new ae(new Array(0),C,0,w,ag)}function L(ax){var ay;for(ay=0;ay<i;ay++){ax.dyn_ltree[ay*2]=0}for(ay=0;ay<f;ay++){ax.dyn_dtree[ay*2]=0}for(ay=0;ay<w;ay++){ax.bl_tree[ay*2]=0}ax.dyn_ltree[g*2]=1;ax.opt_len=ax.static_len=0;ax.last_lit=ax.matches=0}function m(ax){if(ax.bi_valid>8){o(ax,ax.bi_buf)}else{if(ax.bi_valid>0){ax.pending_buf[ax.pending++]=ax.bi_buf}}ax.bi_buf=0;ax.bi_valid=0}function s(az,ay,ax,aA){m(az);if(aA){o(az,ax);o(az,~ax)}aw.arraySet(az.pending_buf,az.window,ay,ax,az.pending);az.pending+=ax}function Z(ay,aC,ax,aB){var aA=aC*2;var az=ax*2;return ay[aA]<ay[az]||ay[aA]===ay[az]&&aB[aC]<=aB[ax]}function at(aB,ax,az){var ay=aB.heap[az];var aA=az<<1;while(aA<=aB.heap_len){if(aA<aB.heap_len&&Z(ax,aB.heap[aA+1],aB.heap[aA],aB.depth)){aA++}if(Z(ax,ay,aB.heap[aA],aB.depth)){break}aB.heap[az]=aB.heap[aA];az=aA;aA<<=1}aB.heap[az]=ay}function ap(ay,aE,aB){var aD;var aA;var aC=0;var az;var ax;if(ay.last_lit!==0){do{aD=ay.pending_buf[ay.d_buf+aC*2]<<8|ay.pending_buf[ay.d_buf+aC*2+1];aA=ay.pending_buf[ay.l_buf+aC];aC++;if(aD===0){am(ay,aA,aE)}else{az=A[aA];am(ay,az+h+1,aE);ax=l[az];if(ax!==0){aA-=O[az];ai(ay,aA,ax)}aD--;az=ac(aD);am(ay,az,aB);ax=x[az];if(ax!==0){aD-=aq[az];ai(ay,aD,ax)}}}while(aC<ay.last_lit)}am(ay,g,aE)}function Y(aF,aC){var aG=aC.dyn_tree;var aE=aC.stat_desc.static_tree;var az=aC.stat_desc.has_stree;var ax=aC.stat_desc.elems;var ay,aB;var aD=-1;var aA;aF.heap_len=0;aF.heap_max=j;for(ay=0;ay<ax;ay++){if(aG[ay*2]!==0){aF.heap[++aF.heap_len]=aD=ay;aF.depth[ay]=0}else{aG[ay*2+1]=0}}while(aF.heap_len<2){aA=aF.heap[++aF.heap_len]=aD<2?++aD:0;aG[aA*2]=1;aF.depth[aA]=0;aF.opt_len--;if(az){aF.static_len-=aE[aA*2+1]}}aC.max_code=aD;for(ay=aF.heap_len>>1;ay>=1;ay--){at(aF,aG,ay)}aA=ax;do{ay=aF.heap[1];aF.heap[1]=aF.heap[aF.heap_len--];at(aF,aG,1);aB=aF.heap[1];aF.heap[--aF.heap_max]=ay;aF.heap[--aF.heap_max]=aB;aG[aA*2]=aG[ay*2]+aG[aB*2];aF.depth[aA]=(aF.depth[ay]>=aF.depth[aB]?aF.depth[ay]:aF.depth[aB])+1;aG[ay*2+1]=aG[aB*2+1]=aA;aF.heap[1]=aA++;at(aF,aG,1)}while(aF.heap_len>=2);aF.heap[--aF.heap_max]=aF.heap[1];n(aF,aC);ak(aG,aD,aF.bl_count)}function r(aF,aG,aE){var ay;var aC=-1;var ax;var aA=aG[0*2+1];var aB=0;var az=7;var aD=4;if(aA===0){az=138;aD=3}aG[(aE+1)*2+1]=65535;for(ay=0;ay<=aE;ay++){ax=aA;aA=aG[(ay+1)*2+1];if(++aB<az&&ax===aA){continue}else{if(aB<aD){aF.bl_tree[ax*2]+=aB}else{if(ax!==0){if(ax!==aC){aF.bl_tree[ax*2]++}aF.bl_tree[I*2]++}else{if(aB<=10){aF.bl_tree[H*2]++}else{aF.bl_tree[N*2]++}}}}aB=0;aC=ax;if(aA===0){az=138;aD=3}else{if(ax===aA){az=6;aD=3}else{az=7;aD=4}}}}function u(aF,aG,aE){var ay;var aC=-1;var ax;var aA=aG[0*2+1];var aB=0;var az=7;var aD=4;if(aA===0){az=138;aD=3}for(ay=0;ay<=aE;ay++){ax=aA;aA=aG[(ay+1)*2+1];if(++aB<az&&ax===aA){continue}else{if(aB<aD){do{am(aF,ax,aF.bl_tree)}while(--aB!==0)}else{if(ax!==0){if(ax!==aC){am(aF,ax,aF.bl_tree);aB--}am(aF,I,aF.bl_tree);ai(aF,aB-3,2)}else{if(aB<=10){am(aF,H,aF.bl_tree);ai(aF,aB-3,3)}else{am(aF,N,aF.bl_tree);ai(aF,aB-11,7)}}}}aB=0;aC=ax;if(aA===0){az=138;aD=3}else{if(ax===aA){az=6;aD=3}else{az=7;aD=4}}}}function G(ay){var ax;r(ay,ay.dyn_ltree,ay.l_desc.max_code);r(ay,ay.dyn_dtree,ay.d_desc.max_code);Y(ay,ay.bl_desc);for(ax=w-1;ax>=3;ax--){if(ay.bl_tree[U[ax]*2+1]!==0){break}}ay.opt_len+=3*(ax+1)+5+5+4;return ax}function R(ay,az,ax,aA){var aB;ai(ay,az-257,5);ai(ay,ax-1,5);ai(ay,aA-4,4);for(aB=0;aB<aA;aB++){ai(ay,ay.bl_tree[U[aB]*2+1],3)}u(ay,ay.dyn_ltree,az-1);u(ay,ay.dyn_dtree,ax-1)}function Q(ay){var ax=4093624447;var az;for(az=0;az<=31;az++,ax>>>=1){if(ax&1&&ay.dyn_ltree[az*2]!==0){return t}}if(ay.dyn_ltree[9*2]!==0||ay.dyn_ltree[10*2]!==0||ay.dyn_ltree[13*2]!==0){return D}for(az=32;az<h;az++){if(ay.dyn_ltree[az*2]!==0){return D}}return t}var af=false;function K(ax){if(!af){W();af=true}ax.l_desc=new au(ax.dyn_ltree,aj);ax.d_desc=new au(ax.dyn_dtree,aa);ax.bl_desc=new au(ax.bl_tree,y);ax.bi_buf=0;ax.bi_valid=0;L(ax)}function S(az,ax,ay,aA){ai(az,(X<<1)+(aA?1:0),3);s(az,ax,ay,true)}function ad(ax){ai(ax,an<<1,3);am(ax,g,P);v(ax)}function p(aC,az,aB,aD){var ay,ax;var aA=0;if(aC.level>0){if(aC.strm.data_type===E){aC.strm.data_type=Q(aC)}Y(aC,aC.l_desc);Y(aC,aC.d_desc);aA=G(aC);ay=aC.opt_len+3+7>>>3;ax=aC.static_len+3+7>>>3;if(ax<=ay){ay=ax}}else{ay=ax=aB+5}if(aB+4<=ay&&az!==-1){S(aC,az,aB,aD)}else{if(aC.strategy===T||ax===ay){ai(aC,(an<<1)+(aD?1:0),3);ap(aC,P,ab)}else{ai(aC,(M<<1)+(aD?1:0),3);R(aC,aC.l_desc.max_code+1,aC.d_desc.max_code+1,aA+1);ap(aC,aC.dyn_ltree,aC.dyn_dtree)}}L(aC);if(aD){m(aC)}}function ao(ax,az,ay){ax.pending_buf[ax.d_buf+ax.last_lit*2]=az>>>8&255;ax.pending_buf[ax.d_buf+ax.last_lit*2+1]=az&255;ax.pending_buf[ax.l_buf+ax.last_lit]=ay&255;ax.last_lit++;if(az===0){ax.dyn_ltree[ay*2]++}else{ax.matches++;az--;ax.dyn_ltree[(A[ay]+h+1)*2]++;ax.dyn_dtree[ac(az)*2]++}return ax.last_lit===ax.lit_bufsize-1}al._tr_init=K;al._tr_stored_block=S;al._tr_flush_block=p;al._tr_tally=ao;al._tr_align=ad},{"../utils/common":27}],39:[function(g,f,e){function h(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}f.exports=h},{}]},{},[9])(9)});